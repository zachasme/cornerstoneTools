/*! cornerstone-tools - 1.1.0 - 2017-11-20 | (c) 2017 Chris Hafey | https://github.com/chafey/cornerstoneTools */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cornerstone-math")):"function"==typeof define&&define.amd?define("cornerstoneTools",["cornerstone-math"],t):"object"==typeof exports?exports.cornerstoneTools=t(require("cornerstone-math")):e.cornerstoneTools=t(e.cornerstoneMath)}(this,function(e){return function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=61)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.cornerstoneMath=void 0;var o=n(62),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o),r=window.cornerstone,i=window.$,l=window.Hammer,s={set cornerstone(e){r=e},get cornerstone(){return r},set $(e){i=e},get $(){return i},set Hammer(e){l=e},get Hammer(){return l}};t.cornerstoneMath=a,t.external=s},function(e,t,n){"use strict";function o(e){var t=u.external.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=d.globalImageIdSpecificToolStateManager),t.toolStateManager}function a(e,t,n){o(e).add(e,t,n);var a={toolType:t,element:e,measurementData:n};(0,f.default)(e,"CornerstoneToolsMeasurementAdded",a)}function r(e,t){return o(e).get(e,t)}function i(e,t,n){for(var a=o(e),r=a.get(e,t),i=-1,l=0;l<r.data.length;l++)r.data[l]===n&&(i=l);if(-1!==i){r.data.splice(i,1);var s={toolType:t,element:e,measurementData:n};(0,f.default)(e,"CornerstoneToolsMeasurementRemoved",s)}}function l(e,t){var n=o(e),a=n.get(e,t);void 0!==a&&(a.data=[])}function s(e,t){u.external.cornerstone.getEnabledElement(e).toolStateManager=t}Object.defineProperty(t,"__esModule",{value:!0}),t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=void 0;var u=n(0),d=n(15),c=n(3),f=function(e){return e&&e.__esModule?e:{default:e}}(c);t.addToolState=a,t.getToolState=r,t.removeToolState=i,t.clearToolState=l,t.setElementToolStateManager=s,t.getElementToolStateManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return 0!=(t&1<<e-1)}},function(e,t,n){"use strict";function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=void 0;"function"==typeof window.CustomEvent?o=new CustomEvent(t.toLocaleLowerCase(),{detail:n,cancelable:!0}):(o=document.createEvent("CustomEvent"),o.initCustomEvent(t.toLocaleLowerCase(),!0,!0,n));var r=a.external.$.Event(t,n);return a.external.$(e).trigger(r,n),!r.isImmediatePropagationStopped()&&e.dispatchEvent(o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var a=n(0)},function(e,t,n){"use strict";function o(e){f=e}function a(){return f}function r(e){d=e}function i(){return d}function l(e){c=e}function s(){return c}function u(e){return e?c:d}Object.defineProperty(t,"__esModule",{value:!0});var d="white",c="greenyellow",f="transparent",g={setFillColor:o,getFillColor:a,setToolColor:r,getToolColor:i,setActiveColor:l,getActiveColor:s,getColorIfActive:u};t.default=g},function(e,t,n){"use strict";function o(e){l=e}function a(){return l}function r(e){s=e}function i(){return s}Object.defineProperty(t,"__esModule",{value:!0});var l=1,s=2,u={setToolWidth:o,getToolWidth:a,setActiveWidth:r,getActiveWidth:i};t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r,i){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var l=a.default.getFont(),s=a.default.getFontSize(),u=a.default.getBackgroundColor();e.save(),e.font=l,e.textBaseline="top",e.strokeStyle=r;var d=0;t.forEach(function(t){var n=e.measureText(t).width;d=Math.max(d,n)}),e.fillStyle=u;var c={width:d+10,height:5+t.length*(s+5)};return i&&i.centering&&!0===i.centering.x&&(n-=c.width/2),i&&i.centering&&!0===i.centering.y&&(o-=c.height/2),c.left=n,c.top=o,i&&!0===i.debug&&(e.fillStyle="#FF0000"),e.fillRect(c.left,c.top,c.width,c.height),t.forEach(function(t,a){e.fillStyle=r,e.fillText(t,n+5,o+5+a*(s+5))}),e.restore(),c};var o=n(14),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){var i=a.external.cornerstone,l=t.element,s=e.createNewMeasurement(t);if(s){var u={mouseButtonMask:t.which};(0,y.addToolState)(t.element,e.toolType,s),a.external.$(l).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(l).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(l).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(l).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),i.updateImage(l);var d=void 0;d=1===Object.keys(s.handles).length?f.default:m.default;var c=void 0;c=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,d(t,e.toolType,s,s.handles.end,function(){s.active=!1,s.invalidated=!0,(0,x.default)(t,s.handles)&&(0,y.removeToolState)(l,e.toolType,s),a.external.$(l).on("CornerstoneToolsMouseMove",u,e.mouseMoveCallback||o),a.external.$(l).on("CornerstoneToolsMouseDown",u,e.mouseDownCallback||r),a.external.$(l).on("CornerstoneToolsMouseDownActivate",u,e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(l).on("CornerstoneToolsMouseDoubleClick",u,e.mouseDoubleClickCallback),i.updateImage(l)},c)}}function n(n,o){if((0,b.default)(o.which,n.data.mouseButtonMask))return e.addNewMeasurement?e.addNewMeasurement(o):t(o),!1}function o(t,n){if(i.default.setCoords(n),0===n.which){var o=(0,y.getToolState)(n.element,e.toolType);if(o){for(var r=!1,l=0;l<o.data.length;l++){var s=n.currentPoints.canvas,u=o.data[l];!0===(0,d.default)(n.element,u.handles,s)&&(r=!0),(e.pointNearTool(n.element,u,s)&&!u.active||!e.pointNearTool(n.element,u,s)&&u.active)&&(u.active=!u.active,r=!0)}!0===r&&a.external.cornerstone.updateImage(n.element)}}}function r(t,n){function r(){i.invalidated=!0,(0,x.default)(n,i.handles)&&(0,y.removeToolState)(l,e.toolType,i),a.external.cornerstone.updateImage(l),a.external.$(l).on("CornerstoneToolsMouseMove",n,e.mouseMoveCallback||o)}var i=void 0,l=n.element;if((0,b.default)(n.which,t.data.mouseButtonMask)){var u=n.startPoints.canvas,d=(0,y.getToolState)(t.currentTarget,e.toolType);if(d){var c=void 0,g=void 0;for(g=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,c=0;c<d.data.length;c++){i=d.data[c];var m=(0,s.default)(l,i.handles,u,6);if(m)return a.external.$(l).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),i.active=!0,(0,f.default)(n,e.toolType,i,m,r,g),t.stopImmediatePropagation(),!1}if(e.pointNearTool){var v=e.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(c=0;c<d.data.length;c++)if(i=d.data[c],i.active=!1,e.pointNearTool(l,i,u))return i.active=!0,a.external.$(l).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),(0,h.default)(t,i,d,e.toolType,v,r),t.stopImmediatePropagation(),!1}}}}function l(t){t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),a.external.cornerstone.updateImage(t)}function u(t){e.onImageRendered(t,t.detail)}function c(t){t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),t.addEventListener("cornerstoneimagerendered",u),a.external.cornerstone.updateImage(t)}function g(t,i){var l={mouseButtonMask:i};t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),t.addEventListener("cornerstoneimagerendered",u),a.external.$(t).on("CornerstoneToolsMouseMove",l,e.mouseMoveCallback||o),a.external.$(t).on("CornerstoneToolsMouseDown",l,e.mouseDownCallback||r),a.external.$(t).on("CornerstoneToolsMouseDownActivate",l,e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&(a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),a.external.$(t).on("CornerstoneToolsMouseDoubleClick",l,e.mouseDoubleClickCallback)),a.external.cornerstone.updateImage(t)}function v(t,i){var l={mouseButtonMask:i},s="CornerstoneToolsToolDeactivated",d={mouseButtonMask:i,toolType:e.toolType,type:s};(0,w.default)(t,s,d),t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),t.addEventListener("cornerstoneimagerendered",u),a.external.$(t).on("CornerstoneToolsMouseMove",l,e.mouseMoveCallback||o),a.external.$(t).on("CornerstoneToolsMouseDown",l,e.mouseDownCallback||r),e.mouseDoubleClickCallback&&(a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),a.external.$(t).on("CornerstoneToolsMouseDoubleClick",l,e.mouseDoubleClickCallback)),e.deactivate&&e.deactivate(t,i),a.external.cornerstone.updateImage(t)}function p(){return C}function T(e){C=e}var C={},M={enable:c,disable:l,activate:g,deactivate:v,getConfiguration:p,setConfiguration:T,mouseDownCallback:r,mouseMoveCallback:o,mouseDownActivateCallback:n};return e.pointNearTool&&(M.pointNearTool=e.pointNearTool),e.mouseDoubleClickCallback&&(M.mouseDoubleClickCallback=e.mouseDoubleClickCallback),e.addNewMeasurement&&(M.addNewMeasurement=e.addNewMeasurement),M};var a=n(0),r=n(36),i=o(r),l=n(18),s=o(l),u=n(37),d=o(u),c=n(22),f=o(c),g=n(23),m=o(g),v=n(38),h=o(v),p=n(12),x=o(p),T=n(2),b=o(T),y=n(1),C=n(3),w=o(C)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,l){e.strokeStyle=a,Object.keys(n).forEach(function(a){var s=n[a];if(!0!==s.drawnIndependently&&(!l||!0!==l.drawHandlesIfActive||s.active)){e.beginPath(),s.active?e.lineWidth=r.default.getActiveWidth():e.lineWidth=r.default.getToolWidth();var u=o.external.cornerstone.pixelToCanvas(t.element,s);e.arc(u.x,u.y,i,0,2*Math.PI),l&&l.fill&&(e.fillStyle=l.fill,e.fill()),e.stroke()}})};var o=n(0),a=n(5),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=6},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){Object.keys(e).forEach(function(t){e[t].active=!1})}function r(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&a(n.handles)}}function i(e){function t(t){var r=l.external.cornerstone,i=t.element,s=e.createNewMeasurement(t);if(s){if((0,x.addToolState)(i,e.toolType,s),1===Object.keys(s.handles).length&&"CornerstoneToolsTap"===t.type)return s.active=!1,s.handles.end.active=!1,s.handles.end.highlight=!1,s.invalidated=!0,(0,u.default)(t,s.handles)&&(0,x.removeToolState)(i,e.toolType,s),void r.updateImage(i);l.external.$(i).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),l.external.$(i).off("CornerstoneToolsTap",e.tapCallback||o),l.external.$(i).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),r.updateImage(i),(0,v.default)(t,e.toolType,s,s.handles.end,function(){s.active=!1,s.invalidated=!0,(0,u.default)(t,s.handles)&&(0,x.removeToolState)(i,e.toolType,s),l.external.$(i).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),l.external.$(i).on("CornerstoneToolsTap",e.tapCallback||o),l.external.$(i).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),r.updateImage(i)})}}function n(n,o){e.addNewMeasurement?e.addNewMeasurement(o):t(o),n.stopImmediatePropagation(),n.preventDefault()}function o(t,i){function s(){r(v),(0,u.default)(i,h.handles)&&(0,x.removeToolState)(f,e.toolType,h),d.updateImage(f),l.external.$(f).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(f).on("CornerstoneToolsTap",e.tapCallback||o)}var d=l.external.cornerstone,f=i.element,m=i.currentPoints.canvas,v=(0,x.getToolState)(t.currentTarget,e.toolType),h=void 0,T=void 0;if(r(v),v)for(T=0;T<v.data.length;T++){h=v.data[T];var b=(0,c.default)(f,h.handles,m,25);if(b)return l.external.$(f).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(f).off("CornerstoneToolsTap",e.tapCallback||o),h.active=!0,b.active=!0,d.updateImage(f),(0,g.default)(t,e.toolType,h,b,s),t.stopImmediatePropagation(),void t.preventDefault()}if(v&&e.pointNearTool)for(T=0;T<v.data.length;T++)if(h=v.data[T],e.pointNearTool(f,h,m))return l.external.$(f).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(f).off("CornerstoneToolsTap",e.tapCallback||o),h.active=!0,d.updateImage(f),(0,p.default)(t,h,v,e.toolType,!0,s),t.stopImmediatePropagation(),void t.preventDefault();return e.touchDownActivateCallback?e.touchDownActivateCallback(t,i):n(t,i),!1}function a(t,n){function r(t,r){f.active=!1,f.invalidated=!0,(0,u.default)(n,f.handles)&&(0,x.removeToolState)(n.element,e.toolType,f),i.updateImage(n.element),l.external.$(s).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(s).on("CornerstoneToolsTap",e.tapCallback||o),e.pressCallback&&l.external.$(s).on("CornerstoneToolsTouchPress",e.pressCallback),t&&"CornerstoneToolsTouchPress"===t.type&&(0,b.default)(s,t.type,r)}var i=l.external.cornerstone,s=n.element,d=n.startPoints.canvas,f=void 0,m=(0,x.getToolState)(t.currentTarget,e.toolType),v=void 0;if(m){for(v=0;v<m.data.length;v++){f=m.data[v];var h=(0,c.default)(n.element,f.handles,d,28);if(h)return l.external.$(s).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(s).off("CornerstoneToolsTap",e.tapCallback||o),e.pressCallback&&l.external.$(s).off("CornerstoneToolsTouchPress",e.pressCallback),f.active=!0,(0,g.default)(t,e.toolType,f,h,r),t.stopImmediatePropagation(),void t.preventDefault()}if(e.pointNearTool)for(v=0;v<m.data.length;v++)if(f=m.data[v],e.pointNearTool(n.element,f,d))return l.external.$(s).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(s).off("CornerstoneToolsTap",e.tapCallback||o),e.pressCallback&&l.external.$(s).off("CornerstoneToolsTouchPress",e.pressCallback),(0,p.default)(t,f,m,e.toolType,!0,r),t.stopImmediatePropagation(),void t.preventDefault()}}function i(t){t.removeEventListener("cornerstoneimagerendered",f),l.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),l.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),e.doubleTapCallback&&l.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&l.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),l.external.cornerstone.updateImage(t)}function s(t){t.removeEventListener("cornerstoneimagerendered",f),l.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),l.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),t.addEventListener("cornerstoneimagerendered",f),e.doubleTapCallback&&l.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&l.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),l.external.cornerstone.updateImage(t)}function d(t){t.removeEventListener("cornerstoneimagerendered",f),l.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),l.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),t.addEventListener("cornerstoneimagerendered",f),l.external.$(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(t).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),l.external.$(t).on("CornerstoneToolsTap",e.tapCallback||o),e.doubleTapCallback&&(l.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),l.external.$(t).on("CornerstoneToolsDoubleTap",e.doubleTapCallback)),e.pressCallback&&(l.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),l.external.$(t).on("CornerstoneToolsTouchPress",e.pressCallback)),l.external.cornerstone.updateImage(t)}function f(t){e.onImageRendered(t,t.detail)}function m(t){var r="CornerstoneToolsToolDeactivated",i={toolType:e.toolType,type:r};(0,b.default)(t,r,i),t.removeEventListener("cornerstoneimagerendered",f),l.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),l.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),l.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),t.addEventListener("cornerstoneimagerendered",f),l.external.$(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),e.doubleTapCallback&&l.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&l.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),l.external.cornerstone.updateImage(t)}var h={enable:s,disable:i,activate:d,deactivate:m,touchStartCallback:e.touchStartCallback||a,touchDownActivateCallback:e.touchDownActivateCallback||n,tapCallback:e.tapCallback||o};return e.pointNearTool&&(h.pointNearTool=e.pointNearTool),e.doubleTapCallback&&(h.doubleTapCallback=e.doubleTapCallback),e.pressCallback&&(h.pressCallback=e.pressCallback),e.addNewMeasurement&&(h.addNewMeasurement=e.addNewMeasurement),h}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),s=n(12),u=o(s),d=n(18),c=o(d),f=n(53),g=o(f),m=n(25),v=o(m),h=n(52),p=o(h),x=n(1),T=n(3),b=o(T);t.default=i},function(e,t,n){"use strict";function o(e){u=e}function a(){return u}function r(e){d=e}function i(){return d}function l(e){c=e}function s(){return c}Object.defineProperty(t,"__esModule",{value:!0});var u=void 0,d=void 0,c=void 0,f={setStartLoadHandler:o,getStartLoadHandler:a,setEndLoadHandler:r,getEndLoadHandler:i,setErrorLoadingHandler:l,getErrorLoadingHandler:s};t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n="CornerstoneToolsTouchDrag";return t&&!0===t.fireOnTouchStart&&(n+=" CornerstoneToolsTouchStart"),{activate:function(a){o.external.$(a).off(n,e),t&&t.eventData?o.external.$(a).on(n,t.eventData,e):o.external.$(a).on(n,e),t&&t.activateCallback&&t.activateCallback(a)},disable:function(a){o.external.$(a).off(n,e),t&&t.disableCallback&&t.disableCallback(a)},enable:function(a){o.external.$(a).off(n,e),t&&t.enableCallback&&t.enableCallback(a)},deactivate:function(a){o.external.$(a).off(n,e),t&&t.deactivateCallback&&t.deactivateCallback(a)}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},r=!1;return Object.keys(t).forEach(function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===o.cornerstoneMath.point.insideRect(n,a)&&(r=!0)}),r};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t,n,a){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e);var r={mouseButtonMask:n,options:a};o.external.$(t).on("CornerstoneToolsMouseDownActivate",r,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var o=n(0)},function(e,t,n){"use strict";function o(e){d=e}function a(){return d}function r(e){u=e}function i(){return u}function l(e){c=e}function s(){return c}Object.defineProperty(t,"__esModule",{value:!0});var u=15,d=u+"px Arial",c="transparent",f={setFont:o,getFont:a,setFontSize:r,getFontSize:i,setBackgroundColor:l,getBackgroundColor:s};t.default=f},function(e,t,n){"use strict";function o(){function e(e){return s[e]}function t(e,t){s[e]=t}function n(){return s}function o(e){s=e}function r(e,t,n){var o=a.external.cornerstone.getEnabledElement(e);o.image&&!1!==s.hasOwnProperty(o.image.imageId)||(s[o.image.imageId]={});var r=s[o.image.imageId];!1===r.hasOwnProperty(t)&&(r[t]={data:[]}),r[t].data.push(n)}function i(e,t){var n=a.external.cornerstone.getEnabledElement(e);if(n.image&&!1!==s.hasOwnProperty(n.image.imageId)){var o=s[n.image.imageId];if(!1!==o.hasOwnProperty(t)){return o[t]}}}function l(e){var t=a.external.cornerstone.getEnabledElement(e);t.image&&!1!==s.hasOwnProperty(t.image.imageId)&&delete s[t.image.imageId]}var s={};return{get:i,add:r,clear:l,saveImageIdToolState:e,restoreImageIdToolState:t,saveToolState:n,restoreToolState:o,toolState:s}}Object.defineProperty(t,"__esModule",{value:!0}),t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=void 0;var a=n(0),r=o();t.newImageIdSpecificToolStateManager=o,t.globalImageIdSpecificToolStateManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.boundingBox)return o.cornerstoneMath.point.insideRect(t,e.boundingBox)};var o=n(0)},function(e,t,n){"use strict";function o(e){return parseFloat("."+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=a.external.cornerstone,r=n.metaData.get("patientStudyModule",e.imageId),i=n.metaData.get("generalSeriesModule",e.imageId);if(r&&i){if("PT"===i.modality){var l=t*e.slope+e.intercept,s=r.patientWeight;if(s){var u=n.metaData.get("petIsotopeModule",e.imageId);if(u){var d=u.radiopharmaceuticalInfo,c=d.radiopharmaceuticalStartTime,f=d.radionuclideTotalDose,g=d.radionuclideHalfLife,m=i.seriesTime;if(c&&f&&g&&m){var v=o(m.fractionalSeconds||0)+m.seconds+60*m.minutes+60*m.hours*60,h=o(c.fractionalSeconds)+c.seconds+60*c.minutes+60*c.hours*60,p=v-h;return l*s/(f*Math.exp(-p*Math.log(2)/g))*1e3}}}}}};var a=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){var i=void 0;if(t)return Object.keys(t).forEach(function(l){var s=t[l];if(s.hasOwnProperty("pointNearHandle")){if(s.pointNearHandle(e,s,n))return void(i=s)}else if(!0===s.hasBoundingBox){if((0,r.default)(s,n))return void(i=s)}else{var u=o.external.cornerstone.pixelToCanvas(e,s),d=o.cornerstoneMath.point.distance(u,n);if(d<=a)return void(i=s)}}),i};var o=n(0),a=n(16),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){/*! cornerstone-core - 1.0.1 - 2017-11-04 | (c) 2016 Chris Hafey | https://github.com/chafey/cornerstone */
!function(t,n){e.exports=n()}(0,function(){return function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=34)}([function(e,t,n){"use strict";function o(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<l.length;t++)if(l[t].element===e)return l[t];throw new Error("element not enabled")}function a(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");l.push(e)}function r(e){var t=[];return l.forEach(function(n){n.image&&n.image.imageId===e&&t.push(n)}),t}function i(){return l}Object.defineProperty(t,"__esModule",{value:!0}),t.getEnabledElement=o,t.addEnabledElement=a,t.getEnabledElementsByImageId=r,t.getEnabledElements=i;var l=[]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=window.$,a={set $(e){o=e},get $(){return o}};t.external=a},function(e,t,n){"use strict";function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=t.toLocaleLowerCase();var o=new CustomEvent(t,{detail:n});e.dispatchEvent(o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,o.getEnabledElement)(e);if(void 0===n.image&&!n.layers.length)throw new Error("updateImage: image has not been loaded yet");(0,r.default)(n,t)};var o=n(0),a=n(4),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.needsRedraw=!0,t&&(e.invalid=!0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(void 0===t)throw new Error("getDefaultViewport: parameter image must not be undefined");var n={scale:1,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT},o=e.height/t.rows,a=e.width/t.columns;return n.scale=Math.min(a,o),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return window.performance?performance.now():Date.now()}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=e.renderingTools.colorRenderCanvas;n.width=t.width,n.height=t.height;var o=n.getContext("2d");o.fillStyle="white",o.fillRect(0,0,n.width,n.height);var a=o.getImageData(0,0,t.width,t.height);e.renderingTools.colorRenderCanvasContext=o,e.renderingTools.colorRenderCanvasData=a}function r(e,t){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&e.cachedLut.invert===t.invert?e.cachedLut.lutArray:((0,c.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.lutArray)}function i(e,t){var n=e.renderingTools.lastRenderedImageId,o=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!o||o.windowCenter!==e.viewport.voi.windowCenter||o.windowWidth!==e.viewport.voi.windowWidth||o.invert!==e.viewport.invert||o.rotation!==e.viewport.rotation||o.hflip!==e.viewport.hflip||o.vflip!==e.viewport.vflip}function l(e,t,n){e.renderingTools.colorRenderCanvas||(e.renderingTools.colorRenderCanvas=document.createElement("canvas"));var o=e.renderingTools.colorRenderCanvas;if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===i(e,t)&&!0!==n)return o;o.width===t.width&&o.height===t.height||a(e,t);var l=window.performance?performance.now():Date.now(),s=r(t,e.viewport);t.stats=t.stats||{},t.stats.lastLutGenerateTime=(window.performance?performance.now():Date.now())-l;var u=e.renderingTools.colorRenderCanvasData,d=e.renderingTools.colorRenderCanvasContext;return t.rgba?(0,v.default)(t,s,u.data):(0,g.default)(t,s,u.data),l=window.performance?performance.now():Date.now(),d.putImageData(u,0,0),t.stats.lastPutImageDataTime=(window.performance?performance.now():Date.now())-l,o}function s(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var o=e.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),!0===e.viewport.pixelReplication?(o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1):(o.imageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0),o.save(),(0,p.default)(e,o);var a=void 0;a=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?T.default.renderer.render(e):l(e,n,t),o.drawImage(a,0,0,n.width,n.height,0,0,n.width,n.height),o.restore(),e.renderingTools.lastRenderedImageId=n.imageId;var r={};r.windowCenter=e.viewport.voi.windowCenter,r.windowWidth=e.viewport.voi.windowWidth,r.invert=e.viewport.invert,r.rotation=e.viewport.rotation,r.hflip=e.viewport.hflip,r.vflip=e.viewport.vflip,e.renderingTools.lastRenderedViewport=r}function u(e,t){if(void 0===e)throw new Error("addColorLayer: layer parameter must not be undefined");var n=e.image;if(n.rgba=!0,void 0===n)throw new Error("addColorLayer: image must be loaded before it can be drawn");e.renderingTools=e.renderingTools||{},e.canvas=l(e,n,t);var o=e.canvas.getContext("2d");!0===e.viewport.pixelReplication?(o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1):(o.imageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0);var a={windowCenter:e.viewport.voi.windowCenter,windowWidth:e.viewport.voi.windowWidth,invert:e.viewport.invert,rotation:e.viewport.rotation,hflip:e.viewport.hflip,vflip:e.viewport.vflip};e.renderingTools.lastRenderedImageId=n.imageId,e.renderingTools.lastRenderedViewport=a}Object.defineProperty(t,"__esModule",{value:!0}),t.renderColorImage=s,t.addColorLayer=u;var d=n(9),c=o(d),f=n(16),g=o(f),m=n(37),v=o(m),h=n(8),p=o(h),x=n(11),T=o(x)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");var o=(0,a.default)(e,n);t.setTransform(o.m[0],o.m[1],o.m[2],o.m[3],o.m[4],o.m[5])};var o=n(17),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,a,i){if(void 0===e.cachedLut){var s=e.maxPixelValue-Math.min(e.minPixelValue,0)+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(s)}var u=e.cachedLut.lutArray,d=e.maxPixelValue,c=e.minPixelValue,f=(0,r.default)(e.slope,e.intercept,a),g=(0,l.default)(t,n,i),m=0;if(c<0&&(m=c),!0===o)for(var v=e.minPixelValue;v<=d;v++)u[v+-m]=255-g(f(v));else for(var h=e.minPixelValue;h<=d;h++)u[h+-m]=g(f(h));return u};var a=n(19),r=o(a),i=n(35),l=o(i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,a.default)(e)};var o=n(17),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(38),r=n(22),i=o(r),l=n(21),s=o(l),u={createProgramFromString:i.default,renderer:{render:a.render,initRenderer:a.initRenderer,getRenderCanvas:a.getRenderCanvas,isWebGLAvailable:a.isWebGLAvailable},textureCache:s.default};Object.defineProperty(u,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return a.isWebGLInitialized}}),t.default=u},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(){function e(){o(this,e),this.listeners={}}return a(e,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],o=0,a=n.length;o<a;o++)if(n[o]===t)return void n.splice(o,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type],n=0,o=t.length;n<o;n++)t[n].call(this,e);return!e.defaultPrevented}}]),e}(),i=new r;t.default=i},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=e.renderingTools.grayscaleRenderCanvas;n.width=t.width,n.height=t.height;var o=n.getContext("2d");o.fillStyle="white",o.fillRect(0,0,n.width,n.height);var a=o.getImageData(0,0,t.width,t.height);e.renderingTools.grayscaleRenderCanvasContext=o,e.renderingTools.grayscaleRenderCanvasData=a}function r(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}function i(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&r(e.cachedLut.modalityLUT,t.modalityLUT)&&r(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n?e.cachedLut.lutArray:((0,f.default)(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT,e.cachedLut.lutArray)}function l(e,t){var n=e.renderingTools.lastRenderedImageId,o=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!o||o.windowCenter!==e.viewport.voi.windowCenter||o.windowWidth!==e.viewport.voi.windowWidth||o.invert!==e.viewport.invert||o.rotation!==e.viewport.rotation||o.hflip!==e.viewport.hflip||o.vflip!==e.viewport.vflip||o.modalityLUT!==e.viewport.modalityLUT||o.voiLUT!==e.viewport.voiLUT}function s(e,t,n){e.renderingTools.grayscaleRenderCanvas||(e.renderingTools.grayscaleRenderCanvas=document.createElement("canvas"));var o=e.renderingTools.grayscaleRenderCanvas;if(!1===l(e,t)&&!0!==n)return o;o.width===t.width&&o.height===t.height||a(e,t);var r=(0,x.default)(),s=i(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=(0,x.default)()-r;var u=e.renderingTools.grayscaleRenderCanvasData,d=e.renderingTools.grayscaleRenderCanvasContext;return(0,m.default)(t,s,u.data),r=(0,x.default)(),d.putImageData(u,0,0),t.stats.lastPutImageDataTime=(0,x.default)()-r,o}function u(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var o=e.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),!0===e.viewport.pixelReplication?(o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1):(o.imageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0),(0,h.default)(e,o),e.renderingTools||(e.renderingTools={});var a=void 0;a=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?b.default.renderer.render(e):s(e,n,t),o.drawImage(a,0,0,n.width,n.height,0,0,n.width,n.height),e.renderingTools.lastRenderedImageId=n.imageId;var r={};r.windowCenter=e.viewport.voi.windowCenter,r.windowWidth=e.viewport.voi.windowWidth,r.invert=e.viewport.invert,r.rotation=e.viewport.rotation,r.hflip=e.viewport.hflip,r.vflip=e.viewport.vflip,r.modalityLUT=e.viewport.modalityLUT,r.voiLUT=e.viewport.voiLUT,e.renderingTools.lastRenderedViewport=r}function d(e,t){if(void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.renderingTools=e.renderingTools||{},e.canvas=s(e,n,t);var o=e.canvas.getContext("2d");!0===e.viewport.pixelReplication?(o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1):(o.imageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0);var a={windowCenter:e.viewport.voi.windowCenter,windowWidth:e.viewport.voi.windowWidth,invert:e.viewport.invert,rotation:e.viewport.rotation,hflip:e.viewport.hflip,vflip:e.viewport.vflip};e.renderingTools.lastRenderedImageId=n.imageId,e.renderingTools.lastRenderedViewport=a}Object.defineProperty(t,"__esModule",{value:!0}),t.renderGrayscaleImage=u,t.addGrayscaleLayer=d;var c=n(9),f=o(c),g=n(15),m=o(g),v=n(8),h=o(v),p=n(6),x=o(p),T=n(11),b=o(T)},function(e,t,n){"use strict";function o(e){window.setTimeout(e,1e3/60)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||o(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var o=(0,a.default)(),r=e.getPixelData();e.stats.lastGetPixelDataTime=(0,a.default)()-o;var i=r.length,l=e.minPixelValue,s=3,u=0;if(o=(0,a.default)(),r instanceof Int16Array)if(l<0)for(;u<i;)n[s]=t[r[u++]+-l],s+=4;else for(;u<i;)n[s]=t[r[u++]],s+=4;else if(r instanceof Uint16Array)for(;u<i;)n[s]=t[r[u++]],s+=4;else if(l<0)for(;u<i;)n[s]=t[r[u++]+-l],s+=4;else for(;u<i;)n[s]=t[r[u++]],s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,a.default)()-o};var o=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var o=(0,a.default)(),r=e.getPixelData();e.stats.lastGetPixelDataTime=(0,a.default)()-o;var i=e.minPixelValue,l=0,s=0,u=r.length;if(o=(0,a.default)(),i<0)for(;s<u;)n[l++]=t[r[s++]+-i],n[l++]=t[r[s++]+-i],n[l]=t[r[s]+-i],s+=2,l+=2;else for(;s<u;)n[l++]=t[r[s++]],n[l++]=t[r[s++]],n[l]=t[r[s]],s+=2,l+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,a.default)()-o};var o=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=new o.Transform;n.translate(e.canvas.width/2,e.canvas.height/2);var a=e.viewport.rotation;0!==a&&n.rotate(a*Math.PI/180);var r=e.viewport.scale,i=e.viewport.scale;return e.image.rowPixelSpacing<e.image.columnPixelSpacing?r*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(i*=e.image.rowPixelSpacing/e.image.columnPixelSpacing),n.scale(r,i),0!==a&&n.rotate(-a*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==a&&n.rotate(a*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-e.image.width/2,-e.image.height/2),n};var o=n(20)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var o=t.element,a={viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n};g.external.$(o).trigger(e,a),(0,M.default)(o,e,a)}function r(e,t){var n=e.image,o=t.image;if(n.imageId&&o.imageId){var a=x.default.get("imagePlane",n.imageId),r=x.default.get("imagePlane",o.imageId);if(a&&a.columnPixelSpacing&&r&&r.columnPixelSpacing){var i=r.columnPixelSpacing*o.width/(a.columnPixelSpacing*n.width),l=t.viewport.scale/e.viewport.scale*i;t.viewport.scale=e.viewport.scale*l}}}function i(e,t,n){var o=(0,v.default)(),i=(0,h.getEnabledElement)(e),l=i.layers,s=(0,b.default)(i.canvas,t);n&&n.viewport&&(s=Object.assign(s,n.viewport)),!1!==i.syncViewports&&(i.syncViewports=!0);var u={image:t,layerId:o,viewport:s,options:n||{}};return l.length&&r(l[0],u),l.push(u),1===l.length&&c(e,o),a("CornerstoneLayerAdded",i,o),o}function l(e,t){var n=(0,h.getEnabledElement)(e),o=n.layers,r=n.layers.findIndex(function(e){return e.layerId===t});-1!==r&&(o.splice(r,1),t===n.activeLayerId&&o.length&&c(e,o[0].layerId),a("CornerstoneLayerRemoved",n,t))}function s(e,t){return(0,h.getEnabledElement)(e).layers.find(function(e){return e.layerId===t})}function u(e){return(0,h.getEnabledElement)(e).layers}function d(e){return(0,h.getEnabledElement)(e).layers.filter(function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity})}function c(e,t){var n=(0,h.getEnabledElement)(e);if(n.activeLayerId!==t){var o=n.layers.findIndex(function(e){return e.layerId===t});if(-1===o)throw new Error("setActiveLayer: layer not found in layers array");var r=n.layers[o];n.activeLayerId=t,n.image=r.image,n.viewport=r.viewport,(0,C.default)(e),a("CornerstoneActiveLayerChanged",n,t)}}function f(e){var t=(0,h.getEnabledElement)(e);return t.layers.find(function(e){return e.layerId===t.activeLayerId})}Object.defineProperty(t,"__esModule",{value:!0}),t.addLayer=i,t.removeLayer=l,t.getLayer=s,t.getLayers=u,t.getVisibleLayers=d,t.setActiveLayer=c,t.getActiveLayer=f;var g=n(1),m=n(49),v=o(m),h=n(0),p=n(24),x=o(p),T=n(5),b=o(T),y=n(3),C=o(y),w=n(2),M=o(w)},function(e,t,n){"use strict";function o(e,t){var n=e,o=t;return function(e){return e*n+o}}function a(e){var t=e.lut[0],n=e.lut[e.lut.length-1],o=e.firstValueMapped+e.lut.length;return function(a){return a<e.firstValueMapped?t:a>=o?n:e.lut[a]}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return n?a(n):o(e,t)}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Transform=function(){function e(){o(this,e),this.reset()}return a(e,[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],o=this.m[0]*e.m[2]+this.m[2]*e.m[3],a=this.m[1]*e.m[2]+this.m[3]*e.m[3],r=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],i=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=a,this.m[4]=r,this.m[5]=i}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,o=-this.m[2]*e,a=this.m[0]*e,r=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),i=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=a,this.m[4]=r,this.m[5]=i}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),o=this.m[0]*t+this.m[2]*n,a=this.m[1]*t+this.m[3]*n,r=this.m[0]*-n+this.m[2]*t,i=this.m[1]*-n+this.m[3]*t;this.m[0]=o,this.m[1]=a,this.m[2]=r,this.m[3]=i}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,o=t;return e=n*this.m[0]+o*this.m[2]+this.m[4],t=n*this.m[1]+o*this.m[3]+this.m[5],{x:e,y:t}}}]),e}()},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(){return{maximumSizeInBytes:x,cacheSizeInBytes:T,numberOfImagesCached:p.length}}function r(){function e(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}if(!(T<=x)){for(p.sort(e);T>x;){var t=p[p.length-1];T-=t.sizeInBytes,delete h[t.imageId],p.pop(),c.external.$(g.default).trigger("CornerstoneWebGLTextureRemoved",{imageId:t.imageId}),(0,v.default)(g.default,"CornerstoneWebGLTextureRemoved",{imageId:t.imageId})}var n=a();c.external.$(g.default).trigger("CornerstoneWebGLTextureCacheFull",n),(0,v.default)(g.default,"CornerstoneWebGLTextureCacheFull",n)}}function i(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");x=e,r()}function l(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(h,n))throw new Error("putImageTexture: imageId already in cache");var o={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes};if(h[n]=o,p.push(o),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");T+=o.sizeInBytes,r()}function s(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");var t=h[e];if(void 0!==t)return t.timeStamp=new Date,t.imageTexture}function u(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=h[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return p.splice(p.indexOf(t),1),T-=t.sizeInBytes,delete h[e],t.imageTexture}function d(){for(;p.length>0;){var e=p.pop();delete h[e.imageId]}T=0}Object.defineProperty(t,"__esModule",{value:!0});var c=n(1),f=n(12),g=o(f),m=n(2),v=o(m),h={},p=[],x=268435456,T=0;t.default={purgeCache:d,getImageTexture:s,putImageTexture:l,removeImageTexture:u,setMaximumSizeBytes:i}},function(e,t,n){"use strict";function o(e,t,n){var o=e.createShader(n);if(e.shaderSource(o,t),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)&&!e.isContextLost()){var a=e.getShaderInfoLog(o);console.error("Could not compile shader:\n"+a)}return o}function a(e,t,n){var o=e.createProgram();if(e.attachShader(o,t),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)&&!e.isContextLost()){var a=e.getProgramInfoLog(o);console.error("WebGL program filed to link:\n"+a)}return o}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return a(e,o(e,t,e.VERTEX_SHADER),o(e,n,e.FRAGMENT_SHADER))}},function(e,t,n){"use strict";function o(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var o=e.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0),o.fillStyle="black",o.fillRect(0,0,e.canvas.width,e.canvas.height),!0===e.viewport.pixelReplication?(o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1):(o.imageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0),(0,r.default)(e,o),e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert?o.drawImage(n.getImage(),0,0,n.width,n.height,0,0,n.width,n.height):(0,i.renderColorImage)(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.renderWebImage=o;var a=n(8),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=n(7)},function(e,t,n){"use strict";function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=void 0;for(n=0;n<i.length&&!(i[n].priority<=t);n++);i.splice(n,0,{priority:t,provider:e})}function a(e){for(var t=0;t<i.length;t++)if(i[t].provider===e){i.splice(t,1);break}}function r(e,t){for(var n=0;n<i.length;n++){var o=i[n].provider(e,t);if(void 0!==o)return o}}Object.defineProperty(t,"__esModule",{value:!0}),t.addProvider=o,t.removeProvider=a;var i=[];t.default={addProvider:o,removeProvider:a,get:r}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){t.width!==e.clientWidth&&(t.width=e.clientWidth,t.style.width=e.clientWidth+"px"),t.height!==e.clientHeight&&(t.height=e.clientHeight,t.style.height=e.clientHeight+"px")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,i.getEnabledElement)(e);a(e,n.canvas);var o={element:e};r.external.$(e).trigger("CornerstoneElementResized",o),(0,f.default)(e,"CornerstoneElementResized",o),void 0!==n.image&&(!0===t?(0,s.default)(e):(0,d.default)(e))};var r=n(1),i=n(0),l=n(26),s=o(l),u=n(3),d=o(u),c=n(2),f=o(c)},function(e,t,n){"use strict";function o(e){return 0===e.viewport.rotation||180===e.viewport.rotation?{width:e.image.width,height:e.image.height}:{width:e.image.height,height:e.image.width}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,a.getEnabledElement)(e),n=o(t),r=t.canvas.height/n.height,l=t.canvas.width/n.width;t.viewport.scale=Math.min(l,r),t.viewport.translation.x=0,t.viewport.translation.y=0,(0,i.default)(e)};var a=n(0),r=n(3),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";function o(e){for(var t=Number.MAX_VALUE,n=Number.MIN_VALUE,o=e.length,a=void 0,r=0;r<o;r++)a=e[r],t=t<a?t:a,n=n>a?n:a;return{minPixelValue:t,maxPixelValue:n}}function a(e){if(e.restore)return e.restore;var t=e.color,n=e.rgba,o=e.cachedLut,a=e.slope,r=e.windowWidth,i=e.windowCenter,l=e.minPixelValue,s=e.maxPixelValue;return function(){if(e.color=t,e.rgba=n,e.cachedLut=o,e.slope=a,e.windowWidth=r,e.windowCenter=i,e.minPixelValue=l,e.maxPixelValue=s,e.origPixelData){var u=e.origPixelData;e.getPixelData=function(){return u}}e.origPixelData=void 0,e.colormapId=void 0,e.falseColor=void 0}}function r(e){return e&&"string"==typeof e&&(e=(0,f.getColormap)(e)),e}function i(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function l(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");t=r(t);var n=t.getId();if(e.colormapId===n)return!1;if(i(e),n){var l=e.minPixelValue||0,s=e.maxPixelValue||255;e.restore=a(e);var u=t.createLookupTable();u.setTableRange(l,s),(0,c.default)(e,u);var d=o(e.getPixelData());e.minPixelValue=d.minPixelValue,e.maxPixelValue=d.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=n}return!0}function s(e,t){return l((0,u.getEnabledElement)(e).image,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.restoreImage=t.convertToFalseColorImage=t.convertImageToFalseColorImage=void 0;var u=n(0),d=n(28),c=function(e){return e&&e.__esModule?e:{default:e}}(d),f=n(30);t.convertImageToFalseColorImage=l,t.convertToFalseColorImage=s,t.restoreImage=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n=e.minPixelValue,o=0,r=0,i=e.width*e.height,l=e.origPixelData||e.getPixelData(),s=new Uint8Array(4*i),u=t,d=void 0,c=void 0;if(e.color=!0,e.falseColor=!0,e.origPixelData=l,t instanceof a.default.LookupTable)for(t.build();r<i;)d=l[r++],c=t.mapValue(d),s[o++]=c[0],s[o++]=c[1],s[o++]=c[2],s[o++]=c[3];else if(n<0)for(;r<i;)d=l[r++],s[o++]=u[d+-n][0],s[o++]=u[d+-n][1],s[o++]=u[d+-n][2],s[o++]=u[d+-n][3];else for(;r<i;)d=l[r++],s[o++]=u[d][0],s[o++]=u[d][1],s[o++]=u[d][2],s[o++]=u[d][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return s}};var o=n(29),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(30),a=n(31),r=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={getColormap:o.getColormap,getColormapsList:o.getColormapsList,LookupTable:r.default}},function(e,t,n){"use strict";function o(e,t,n){n=null===n?100:n;for(var o=(t-e)/(n-1),a=[];n-- >0;)a.push(e),e+=o;return a[a.length-1]=t,a}function a(e,t){for(var n=0,o=e.length-1;n<=o;){var a=n+Math.floor((o-n)/2),r=e[a];if(r===t)return a;t<r?o=a-1:n=a+1}return n}function r(e,t){var n=void 0,o=[],r=t.length;for(e.sort(function(e,t){return e-t}),n=0;n<r;n++)o[n]=a(e,t[n]);return o}function i(e,t,n){var a=void 0,i=[],l=[],s=[],u=[];for(n=null===n?1:n,a=0;a<t.length;a++){var d=t[a];i.push((e-1)*d[0]),l.push(d[1]),s.push(d[1])}var c=o(0,1,e);for(a=0;a<e;a++)c[a]=(e-1)*Math.pow(c[a],n);var f=r(i,c);for(a=1;a<e-1;a++){var g=f[a],m=(c[a]-i[g-1])/(i[g]-i[g-1]),v=l[g]-s[g-1];u[a]=m*v+s[g-1]}return u[0]=s[0],u[e-1]=l[t.length-1],u}function l(e,t,n){var o=void 0,a=[];t=null===t?256:t,n=null===n?1:n;var r=i(t,e.red,n),l=i(t,e.green,n),s=i(t,e.blue,n);for(o=0;o<t;o++){var u=Math.round(255*r[o]),d=Math.round(255*l[o]),c=Math.round(255*s[o]),f=[u,d,c,255];a.push(f)}return a}function s(){var e=[];return Object.keys(g).forEach(function(t){if(g.hasOwnProperty(t)){var n=g[t];e.push({id:t,name:n.name})}}),e.sort(function(e,t){var n=e.name.toLowerCase(),o=t.name.toLowerCase();return n===o?0:n<o?-1:1}),e}function u(e,t){var n=g[e];return n||(n=g[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=l(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(f);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:f},getColorRepeating:function(e){var t=n.colors.length;return e=t?e%t:0,this.getColor(e)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=void 0,o=n.colors.length;for(e.setNumberOfTableValues(o),t=0;t<o;t++)e.setTableValue(t,n.colors[t])}},createLookupTable:function(){var e=new c.default;return this.buildLookupTable(e),e},isValidIndex:function(e){return e>=0&&e<n.colors.length}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getColormapsList=s,t.getColormap=u;var d=n(31),c=function(e){return e&&e.__esModule?e:{default:e}}(d),f=[0,0,0,255],g={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}}},function(e,t,n){"use strict";function o(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[],this.setNumberOfTableValues=function(e){this.NumberOfColors=e},this.setRamp=function(e){this.Ramp=e},this.setTableRange=function(e,t){this.TableRange[0]=e,this.TableRange[1]=t},this.setHueRange=function(e,t){this.HueRange[0]=e,this.HueRange[1]=t},this.setSaturationRange=function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t},this.setValueRange=function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t},this.setRange=function(e,t){this.InputRange[0]=e,this.InputRange[1]=t},this.setAlphaRange=function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t},this.getColor=function(e){return this.mapValue(e)},this.HSVToRGB=function(e,t,n){if(e>1)throw new Error("HSVToRGB expects hue < 1");var o=[];if(0===t)return o[0]=n,o[1]=n,o[2]=n,o;var a=Math.floor(6*e),r=6*e-a,i=n*(1-t),l=n*(1-t*r),s=n*(1-t*(1-r));switch(a){case 0:case 6:o[0]=n,o[1]=s,o[2]=i;break;case 1:o[0]=l,o[1]=n,o[2]=i;break;case 2:o[0]=i,o[1]=n,o[2]=s;break;case 3:o[0]=i,o[1]=l,o[2]=n;break;case 4:o[0]=s,o[1]=i,o[2]=n;break;case 5:o[0]=n,o[1]=i,o[2]=l}return o},this.build=function(e){if(!(this.Table.length>1)||e){this.Table=[];var t=this.NumberOfColors-1,n=void 0,o=void 0,a=void 0,r=void 0;t?(n=(this.HueRange[1]-this.HueRange[0])/t,o=(this.SaturationRange[1]-this.SaturationRange[0])/t,a=(this.ValueRange[1]-this.ValueRange[0])/t,r=(this.AlphaRange[1]-this.AlphaRange[0])/t):n=o=a=r=0;for(var i=0;i<=t;i++){var l=this.HueRange[0]+i*n,s=this.SaturationRange[0]+i*o,u=this.ValueRange[0]+i*a,d=this.AlphaRange[0]+i*r,c=this.HSVToRGB(l,s,u),f=[];switch(this.Ramp){case"scurve":f[0]=Math.floor(127.5*(1+Math.cos((1-c[0])*Math.PI))),f[1]=Math.floor(127.5*(1+Math.cos((1-c[1])*Math.PI))),f[2]=Math.floor(127.5*(1+Math.cos((1-c[2])*Math.PI))),f[3]=Math.floor(255*d);break;case"linear":f[0]=Math.floor(255*c[0]+.5),f[1]=Math.floor(255*c[1]+.5),f[2]=Math.floor(255*c[2]+.5),f[3]=Math.floor(255*d+.5);break;case"sqrt":f[0]=Math.floor(255*Math.sqrt(c[0])+.5),f[1]=Math.floor(255*Math.sqrt(c[1])+.5),f[2]=Math.floor(255*Math.sqrt(c[2])+.5),f[3]=Math.floor(255*Math.sqrt(d)+.5);break;default:throw new Error("Invalid Ramp value ("+this.Ramp+")")}this.Table.push(f)}this.buildSpecialColors()}},this.buildSpecialColors=function(){var e=this.NumberOfColors,t=e+a,n=e+r,o=e+i;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[o]=this.NaNColor},this.mapValue=function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]},this.linearIndexLookupMain=function(e,t){var n=void 0;return n=e<t.Range[0]?t.MaxIndex+a+1.5:e>t.Range[1]?t.MaxIndex+r+1.5:(e+t.Shift)*t.Scale,Math.floor(n)},this.getIndex=function(e){var t={};if(t.Range=[],t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e))return-1;var n=this.linearIndexLookupMain(e,t);return n===this.NumberOfColors+a?n=0:n===this.NumberOfColors+r&&(n=this.NumberOfColors-1),n},this.setTableValue=function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index ("+e+")");e>=this.NumberOfColors&&new Error("Index "+e+" is greater than the number of colors "+this.NumberOfColors),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var a=0,r=1,i=2},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,r){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var i=(0,o.getEnabledElement)(e),l=[],s=0,u=i.image.getPixelData(),d=0;d<r;d++)for(var c=0;c<a;c++){var f=(d+n)*i.image.columns+(c+t);l[s++]=u[f]}return l};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");x=e,g.external.$(v.default).trigger("CornerstoneImageCacheMaximumSizeChanged"),(0,p.default)(v.default,"CornerstoneImageCacheMaximumSizeChanged"),r()}function r(){function e(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}if(!(T<=x)){for(y.sort(e);T>x;){var t=y[y.length-1],n=t.imageId;s(n),g.external.$(v.default).trigger("CornerstoneImageCachePromiseRemoved",{imageId:n}),(0,p.default)(v.default,"CornerstoneImageCachePromiseRemoved",{imageId:n})}var o=u();g.external.$(v.default).trigger("CornerstoneImageCacheFull",o),(0,p.default)(v.default,"CornerstoneImageCacheFull",o)}}function i(e,t){if(void 0===e)throw new Error("putImagePromise: imageId must not be undefined");if(void 0===t)throw new Error("putImagePromise: imagePromise must not be undefined");if(!0===b.hasOwnProperty(e))throw new Error("putImagePromise: imageId already in cache");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imagePromise:t,timeStamp:Date.now(),sizeInBytes:0};b[e]=n,y.push(n),t.then(function(e){if(-1!==y.indexOf(n)){if(n.loaded=!0,n.image=e,void 0===e.sizeInBytes)throw new Error("putImagePromise: sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImagePromise: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,T+=n.sizeInBytes;var t={action:"addImage",image:n};g.external.$(v.default).trigger("CornerstoneImageCacheChanged",t),(0,p.default)(v.default,"CornerstoneImageCacheChanged",t),n.sharedCacheKey=e.sharedCacheKey,r()}})}function l(e){if(void 0===e)throw new Error("getImagePromise: imageId must not be undefined");var t=b[e];if(void 0!==t)return t.timeStamp=Date.now(),t.imagePromise}function s(e){if(void 0===e)throw new Error("removeImagePromise: imageId must not be undefined");var t=b[e];if(void 0===t)throw new Error("removeImagePromise: imageId was not present in imageCache");t.imagePromise.reject(),y.splice(y.indexOf(t),1),T-=t.sizeInBytes;var n={action:"deleteImage",image:t};g.external.$(v.default).trigger("CornerstoneImageCacheChanged",n),(0,p.default)(v.default,"CornerstoneImageCacheChanged",n),d(t.imagePromise),delete b[e]}function u(){return{maximumSizeInBytes:x,cacheSizeInBytes:T,numberOfImagesCached:y.length}}function d(e){e.then(function(e){e.decache&&e.decache()})}function c(){for(;y.length>0;)s(y[0].imageId)}function f(e,t){var n=b[e];n&&n.imagePromise.then(function(e){var o=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,T+=o;var a={action:"changeImageSize",image:e};g.external.$(v.default).trigger("CornerstoneImageCacheChanged",a),(0,p.default)(v.default,"CornerstoneImageCacheChanged",a)})}Object.defineProperty(t,"__esModule",{value:!0}),t.cachedImages=void 0,t.setMaximumSizeBytes=a,t.putImagePromise=i,t.getImagePromise=l,t.removeImagePromise=s,t.getCacheInfo=u,t.purgeCache=c,t.changeImageIdCacheSize=f;var g=n(1),m=n(12),v=o(m),h=n(2),p=o(h),x=1073741824,T=0,b={},y=t.cachedImages=[];t.default={imageCache:b,cachedImages:y,setMaximumSizeBytes:a,putImagePromise:i,getImagePromise:l,removeImagePromise:s,getCacheInfo:u,purgeCache:c,changeImageIdCacheSize:f}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4);Object.defineProperty(t,"drawImage",{enumerable:!0,get:function(){return o(a).default}});var r=n(9);Object.defineProperty(t,"generateLut",{enumerable:!0,get:function(){return o(r).default}});var i=n(5);Object.defineProperty(t,"getDefaultViewport",{enumerable:!0,get:function(){return o(i).default}});var l=n(14);Object.defineProperty(t,"requestAnimationFrame",{enumerable:!0,get:function(){return o(l).default}});var s=n(15);Object.defineProperty(t,"storedPixelDataToCanvasImageData",{enumerable:!0,get:function(){return o(s).default}});var u=n(16);Object.defineProperty(t,"storedColorPixelDataToCanvasImageData",{enumerable:!0,get:function(){return o(u).default}});var d=n(36);Object.defineProperty(t,"internal",{enumerable:!0,get:function(){return o(d).default}});var c=n(7);Object.defineProperty(t,"renderColorImage",{enumerable:!0,get:function(){return c.renderColorImage}});var f=n(13);Object.defineProperty(t,"renderGrayscaleImage",{enumerable:!0,get:function(){return f.renderGrayscaleImage}});var g=n(23);Object.defineProperty(t,"renderWebImage",{enumerable:!0,get:function(){return g.renderWebImage}});var m=n(46);Object.defineProperty(t,"canvasToPixel",{enumerable:!0,get:function(){return o(m).default}});var v=n(47);Object.defineProperty(t,"disable",{enumerable:!0,get:function(){return o(v).default}});var h=n(48);Object.defineProperty(t,"displayImage",{enumerable:!0,get:function(){return o(h).default}});var p=n(50);Object.defineProperty(t,"draw",{enumerable:!0,get:function(){return o(p).default}});var x=n(51);Object.defineProperty(t,"drawInvalidated",{enumerable:!0,get:function(){return o(x).default}});var T=n(52);Object.defineProperty(t,"enable",{enumerable:!0,get:function(){return o(T).default}});var b=n(55);Object.defineProperty(t,"getElementData",{enumerable:!0,get:function(){return b.getElementData}}),Object.defineProperty(t,"removeElementData",{enumerable:!0,get:function(){return b.removeElementData}});var y=n(0);Object.defineProperty(t,"getEnabledElement",{enumerable:!0,get:function(){return y.getEnabledElement}}),Object.defineProperty(t,"addEnabledElement",{enumerable:!0,get:function(){return y.addEnabledElement}}),Object.defineProperty(t,"getEnabledElementsByImageId",{enumerable:!0,get:function(){return y.getEnabledElementsByImageId}}),Object.defineProperty(t,"getEnabledElements",{enumerable:!0,get:function(){return y.getEnabledElements}});var C=n(18);Object.defineProperty(t,"addLayer",{enumerable:!0,get:function(){return C.addLayer}}),Object.defineProperty(t,"removeLayer",{enumerable:!0,get:function(){return C.removeLayer}}),Object.defineProperty(t,"getLayer",{enumerable:!0,get:function(){return C.getLayer}}),Object.defineProperty(t,"getLayers",{enumerable:!0,get:function(){return C.getLayers}}),Object.defineProperty(t,"getVisibleLayers",{enumerable:!0,get:function(){return C.getVisibleLayers}}),Object.defineProperty(t,"setActiveLayer",{enumerable:!0,get:function(){return C.setActiveLayer}}),Object.defineProperty(t,"getActiveLayer",{enumerable:!0,get:function(){return C.getActiveLayer}});var w=n(26);Object.defineProperty(t,"fitToWindow",{enumerable:!0,get:function(){return o(w).default}});var M=n(56);Object.defineProperty(t,"getDefaultViewportForImage",{enumerable:!0,get:function(){return o(M).default}});var P=n(57);Object.defineProperty(t,"getImage",{enumerable:!0,get:function(){return o(P).default}});var I=n(58);Object.defineProperty(t,"getPixels",{enumerable:!0,get:function(){return o(I).default}});var S=n(32);Object.defineProperty(t,"getStoredPixels",{enumerable:!0,get:function(){return o(S).default}});var _=n(59);Object.defineProperty(t,"getViewport",{enumerable:!0,get:function(){return o(_).default}});var O=n(60);Object.defineProperty(t,"loadImage",{enumerable:!0,get:function(){return O.loadImage}}),Object.defineProperty(t,"loadAndCacheImage",{enumerable:!0,get:function(){return O.loadAndCacheImage}}),Object.defineProperty(t,"registerImageLoader",{enumerable:!0,get:function(){return O.registerImageLoader}}),Object.defineProperty(t,"registerUnknownImageLoader",{enumerable:!0,get:function(){return O.registerUnknownImageLoader}});var E=n(61);Object.defineProperty(t,"invalidate",{enumerable:!0,get:function(){return o(E).default}});var k=n(62);Object.defineProperty(t,"invalidateImageId",{enumerable:!0,get:function(){return o(k).default}});var D=n(63);Object.defineProperty(t,"pageToPixel",{enumerable:!0,get:function(){return o(D).default}});var $=n(64);Object.defineProperty(t,"pixelToCanvas",{enumerable:!0,get:function(){return o($).default}});var j=n(65);Object.defineProperty(t,"reset",{enumerable:!0,get:function(){return o(j).default}});var R=n(25);Object.defineProperty(t,"resize",{enumerable:!0,get:function(){return o(R).default}});var L=n(8);Object.defineProperty(t,"setToPixelCoordinateSystem",{enumerable:!0,get:function(){return o(L).default}});var A=n(66);Object.defineProperty(t,"setViewport",{enumerable:!0,get:function(){return o(A).default}});var B=n(3);Object.defineProperty(t,"updateImage",{enumerable:!0,get:function(){return o(B).default}});var V=n(28);Object.defineProperty(t,"pixelDataToFalseColorData",{enumerable:!0,get:function(){return o(V).default}});var U=n(67);Object.defineProperty(t,"rendering",{enumerable:!0,get:function(){return o(U).default}});var N=n(33);Object.defineProperty(t,"imageCache",{enumerable:!0,get:function(){return o(N).default}});var W=n(24);Object.defineProperty(t,"metaData",{enumerable:!0,get:function(){return o(W).default}});var F=n(11);Object.defineProperty(t,"webGL",{enumerable:!0,get:function(){return o(F).default}});var z=n(29);Object.defineProperty(t,"colors",{enumerable:!0,get:function(){return o(z).default}});var H=n(27);Object.defineProperty(t,"convertImageToFalseColorImage",{enumerable:!0,get:function(){return H.convertImageToFalseColorImage}}),Object.defineProperty(t,"convertToFalseColorImage",{enumerable:!0,get:function(){return H.convertToFalseColorImage}}),Object.defineProperty(t,"restoreImage",{enumerable:!0,get:function(){return H.restoreImage}});var Y=n(12);Object.defineProperty(t,"events",{enumerable:!0,get:function(){return o(Y).default}});var X=n(1);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return X.external}})},function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){return function(n){return 255*((n-t)/e+.5)}}function r(e){var t=Math.max.apply(Math,o(e.lut)).toString(2).length,n=t-8,a=e.lut[0]>>n,r=e.lut[e.lut.length-1]>>n,i=e.firstValueMapped+e.lut.length-1;return function(t){return t<e.firstValueMapped?a:t>=i?r:e.lut[t-e.firstValueMapped]>>n}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return n?r(n):a(e,t)}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),r=o(a),i=n(9),l=o(i),s=n(5),u=o(s),d=n(14),c=o(d),f=n(15),g=o(f),m=n(16),v=o(m),h=n(10),p=o(h),x=n(17),T=o(x),b=n(20);t.default={drawImage:r.default,generateLut:l.default,getDefaultViewport:u.default,requestAnimationFrame:c.default,storedPixelDataToCanvasImageData:g.default,storedColorPixelDataToCanvasImageData:v.default,getTransform:p.default,calculateTransform:T.default,Transform:b.Transform}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var o=(0,a.default)(),r=e.getPixelData();e.stats.lastGetPixelDataTime=(0,a.default)()-o;var i=e.minPixelValue,l=0,s=0,u=r.length;if(o=(0,a.default)(),i<0)for(;s<u;)n[l++]=t[r[s++]+-i],n[l++]=t[r[s++]+-i],n[l++]=t[r[s++]+-i],n[l++]=r[s++];else for(;s<u;)n[l++]=t[r[s++]],n[l++]=t[r[s++]],n[l++]=t[r[s++]],n[l++]=r[s++];e.stats.lastStoredPixelDataToCanvasImageDataTime=(0,a.default)()-o};var o=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(){return P}function r(){for(var e in T.shaders){var t=T.shaders[e];t.attributes={},t.uniforms={},t.vert=b.vertexShader,t.program=(0,M.default)(I,t.vert,t.frag),t.attributes.texCoordLocation=I.getAttribLocation(t.program,"a_texCoord"),I.enableVertexAttribArray(t.attributes.texCoordLocation),t.attributes.positionLocation=I.getAttribLocation(t.program,"a_position"),I.enableVertexAttribArray(t.attributes.positionLocation),t.uniforms.resolutionLocation=I.getUniformLocation(t.program,"u_resolution")}}function i(){!0!==O&&d(P)&&(v(),r(),t.isWebGLInitialized=O=!0)}function l(e,t,n){e.bufferData(e.ARRAY_BUFFER,new Float32Array([t,n,0,n,t,0,0,0]),e.STATIC_DRAW)}function s(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function u(e){e.preventDefault(),t.isWebGLInitialized=O=!1,C.default.purgeCache(),i()}function d(e){I=null;try{var t={preserveDrawingBuffer:!0};I=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",s,!1),e.addEventListener("webglcontextlost",s,!1),e.removeEventListener("webglcontextrestored",u,!1),e.addEventListener("webglcontextrestored",u,!1)}catch(e){throw new Error("Error creating WebGL context")}return I||(console.error("Unable to initialize WebGL. Your browser may not support it."),I=null),I}function c(e){if(e.color)return"rgb";var t="int";return e.minPixelValue>=0&&(t="u"+t),e.maxPixelValue>255?t+="16":t+="8",t}function f(e){var t=c(e);return T.shaders.hasOwnProperty(t)?T.shaders[t]:T.shaders.rgb}function g(e){var t={uint8:I.LUMINANCE,int8:I.LUMINANCE_ALPHA,uint16:I.LUMINANCE_ALPHA,int16:I.RGB,rgb:I.RGB},n={int8:1,uint16:2,int16:3,rgb:3},o=c(e),a=t[o],r=I.createTexture();I.bindTexture(I.TEXTURE_2D,r),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.pixelStorei(I.UNPACK_ALIGNMENT,1);var i=T.dataUtilities[o].storedPixelDataToImageData(e,e.width,e.height);return I.texImage2D(I.TEXTURE_2D,0,a,e.width,e.height,0,a,I.UNSIGNED_BYTE,i),{texture:r,sizeInBytes:e.width*e.height*n[o]}}function m(e){var t=C.default.getImageTexture(e.imageId);return t||(t=g(e),C.default.putImageTexture(e,t)),t.texture}function v(){_=I.createBuffer(),I.bindBuffer(I.ARRAY_BUFFER,_),I.bufferData(I.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),I.STATIC_DRAW),S=I.createBuffer(),I.bindBuffer(I.ARRAY_BUFFER,S),I.bufferData(I.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),I.STATIC_DRAW)}function h(e,t,n,o,a){I.clearColor(1,0,0,1),I.viewport(0,0,o,a),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT),I.useProgram(e.program),I.bindBuffer(I.ARRAY_BUFFER,S),I.vertexAttribPointer(e.attributes.texCoordLocation,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,_),I.vertexAttribPointer(e.attributes.positionLocation,2,I.FLOAT,!1,0,0);for(var r in t){var i=I.getUniformLocation(e.program,r);if(i){var s=t[r],u=s.type,d=s.value;"i"===u?I.uniform1i(i,d):"f"===u?I.uniform1f(i,d):"2f"===u&&I.uniform2f(i,d[0],d[1])}}l(I,o,a),I.activeTexture(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,n),I.drawArrays(I.TRIANGLE_STRIP,0,4)}function p(e){var t=e.image;P.width=t.width,P.height=t.height;var n=e.viewport,o=f(t),a=m(t);return h(o,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:n.voi.windowCenter},ww:{type:"f",value:n.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:n.invert?1:0}},a,t.width,t.height),P}function x(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.isWebGLInitialized=void 0,t.getRenderCanvas=a,t.initRenderer=i,t.render=p,t.isWebGLAvailable=x;var T=n(39),b=n(45),y=n(21),C=o(y),w=n(22),M=o(w),P=document.createElement("canvas"),I=void 0,S=void 0,_=void 0,O=!1;t.isWebGLInitialized=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dataUtilities=t.shaders=void 0;var o=n(40),a=n(41),r=n(42),i=n(43),l=n(44),s={int16:o.int16Shader,int8:a.int8Shader,rgb:r.rgbShader,uint16:i.uint16Shader,uint8:l.uint8Shader},u={int16:o.int16DataUtilities,int8:a.int8DataUtilities,rgb:r.rgbDataUtilities,uint16:i.uint16DataUtilities,uint8:l.uint8DataUtilities};t.shaders=s,t.dataUtilities=u},function(e,t,n){"use strict";function o(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),o=0,a=0;a<t.length;a++){var r=Math.abs(t[a]);n[o++]=255&r,n[o++]=r>>8,n[o++]=t[a]<0?0:1}return n}Object.defineProperty(t,"__esModule",{value:!0});var a={};t.int16DataUtilities={storedPixelDataToImageData:o},a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",t.int16Shader=a},function(e,t,n){"use strict";function o(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),o=0,a=0;a<t.length;a++)n[o++]=t[a],n[o++]=t[a]<0?0:1;return n}Object.defineProperty(t,"__esModule",{value:!0});var a={};t.int8DataUtilities={storedPixelDataToImageData:o},a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",t.int8Shader=a},function(e,t,n){"use strict";function o(e){var t=e.minPixelValue,n=0,o=0,a=e.width*e.height*4,r=e.width*e.height*3,i=e.getPixelData(),l=new Uint8Array(r);if(t<0)for(;o<a;)l[n++]=i[o++]+-t,l[n++]=i[o++]+-t,l[n++]=i[o++]+-t,o+=1;else for(;o<a;)l[n++]=i[o++],l[n++]=i[o++],l[n++]=i[o++],o+=1;return l}Object.defineProperty(t,"__esModule",{value:!0});var a={};t.rgbDataUtilities={storedPixelDataToImageData:o},a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}",t.rgbShader=a},function(e,t,n){"use strict";function o(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),o=0,a=0;a<t.length;a++){var r=t[a];n[o++]=255&r,n[o++]=r>>8}return n}Object.defineProperty(t,"__esModule",{value:!0});var a={};t.uint16DataUtilities={storedPixelDataToImageData:o},a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",t.uint16Shader=a},function(e,t,n){"use strict";function o(e){return e.getPixelData()}Object.defineProperty(t,"__esModule",{value:!0});var a={};t.uint8DataUtilities={storedPixelDataToImageData:o},a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",t.uint8Shader=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,o.getEnabledElement)(e),a=(0,r.default)(n);return a.invert(),a.transformPoint(t.x,t.y)};var o=n(0),a=n(10),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=(0,a.getEnabledElements)(),n=0;n<t.length;n++)if(t[n].element===e){var r={element:e};o.external.$(e).trigger("CornerstoneElementDisabled",r),$(e).trigger("CornerstoneElementDisabled",r),(0,i.default)(e,"CornerstoneElementDisabled",r),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}};var o=n(1),a=n(0),r=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var o=(0,r.getEnabledElement)(e),i=o.image;if(o.image=t,o.layers&&o.layers.length&&((0,f.getActiveLayer)(e).image=t),void 0===o.viewport&&(o.viewport=(0,l.default)(o.canvas,t)),n)for(var s in n)null!==n[s]&&(o.viewport[s]=n[s]);var d=void 0;void 0!==o.lastImageTimeStamp&&(d=(1e3/((0,c.default)()-o.lastImageTimeStamp)).toFixed()),o.lastImageTimeStamp=(0,c.default)();var g={viewport:o.viewport,element:o.element,image:o.image,oldImage:i,enabledElement:o,frameRate:d};a.external.$(o.element).trigger("CornerstoneNewImage",g),(0,m.default)(o.element,"CornerstoneNewImage",g),(0,u.default)(e)};var a=n(1),r=n(0),i=n(5),l=o(i),s=n(3),u=o(s),d=n(6),c=o(d),f=n(18),g=n(2),m=o(g)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,o.getEnabledElement)(e);if(void 0===t.image)throw new Error("draw: image has not been loaded yet");(0,r.default)(t)};var o=n(0),a=n(4),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){for(var e=(0,o.getEnabledElements)(),t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&(0,r.default)(n,!0)}};var o=n(0),a=n(4),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return void 0!==e.image||e.layers.length}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function n(e){if(void 0!==l.canvas){var t={enabledElement:l,timestamp:e};r.external.$(l.element).trigger("CornerstonePreRender",t),(0,h.default)(l.element,"CornerstonePreRender",t),l.needsRedraw&&a(l)&&(0,d.default)(l,l.invalid),(0,f.default)(n)}}if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&(m.default.renderer.isWebGLAvailable()?(m.default.renderer.initRenderer(),t.renderer="webgl"):(console.error("WebGL not available, falling back to Canvas renderer"),delete t.renderer));var o=document.createElement("canvas");e.appendChild(o);var l={element:e,canvas:o,image:void 0,invalid:!1,needsRedraw:!0,options:t,layers:[],data:{},renderingTools:{}};(0,i.addEnabledElement)(l),(0,s.default)(e,!0),n()};var r=n(1),i=n(0),l=n(25),s=o(l),u=n(53),d=o(u),c=n(14),f=o(c),g=n(11),m=o(g),v=n(2),h=o(v)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.image,o=e.element,r=e.layers||[];if(e.canvas&&(e.image||r.length)){var l=(0,i.default)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},r&&r.length)(0,s.default)(e,t);else if(n){var c=n.render;c||(c=n.color?u.renderColorImage:d.renderGrayscaleImage),c(e,t)}var g=(0,i.default)()-l,m={viewport:e.viewport,element:o,image:n,enabledElement:e,canvasContext:e.canvas.getContext("2d"),renderTimeInMs:g};n.stats.lastRenderTime=g,e.invalid=!1,e.needsRedraw=!1,a.external.$(o).trigger("CornerstoneImageRendered",m),(0,f.default)(o,"CornerstoneImageRendered",m)}};var a=n(1),r=n(6),i=o(r),l=n(54),s=o(l),u=n(7),d=n(13),c=n(2),f=o(c)},function(e,t,n){"use strict";function o(e){return{rotation:e.rotation,scale:e.scale,translation:{x:e.translation.x,y:e.translation.y},hflip:e.hflip,vflip:e.vflip}}function a(e,t){e.forEach(function(e){if(e!==t){var n=f[t.layerId],o=f[e.layerId]||e.viewport,a=o.scale/n.scale;e.viewport.scale=t.viewport.scale*a,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/a,y:t.viewport.translation.y/a},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip}})}function r(e,t,n,o){var a=e.canvas;n.forEach(function(t){if(e.save(),t.image){t.canvas=a,(0,c.default)(t,e);var n=void 0;t.options.colormap&&t.image.colormapId!==t.options.colormap?(n=(0,u.convertImageToFalseColorImage)(t.image,t.options.colormap),t.viewport.voi={windowWidth:t.image.windowWidth,windowCenter:t.image.windowCenter}):!t.options.colormap&&t.image.colormapId&&(n=(0,u.restoreImage)(t.image),t.viewport.voi={windowWidth:t.image.windowWidth,windowCenter:t.image.windowCenter}),o=o||n,!0===t.image.color?(0,l.addColorLayer)(t,o):(0,s.addGrayscaleLayer)(t,o),t.options&&t.options.opacity?e.globalAlpha=t.options.opacity:e.globalAlpha=1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),!0===t.viewport.pixelReplication?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),e.drawImage(t.canvas,0,0,t.image.width,t.image.height,0,0,t.image.width,t.image.height),e.restore()}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.element,l=(0,i.getLayers)(n),s=(0,i.getActiveLayer)(n),u=(0,i.getVisibleLayers)(n),d=!e.lastSyncViewportsState&&e.syncViewports;e.lastSyncViewportsState=e.syncViewports,d&&l.forEach(function(e){f[e.layerId]=o(e.viewport)}),!0===e.syncViewports&&a(u,s);var c=e.canvas.getContext("2d");c.setTransform(1,0,0,1,0,0),c.fillStyle="black",c.fillRect(0,0,e.canvas.width,e.canvas.height),r(c,s,u,t)};var i=n(18),l=n(7),s=n(13),u=n(27),d=n(8),c=function(e){return e&&e.__esModule?e:{default:e}}(d),f={}},function(e,t,n){"use strict";function o(e,t){var n=(0,r.getEnabledElement)(e);return!1===n.data.hasOwnProperty(t)&&(n.data[t]={}),n.data[t]}function a(e,t){delete(0,r.getEnabledElement)(e).data[t]}Object.defineProperty(t,"__esModule",{value:!0}),t.getElementData=o,t.removeElementData=a;var r=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,o.getEnabledElement)(e);return(0,r.default)(n.canvas,t)};var o=n(0),a=n(5),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,o.getEnabledElement)(e).image};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r){var l=(0,i.default)(e,t,n,o,r),u=(0,a.getEnabledElement)(e),d=(0,s.default)(u.image.slope,u.image.intercept,u.viewport.modalityLUT);return l.map(d)};var a=n(0),r=n(32),i=o(r),l=n(19),s=o(l)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,o.getEnabledElement)(e),n=t.viewport;if(void 0!==n)return{scale:n.scale,translation:{x:n.translation.x,y:n.translation.y},voi:{windowWidth:n.voi.windowWidth,windowCenter:n.voi.windowCenter},invert:n.invert,pixelReplication:n.pixelReplication,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=e.indexOf(":"),o=e.substring(0,n),a=v[o],r=void 0;if(void 0===a||null===a){if(void 0!==h)return r=h(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}return r=a(e,t),r.then(function(e){u.external.$(f.default).trigger("CornerstoneImageLoaded",{image:e}),(0,m.default)(f.default,"CornerstoneImageLoaded",{image:e})}),r}function r(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=(0,d.getImagePromise)(e);return void 0!==n?n:n=a(e,t)}function i(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=(0,d.getImagePromise)(e);return void 0!==n?n:(n=a(e,t),(0,d.putImagePromise)(e,n),n)}function l(e,t){v[e]=t}function s(e){var t=h;return h=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=r,t.loadAndCacheImage=i,t.registerImageLoader=l,t.registerUnknownImageLoader=s;var u=n(1),d=n(33),c=n(12),f=o(c),g=n(2),m=o(g),v={},h=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,a.getEnabledElement)(e);t.invalid=!0,t.needsRedraw=!0;var n={element:e};o.external.$(e).trigger("CornerstoneInvalidated",n),(0,i.default)(e,"CornerstoneInvalidated",n)};var o=n(1),a=n(0),r=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){(0,o.getEnabledElementsByImageId)(e).forEach(function(e){(0,r.default)(e,!0)})};var o=n(0),a=n(4),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var a=(0,o.getEnabledElement)(e);if(void 0===a.image)throw new Error("image has not been loaded yet");var i=e.getBoundingClientRect(),l=t-i.left-window.pageXOffset,s=n-i.top-window.pageYOffset,u={x:l,y:s},d=(0,r.default)(a);return d.invert(),d.transformPoint(u.x,u.y)};var o=n(0),a=n(10),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,o.getEnabledElement)(e);return(0,r.default)(n).transformPoint(t.x,t.y)};var o=n(0),a=n(10),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=(0,a.getEnabledElement)(e);t.viewport=(0,i.default)(t.canvas,t.image),(0,s.default)(e)};var a=n(0),r=n(5),i=o(r),l=n(3),s=o(l)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,o.getEnabledElement)(e);n.viewport.scale=t.scale,n.viewport.translation.x=t.translation.x,n.viewport.translation.y=t.translation.y,n.viewport.voi.windowWidth=t.voi.windowWidth,n.viewport.voi.windowCenter=t.voi.windowCenter,n.viewport.invert=t.invert,n.viewport.pixelReplication=t.pixelReplication,n.viewport.rotation=t.rotation,n.viewport.hflip=t.hflip,n.viewport.vflip=t.vflip,n.viewport.modalityLUT=t.modalityLUT,n.viewport.voiLUT=t.voiLUT,n.viewport.voi.windowWidth=Math.max(n.viewport.voi.windowWidth,i),n.viewport.scale=Math.max(n.viewport.scale,l),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),(0,r.default)(e)};var o=n(0),a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=1e-6,l=1e-4},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(13),r=n(23);t.default={colorImage:o.renderColorImage,grayscaleImage:a.renderGrayscaleImage,webImage:r.renderWebImage}}])})},function(e,t,n){"use strict";function o(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],n=void 0;return/trident/i.test(t[1])?(n=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(n[1]||"")):"Chrome"===t[1]&&null!==(n=e.match(/\b(OPR|Edge)\/(\d+)/))?n.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(n=e.match(/version\/(\d+)/i))&&t.splice(1,1,n[1]),t.join(" "))}function a(e){s=e}function r(){return s||i()}function i(){var e=o(),t=e.split(" "),n=t[0],a=t[1],r=u[n];return r?r[a]?r[a]:r.default:u.default}function l(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}Object.defineProperty(t,"__esModule",{value:!0});var s=void 0,u={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};t.getDefaultSimultaneousRequests=i,t.getMaxSimultaneousRequests=r,t.setMaxSimultaneousRequests=a,t.getBrowserInfo=o,t.isMobileDevice=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e);var n={};o.external.$(t).on("CornerstoneToolsMouseWheel",n,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e)}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,i,l){function s(e,o){!1===a.hasMoved&&(a.hasMoved=!0),a.active=!0,a.x=o.currentPoints.image.x+f.x,a.y=o.currentPoints.image.y+f.y,l&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),d.updateImage(c);var i={toolType:t,element:c,measurementData:n};(0,r.default)(c,"CornerstoneToolsMeasurementModified",i)}function u(){a.active=!1,o.external.$(c).off("CornerstoneToolsMouseDrag",s),o.external.$(c).off("CornerstoneToolsMouseUp",u),o.external.$(c).off("CornerstoneToolsMouseClick",u),d.updateImage(c),"function"==typeof i&&i()}var d=o.external.cornerstone,c=e.element,f={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y};o.external.$(c).on("CornerstoneToolsMouseDrag",s),o.external.$(c).on("CornerstoneToolsMouseUp",u),o.external.$(c).on("CornerstoneToolsMouseClick",u)};var o=n(0),a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,i,l){function s(e,o){a.active=!0,a.x=o.currentPoints.image.x,a.y=o.currentPoints.image.y,l&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),g.updateImage(m);var i={toolType:t,element:m,measurementData:n};(0,r.default)(m,"CornerstoneToolsMeasurementModified",i)}function u(e){o.external.$(m).off("CornerstoneToolsMouseMove",u),o.external.$(m).off("CornerstoneToolsMouseDrag",u),o.external.$(m).on("CornerstoneToolsMouseMove",s),o.external.$(m).on("CornerstoneToolsMouseDrag",s),o.external.$(m).on("CornerstoneToolsMouseClick",f),"CornerstoneToolsMouseDrag"===e.type&&o.external.$(m).on("CornerstoneToolsMouseUp",f)}function d(e,t){t.measurementData===n&&f()}function c(e,n){n.toolType===t&&(o.external.$(m).off("CornerstoneToolsMouseMove",s),o.external.$(m).off("CornerstoneToolsMouseDrag",s),o.external.$(m).off("CornerstoneToolsMouseClick",f),o.external.$(m).off("CornerstoneToolsMouseUp",f),o.external.$(m).off("CornerstoneToolsMeasurementRemoved",d),o.external.$(m).off("CornerstoneToolsToolDeactivated",c),a.active=!1,g.updateImage(m))}function f(){o.external.$(m).off("CornerstoneToolsMouseMove",s),o.external.$(m).off("CornerstoneToolsMouseDrag",s),o.external.$(m).off("CornerstoneToolsMouseClick",f),o.external.$(m).off("CornerstoneToolsMouseUp",f),o.external.$(m).off("CornerstoneToolsMeasurementRemoved",d),o.external.$(m).off("CornerstoneToolsToolDeactivated",c),a.active=!1,g.updateImage(m),"function"==typeof i&&i()}var g=o.external.cornerstone,m=e.element;o.external.$(m).on("CornerstoneToolsMouseDrag",u),o.external.$(m).on("CornerstoneToolsMouseMove",u),o.external.$(m).on("CornerstoneToolsMeasurementRemoved",d),o.external.$(m).on("CornerstoneToolsToolDeactivated",c)};var o=n(0),a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){e(t,t.detail)}var n={};return{disable:function(e){e.removeEventListener("cornerstoneimagerendered",t)},enable:function(e){e.removeEventListener("cornerstoneimagerendered",t),e.addEventListener("cornerstoneimagerendered",t),o.external.cornerstone.updateImage(e)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,i,l){function s(e,o){a.x=o.currentPoints.image.x+v.x,a.y=o.currentPoints.image.y+v.y,l&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),f.updateImage(g);var i={toolType:t,element:g,measurementData:n};(0,r.default)(g,"CornerstoneToolsMeasurementModified",i)}function u(e,t){if(o.external.$(g).off("CornerstoneToolsTouchDrag",s),o.external.$(g).off("CornerstoneToolsTouchPinch",u),o.external.$(g).off("CornerstoneToolsTouchEnd",u),o.external.$(g).off("CornerstoneToolsTap",u),o.external.$(g).off("CornerstoneToolsTouchStart",d),o.external.$(g).off("CornerstoneToolsToolDeactivated",c),"CornerstoneToolsTouchPinch"===e.type||"CornerstoneToolsTouchPress"===e.type)return a.active=!1,f.updateImage(g),void i();a.active=!1,n.active=!1,a.x=t.currentPoints.image.x+v.x,a.y=t.currentPoints.image.y+v.y,l&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,t.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,t.image.height)),f.updateImage(g),"function"==typeof i&&i()}function d(e){return e.stopImmediatePropagation(),!1}function c(){o.external.$(g).off("CornerstoneToolsTouchDrag",s),o.external.$(g).off("CornerstoneToolsTouchPinch",u),o.external.$(g).off("CornerstoneToolsTouchEnd",u),o.external.$(g).off("CornerstoneToolsTap",u),o.external.$(g).off("CornerstoneToolsTouchStart",d),o.external.$(g).off("CornerstoneToolsToolDeactivated",c),a.active=!1,n.active=!1,a.x=e.currentPoints.image.x+v.x,a.y=e.currentPoints.image.y+v.y,l&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,e.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,e.image.height)),f.updateImage(g)}var f=o.external.cornerstone,g=e.element,m=f.pageToPixel(g,e.currentPoints.page.x,e.currentPoints.page.y+50),v={x:a.x-m.x,y:a.y-m.y};a.active=!0,n.active=!0,o.external.$(g).on("CornerstoneToolsTouchDrag",s),o.external.$(g).on("CornerstoneToolsTouchPinch",u),o.external.$(g).on("CornerstoneToolsTouchEnd",u),o.external.$(g).on("CornerstoneToolsTap",u),o.external.$(g).on("CornerstoneToolsTouchStart",d),o.external.$(g).on("CornerstoneToolsToolDeactivated",c)};var o=n(0),a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";function o(){return v}function a(e,t){console.log("PERFORM_THRESHOLDING");var n=void 0,o=void 0,a=e.imageIds,r=a.length;return g.loadImage(a[0]).then(function(e){n=e.width,o=e.height;var i=n*o*r*h,l=new ArrayBuffer(i),s=new Uint8Array(l),u=a.map(function(e,t){return g.loadImage(e).then(function(e){for(var a=e.slope,r=e.intercept,i=e.getPixelData(),l=n*o,u=0;u<l;u++){var d=i[u],c=d*a+r,f=c>=p.calciumThresholdHu?1:0;s[t*l+u]=f}})});return Promise.all(u).then(function(){var e={buffer:l,width:n,height:o};return t&&t(e),e})})}function r(e,t){console.log("onImageRendered");var n=t.element,o=(0,m.getToolState)(n,"stack"),a=(0,m.getToolState)(n,"regions");if(a&&a.data&&a.data.length){var r=o.data[0].currentImageIdIndex,i=a.data[0].buffer,l=t.canvasContext,s=t.enabledElement,u=t.image,d=u.width,c=u.height,f=document.createElement("canvas"),v=f.getContext("2d");f.width=d,f.height=c,x=x||v.createImageData(d,c);for(var h=x.data,T=d*c,b=r*T,y=new Uint8Array(i,b,T),C=0;C<y.length;C+=1){var w=y[C],M=4*C;if(w){var P=p.regionColorsRGB[w-1];h[M+0]=P[0],h[M+1]=P[1],h[M+2]=P[2],h[M+3]=255*p.drawAlpha}else h[M+3]=0}v.putImageData(x,0,0),g.setToPixelCoordinateSystem(s,l),l.drawImage(f,0,0)}}function i(e,t){var n=(0,m.getToolState)(e,"regions");if(!n.data[0]||!n.data[0].enabled){console.log("*** ENABLING regionsThreshold ***"),v=e;var o=(0,m.getToolState)(e,"stack");if(o&&o.data&&o.data.length){var i={enabled:1,buffer:null,width:null,height:null,history:[]};(0,m.addToolState)(e,"regions",i);var l=o.data[0];setTimeout(function(){a(l,function(n){var o=(0,m.getToolState)(e,"regions");o.data[0].buffer=n.buffer,o.data[0].width=n.width,o.data[0].height=n.height,e.addEventListener("CornerstoneImageRendered",r),g.updateImage(e),"function"==typeof t&&t()})},100)}}}function l(e){var t=(0,m.getToolState)(e,"regions");t&&t.data.length&&(t.data[0].enabled=!1)}function s(e){var t=e||v;return new Promise(function(e,n){l(t),i(t,function(){e()})})}function u(e){console.log("CREATE UNDO STEP");var t=(0,m.getToolState)(e,"regions"),n=t.data[0],o=n.buffer.slice();n.history.push(o),n.history.length>p.historySize&&n.history.shift()}function d(){return console.log("GETCONFIGURATION"),p}function c(e){console.log("SETCONFIGURATION"),p=e}Object.defineProperty(t,"__esModule",{value:!0}),t.getLastElement=o,t.update=s,t.createUndoStep=u,t.getConfiguration=d,t.setConfiguration=c;var f=n(19),g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(f),m=n(1),v=null,h=1,p={historySize:4,historyPosition:0,toolRegionValue:2,calciumThresholdHu:"-",layersAbove:0,layersBelow:0,drawAlpha:1,regionColorsRGB:[[255,0,255],[246,193,91],[237,148,69],[230,103,49],[184,74,41],[106,58,45]],kvpToMultiplier:{150:1.06,140:1.04,130:1.02,120:1,110:.98,100:.96,90:.93,80:.89,70:.85},growIterationsPerChunk:2};console.log("CONFIGURATION"),p.calciumThresholdHuParsed=parseInt(p.calciumThresholdHu);var x=null;t.default={activate:i,deactivate:l,update:s,enable:i,disable:l,getConfiguration:d,setConfiguration:c}},function(e,t,n){"use strict";function o(e,t){var n=e.clone().sub(t.imagePositionPatient);return{x:t.rowCosines.dot(n)/t.columnPixelSpacing,y:t.columnCosines.dot(n)/t.rowPixelSpacing}}function a(e,t){var n=t.rowCosines.clone().multiplyScalar(e.x);n.multiplyScalar(t.columnPixelSpacing);var o=t.columnCosines.clone().multiplyScalar(e.y);o.multiplyScalar(t.rowPixelSpacing);var a=n.add(o);return a.add(t.imagePositionPatient),a}function r(e){var t=a({x:0,y:0},e),n=a({x:e.columns,y:0},e),o=a({x:0,y:e.rows},e),r=a({x:e.columns,y:e.rows},e);return{top:new s.cornerstoneMath.Line3(t,n),left:new s.cornerstoneMath.Line3(t,o),right:new s.cornerstoneMath.Line3(n,r),bottom:new s.cornerstoneMath.Line3(o,r)}}function i(e,t){var n=[];return Object.keys(t).forEach(function(o){var a=t[o],r=e.intersectLine(a);r&&n.push(r)}),n}function l(e,t){var n=e.rowCosines.clone().cross(e.columnCosines),o=new s.cornerstoneMath.Plane;o.setFromNormalAndCoplanarPoint(n,e.imagePositionPatient);var l=t.rowCosines.clone().cross(t.columnCosines),u=new s.cornerstoneMath.Plane;u.setFromNormalAndCoplanarPoint(l,t.imagePositionPatient);var d=u.clone().intersectPlane(o),c=d.origin,f=d.direction,g=a({x:t.columns,y:t.rows},t),m=t.imagePositionPatient.distanceTo(g),v=new s.cornerstoneMath.Line3;v.start=c,v.end=c.clone().add(f.multiplyScalar(m));var h=r(t),p=i(v,h);if(2===p.length)return{start:p[0],end:p[1]}}Object.defineProperty(t,"__esModule",{value:!0}),t.projectPatientPointToImagePlane=o,t.imagePointToPatientPoint=a,t.planePlaneIntersection=l;var s=n(0)},function(e,t,n){"use strict";function o(e,t,n,o,a,r){if(!f.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var i={type:n,imageId:t,preventCache:o,doneCallback:a,failCallback:r},l=d.external.cornerstone.imageCache.getImagePromise(t);if(l)return void l.then(function(e){a(e)},function(e){r(e)});f[n].push(i)}}function a(e){if(!f.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");f[e]=[]}function r(){v&&setTimeout(function(){l()},h)}function i(e){var t=d.external.cornerstone,n=e.type;g[n]++,v=!0;var o=e.imageId,a=e.doneCallback,i=e.failCallback,l=t.imageCache.getImagePromise(o);if(l)return void l.then(function(e){g[n]--,a(e),r()},function(e){g[n]--,i(e),r()});var s=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e),u=void 0;u=!0===e.preventCache?t.loadImage(o,{priority:s,type:e.type}):t.loadAndCacheImage(o,{priority:s,type:e.type}),u.then(function(e){g[n]--,a(e),r()},function(e){g[n]--,i(e),r()})}function l(){var e=(0,c.getMaxSimultaneousRequests)();m={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=g.interaction+g.thumbnail+g.prefetch,n=e-t,o=0;o<n;o++){var a=s();a&&i(a)}}function s(){return f.interaction.length&&g.interaction<m.interaction?f.interaction.shift():f.thumbnail.length&&g.thumbnail<m.thumbnail?f.thumbnail.shift():f.prefetch.length&&g.prefetch<m.prefetch?f.prefetch.shift():(f.interaction.length||f.thumbnail.length||f.prefetch.length||(v=!1),!1)}function u(){return f}Object.defineProperty(t,"__esModule",{value:!0});var d=n(0),c=n(20),f={interaction:[],thumbnail:[],prefetch:[]},g={interaction:0,thumbnail:0,prefetch:0},m={interaction:6,thumbnail:6,prefetch:5},v=!1,h=20;t.default={addRequest:o,clearRequestStack:a,startGrabbing:l,getRequestPool:u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n={},a="CornerstoneToolsMultiTouchDrag";return t&&!0===t.fireOnTouchStart&&(a+=" CornerstoneToolsMultiTouchStart"),{activate:function(n){o.external.$(n).off(a,e),t&&t.eventData?o.external.$(n).on(a,t.eventData,e):o.external.$(n).on(a,e),t&&t.activateCallback&&t.activateCallback(n)},disable:function(n){o.external.$(n).off(a,e),t&&t.disableCallback&&t.disableCallback(n)},enable:function(n){o.external.$(n).off(a,e),t&&t.enableCallback&&t.enableCallback(n)},deactivate:function(n){o.external.$(n).off(a,e),t&&t.deactivateCallback&&t.deactivateCallback(n)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(0,r.getToolState)(e,"stack");if(o&&o.data&&o.data.length){var i=o.data[0],l=i.currentImageIdIndex+t;if(n){l%=i.imageIds.length}else l=Math.min(i.imageIds.length-1,l),l=Math.max(0,l);(0,a.default)(e,l)}};var o=n(44),a=function(e){return e&&e.__esModule?e:{default:e}}(o),r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.width/2,o=e.height/2;if(n<=0||o<=0)return!1;var a={x:e.left+n,y:e.top+o},r={x:t.x-a.x,y:t.y-a.y};return r.x*r.x/(n*n)+r.y*r.y/(o*o)<=1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,r){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i=o.external.cornerstone.getEnabledElement(e),l=[],s=0,u=i.image.getPixelData(),d=void 0,c=void 0,f=void 0;if(i.image.color)for(c=0;c<r;c++)for(f=0;f<a;f++){d=4*((c+n)*i.image.columns+(f+t));var g=u[d],m=u[d+1],v=u[d+2],h=u[d+3];l[s++]=g,l[s++]=m,l[s++]=v,l[s++]=h}return l};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{page:o.cornerstoneMath.point.copy(e.page),image:o.cornerstoneMath.point.copy(e.image),client:o.cornerstoneMath.point.copy(e.client),canvas:o.cornerstoneMath.point.copy(e.canvas)}};var o=n(0)},function(e,t,n){"use strict";function o(e){r=e.currentPoints.canvas}function a(){return r}Object.defineProperty(t,"__esModule",{value:!0});var r=void 0,i={setCoords:o,getCoords:a};t.default=i},function(e,t,n){"use strict";function o(e){var t=void 0;return Object.keys(e).forEach(function(n){var o=e[n];if(!0===o.active)return void(t=o)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){a||(a=6);var i=o(t),l=(0,r.default)(e,t,n,a);return i!==l&&(void 0!==l&&(l.active=!0),void 0!==i&&(i.active=!1),!0)};var a=n(18),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r,s){function d(e,n){t.active=!0,Object.keys(t.handles).forEach(function(e){var o=t.handles[e];!0!==o.movesIndependently&&(o.x+=n.deltaPoints.image.x,o.y+=n.deltaPoints.image.y,!0===r.preventHandleOutsideImage&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,n.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,n.image.height)))}),f.updateImage(g);var a={toolType:o,element:g,measurementData:t};return(0,u.default)(g,"CornerstoneToolsMeasurementModified",a),!1}function c(e,n){t.invalidated=!0,a.external.$(g).off("CornerstoneToolsMouseDrag",d),a.external.$(g).off("CornerstoneToolsMouseUp",c),a.external.$(g).off("CornerstoneToolsMouseClick",c),!0===r.deleteIfHandleOutsideImage&&(0,i.default)(n,t.handles)&&(0,l.removeToolState)(g,o,t),f.updateImage(g),"function"==typeof s&&s()}var f=a.external.cornerstone,g=e.element;return a.external.$(g).on("CornerstoneToolsMouseDrag",d),a.external.$(g).on("CornerstoneToolsMouseUp",c),a.external.$(g).on("CornerstoneToolsMouseClick",c),!0};var a=n(0),r=n(12),i=o(r),l=n(1),s=n(3),u=o(s)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=(0,a.getToolState)(e,"timeSeries");if(r&&r.data&&r.data.length){var l=o.external.cornerstone,s=r.data[0],u=s.stacks[s.currentStackIndex],d=u.currentImageIdIndex,c=s.currentStackIndex+t;if(n?(c>=s.stacks.length&&(c=0),c<0&&(c=s.stacks.length-1)):(c=Math.min(s.stacks.length-1,c),c=Math.max(0,c)),c!==s.currentStackIndex){var f=l.getViewport(e),g=s.stacks[c],m=i.default.getStartLoadHandler(),v=i.default.getEndLoadHandler(),h=i.default.getErrorLoadingHandler();m&&m(e);var p=void 0;p=!0===g.preventCache?l.loadImage(g.imageIds[d]):l.loadAndCacheImage(g.imageIds[d]),p.then(function(t){s.currentImageIdIndex!==d&&(g.currentImageIdIndex=d,s.currentStackIndex=c,l.displayImage(e,t,f),v&&v(e,t))},function(t){var n=g.imageIds[d];h&&h(e,n,t)})}}};var o=n(0),a=n(1),r=n(10),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,o.planePlaneIntersection)(e,t);if(n)return{start:(0,o.projectPatientPointToImagePlane)(n.start,e),end:(0,o.projectPatientPointToImagePlane)(n.end,e)}};var o=n(27)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){var r=a.external.cornerstone,l=r.getEnabledElement(n).image,u=r.getEnabledElement(o).image;if(l&&u){var c=r.metaData.get("imagePlaneModule",l.imageId),f=r.metaData.get("imagePlaneModule",u.imageId);if(c&&f&&c.rowCosines&&c.columnCosines&&c.imagePositionPatient&&f.rowCosines&&f.columnCosines&&f.imagePositionPatient&&c.frameOfReferenceUID===f.frameOfReferenceUID){var g=c.rowCosines.clone().cross(c.columnCosines),m=f.rowCosines.clone().cross(f.columnCosines),v=g.angleTo(m);if(!((v=Math.abs(v))<.5)){var h=(0,i.default)(c,f);if(h){var p=r.pixelToCanvas(t.element,h.start),x=r.pixelToCanvas(t.element,h.end),T=s.default.getActiveColor(),b=d.default.getToolWidth();e.setTransform(1,0,0,1,0,0),e.save(),e.beginPath(),e.strokeStyle=T,e.lineWidth=b,e.moveTo(p.x,p.y),e.lineTo(x.x,x.y),e.stroke(),e.restore()}}}}};var a=n(0),r=n(40),i=o(r),l=n(4),s=o(l),u=n(5),d=o(u)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(65),r=o(a),i=n(66),l=o(i),s={getOrientationString:r.default,invertOrientationString:l.default};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return o.external.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function n(n){if(m.currentImageIdIndex===t){try{s.getEnabledElement(e)}catch(e){return}c?(c.currentImageIdIndex=t,c.render(e,i.data)):s.displayImage(e,n),h&&h(e,n)}}function o(n){var o=m.imageIds[t];p&&p(e,o,n)}var i=(0,r.getToolState)(e,"stack");if(i&&i.data&&i.data.length){var s=a.external.cornerstone,c=void 0;if(i.data.length>1){var g=(0,r.getToolState)(e,"stackRenderer");g&&g.data&&g.data.length&&(c=g.data[0])}var m=i.data[0];t<0&&(t+=m.imageIds.length);var v=u.default.getStartLoadHandler(),h=u.default.getEndLoadHandler(),p=u.default.getErrorLoadingHandler();if(t!==m.currentImageIdIndex){v&&v(e);var x={newImageIdIndex:t,direction:t-m.currentImageIdIndex};m.currentImageIdIndex=t;var T=m.imageIds[t],b=d.stackScroll.getConfiguration();if(b&&!0===b.retryLoadOnScroll){var y=s.imageCache.getImagePromise(T);y&&"rejected"===y.state()&&s.imageCache.removeImagePromise(T)}var C=Boolean(m.preventCache),w=void 0;w=C?s.loadImage(T):s.loadAndCacheImage(T),w.then(n,o),l.default.startGrabbing(),(0,f.default)(e,"CornerstoneStackScroll",x)}}};var a=n(0),r=n(1),i=n(28),l=o(i),s=n(10),u=o(s),d=n(45),c=n(3),f=o(c)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){u.external.$(t.element).off("CornerstoneToolsMouseDrag",l),u.external.$(t.element).off("CornerstoneToolsMouseUp",a),u.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask)){var n={deltaY:0};return u.external.$(t.element).on("CornerstoneToolsMouseDrag",n,l),u.external.$(t.element).on("CornerstoneToolsMouseUp",a),u.external.$(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function i(e,t){var n=-t.direction,o=w.getConfiguration(),a=!1;o&&o.loop&&(a=o.loop),(0,y.default)(t.element,n,a)}function l(e,t){var n=t.element,o=(0,C.getToolState)(n,"stack");if(o&&o.data&&o.data.length){var a=o.data[0],r=w.getConfiguration(),i=Math.max(2,u.external.$(n).height()/Math.max(a.imageIds.length,8));if(r&&r.stackScrollSpeed&&(i=r.stackScrollSpeed),e.data.deltaY=e.data.deltaY||0,e.data.deltaY+=t.deltaPoints.page.y,Math.abs(e.data.deltaY)>=i){var l=e.data.deltaY/i,s=Math.round(l),d=e.data.deltaY%i;e.data.deltaY=d,(0,y.default)(n,s)}return!1}}function s(e,t){var n=_.getConfiguration();n&&n.testPointers(t)&&l(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=void 0;var u=n(0),d=n(11),c=o(d),f=n(29),g=o(f),m=n(13),v=o(m),h=n(21),p=o(h),x=n(2),T=o(x),b=n(30),y=o(b),C=n(1),w=(0,v.default)(r),M=(0,p.default)(i),P={eventData:{deltaY:0}},I=(0,c.default)(l,P),S={testPointers:function(e){return e.numPointers>=3}},_=(0,g.default)(s,P);_.setConfiguration(S),t.stackScroll=w,t.stackScrollWheel=M,t.stackScrollTouchDrag=I,t.stackScrollMultiTouch=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,r){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i=o.external.cornerstone.getEnabledElement(e),l=i.image,s=[],u=0,d=l.getPixelData(),c=void 0,f=void 0,g=void 0;if(l.color)for(f=0;f<r;f++)for(g=0;g<a;g++){c=4*((f+n)*l.columns+(g+t));var m=d[c],v=d[c+1],h=d[c+2];s[u++]=.2126*m+.7152*v+.0722*h}else for(f=0;f<r;f++)for(g=0;g<a;g++)c=(f+n)*l.columns+(g+t),s[u++]=d[c]*l.slope+l.intercept;return s};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,a){var r=o/2*.5522848,i=a/2*.5522848,l=t+o,s=n+a,u=t+o/2,d=n+a/2;e.beginPath(),e.moveTo(t,d),e.bezierCurveTo(t,d-i,u-r,n,u,n),e.bezierCurveTo(u+r,n,l,d-i,l,d),e.bezierCurveTo(l,d+i,u+r,s,u,s),e.bezierCurveTo(u-r,s,t,d+i,t,d),e.closePath(),e.stroke()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){e.beginPath(),e.strokeStyle=n,e.lineWidth=o,e.arc(t.x,t.y,6,0,2*Math.PI),e.stroke()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,a){var r=Math.atan2(n.y-t.y,n.x-t.x);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.strokeStyle=o,e.lineWidth=a,e.stroke(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x-10*Math.cos(r-Math.PI/7),n.y-10*Math.sin(r-Math.PI/7)),e.lineTo(n.x-10*Math.cos(r+Math.PI/7),n.y-10*Math.sin(r+Math.PI/7)),e.lineTo(n.x,n.y),e.lineTo(n.x-10*Math.cos(r-Math.PI/7),n.y-10*Math.sin(r-Math.PI/7)),e.strokeStyle=o,e.lineWidth=a,e.stroke(),e.fillStyle=o,e.fill()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=0,o=0,r=0,i=0,l=t.top;l<t.top+t.height;l++)for(var s=t.left;s<t.left+t.width;s++){var u={x:s,y:l};(0,a.default)(t,u)&&(n+=e[i],o+=e[i]*e[i],r++),i++}if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var d=n/r,c=o/r-d*d;return{count:r,mean:d,variance:c,stdDev:Math.sqrt(c)}};var o=n(32),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e),o.external.$(t).on("CornerstoneToolsKeyDown",e)},disable:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r,s){function d(e,n){t.active=!0,Object.keys(t.handles).forEach(function(e){var o=t.handles[e];!0!==o.movesIndependently&&(o.x+=n.deltaPoints.image.x,o.y+=n.deltaPoints.image.y)}),g.updateImage(f);var a={toolType:o,element:f,measurementData:t};return(0,u.default)(f,"CornerstoneToolsMeasurementModified",a),!1}function c(e,n){t.active=!1,t.invalidated=!1,a.external.$(f).off("CornerstoneToolsTouchDrag",d),a.external.$(f).off("CornerstoneToolsTouchPinch",c),a.external.$(f).off("CornerstoneToolsTouchPress",c),a.external.$(f).off("CornerstoneToolsTouchEnd",c),a.external.$(f).off("CornerstoneToolsDragEnd",c),a.external.$(f).off("CornerstoneToolsTap",c),!0===r&&(0,i.default)(n,t.handles)&&(0,l.removeToolState)(f,o,t),g.updateImage(f),"function"==typeof s&&s(e,n)}var f=e.element,g=a.external.cornerstone;return a.external.$(f).on("CornerstoneToolsTouchDrag",d),a.external.$(f).on("CornerstoneToolsTouchPinch",c),a.external.$(f).on("CornerstoneToolsTouchPress",c),a.external.$(f).on("CornerstoneToolsTouchEnd",c),a.external.$(f).on("CornerstoneToolsDragEnd",c),a.external.$(f).on("CornerstoneToolsTap",c),!0};var a=n(0),r=n(12),i=o(r),l=n(1),s=n(3),u=o(s)},function(e,t,n){"use strict";function o(e,t,n,r,i){if(n.value){var l=a.external.cornerstone,s=(new Date).getTime(),u=Math.abs(t.y-i.y),d=u/10;if(console.log("distanceRemaining: "+u),u<1)return t.y=i.y,void(n.value=!1);t.y>i.y?t.y-=d:t.y<i.y&&(t.y+=d),l.updateImage(r.element),l.requestAnimationFrame(function(){o(s,t,n,r,i)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,u){function d(e,o){l.value=!1,!1===r.hasMoved&&(r.hasMoved=!0),r.active=!0;var a=o.currentPoints,s={x:a.page.x,y:a.page.y+h};x=f.pageToPixel(g,s.x,s.y),r.x=x.x,r.y=x.y,f.updateImage(g);var u={toolType:t,element:g,measurementData:n};(0,i.default)(g,"CornerstoneToolsMeasurementModified",u)}function c(t,o){l.value=!1,r.active=!1,a.external.$(g).off("CornerstoneToolsTouchDrag",d),a.external.$(g).off(s,c),f.updateImage(g),"CornerstoneToolsTouchPress"===t.type&&(o.handlePressed=n,r.x=e.currentPoints.image.x,r.y=e.currentPoints.image.y),"function"==typeof u&&u(t,o)}l.value=!0;var f=a.external.cornerstone,g=e.element,m=f.getEnabledElement(g),v=(new Date).getTime(),h=-57,p={x:e.currentPoints.page.x,y:e.currentPoints.page.y+h},x=f.pageToPixel(g,p.x,p.y);a.external.$(g).on("CornerstoneToolsTouchDrag",d),a.external.$(g).on(s,c),o(v,r,l,m,x)};var a=n(0),r=n(3),i=function(e){return e&&e.__esModule?e:{default:e}}(r),l={value:!1},s=["CornerstoneToolsTouchEnd","CornerstoneToolsDragEnd","CornerstoneToolsTouchPinch","CornerstoneToolsTouchPress","CornerstoneToolsTap"].join(" ")},function(e,t,n){"use strict";function o(e,t){var n=Date.now();if(e!==c){if(n-f<=u)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;c=e}f=n}function a(e,t,n){var o=n?g:m;t.forEach(function(t){s.external.$(e).on(t,o)})}function r(e,t,n){var o=n?g:m;t.forEach(function(t){s.external.$(e).off(t,o)})}function i(e){r(e,v,d.mouse),r(e,h,d.touch)}function l(e){i(e),a(e,v,d.mouse),a(e,h,d.touch)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),u=2e3,d={mouse:0,touch:1},c=void 0,f=void 0,g=o.bind(null,d.mouse),m=o.bind(null,d.touch),v=["mousedown","mouseup"],h=["touchstart","touchend"],p={enable:l,disable:i};t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e);var n={};o.external.$(t).on("CornerstoneToolsDoubleTap",n,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e)}}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function n(n){var o=e.createNewMeasurement(n);o&&((0,T.addToolState)(n.element,e.toolType,o),a.external.$(n.element).off("CornerstoneToolsMouseMove",r),(0,f.default)(n,e.toolType,o,o.handles.end,function(){o.active=!1,(0,h.default)(n,o.handles)&&(0,T.removeToolState)(n.element,e.toolType,o),a.external.$(n.element).on("CornerstoneToolsMouseMove",r)},t))}function o(e,t){if((0,x.default)(t.which,e.data.mouseButtonMask))return n(t),!1}function r(t,n){if(i.default.setCoords(n),0===n.which){var o=(0,T.getToolState)(n.element,e.toolType);if(void 0!==o){for(var r=!1,l=n.currentPoints.canvas,s=0;s<o.data.length;s++){var u=o.data[s];!0===(0,d.default)(n.element,u.handles,l)&&(r=!0),(e.pointInsideRect(n.element,u,l)&&!u.active||!e.pointInsideRect(n.element,u,l)&&u.active)&&(u.active=!u.active,r=!0)}!0===r&&a.external.cornerstone.updateImage(n.element)}}}function l(n,o){function i(){u.active=!1,(0,h.default)(o,u.handles)&&(0,T.removeToolState)(o.element,e.toolType,u),l.updateImage(o.element),a.external.$(o.element).on("CornerstoneToolsMouseMove",r)}var l=a.external.cornerstone,u=void 0;if((0,x.default)(o.which,n.data.mouseButtonMask)){var d=o.startPoints.canvas,c=(0,T.getToolState)(n.currentTarget,e.toolType),g=void 0;if(void 0!==c)for(g=0;g<c.data.length;g++){u=c.data[g];var v=(0,s.default)(o.element,u.handles,d,25);if(void 0!==v)return a.external.$(o.element).off("CornerstoneToolsMouseMove",r),u.active=!0,(0,f.default)(o,e.toolType,u,v,i,t),n.stopImmediatePropagation(),!1}var p={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:t};if(void 0!==c&&void 0!==e.pointInsideRect)for(g=0;g<c.data.length;g++)if(u=c.data[g],e.pointInsideRect(o.element,u,d))return a.external.$(o.element).off("CornerstoneToolsMouseMove",r),(0,m.default)(n,u,c,e.toolType,p,i),a.external.$(o.element).on("CornerstoneToolsMouseMove",r),n.stopImmediatePropagation(),!1}}function u(t){e.onImageRendered(t,t.detail)}function c(e){e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",l),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),a.external.cornerstone.updateImage(e)}function g(e){e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",l),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),e.addEventListener("cornerstoneimagerendered",u),a.external.cornerstone.updateImage(e)}function v(e,t){var n={mouseButtonMask:t};e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",l),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),e.addEventListener("cornerstoneimagerendered",u),a.external.$(e).on("CornerstoneToolsMouseMove",n,r),a.external.$(e).on("CornerstoneToolsMouseDown",n,l),a.external.$(e).on("CornerstoneToolsMouseDownActivate",n,o),a.external.cornerstone.updateImage(e)}function p(e,t){var n={mouseButtonMask:t};e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",l),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),e.addEventListener("cornerstoneimagerendered",u),a.external.$(e).on("CornerstoneToolsMouseMove",n,r),a.external.$(e).on("CornerstoneToolsMouseDown",n,l),a.external.cornerstone.updateImage(e)}return{enable:g,disable:c,activate:v,deactivate:p}};var a=n(0),r=n(36),i=o(r),l=n(18),s=o(l),u=n(37),d=o(u),c=n(22),f=o(c),g=n(38),m=o(g),v=n(12),h=o(v),p=n(2),x=o(p),T=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e);var n={};o.external.$(t).on("CornerstoneToolsTouchPinch",n,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e)}}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t,n){e.onMouseMove(t,n)}function n(r,i){e.onMouseUp(r,i),a.external.$(i.element).off("CornerstoneToolsMouseDrag",t),a.external.$(i.element).off("CornerstoneToolsMouseDrag",o),a.external.$(i.element).off("CornerstoneToolsMouseUp",n),a.external.$(i.element).off("CornerstoneToolsMouseClick",n)}function o(t,n){return e.onDrag(t,n),!1}function i(r,i){if((0,u.default)(i.which,r.data.mouseButtonMask))return a.external.$(i.element).on("CornerstoneToolsMouseDrag",o),a.external.$(i.element).on("CornerstoneToolsMouseUp",n),a.external.$(i.element).on("CornerstoneToolsMouseClick",n),e.onMouseDown(r,i),!1;a.external.$(i.element).on("CornerstoneToolsMouseDrag",t),a.external.$(i.element).on("CornerstoneToolsMouseUp",n)}function s(t){var n=t.detail,o=n.element,i=(0,r.getToolState)(o,d),l=void 0;i?l=i.data[0].pixelData:(l=new Uint8ClampedArray(n.image.width*n.image.height),(0,r.addToolState)(o,d,{pixelData:l}));var s=a.external.cornerstone.getLayer(n.element,c);s.image.setPixelData(l),s.invalid=!0,a.external.cornerstone.updateImage(o),e.onImageRendered(t,n)}function f(e,n){e.removeEventListener("cornerstoneimagerendered",s),e.addEventListener("cornerstoneimagerendered",s);var o={mouseButtonMask:n};a.external.$(e).off("CornerstoneToolsMouseDownActivate",i),a.external.$(e).on("CornerstoneToolsMouseDownActivate",o,i),a.external.$(e).off("CornerstoneToolsMouseMove",t),a.external.$(e).on("CornerstoneToolsMouseMove",t);var l=a.external.cornerstone.getEnabledElement(e),u=l.image,f=u.width,g=u.height,v=new Uint8ClampedArray(f*g),h=m.getConfiguration(),p=h.colormapId;if(!p){p="BrushColorMap";var x=a.external.cornerstone.colors.getColormap(p);x.setNumberOfColors(2),x.setColor(0,[0,0,0,0]),x.setColor(1,[255,0,0,255])}var T={minPixelValue:0,maxPixelValue:1,slope:1,intercept:0,getPixelData:function(){return v},rows:l.image.height,columns:l.image.width,height:g,width:f,pixelData:v,setPixelData:function(e){v=e},colormap:p,color:!1,rgba:!1,labelmap:!0,invert:!1,columnPixelSpacing:1,rowPixelSpacing:1,sizeInBytes:l.image.width*l.image.height},b=void 0,y={viewport:{pixelReplication:!0}};c&&(b=a.external.cornerstone.getLayer(e,c)),b||(c=a.external.cornerstone.addLayer(e,T,y)),(0,r.addToolState)(e,d,{pixelData:v}),h.brushLayerId=c,m.setConfiguration(h),a.external.cornerstone.updateImage(e)}function g(e){e.removeEventListener("cornerstoneimagerendered",s),a.external.$(e).off("CornerstoneToolsMouseDownActivate",i),a.external.$(e).off("CornerstoneToolsMouseMove",t)}var m=(0,l.default)({mouseMoveCallback:t,mouseDownActivateCallback:i,onImageRendered:s,deactivate:g});return m.activate=f,m};var a=n(0),r=n(1),i=n(7),l=o(i),s=n(2),u=o(s),d="brush",c=void 0},function(e,t,n){"use strict";function o(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=Math.round(o),i=Math.round(a);if(1===e)return[[r,i]];for(var l=[],s=0,u=-e;u<=e;u++){var d=i+u;if(!(d>t||d<0))for(var c=-e;c<=e;c++){var f=r+c;f>n||f<0||c*c+u*u<e*e&&(l[s++]=[r+c,i+u])}}return l}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";function o(e,t,n,o){var a=function(e,t){return t*o+e};e.forEach(function(e){var o=a(e[0],e[1]);t[o]=n})}function a(e,t,n,o){var a=r.external.cornerstone.pixelToCanvas(o,{x:0,y:0}),i=r.external.cornerstone.pixelToCanvas(o,{x:1,y:1}),l=i.x-a.x,s=i.y-a.y;t.save(),t.fillStyle=n,e.forEach(function(e){var n=r.external.cornerstone.pixelToCanvas(o,{x:e[0],y:e[1]});t.fillRect(n.x,n.y,l,s)}),t.restore()}Object.defineProperty(t,"__esModule",{value:!0}),t.drawBrushOnCanvas=t.drawBrushPixels=void 0;var r=n(0);t.drawBrushPixels=o,t.drawBrushOnCanvas=a},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return a.external}});var r=n(63);Object.defineProperty(t,"referenceLines",{enumerable:!0,get:function(){return o(r).default}});var i=n(42);Object.defineProperty(t,"orientation",{enumerable:!0,get:function(){return o(i).default}});var l=n(28);Object.defineProperty(t,"requestPoolManager",{enumerable:!0,get:function(){return o(l).default}});var s=n(43);Object.defineProperty(t,"setContextToDisplayFontSize",{enumerable:!0,get:function(){return o(s).default}});var u=n(44);Object.defineProperty(t,"scrollToIndex",{enumerable:!0,get:function(){return o(u).default}});var d=n(30);Object.defineProperty(t,"scroll",{enumerable:!0,get:function(){return o(d).default}});var c=n(31);Object.defineProperty(t,"roundToDecimal",{enumerable:!0,get:function(){return o(c).default}});var f=n(27);Object.defineProperty(t,"projectPatientPointToImagePlane",{enumerable:!0,get:function(){return f.projectPatientPointToImagePlane}}),Object.defineProperty(t,"imagePointToPatientPoint",{enumerable:!0,get:function(){return f.imagePointToPatientPoint}}),Object.defineProperty(t,"planePlaneIntersection",{enumerable:!0,get:function(){return f.planePlaneIntersection}});var g=n(16);Object.defineProperty(t,"pointInsideBoundingBox",{enumerable:!0,get:function(){return o(g).default}});var m=n(32);Object.defineProperty(t,"pointInEllipse",{enumerable:!0,get:function(){return o(m).default}});var v=n(33);Object.defineProperty(t,"pauseEvent",{enumerable:!0,get:function(){return o(v).default}});var h=n(2);Object.defineProperty(t,"isMouseButtonEnabled",{enumerable:!0,get:function(){return o(h).default}});var p=n(34);Object.defineProperty(t,"getRGBPixels",{enumerable:!0,get:function(){return o(p).default}});var x=n(20);Object.defineProperty(t,"getDefaultSimultaneousRequests",{enumerable:!0,get:function(){return x.getDefaultSimultaneousRequests}}),Object.defineProperty(t,"getMaxSimultaneousRequests",{enumerable:!0,get:function(){return x.getMaxSimultaneousRequests}}),Object.defineProperty(t,"getBrowserInfo",{enumerable:!0,get:function(){return x.getBrowserInfo}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return x.isMobileDevice}});var T=n(46);Object.defineProperty(t,"getLuminance",{enumerable:!0,get:function(){return o(T).default}});var b=n(6);Object.defineProperty(t,"drawTextBox",{enumerable:!0,get:function(){return o(b).default}});var y=n(47);Object.defineProperty(t,"drawEllipse",{enumerable:!0,get:function(){return o(y).default}});var C=n(48);Object.defineProperty(t,"drawCircle",{enumerable:!0,get:function(){return o(C).default}});var w=n(49);Object.defineProperty(t,"drawArrow",{enumerable:!0,get:function(){return o(w).default}});var M=n(35);Object.defineProperty(t,"copyPoints",{enumerable:!0,get:function(){return o(M).default}});var P=n(17);Object.defineProperty(t,"calculateSUV",{enumerable:!0,get:function(){return o(P).default}});var I=n(50);Object.defineProperty(t,"calculateEllipseStatistics",{enumerable:!0,get:function(){return o(I).default}});var S=n(67);Object.defineProperty(t,"probeTool4D",{enumerable:!0,get:function(){return o(S).default}});var _=n(39);Object.defineProperty(t,"incrementTimePoint",{enumerable:!0,get:function(){return o(_).default}});var O=n(70);Object.defineProperty(t,"timeSeriesPlayer",{enumerable:!0,get:function(){return o(O).default}});var E=n(71);Object.defineProperty(t,"timeSeriesScroll",{enumerable:!0,get:function(){return E.timeSeriesScroll}}),Object.defineProperty(t,"timeSeriesScrollWheel",{enumerable:!0,get:function(){return E.timeSeriesScrollWheel}}),Object.defineProperty(t,"timeSeriesScrollTouchDrag",{enumerable:!0,get:function(){return E.timeSeriesScrollTouchDrag}});var k=n(72);Object.defineProperty(t,"wwwcSynchronizer",{enumerable:!0,get:function(){return o(k).default}});var D=n(73);Object.defineProperty(t,"updateImageSynchronizer",{enumerable:!0,get:function(){return o(D).default}});var $=n(74);Object.defineProperty(t,"Synchronizer",{enumerable:!0,get:function(){return o($).default}});var j=n(75);Object.defineProperty(t,"stackScrollSynchronizer",{enumerable:!0,get:function(){return o(j).default}});var R=n(76);Object.defineProperty(t,"stackImagePositionSynchronizer",{enumerable:!0,get:function(){return o(R).default}});var L=n(77);Object.defineProperty(t,"stackImagePositionOffsetSynchronizer",{enumerable:!0,get:function(){return o(L).default}});var A=n(78);Object.defineProperty(t,"stackImageIndexSynchronizer",{enumerable:!0,get:function(){return o(A).default}});var B=n(79);Object.defineProperty(t,"panZoomSynchronizer",{enumerable:!0,get:function(){return o(B).default}});var V=n(5);Object.defineProperty(t,"toolStyle",{enumerable:!0,get:function(){return o(V).default}});var U=n(1);Object.defineProperty(t,"addToolState",{enumerable:!0,get:function(){return U.addToolState}}),Object.defineProperty(t,"getToolState",{enumerable:!0,get:function(){return U.getToolState}}),Object.defineProperty(t,"removeToolState",{enumerable:!0,get:function(){return U.removeToolState}}),Object.defineProperty(t,"clearToolState",{enumerable:!0,get:function(){return U.clearToolState}}),Object.defineProperty(t,"setElementToolStateManager",{enumerable:!0,get:function(){return U.setElementToolStateManager}}),Object.defineProperty(t,"getElementToolStateManager",{enumerable:!0,get:function(){return U.getElementToolStateManager}});var N=n(36);Object.defineProperty(t,"toolCoordinates",{enumerable:!0,get:function(){return o(N).default}});var W=n(4);Object.defineProperty(t,"toolColors",{enumerable:!0,get:function(){return o(W).default}});var F=n(80);Object.defineProperty(t,"addTimeSeriesStateManager",{enumerable:!0,get:function(){return F.addTimeSeriesStateManager}}),Object.defineProperty(t,"newTimeSeriesSpecificToolStateManager",{enumerable:!0,get:function(){return F.newTimeSeriesSpecificToolStateManager}});var z=n(14);Object.defineProperty(t,"textStyle",{enumerable:!0,get:function(){return o(z).default}});var H=n(81);Object.defineProperty(t,"stackSpecificStateManager",{enumerable:!0,get:function(){return H.stackSpecificStateManager}}),Object.defineProperty(t,"newStackSpecificToolStateManager",{enumerable:!0,get:function(){return H.newStackSpecificToolStateManager}}),Object.defineProperty(t,"addStackStateManager",{enumerable:!0,get:function(){return H.addStackStateManager}});var Y=n(10);Object.defineProperty(t,"loadHandlerManager",{enumerable:!0,get:function(){return o(Y).default}});var X=n(15);Object.defineProperty(t,"newImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.newImageIdSpecificToolStateManager}}),Object.defineProperty(t,"globalImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.globalImageIdSpecificToolStateManager}});var G=n(82);Object.defineProperty(t,"newFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return G.newFrameOfReferenceSpecificToolStateManager}}),Object.defineProperty(t,"globalFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return G.globalFrameOfReferenceSpecificToolStateManager}});var q=n(83);Object.defineProperty(t,"appState",{enumerable:!0,get:function(){return o(q).default}});var K=n(84);Object.defineProperty(t,"stackScrollKeyboard",{enumerable:!0,get:function(){return o(K).default}});var Z=n(45);Object.defineProperty(t,"stackScroll",{enumerable:!0,get:function(){return Z.stackScroll}}),Object.defineProperty(t,"stackScrollWheel",{enumerable:!0,get:function(){return Z.stackScrollWheel}}),Object.defineProperty(t,"stackScrollTouchDrag",{enumerable:!0,get:function(){return Z.stackScrollTouchDrag}}),Object.defineProperty(t,"stackScrollMultiTouch",{enumerable:!0,get:function(){return Z.stackScrollMultiTouch}});var J=n(85);Object.defineProperty(t,"stackPrefetch",{enumerable:!0,get:function(){return o(J).default}});var Q=n(86);Object.defineProperty(t,"scrollIndicator",{enumerable:!0,get:function(){return o(Q).default}});var ee=n(87);Object.defineProperty(t,"stackRenderers",{enumerable:!0,get:function(){return o(ee).default}});var te=n(89);Object.defineProperty(t,"playClip",{enumerable:!0,get:function(){return te.playClip}}),Object.defineProperty(t,"stopClip",{enumerable:!0,get:function(){return te.stopClip}});var ne=n(12);Object.defineProperty(t,"anyHandlesOutsideImage",{enumerable:!0,get:function(){return o(ne).default}});var oe=n(8);Object.defineProperty(t,"drawHandles",{enumerable:!0,get:function(){return o(oe).default}});var ae=n(18);Object.defineProperty(t,"getHandleNearImagePoint",{enumerable:!0,get:function(){return o(ae).default}});var re=n(37);Object.defineProperty(t,"handleActivator",{enumerable:!0,get:function(){return o(re).default}});var ie=n(38);Object.defineProperty(t,"moveAllHandles",{enumerable:!0,get:function(){return o(ie).default}});var le=n(22);Object.defineProperty(t,"moveHandle",{enumerable:!0,get:function(){return o(le).default}});var se=n(23);Object.defineProperty(t,"moveNewHandle",{enumerable:!0,get:function(){return o(se).default}});var ue=n(25);Object.defineProperty(t,"moveNewHandleTouch",{enumerable:!0,get:function(){return o(ue).default}});var de=n(52);Object.defineProperty(t,"touchMoveAllHandles",{enumerable:!0,get:function(){return o(de).default}});var ce=n(53);Object.defineProperty(t,"touchMoveHandle",{enumerable:!0,get:function(){return o(ce).default}});var fe=n(90);Object.defineProperty(t,"keyboardInput",{enumerable:!0,get:function(){return o(fe).default}});var ge=n(91);Object.defineProperty(t,"mouseInput",{enumerable:!0,get:function(){return o(ge).default}});var me=n(92);Object.defineProperty(t,"mouseWheelInput",{enumerable:!0,get:function(){return o(me).default}});var ve=n(54);Object.defineProperty(t,"preventGhostClick",{enumerable:!0,get:function(){return o(ve).default}});var he=n(93);Object.defineProperty(t,"touchInput",{enumerable:!0,get:function(){return o(he).default}});var pe=n(94);Object.defineProperty(t,"angle",{enumerable:!0,get:function(){return pe.angle}}),Object.defineProperty(t,"angleTouch",{enumerable:!0,get:function(){return pe.angleTouch}});var xe=n(95);Object.defineProperty(t,"arrowAnnotate",{enumerable:!0,get:function(){return xe.arrowAnnotate}}),Object.defineProperty(t,"arrowAnnotateTouch",{enumerable:!0,get:function(){return xe.arrowAnnotateTouch}});var Te=n(96);Object.defineProperty(t,"crosshairs",{enumerable:!0,get:function(){return Te.crosshairs}}),Object.defineProperty(t,"crosshairsTouch",{enumerable:!0,get:function(){return Te.crosshairsTouch}});var be=n(24);Object.defineProperty(t,"displayTool",{enumerable:!0,get:function(){return o(be).default}});var ye=n(55);Object.defineProperty(t,"doubleTapTool",{enumerable:!0,get:function(){return o(ye).default}});var Ce=n(97);Object.defineProperty(t,"doubleTapZoom",{enumerable:!0,get:function(){return o(Ce).default}});var we=n(98);Object.defineProperty(t,"dragProbe",{enumerable:!0,get:function(){return we.dragProbe}}),Object.defineProperty(t,"dragProbeTouch",{enumerable:!0,get:function(){return we.dragProbeTouch}});var Me=n(99);Object.defineProperty(t,"ellipticalRoi",{enumerable:!0,get:function(){return Me.ellipticalRoi}}),Object.defineProperty(t,"ellipticalRoiTouch",{enumerable:!0,get:function(){return Me.ellipticalRoiTouch}});var Pe=n(100);Object.defineProperty(t,"freehand",{enumerable:!0,get:function(){return Pe.freehand}});var Ie=n(101);Object.defineProperty(t,"highlight",{enumerable:!0,get:function(){return Ie.highlight}}),Object.defineProperty(t,"highlightTouch",{enumerable:!0,get:function(){return Ie.highlightTouch}});var Se=n(102);Object.defineProperty(t,"imageStats",{enumerable:!0,get:function(){return o(Se).default}});var _e=n(51);Object.defineProperty(t,"keyboardTool",{enumerable:!0,get:function(){return o(_e).default}});var Oe=n(103);Object.defineProperty(t,"length",{enumerable:!0,get:function(){return Oe.length}}),Object.defineProperty(t,"lengthTouch",{enumerable:!0,get:function(){return Oe.lengthTouch}});var Ee=n(104);Object.defineProperty(t,"magnify",{enumerable:!0,get:function(){return Ee.magnify}}),Object.defineProperty(t,"magnifyTouchDrag",{enumerable:!0,get:function(){return Ee.magnifyTouchDrag}});var ke=n(56);Object.defineProperty(t,"mouseButtonRectangleTool",{enumerable:!0,get:function(){return o(ke).default}});var De=n(7);Object.defineProperty(t,"mouseButtonTool",{enumerable:!0,get:function(){return o(De).default}});var $e=n(21);Object.defineProperty(t,"mouseWheelTool",{enumerable:!0,get:function(){return o($e).default}});var je=n(29);Object.defineProperty(t,"multiTouchDragTool",{enumerable:!0,get:function(){return o(je).default}});var Re=n(105);Object.defineProperty(t,"orientationMarkers",{enumerable:!0,get:function(){return o(Re).default}});var Le=n(106);Object.defineProperty(t,"pan",{enumerable:!0,get:function(){return Le.pan}}),Object.defineProperty(t,"panTouchDrag",{enumerable:!0,get:function(){return Le.panTouchDrag}});var Ae=n(107);Object.defineProperty(t,"panMultiTouch",{enumerable:!0,get:function(){return o(Ae).default}});var Be=n(108);Object.defineProperty(t,"probe",{enumerable:!0,get:function(){return Be.probe}}),Object.defineProperty(t,"probeTouch",{enumerable:!0,get:function(){return Be.probeTouch}});var Ve=n(109);Object.defineProperty(t,"rectangleRoi",{enumerable:!0,get:function(){return Ve.rectangleRoi}}),Object.defineProperty(t,"rectangleRoiTouch",{enumerable:!0,get:function(){return Ve.rectangleRoiTouch}});var Ue=n(110);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return Ue.rotate}}),Object.defineProperty(t,"rotateTouchDrag",{enumerable:!0,get:function(){return Ue.rotateTouchDrag}});var Ne=n(111);Object.defineProperty(t,"rotateTouch",{enumerable:!0,get:function(){return o(Ne).default}});var We=n(112);Object.defineProperty(t,"saveAs",{enumerable:!0,get:function(){return o(We).default}});var Fe=n(113);Object.defineProperty(t,"seedAnnotate",{enumerable:!0,get:function(){return Fe.seedAnnotate}}),Object.defineProperty(t,"seedAnnotateTouch",{enumerable:!0,get:function(){return Fe.seedAnnotateTouch}});var ze=n(114);Object.defineProperty(t,"simpleAngle",{enumerable:!0,get:function(){return ze.simpleAngle}}),Object.defineProperty(t,"simpleAngleTouch",{enumerable:!0,get:function(){return ze.simpleAngleTouch}});var He=n(13);Object.defineProperty(t,"simpleMouseButtonTool",{enumerable:!0,get:function(){return o(He).default}});var Ye=n(115);Object.defineProperty(t,"textMarker",{enumerable:!0,get:function(){return Ye.textMarker}}),Object.defineProperty(t,"textMarkerTouch",{enumerable:!0,get:function(){return Ye.textMarkerTouch}});var Xe=n(11);Object.defineProperty(t,"touchDragTool",{enumerable:!0,get:function(){return o(Xe).default}});var Ge=n(57);Object.defineProperty(t,"touchPinchTool",{enumerable:!0,get:function(){return o(Ge).default}});var qe=n(9);Object.defineProperty(t,"touchTool",{enumerable:!0,get:function(){return o(qe).default}});var Ke=n(116);Object.defineProperty(t,"wwwc",{enumerable:!0,get:function(){return Ke.wwwc}}),Object.defineProperty(t,"wwwcTouchDrag",{enumerable:!0,get:function(){return Ke.wwwcTouchDrag}});var Ze=n(117);Object.defineProperty(t,"wwwcRegion",{enumerable:!0,get:function(){return Ze.wwwcRegion}}),Object.defineProperty(t,"wwwcRegionTouch",{enumerable:!0,get:function(){return Ze.wwwcRegionTouch}});var Je=n(118);Object.defineProperty(t,"zoom",{enumerable:!0,get:function(){return Je.zoom}}),Object.defineProperty(t,"zoomWheel",{enumerable:!0,get:function(){return Je.zoomWheel}}),Object.defineProperty(t,"zoomTouchPinch",{enumerable:!0,get:function(){return Je.zoomTouchPinch}}),Object.defineProperty(t,"zoomTouchDrag",{enumerable:!0,get:function(){return Je.zoomTouchDrag}});var Qe=n(119);Object.defineProperty(t,"brush",{enumerable:!0,get:function(){return Qe.brush}});var et=n(120);Object.defineProperty(t,"adaptiveBrush",{enumerable:!0,get:function(){return et.adaptiveBrush}});var tt=n(121);Object.defineProperty(t,"regionsThreshold",{enumerable:!0,get:function(){return tt.regionsThreshold}}),Object.defineProperty(t,"regionsGrow",{enumerable:!0,get:function(){return tt.regionsGrow}}),Object.defineProperty(t,"regionsDraw",{enumerable:!0,get:function(){return tt.regionsDraw}}),Object.defineProperty(t,"regionsScore",{enumerable:!0,get:function(){return tt.regionsScore}}),Object.defineProperty(t,"regionsUndo",{enumerable:!0,get:function(){return tt.regionsUndo}});var nt=n(126);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return o(nt).default}})},function(t,n){t.exports=e},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(40),r=o(a),i=n(64),l=o(i),s=n(41),u=o(s),d={calculateReferenceLine:r.default,tool:l.default,renderActiveReferenceLine:u.default};t.default=d},function(e,t,n){"use strict";function o(e){var t=e.detail,n=(0,l.getToolState)(e.currentTarget,d);if(void 0!==n){var o=n.data[0].synchronizationContext,a=o.getSourceElements(),r=n.data[0].renderer,s=t.canvasContext.canvas.getContext("2d");i.external.cornerstone.setToPixelCoordinateSystem(t.enabledElement,s),a.forEach(function(n){n!==e.currentTarget&&r(s,t,e.currentTarget,n)})}}function a(e,t,n){n=n||u.default,(0,l.addToolState)(e,d,{synchronizationContext:t,renderer:n}),e.removeEventListener("cornerstoneimagerendered",o),e.addEventListener("cornerstoneimagerendered",o),i.external.cornerstone.updateImage(e)}function r(e){e.removeEventListener("cornerstoneimagerendered",o),i.external.cornerstone.updateImage(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),l=n(1),s=n(41),u=function(e){return e&&e.__esModule?e:{default:e}}(s),d="referenceLines",c={enable:a,disable:r};t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t="",n=e.x<0?"R":"L",a=e.y<0?"A":"P",r=e.z<0?"F":"H",i=new o.cornerstoneMath.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),l=0;l<3;l++)if(i.x>1e-4&&i.x>i.y&&i.x>i.z)t+=n,i.x=0;else if(i.y>1e-4&&i.y>i.x&&i.y>i.z)t+=a,i.y=0;else{if(!(i.z>1e-4&&i.z>i.x&&i.z>i.y))break;t+=r,i.z=0}return t};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.replace("H","f");return t=t.replace("F","h"),t=t.replace("R","l"),t=t.replace("L","r"),t=t.replace("A","p"),t=t.replace("P","a"),t=t.toUpperCase()}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=l.external.cornerstone,n=[];e.timeSeries.stacks.forEach(function(o){var a=void 0;a=!0===o.preventCache?t.loadImage(o.imageIds[e.imageIdIndex]):t.loadAndCacheImage(o.imageIds[e.imageIdIndex]),a.then(function(t){var o=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*t.width,a=t.getPixelData()[o];n.push(a)})}),e.lineSample.set(n)}function r(e){var t=(0,m.getToolState)(e.element,"timeSeries");if(void 0!==t&&void 0!==t.data&&0!==t.data.length){var n=t.data[0],o={timeSeries:n,lineSample:new x.default,imageIdIndex:n.stacks[n.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return a(o),h.default.add(o),o}}function i(e,t){var n=(0,m.getToolState)(e.currentTarget,T);if(n){var o=t.canvasContext.canvas.getContext("2d");l.external.cornerstone.setToPixelCoordinateSystem(t.enabledElement,o);for(var a=0;a<n.data.length;a++){o.save();var r=n.data[a];o.beginPath(),(0,c.default)(o,t,r.handles,"white"),o.stroke();var i=(0,g.default)(t.enabledElement,t.canvasContext,15);o.font=i.fontSize+"px Arial";var s=Math.round(r.handles.end.x),u=Math.round(r.handles.end.y),d=r.handles.end.x+3,f=r.handles.end.y-3;o.fillStyle="white",o.fillText(s+","+u,d,f),o.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),s=n(7),u=o(s),d=n(8),c=o(d),f=n(43),g=o(f),m=n(1),v=n(68),h=o(v),p=n(69),x=o(p),T="probe4D",b=(0,u.default)({createNewMeasurement:r,onImageRendered:i,toolType:T});t.default=b},function(e,t,n){"use strict";function o(){var e=this;e.measurements=[],this.add=function(t){var n=e.measurements.push(t),o={index:n,measurement:t};(0,r.default)(e,"CornerstoneMeasurementAdded",o)},this.remove=function(t){var n=e.measurements[t];e.measurements.splice(t,1);var o={index:t,measurement:n};(0,r.default)(e,"CornerstoneMeasurementRemoved",o)}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=new o;t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;e.samples=[],this.set=function(t){e.samples=t,(0,a.default)(e,"CornerstoneLineSampleUpdated")}};var o=n(3),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function o(e,t){if(void 0===e)throw new Error("playClip: element must not be undefined");void 0===t&&(t=30);var n=(0,r.getToolState)(e,"timeSeries");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var o=(0,r.getToolState)(e,s),a=void 0;void 0===o||0===o.data.length?(a={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},(0,r.addToolState)(e,s,a)):(a=o.data[0],a.framesPerSecond=t),void 0===a.intervalId&&(a.intervalId=setInterval(function(){a.framesPerSecond>0?(0,l.default)(e,1,!0):(0,l.default)(e,-1,!0)},1e3/Math.abs(a.framesPerSecond)))}}function a(e){var t=(0,r.getToolState)(e,s);if(t&&t.data&&t.data.length){var n=t.data[0];clearInterval(n.intervalId),n.intervalId=void 0}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(39),l=function(e){return e&&e.__esModule?e:{default:e}}(i),s="timeSeriesPlayer",u={start:o,stop:a};t.default=u},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){u.external.$(t.element).off("CornerstoneToolsMouseDrag",i),u.external.$(t.element).off("CornerstoneToolsMouseUp",a),u.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask)){var n={deltaY:0,options:e.data.options};return u.external.$(t.element).on("CornerstoneToolsMouseDrag",n,i),u.external.$(t.element).on("CornerstoneToolsMouseUp",a),u.external.$(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function i(e,t){e.data.deltaY+=t.deltaPoints.page.y;var n=(0,b.getToolState)(t.element,"timeSeries");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var o=n.data[0],a=u.external.$(t.element).height()/o.stacks.length;if(void 0!==e.data.options&&void 0!==e.data.options.timeSeriesScrollSpeed&&(a=e.data.options.timeSeriesScrollSpeed),e.data.deltaY>=a||e.data.deltaY<=-a){var r=Math.round(e.data.deltaY/a),i=e.data.deltaY%a;(0,p.default)(t.element,r),e.data.deltaY=i}return!1}}function l(e,t){var n=-t.direction;(0,p.default)(t.element,n)}function s(e){var t=e.originalEvent.detail,n={deltaY:0};n.deltaY+=t.deltaPoints.page.y;var o=(0,b.getToolState)(t.element,"stack");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){if(n.deltaY>=3||n.deltaY<=-3){var a=n.deltaY/3,r=n.deltaY%3;(0,p.default)(n.element,a),n.deltaY=r}return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=void 0;var u=n(0),d=n(13),c=o(d),f=n(11),g=o(f),m=n(21),v=o(m),h=n(39),p=o(h),x=n(2),T=o(x),b=n(1),y=(0,c.default)(r),C=(0,v.default)(l),w=(0,g.default)(s);t.timeSeriesScroll=y,t.timeSeriesScrollWheel=C,t.timeSeriesScrollTouchDrag=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var a=o.external.cornerstone,r=a.getViewport(t),i=a.getViewport(n);i.voi.windowWidth===r.voi.windowWidth&&i.voi.windowCenter===r.voi.windowCenter&&i.invert===r.invert||(i.voi.windowWidth=r.voi.windowWidth,i.voi.windowCenter=r.voi.windowCenter,i.invert=r.invert,e.setViewport(n,i))}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){n!==t&&o.external.cornerstone.updateImage(n)};var o=n(0)},function(e,t,n){"use strict";function o(e,t){function n(e,t){s.length&&u.length&&(d=!0,u.forEach(function(n){var o=u.indexOf(n);if(-1!==o){var a=c.imageIds.targetElements[o],r=s.indexOf(e);if(-1!==r){var i=c.imageIds.sourceElements[r],d=void 0;i===a?d=0:void 0!==c.distances[i]&&(d=c.distances[i][a]),f(l,e,n,t,d)}}}),d=!1)}function o(e,t){!0!==d&&n(e.currentTarget,t)}function r(e){var t=e.detail.element;l.remove(t)}var i=a.external.cornerstone,l=this,s=[],u=[],d=!1,c={},f=t;this.setHandler=function(e){f=e},this.getHandler=function(){return f},this.getDistances=function(){s.length&&u.length&&(c.distances={},c.imageIds={sourceElements:[],targetElements:[]},s.forEach(function(e){var t=i.getEnabledElement(e);if(t&&t.image){var n=t.image.imageId,o=i.metaData.get("imagePlaneModule",n);if(o&&o.imagePositionPatient){var a=o.imagePositionPatient;c.hasOwnProperty(t)||(c.distances[n]={},c.imageIds.sourceElements.push(n),u.forEach(function(t){var o=i.getEnabledElement(t);if(o&&o.image){var r=o.image.imageId;if(c.imageIds.targetElements.push(r),e!==t&&n!==r&&!c.distances[n].hasOwnProperty(r)){var l=i.metaData.get("imagePlaneModule",r);if(l&&l.imagePositionPatient){var s=l.imagePositionPatient;c.distances[n][r]=s.clone().sub(a)}}}}),Object.keys(c.distances[n]).length||delete c.distances[n])}}}))},this.addSource=function(t){-1===s.indexOf(t)&&(s.push(t),a.external.$(t).on(e,o),l.getDistances(),l.updateDisableHandlers())},this.addTarget=function(e){-1===u.indexOf(e)&&(u.push(e),l.getDistances(),f(l,e,e,0),l.updateDisableHandlers())},this.add=function(e){l.addSource(e),l.addTarget(e)},this.removeSource=function(t){var r=s.indexOf(t);-1!==r&&(s.splice(r,1),a.external.$(t).off(e,o),l.getDistances(),n(t),l.updateDisableHandlers())},this.removeTarget=function(e){var t=u.indexOf(e);-1!==t&&(u.splice(t,1),l.getDistances(),f(l,e,e,0),l.updateDisableHandlers())},this.remove=function(e){l.removeTarget(e),l.removeSource(e)},this.getSourceElements=function(){return s},this.getTargetElements=function(){return u},this.displayImage=function(e,t,n){d=!0,i.displayImage(e,t,n),d=!1},this.setViewport=function(e,t){d=!0,i.setViewport(e,t),d=!1},this.updateDisableHandlers=function(){a.external.$.unique(s.concat(u)).forEach(function(e){e.removeEventListener("cornerstoneelementdisabled",r),e.addEventListener("cornerstoneelementdisabled",r)})},this.destroy=function(){a.external.$.unique(s.concat(u)).forEach(function(e){l.remove(e)})}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){if(t!==n&&r&&r.direction){var l=o.external.cornerstone,s=(0,a.getToolState)(n,"stack"),u=s.data[0],d=u.currentImageIdIndex+r.direction;if(d=Math.min(Math.max(d,0),u.imageIds.length-1),u.currentImageIdIndex!==d){var c=i.default.getStartLoadHandler(),f=i.default.getEndLoadHandler(),g=i.default.getErrorLoadingHandler();c&&c(n);var m=void 0;m=!0===u.preventCache?l.loadImage(u.imageIds[d]):l.loadAndCacheImage(u.imageIds[d]),m.then(function(t){var o=l.getViewport(n);u.currentImageIdIndex=d,e.displayImage(n,t,o),f&&f(n,t)},function(e){var t=u.imageIds[d];g&&g(n,t,e)})}}};var o=n(0),a=n(1),r=n(10),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var r=o.external.cornerstone,l=r.getEnabledElement(t).image,s=r.metaData.get("imagePlaneModule",l.imageId),u=s.imagePositionPatient,d=(0,a.getToolState)(n,"stack"),c=d.data[0],f=Number.MAX_VALUE,g=-1;if(c.imageIds.forEach(function(e,t){var n=r.metaData.get("imagePlaneModule",e),o=n.imagePositionPatient,a=o.distanceToSquared(u);a<f&&(f=a,g=t)}),g!==c.currentImageIdIndex){var m=i.default.getStartLoadHandler(),v=i.default.getEndLoadHandler(),h=i.default.getErrorLoadingHandler();if(m&&m(n),-1!==g){var p=void 0;p=!0===c.preventCache?r.loadImage(c.imageIds[g]):r.loadAndCacheImage(c.imageIds[g]),p.then(function(t){var o=r.getViewport(n);c.currentImageIdIndex=g,e.displayImage(n,t,o),v&&v(n,t)},function(e){var t=c.imageIds[g];h&&h(n,t,e)})}}}};var o=n(0),a=n(1),r=n(10),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,l){if(n!==t){var s=o.external.cornerstone,u=s.getEnabledElement(t),d=s.metaData.get("imagePlaneModule",u.image.imageId),c=d.imagePositionPatient,f=(0,a.getToolState)(n,"stack"),g=f.data[0],m=Number.MAX_VALUE,v=-1;if(l){var h=c.clone().add(l);if(g.imageIds.forEach(function(e,t){var n=s.metaData.get("imagePlaneModule",e),o=n.imagePositionPatient,a=h.distanceToSquared(o);a<m&&(m=a,v=t)}),v!==g.currentImageIdIndex&&-1!==v){var p=i.default.getStartLoadHandler(),x=i.default.getEndLoadHandler(),T=i.default.getErrorLoadingHandler();p&&p(n);var b=void 0;b=!0===g.preventCache?s.loadImage(g.imageIds[v]):s.loadAndCacheImage(g.imageIds[v]),b.then(function(t){var o=s.getViewport(n);g.currentImageIdIndex=v,e.displayImage(n,t,o),x&&x(n,t)},function(e){var t=g.imageIds[v];T&&T(n,t,e)})}}}};var o=n(0),a=n(1),r=n(10),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var r=o.external.cornerstone,l=(0,a.getToolState)(t,"stack"),s=l.data[0],u=(0,a.getToolState)(n,"stack"),d=u.data[0],c=s.currentImageIdIndex;if((c=Math.min(Math.max(c,0),d.imageIds.length-1))!==d.currentImageIdIndex){var f=i.default.getStartLoadHandler(),g=i.default.getEndLoadHandler(),m=i.default.getErrorLoadingHandler();f&&f(n);var v=void 0;v=!0===d.preventCache?r.loadImage(d.imageIds[c]):r.loadAndCacheImage(d.imageIds[c]),v.then(function(t){var o=r.getViewport(n);d.currentImageIdIndex=c,e.displayImage(n,t,o),g&&g(n,t)},function(e){var t=d.imageIds[c];m&&m(n,t,e)})}}};var o=n(0),a=n(1),r=n(10),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var a=o.external.cornerstone,r=a.getViewport(t),i=a.getViewport(n);i.scale===r.scale&&i.translation.x===r.translation.x&&i.translation.y===r.translation.y||(i.scale=r.scale,i.translation.x=r.translation.x,i.translation.y=r.translation.y,e.setViewport(n,i))}};var o=n(0)},function(e,t,n){"use strict";function o(e,t){function n(n,o,r){if(!(e.indexOf(o)>=0))return t.add(n,o,r);!1===a.hasOwnProperty(o)&&(a[o]={data:[]}),a[o].data.push(r)}function o(n,o){return e.indexOf(o)>=0?(!1===a.hasOwnProperty(o)&&(a[o]={data:[]}),a[o]):t.get(n,o)}var a={};return{get:o,add:n}}function a(e,t){t=t||["timeSeries"];var n=(0,i.getElementToolStateManager)(e);void 0===n&&(n=r.globalImageIdSpecificToolStateManager);var a=o(t,n);l.push(a),(0,i.setElementToolStateManager)(e,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=void 0;var r=n(15),i=n(1),l=[];t.addTimeSeriesStateManager=a,t.newTimeSeriesSpecificToolStateManager=o},function(e,t,n){"use strict";function o(e,t){function n(){return i}function o(e){i=e}function a(n,o,a){if(!(e.indexOf(o)>=0))return t.add(n,o,a);!1===i.hasOwnProperty(o)&&(i[o]={data:[]}),i[o].data.push(a)}function r(n,o){return e.indexOf(o)>=0?(!1===i.hasOwnProperty(o)&&(i[o]={data:[]}),i[o]):t.get(n,o)}var i={};return{get:r,add:a,saveToolState:n,restoreToolState:o,toolState:i}}function a(e,t){var n=(0,i.getElementToolStateManager)(e);n||(n=r.globalImageIdSpecificToolStateManager);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(a=a.concat(t));var s=o(a,n);l.push(s),(0,i.setElementToolStateManager)(e,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=void 0;var r=n(15),i=n(1),l=[],s={newStackSpecificToolStateManager:o,addStackStateManager:a};t.stackSpecificStateManager=s,t.newStackSpecificToolStateManager=o,t.addStackStateManager=a},function(e,t,n){"use strict";function o(){function e(e,t,n){!1===o.hasOwnProperty(e)&&(o[e]={});var a=o[e];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(n)}function t(e,t){if(!1!==o.hasOwnProperty(e)){var n=o[e];if(!1!==n.hasOwnProperty(t)){return n[t]}}}function n(e,t,n){if(!1!==o.hasOwnProperty(e)){var a=o[e];if(!1!==a.hasOwnProperty(t)){for(var r=a[t],i=-1,l=0;l<r.data.length;l++)r.data[l]===n&&(i=l);-1!==i&&r.data.splice(i,1)}}}var o={};return{get:t,add:e,remove:n}}Object.defineProperty(t,"__esModule",{value:!0});var a=o();t.newFrameOfReferenceSpecificToolStateManager=o,t.globalFrameOfReferenceSpecificToolStateManager=a},function(e,t,n){"use strict";function o(e){var t={imageIdToolState:i.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach(function(e){var n=(0,l.getElementToolStateManager)(e);n!==i.globalImageIdSpecificToolStateManager&&(t.elementToolState[e.id]=n.saveToolState(),t.elementViewport[e.id]=r.external.cornerstone.getViewport(e))}),t}function a(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport")){var t=r.external.cornerstone;return i.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach(function(n){var o=document.getElementById(n);if(o&&e.elementToolState.hasOwnProperty(n)){var a=(0,l.getElementToolStateManager)(o);if(a!==i.globalImageIdSpecificToolStateManager){a.restoreToolState(e.elementToolState[n]);var r=e.elementViewport[n];t.setViewport(o,r),t.updateImage(o)}}}),e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(15),l=n(1),s={save:o,restore:a};t.default=s},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=t.keyCode;if(n===u.UP||n===u.DOWN){var o=1;n===u.DOWN&&(o=-1),(0,i.default)(t.element,o)}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),i=o(r),l=n(51),s=o(l),u={UP:38,DOWN:40},d=(0,s.default)(a);t.default=d},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e=Math.round(e)||0,t=Math.round(t)||0;var n=[],o=t-e+1;if(o<=0)return n;for(;o--;)n[o]=t--;return n}function r(e,t){var n=[],o=[];return e.forEach(function(e){e<t?n.push(e):e>t&&o.push(e)}),{low:e.indexOf(P(n)),high:e.indexOf(I(o))}}function i(e){function t(e){var t=s.indicesToRequest.indexOf(e);t>-1&&s.indicesToRequest.splice(t,1)}function n(e){t(i.imageIds.indexOf(e.imageId))}function o(t){console.log("prefetch errored: "+t),f&&f(e,d,t,"stackPrefetch")}var a=(0,x.getToolState)(e,"stack");if(a&&a.data&&a.data.length){var i=a.data[0],l=(0,x.getToolState)(e,b);if(l){var s=l.data[0]||{};if(s.indicesToRequest&&s.indicesToRequest.length||(s.enabled=!1),!1!==s.enabled){l.data[0].indicesToRequest.sort(function(e,t){return e-t});if(s.indicesToRequest.slice().forEach(function(e){var n=i.imageIds[e];if(n){var o=g.external.cornerstone.imageCache.getImagePromise(n);o&&"resolved"===o.state()&&t(e)}}),s.indicesToRequest.length){v.default.clearRequestStack(y);for(var u=r(s.indicesToRequest,i.currentImageIdIndex),d=void 0,c=void 0,f=p.default.getErrorLoadingHandler(),m=u.low,h=u.high;m>=0||h<s.indicesToRequest.length;){var T=i.currentImageIdIndex,w=T-s.indicesToRequest[m]>C.maxImagesToPrefetch,M=s.indicesToRequest[h]-T>C.maxImagesToPrefetch,P=!w&&m>=0,I=!M&&h<s.indicesToRequest.length;if(!I&&!P)break;P&&(c=s.indicesToRequest[m--],d=i.imageIds[c],v.default.addRequest(e,d,y,!1,n,o)),I&&(c=s.indicesToRequest[h++],d=i.imageIds[c],v.default.addRequest(e,d,y,!1,n,o))}v.default.startGrabbing()}}}}}function l(e){return function(t){var n=t.detail,o=void 0;try{o=(0,x.getToolState)(e,"stack")}catch(e){return}if(o&&o.data&&o.data.length){var a=o.data[0],r=a.imageIds.indexOf(n.imageId);if(!(r<0)){var i=(0,x.getToolState)(e,b);i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(r)}}}}function s(e){clearTimeout(w),w=setTimeout(function(){var t=e.target;try{i(t)}catch(e){return}},M)}function u(e){(0,x.getToolState)(e,b).data=[];var t=(0,x.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0===n.preventCache)return void console.warn("A stack that should not be cached was given the stackPrefetch");var o={indicesToRequest:a(0,n.imageIds.length-1),enabled:!0,direction:1},r=o.indicesToRequest.indexOf(n.currentImageIdIndex);o.indicesToRequest.splice(r,1),(0,x.addToolState)(e,b,o),i(e),e.removeEventListener("cornerstonenewimage",s),e.addEventListener("cornerstonenewimage",s);var u=l(e);g.external.cornerstone.events.removeEventListener("cornerstoneimagecachepromiseremoved",u),g.external.cornerstone.events.addEventListener("cornerstoneimagecachepromiseremoved",u)}}function d(e){clearTimeout(w),e.removeEventListener("cornerstonenewimage",s);var t=l(e);g.external.cornerstone.events.removeEventListener("cornerstoneimagecachepromiseremoved",t);var n=(0,x.getToolState)(e,b);n&&n.data.length&&(n.data[0].enabled=!1,v.default.clearRequestStack(y))}function c(){return C}function f(e){C=e,e.maxSimultaneousRequests&&(0,T.setMaxSimultaneousRequests)(e.maxSimultaneousRequests)}Object.defineProperty(t,"__esModule",{value:!0});var g=n(0),m=n(28),v=o(m),h=n(10),p=o(h),x=n(1),T=n(20),b="stackPrefetch",y="prefetch",C={maxImagesToPrefetch:1/0},w=void 0,M=10,P=function(e){return Math.max.apply(null,e)},I=function(e){return Math.min.apply(null,e)},S={enable:u,disable:d,getConfiguration:c,setConfiguration:f};t.default=S},function(e,t,n){"use strict";function o(e,t){var n=t.element,o=t.enabledElement.canvas.width,a=t.enabledElement.canvas.height;if(!o||!a)return!1;var r=t.enabledElement.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.save();var s=u.getConfiguration();r.fillStyle=s.backgroundColor,"horizontal"===s.orientation?r.fillRect(0,a-l,o,l):r.fillRect(0,0,l,a);var d=(0,i.getToolState)(n,"stack");if(d&&d.data&&d.data.length){var c=d.data[0].imageIds,f=d.data[0].currentImageIdIndex,g=o/c.length,m=a/c.length,v=g*f,h=m*f;r.fillStyle=s.fillColor,"horizontal"===s.orientation?r.fillRect(v,a-l,g,l):r.fillRect(0,h,l,m),r.restore()}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(24),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=n(1),l=6,s={backgroundColor:"rgb(19, 63, 141)",fillColor:"white",orientation:"horizontal"},u=(0,r.default)(o);u.setConfiguration(s),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(88),a=function(e){return e&&e.__esModule?e:{default:e}}(o),r={};r.FusionRenderer=a.default,t.default=r},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),i=n(1),l=function(){function e(){o(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return a(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");if(!t){t=(0,i.getToolState)(e,"stack").data}var o=r.external.cornerstone,a=t[0],l=a.imageIds[this.currentImageIdIndex],s=t.slice(1,t.length);o.loadAndCacheImage(l).then(function(t){var r=n.layerIds[0];r?o.setLayerImage(e,t,r):(r=o.addLayer(e,t,a.options),n.layerIds.push(r)),o.displayImage(e,t),s.forEach(function(t,a){var i=n.findImageFn(t.imageIds,l),s=a+1,u=n.layerIds[s];u||(u=o.addLayer(e,void 0,t.options),n.layerIds.push(u)),i?o.loadAndCacheImage(i).then(function(t){o.setLayerImage(e,t,u),o.updateImage(e)}):(o.setLayerImage(e,void 0,u),o.setActiveLayer(e,r),o.updateImage(e))})})}}]),e}();t.default=l},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=void 0,o=void 0,a=void 0,r=0,i=e.length,l=[];for(l.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)a=Number(e[n])/t|0,l.push(a),1===n?o=a:a!==o&&(l.isTimeVarying=!0),r+=a;return l.length>0&&(a=l.isTimeVarying?r/l.length|0:l[0],l.push(a)),l}function r(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function i(e){var t={element:e};(0,m.default)(e,"CornerstoneToolsClipStopped",t)}function l(e,t){var n=void 0,o=void 0;if(void 0===e)throw new Error("playClip: element must not be undefined");var l=(0,f.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var s=u.external.cornerstone,d=void 0;if(l.data.length>1){var g=(0,f.getToolState)(e,"stackRenderer");g&&g.data&&g.data.length&&(d=g.data[0])}var m=l.data[0],h=(0,f.getToolState)(e,v);h&&h.data&&h.data.length?(n=h.data[0],r(n)):(n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},(0,f.addToolState)(e,v,n)),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===m.imageIds.length&&(o=a(n.frameTimeVector,n.speed));var p=function(){var t=void 0,o=void 0,a=void 0,u=void 0,f=m.currentImageIdIndex,g=m.imageIds.length;if(n.reverse?f--:f++,!n.loop&&(f<0||f>=g))return r(n),void i(e);f>=g&&(f=0),f<0&&(f=g-1),f!==m.currentImageIdIndex&&(o=c.default.getStartLoadHandler(),a=c.default.getEndLoadHandler(),u=c.default.getErrorLoadingHandler(),o&&o(e),t=!0===m.preventCache?s.loadImage(m.imageIds[f]):s.loadAndCacheImage(m.imageIds[f]),t.then(function(t){try{m.currentImageIdIndex=f,d?(d.currentImageIdIndex=f,d.render(e,l.data)):s.displayImage(e,t),a&&a(e,t)}catch(e){return}},function(t){var n=m.imageIds[f];u&&u(e,n,t)}))};o&&o.length>0&&o.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout(function e(){n.intervalId=setTimeout(e,o[m.currentImageIdIndex]),p()},0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(p,1e3/Math.abs(n.framesPerSecond)))}}function s(e){var t=(0,f.getToolState)(e,v);t&&t.data&&t.data.length&&r(t.data[0])}Object.defineProperty(t,"__esModule",{value:!0}),t.stopClip=t.playClip=void 0;var u=n(0),d=n(10),c=o(d),f=n(1),g=n(3),m=o(g),v="playClip";t.playClip=l,t.stopClip=s},function(e,t,n){"use strict";function o(e){var t=l.external.cornerstone,n=e.currentTarget,o={event:window.event||e,element:n,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,currentPoints:{page:{x:d,y:c},image:t.pageToPixel(n,d,c)},keyCode:e.keyCode,which:e.which};o.currentPoints.canvas=t.pixelToCanvas(n,o.currentPoints.image);var a={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};(0,u.default)(n,a[e.type],o)}function a(e){d=e.pageX||e.originalEvent.pageX,c=e.pageY||e.originalEvent.pageY}function r(e){i(e),l.external.$(e).on(f,o),l.external.$(e).on("mousemove",a)}function i(e){l.external.$(e).off(f,o),l.external.$(e).off("mousemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),s=n(3),u=function(e){return e&&e.__esModule?e:{default:e}}(s),d=void 0,c=void 0,f="keydown keypress keyup",g={enable:r,disable:i};t.default=g},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return"number"!=typeof e.buttons?e.which:0===e.buttons?0:e.buttons%2==1?1:e.buttons%4==2?3:e.buttons%8==4?2:0}function r(){x=!1}function i(e){var t=c.external.cornerstone,n=e.currentTarget,o="CornerstoneToolsMouseDoubleClick",r={page:c.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=t.pixelToCanvas(n,r.image);var i=(0,g.default)(r),l={event:e,which:a(e),viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:r,lastPoints:i,currentPoints:r,deltaPoints:{x:0,y:0},type:o};(0,p.default)(l.element,o,l)}function l(e){function t(e){var t={page:c.cornerstoneMath.point.pageToPoint(e),image:o.pageToPixel(i,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};t.canvas=o.pixelToCanvas(i,t.image);var n={page:c.cornerstoneMath.point.subtract(t.page,u.page),image:c.cornerstoneMath.point.subtract(t.image,u.image),client:c.cornerstoneMath.point.subtract(t.client,u.client),canvas:c.cornerstoneMath.point.subtract(t.canvas,u.canvas)},a={which:f,viewport:o.getViewport(i),image:o.getEnabledElement(i).image,element:i,startPoints:l,lastPoints:u,currentPoints:t,deltaPoints:n,type:"CornerstoneToolsMouseDrag",ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};return(0,p.default)(a.element,"CornerstoneToolsMouseDrag",a),u=(0,g.default)(t),(0,v.default)(e)}function n(e){clearTimeout(T);var a="CornerstoneToolsMouseUp";x&&(a="CornerstoneToolsMouseClick");var r={page:c.cornerstoneMath.point.pageToPoint(e),image:o.pageToPixel(i,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=o.pixelToCanvas(i,r.image);var d={page:c.cornerstoneMath.point.subtract(r.page,u.page),image:c.cornerstoneMath.point.subtract(r.image,u.image),client:c.cornerstoneMath.point.subtract(r.client,u.client),canvas:c.cornerstoneMath.point.subtract(r.canvas,u.canvas)},g={event:e,which:f,viewport:o.getViewport(i),image:o.getEnabledElement(i).image,element:i,startPoints:l,lastPoints:u,currentPoints:r,deltaPoints:d,type:a};(0,p.default)(g.element,a,g),c.external.$(document).off("mousemove",t),c.external.$(document).off("mouseup",n),c.external.$(g.element).on("mousemove",s),x=!0}T=setTimeout(r,b);var o=c.external.cornerstone,i=e.currentTarget;c.external.$(i).off("mousemove",s);var l={page:c.cornerstoneMath.point.pageToPoint(e),image:o.pageToPixel(i,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=o.pixelToCanvas(i,l.image);var u=(0,g.default)(l),d={event:e,which:a(e),viewport:o.getViewport(i),image:o.getEnabledElement(i).image,element:i,startPoints:l,lastPoints:u,currentPoints:l,deltaPoints:{x:0,y:0},type:"CornerstoneToolsMouseDown"};(0,p.default)(d.element,"CornerstoneToolsMouseDown",d)&&(d.type="CornerstoneToolsMouseDownActivate",(0,p.default)(d.element,"CornerstoneToolsMouseDownActivate",d));var f=a(e);return c.external.$(document).on("mousemove",t),c.external.$(document).on("mouseup",n),(0,v.default)(e)}function s(e){var t=c.external.cornerstone,n=e.currentTarget,o={page:c.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=t.pixelToCanvas(n,o.image);var r=(0,g.default)(o),i=a(e),l={page:c.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=t.pixelToCanvas(n,l.image);var s={page:c.cornerstoneMath.point.subtract(l.page,r.page),image:c.cornerstoneMath.point.subtract(l.image,r.image),client:c.cornerstoneMath.point.subtract(l.client,r.client),canvas:c.cornerstoneMath.point.subtract(l.canvas,r.canvas)},u={which:i,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:o,lastPoints:r,currentPoints:l,deltaPoints:s,type:"CornerstoneToolsMouseMove"};(0,p.default)(n,"CornerstoneToolsMouseMove",u),r=(0,g.default)(l)}function u(e){c.external.$(e).off("mousedown",l),c.external.$(e).off("mousemove",s),c.external.$(e).off("dblclick",i)}function d(e){u(e),c.external.$(e).on("mousedown",l),c.external.$(e).on("mousemove",s),c.external.$(e).on("dblclick",i)}Object.defineProperty(t,"__esModule",{value:!0});var c=n(0),f=n(35),g=o(f),m=n(33),v=o(m),h=n(3),p=o(h),x=!0,T=void 0,b=200,y={enable:d,disable:u};t.default=y},function(e,t,n){"use strict";function o(e){if(!("mousewheel"===e.originalEvent.type&&0===e.originalEvent.wheelDeltaY||"DOMMouseScroll"===e.originalEvent.type&&1===e.originalEvent.axis)){e.preventDefault();var t=i.external.cornerstone,n=e.currentTarget,o=void 0,a=void 0;void 0!==e.pageX&&void 0!==e.pageY?(o=e.pageX,a=e.pageY):e.originalEvent&&void 0!==e.originalEvent.pageX&&void 0!==e.originalEvent.pageY?(o=e.originalEvent.pageX,a=e.originalEvent.pageY):(o=e.x,a=e.y);var r=t.pageToPixel(n,o,a);e=window.event&&window.event.wheelDelta?window.event:e;var l=void 0;l=e.originalEvent&&e.originalEvent.wheelDelta?-e.originalEvent.wheelDelta:e.originalEvent&&e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent&&e.originalEvent.detail?-e.originalEvent.detail:e.wheelDelta;var u=l<0?-1:1,d={element:n,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,direction:u,pageX:o,pageY:a,imageX:r.x,imageY:r.y};(0,s.default)(n,"CornerstoneToolsMouseWheel",d)}}function a(e){r(e),i.external.$(e).on(u,o)}function r(e){i.external.$(e).unbind(u,o)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),l=n(3),s=function(e){return e&&e.__esModule?e:{default:e}}(l),u="mousewheel DOMMouseScroll",d={enable:a,disable:r};t.default=d},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=l.external.cornerstone,n=e.currentTarget||e.srcEvent.currentTarget,o=void 0,a=void 0,r=void 0,i=void 0,s=void 0;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(S=!1,clearTimeout(C)),e.type){case"tap":S=!1,clearTimeout(C),p={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),o="CornerstoneToolsTap",b={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,currentPoints:p,type:o,isTouchEvent:!0},(0,v.default)(n,o,b);break;case"doubletap":S=!1,clearTimeout(C),p={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),o="CornerstoneToolsDoubleTap",b={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,currentPoints:p,type:o,isTouchEvent:!0},(0,v.default)(n,o,b);break;case"pinchstart":S=!1,clearTimeout(C),M=1;break;case"pinchmove":if(S=!1,clearTimeout(C),!0===I){M=e.scale,I=!1;break}a=(e.scale-M)/M,h={page:e.center,image:t.pageToPixel(n,e.center.x,e.center.y)},h.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchPinch",b={event:e,startPoints:h,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,direction:e.scale<1?1:-1,scaleChange:a,type:o,isTouchEvent:!0},(0,v.default)(n,o,b),M=e.scale;break;case"touchstart":M=1,clearTimeout(C),clearTimeout(y),y=setTimeout(function(){h={page:l.cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:t.pageToPixel(n,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},h.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(o="CornerstoneToolsMultiTouchStart"),b={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,currentPoints:h,type:o,isTouchEvent:!0},!0===(0,v.default)(n,o,b)&&(o="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(o="CornerstoneToolsMultiTouchStartActive"),b.type=o,(0,v.default)(n,o,b)),x=(0,u.default)(h)},50),S=!0,w=0,C=setTimeout(function(){S&&(p={page:l.cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:t.pageToPixel(n,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},p.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchPress",b={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,currentPoints:p,type:o,isTouchEvent:!0},(0,v.default)(n,o,b))},O);break;case"touchend":M=1,S=!1,clearTimeout(C),setTimeout(function(){h={page:l.cornerstoneMath.point.pageToPoint(e.originalEvent.changedTouches[0]),image:t.pageToPixel(n,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},h.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchEnd",b={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,currentPoints:h,type:o,isTouchEvent:!0},(0,v.default)(n,o,b)},50);break;case"panmove":r={x:e.deltaX-_.x,y:e.deltaY-_.y},_={x:e.deltaX,y:e.deltaY},p={page:{x:x.page.x+r.x,y:x.page.y+r.y},image:t.pageToPixel(n,x.page.x+r.x,x.page.y+r.y),client:{x:x.client.x+r.x,y:x.client.y+r.y}},p.canvas=t.pixelToCanvas(n,p.image),T={page:l.cornerstoneMath.point.subtract(p.page,x.page),image:l.cornerstoneMath.point.subtract(p.image,x.image),client:l.cornerstoneMath.point.subtract(p.client,x.client),canvas:l.cornerstoneMath.point.subtract(p.canvas,x.canvas)},w+=Math.sqrt(T.page.x*T.page.x+T.page.y*T.page.y),w>E&&(S=!1,clearTimeout(C)),o="CornerstoneToolsTouchDrag",e.pointers.length>1&&(o="CornerstoneToolsMultiTouchDrag"),b={viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,lastPoints:x,currentPoints:p,deltaPoints:T,numPointers:e.pointers.length,type:o,isTouchEvent:!0},(0,v.default)(n,o,b),x=(0,u.default)(p);break;case"panstart":_={x:e.deltaX,y:e.deltaY},p={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),x=(0,u.default)(p);break;case"panend":return S=!1,(clearTimeout(C),x)?(p={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),T={page:l.cornerstoneMath.point.subtract(p.page,x.page),image:l.cornerstoneMath.point.subtract(p.image,x.image),client:l.cornerstoneMath.point.subtract(p.client,x.client),canvas:l.cornerstoneMath.point.subtract(p.canvas,x.canvas)},o="CornerstoneToolsDragEnd",b={event:e.srcEvent,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,lastPoints:x,currentPoints:p,deltaPoints:T,type:o,isTouchEvent:!0},(0,v.default)(n,o,b),i=e.pointers.length-e.changedPointers.length,2===i&&(I=!0),(0,c.default)(e)):!1;case"rotatemove":S=!1,clearTimeout(C),s=e.rotation-P,P=e.rotation,o="CornerstoneToolsTouchRotate",b={event:e.srcEvent,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,rotation:s,type:o},(0,v.default)(n,o,b)}return!1}function r(e){i(e);var t=l.external.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},o=new t.Manager(e,n),r={pointers:0,direction:t.DIRECTION_ALL,threshold:0},s=new t.Pan(r),u=new t.Pinch({threshold:0}),d=new t.Rotate({threshold:0});u.recognizeWith(s),u.recognizeWith(d),d.recognizeWith(s);var c=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});c.recognizeWith(s),o.add([c,s,d,u]),o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",a),g.default.enable(e),l.external.$(e).on("touchstart touchend",a),l.external.$(e).data("hammer",o)}function i(e){g.default.disable(e),l.external.$(e).off("touchstart touchend",a);var t=l.external.$(e).data("hammer");t&&t.off("tap doubletap panstart panmove panend pinchmove rotatemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),s=n(35),u=o(s),d=n(33),c=o(d),f=n(54),g=o(f),m=n(3),v=o(m),h=void 0,p=void 0,x=void 0,T=void 0,b=void 0,y=void 0,C=void 0,w=void 0,M=1,P=0,I=!1,S=!1,_=void 0,O=700,E=5,k={enable:r,disable:i};t.default=k},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function r(e,t,n){var o=l.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.end)},r=l.cornerstoneMath.lineSegment.distanceToPoint(a,n);return r<5||(a.start=o.pixelToCanvas(e,t.handles.start2),a.end=o.pixelToCanvas(e,t.handles.end2),(r=l.cornerstoneMath.lineSegment.distanceToPoint(a,n))<5)}function i(e,t){var n=(0,M.getToolState)(e.currentTarget,P);if(void 0!==n){var o=t.canvasContext.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);for(var a=void 0,r=p.default.getToolWidth(),i=T.default.getFont(),s=I.getConfiguration(),u=l.external.cornerstone,d=0;d<n.data.length;d++){o.save(),s&&s.shadow&&(o.shadowColor=s.shadowColor||"#000000",o.shadowOffsetX=s.shadowOffsetX||1,o.shadowOffsetY=s.shadowOffsetY||1);var c=n.data[d];a=c.active?y.default.getActiveColor():y.default.getToolColor(),o.beginPath(),o.strokeStyle=a,o.lineWidth=r;var f=u.pixelToCanvas(t.element,c.handles.start),m=u.pixelToCanvas(t.element,c.handles.end);o.moveTo(f.x,f.y),o.lineTo(m.x,m.y),f=u.pixelToCanvas(t.element,c.handles.start2),m=u.pixelToCanvas(t.element,c.handles.end2),o.moveTo(f.x,f.y),o.lineTo(m.x,m.y),o.stroke(),(0,w.default)(o,t,c.handles),o.fillStyle=a;var h=(Math.ceil(c.handles.start.x)-Math.ceil(c.handles.end.x))*t.image.columnPixelSpacing,x=(Math.ceil(c.handles.start.y)-Math.ceil(c.handles.end.y))*t.image.rowPixelSpacing,b=(Math.ceil(c.handles.start2.x)-Math.ceil(c.handles.end2.x))*t.image.columnPixelSpacing,C=(Math.ceil(c.handles.start2.y)-Math.ceil(c.handles.end2.y))*t.image.rowPixelSpacing,S=Math.acos(Math.abs((h*b+x*C)/(Math.sqrt(h*h+x*x)*Math.sqrt(b*b+C*C))));S*=180/Math.PI;var _=(0,v.default)(S,2),O=_.toString()+String.fromCharCode(parseInt("00B0",16)),E=(f.x+m.x)/2,k=(f.y+m.y)/2;o.font=i,(0,g.default)(o,O,E,k,a),o.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.angleTouch=t.angle=void 0;var l=n(0),s=n(7),u=o(s),d=n(9),c=o(d),f=n(6),g=o(f),m=n(31),v=o(m),h=n(5),p=o(h),x=n(14),T=o(x),b=n(4),y=o(b),C=n(8),w=o(C),M=n(1),P="angle",I=(0,u.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P}),S=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P});t.angle=I,t.angleTouch=S},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,n){n(prompt("Change your annotation:"))}function i(e){function t(t){null===t?(0,U.removeToolState)(e.element,N,n):n.text=t,n.active=!1,o.updateImage(e.element),g.external.$(e.element).on("CornerstoneToolsMouseMove",a,F.mouseMoveCallback),g.external.$(e.element).on("CornerstoneToolsMouseDown",a,F.mouseDownCallback),g.external.$(e.element).on("CornerstoneToolsMouseDownActivate",a,F.mouseDownActivateCallback),g.external.$(e.element).on("CornerstoneToolsMouseDoubleClick",a,F.mouseDoubleClickCallback)}var n=l(e),o=g.external.cornerstone,a={mouseButtonMask:e.which};(0,U.addToolState)(e.element,N,n),g.external.$(e.element).off("CornerstoneToolsMouseMove",F.mouseMoveCallback),g.external.$(e.element).off("CornerstoneToolsMouseDown",F.mouseDownCallback),g.external.$(e.element).off("CornerstoneToolsMouseDownActivate",F.mouseDownActivateCallback),g.external.$(e.element).off("CornerstoneToolsMouseDoubleClick",F.mouseDoubleClickCallback),o.updateImage(e.element),(0,k.default)(e,N,n,n.handles.end,function(){(0,R.default)(e,n.handles)&&(0,U.removeToolState)(e.element,N,n);var a=F.getConfiguration();void 0===n.text&&a.getTextCallback(t),o.updateImage(e.element)})}function l(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,n){var o=g.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.end)};return g.cornerstoneMath.lineSegment.distanceToPoint(a,n)<25}function u(e,t){var n=(0,U.getToolState)(e.currentTarget,N);if(n){var o=t.enabledElement,a=g.external.cornerstone,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var i=void 0,l=y.default.getToolWidth(),s=w.default.getFont(),u=F.getConfiguration(),d=0;d<n.data.length;d++){r.save(),u&&u.shadow&&(r.shadowColor=u.shadowColor||"#000000",r.shadowOffsetX=u.shadowOffsetX||1,r.shadowOffsetY=u.shadowOffsetY||1);var c=n.data[d];i=c.active?P.default.getActiveColor():P.default.getToolColor();var f=a.pixelToCanvas(t.element,c.handles.start),m=a.pixelToCanvas(t.element,c.handles.end);u.arrowFirst?(0,O.default)(r,m,f,i,l):(0,O.default)(r,f,m,i,l);var v={drawHandlesIfActive:u&&u.drawHandlesOnHover};if(u.drawHandles&&(0,S.default)(r,t,c.handles,i,v),c.text&&""!==c.text){r.font=s;var h=r.measureText(c.text).width+10,p=w.default.getFontSize()+10,x=Math.max(h,p)/2+5;m.x<f.x&&(x=-x);var b=void 0;if(!c.handles.textBox.hasMoved){b=u.arrowFirst?{x:m.x-h/2+x,y:m.y-p/2}:{x:f.x-h/2-x,y:f.y-p/2};var C=a.internal.getTransform(o);C.invert();var M=C.transformPoint(b.x,b.y);c.handles.textBox.x=M.x,c.handles.textBox.y=M.y}b=a.pixelToCanvas(t.element,c.handles.textBox);var I=(0,T.default)(r,c.text,b.x,b.y,i);if(c.handles.textBox.boundingBox=I,c.handles.textBox.hasMoved){var _={start:{},end:{}},E={x:(f.x+m.x)/2,y:(f.y+m.y)/2},k=[f,m,E];_.end.x=b.x,_.end.y=b.y,_.start=g.cornerstoneMath.point.findClosestPoint(k,_.end);var D=[{x:I.left+I.width/2,y:I.top},{x:I.left,y:I.top+I.height/2},{x:I.left+I.width/2,y:I.top+I.height},{x:I.left+I.width,y:I.top+I.height/2}];_.end=g.cornerstoneMath.point.findClosestPoint(D,_.start),r.beginPath(),r.strokeStyle=i,r.lineWidth=l,r.setLineDash([2,3]),r.moveTo(_.start.x,_.start.y),r.lineTo(_.end.x,_.end.y),r.stroke()}}r.restore()}}}function d(e){function t(e){null===e?(0,U.removeToolState)(n,N,o):o.text=e,o.active=!1,a.updateImage(n),g.external.$(n).on("CornerstoneToolsTouchPress",z.pressCallback),g.external.$(n).on("CornerstoneToolsTouchStartActive",z.touchDownActivateCallback),g.external.$(n).on("CornerstoneToolsTap",z.tapCallback)}var n=e.element,o=l(e),a=g.external.cornerstone;(0,U.addToolState)(n,N,o),g.external.$(n).off("CornerstoneToolsTouchPress",z.pressCallback),g.external.$(n).off("CornerstoneToolsTouchStartActive",z.touchDownActivateCallback),g.external.$(n).off("CornerstoneToolsTap",z.tapCallback),a.updateImage(n),(0,$.default)(e,N,o,o.handles.end,function(){a.updateImage(n),(0,R.default)(e,o.handles)&&(0,U.removeToolState)(n,N,o);var r=F.getConfiguration();void 0===o.text&&r.getTextCallback(t)})}function c(e,t){function n(e,t,n){!0===n?(0,U.removeToolState)(o,N,e):e.text=t,e.active=!1,a.updateImage(o)}var o=t.element,a=g.external.cornerstone,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,A.default)(t.which,e.data.mouseButtonMask)){var i=F.getConfiguration(),l=t.currentPoints.canvas,u=(0,U.getToolState)(o,N);if(u)for(var d=0;d<u.data.length;d++)if(r=u.data[d],s(o,r,l)||(0,V.default)(r.handles.textBox,l))return r.active=!0,a.updateImage(o),i.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1}}function f(e,t){function n(e,t,n){console.log("pressCallback doneChangingTextCallback"),!0===n?(0,U.removeToolState)(o,N,e):e.text=t,e.active=!1,a.updateImage(o),g.external.$(o).on("CornerstoneToolsTouchStart",z.touchStartCallback),g.external.$(o).on("CornerstoneToolsTouchStartActive",z.touchDownActivateCallback),g.external.$(o).on("CornerstoneToolsTap",z.tapCallback)}var o=t.element,a=g.external.cornerstone,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,A.default)(t.which,e.data.mouseButtonMask)){var i=F.getConfiguration(),l=t.currentPoints.canvas,u=(0,U.getToolState)(o,N);if(u){if(t.handlePressed)return g.external.$(o).off("CornerstoneToolsTouchStart",z.touchStartCallback),g.external.$(o).off("CornerstoneToolsTouchStartActive",z.touchDownActivateCallback),g.external.$(o).off("CornerstoneToolsTap",z.tapCallback),i.changeTextCallback(t.handlePressed,t,n),e.stopImmediatePropagation(),!1;for(var d=0;d<u.data.length;d++)if(r=u.data[d],s(o,r,l)||(0,V.default)(r.handles.textBox,l))return r.active=!0,a.updateImage(o),g.external.$(o).off("CornerstoneToolsTouchStart",z.touchStartCallback),g.external.$(o).off("CornerstoneToolsTouchStartActive",z.touchDownActivateCallback),g.external.$(o).off("CornerstoneToolsTap",z.tapCallback),i.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1;return!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.arrowAnnotateTouch=t.arrowAnnotate=void 0;var g=n(0),m=n(7),v=o(m),h=n(9),p=o(h),x=n(6),T=o(x),b=n(5),y=o(b),C=n(14),w=o(C),M=n(4),P=o(M),I=n(8),S=o(I),_=n(49),O=o(_),E=n(23),k=o(E),D=n(25),$=o(D),j=n(12),R=o(j),L=n(2),A=o(L),B=n(16),V=o(B),U=n(1),N="arrowAnnotate",W={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0},F=(0,v.default)({addNewMeasurement:i,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:N,mouseDoubleClickCallback:c});F.setConfiguration(W);var z=(0,p.default)({addNewMeasurement:d,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:N,pressCallback:f});t.arrowAnnotate=F,t.arrowAnnotateTouch=z},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e.stopImmediatePropagation();var n=(0,x.getToolState)(e.currentTarget,C);if(n){var o=v.external.cornerstone,a=e.currentTarget,r=o.getEnabledElement(a),i=r.image.imageId,l=o.metaData.get("imagePlaneModule",i),s=t.currentPoints.image,u=(0,y.imagePointToPatientPoint)(s,l);n.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==a){var t=Number.MAX_VALUE,n=-1,r=(0,x.getToolState)(e,"stack");if(void 0!==r){var i=r.data[0];if(i.imageIds.forEach(function(e,a){var r=o.metaData.get("imagePlaneModule",e),i=r.imagePositionPatient,l=r.rowCosines.clone(),s=r.columnCosines.clone(),d=s.clone().cross(l.clone()),c=Math.abs(d.clone().dot(i)-d.clone().dot(u));c<t&&(t=c,n=a)}),n!==i.currentImageIdIndex&&-1!==n&&void 0!==i.imageIds[n]){var l=p.default.getStartLoadHandler(),s=p.default.getEndLoadHandler(),d=p.default.getErrorLoadingHandler();l&&l(e);var c=void 0;c=!0===i.preventCache?o.loadImage(i.imageIds[n]):o.loadAndCacheImage(i.imageIds[n]),c.then(function(t){var a=o.getViewport(e);i.currentImageIdIndex=n,o.displayImage(e,t,a),s&&s(e,t)},function(t){var o=i.imageIds[n];d&&d(e,o,t)})}}}})}}function r(e,t){v.external.$(t.element).off("CornerstoneToolsMouseDrag",l),v.external.$(t.element).off("CornerstoneToolsMouseUp",r)}function i(e,t){if((0,b.default)(t.which,e.data.mouseButtonMask))return v.external.$(t.element).on("CornerstoneToolsMouseDrag",l),v.external.$(t.element).on("CornerstoneToolsMouseUp",r),a(e,t),!1}function l(e,t){return a(e,t),!1}function s(e,t,n){var o={mouseButtonMask:t};(0,x.clearToolState)(e,C),(0,x.addToolState)(e,C,{synchronizationContext:n}),v.external.$(e).off("CornerstoneToolsMouseDown",i),v.external.$(e).on("CornerstoneToolsMouseDown",o,i)}function u(e){v.external.$(e).off("CornerstoneToolsMouseDown",i)}function d(e,t){v.external.$(t.element).off("CornerstoneToolsTouchDrag",f),v.external.$(t.element).off("CornerstoneToolsDragEnd",d)}function c(e,t){return v.external.$(t.element).on("CornerstoneToolsTouchDrag",f),v.external.$(t.element).on("CornerstoneToolsDragEnd",d),a(e,t),!1}function f(e,t){return a(e,t),!1}function g(e,t){(0,x.clearToolState)(e,C),(0,x.addToolState)(e,C,{synchronizationContext:t}),v.external.$(e).off("CornerstoneToolsTouchStart",c),v.external.$(e).on("CornerstoneToolsTouchStart",c)}function m(e){v.external.$(e).off("CornerstoneToolsTouchStart",c)}Object.defineProperty(t,"__esModule",{value:!0}),t.crosshairsTouch=t.crosshairs=void 0;var v=n(0),h=n(10),p=o(h),x=n(1),T=n(2),b=o(T),y=n(27),C="crosshairs",w={activate:s,deactivate:u,enable:s,disable:u},M={activate:g,deactivate:m,enable:g,disable:m};t.crosshairs=w,t.crosshairsTouch=M},function(e,t,n){"use strict";function o(e){r.external.cornerstone.fitToWindow(e.element)}function a(e,t){return s.strategy(t),!1}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(55),l=function(e){return e&&e.__esModule?e:{default:e}}(i),s=(0,l.default)(a);s.strategies={default:o},s.strategy=o,t.default=s},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=d.external.cornerstone,n=t.getEnabledElement(e.element),o=n.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);var a=x.default.getActiveColor(),r=h.default.getFont(),i=h.default.getFontSize(),l=_.getConfiguration();o.save(),l&&l.shadow&&(o.shadowColor=l.shadowColor||"#000000",o.shadowOffsetX=l.shadowOffsetX||1,o.shadowOffsetY=l.shadowOffsetY||1);var s=Math.round(e.currentPoints.image.x),u=Math.round(e.currentPoints.image.y),c=void 0,f=void 0,g=void 0;if(!(s<0||u<0||s>=e.image.columns||u>=e.image.rows)){if(e.image.color)c=(0,C.default)(e.element,s,u,1,1),f=s+", "+u,g="R: "+c[0]+" G: "+c[1]+" B: "+c[2]+" A: "+c[3];else{c=t.getStoredPixels(e.element,s,u,1,1);var m=c[0],v=m*e.image.slope+e.image.intercept,p=(0,M.default)(e.image,m);f=s+", "+u,g="SP: "+m+" MO: "+parseFloat(v.toFixed(3)),p&&(g+=" SUV: "+parseFloat(p.toFixed(3)))}var T={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},y=t.pixelToCanvas(e.element,T);o.font=r,o.fillStyle=a,(0,b.default)(o,g,y.x,y.y+i+5,a),(0,b.default)(o,f,y.x,y.y,a),o.restore()}}function r(e){var t=d.external.cornerstone,n=e.element,o=t.getEnabledElement(n),a=o.image,r=o.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);var i=x.default.getActiveColor(),l=h.default.getFont(),s=_.getConfiguration();r.save(),s&&s.shadow&&(r.shadowColor=s.shadowColor||"#000000",r.shadowOffsetX=s.shadowOffsetX||1,r.shadowOffsetY=s.shadowOffsetY||1);var u=t.metaData.get("generalSeriesModule",a.imageId),c=void 0;u&&(c=u.modality);var f=void 0;f=!0===e.isTouchEvent?t.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-4*h.default.getFontSize()):t.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-h.default.getFontSize()/2);var g=void 0,m="";if(!(f.x<0||f.y<0||f.x>=a.columns||f.y>=a.rows)){if(a.color)g=(0,C.default)(n,f.x,f.y,1,1),m="R: "+g[0]+" G: "+g[1]+" B: "+g[2];else{g=t.getStoredPixels(n,f.x,f.y,1,1);var v=g[0],p=v*e.image.slope+e.image.intercept,T=parseFloat(p.toFixed(2));if("CT"===c)m+="HU: "+T;else if("PT"===c){m+=T;var y=(0,M.default)(e.image,v);y&&(m+=" SUV: "+parseFloat(y.toFixed(2)))}else m+=T}var w=t.pixelToCanvas(n,f);r.font=l,r.fillStyle=i;var P=void 0,I=r.measureText(m).width;P=!0===e.isTouchEvent?{x:-I/2-5,y:-h.default.getFontSize()-10-12}:{x:12,y:-(h.default.getFontSize()+10)/2},r.beginPath(),r.strokeStyle=i,r.arc(w.x,w.y,6,0,2*Math.PI),r.stroke(),(0,b.default)(r,m,w.x+P.x,w.y+P.y,i),r.restore()}}function i(e,t){var n=t.element;n.removeEventListener("cornerstoneimagerendered",s),d.external.$(n).off("CornerstoneToolsMouseDrag",u),d.external.$(n).off("CornerstoneToolsMouseUp",i),d.external.$(n).off("CornerstoneToolsMouseClick",i),d.external.cornerstone.updateImage(t.element)}function l(e,t){var n=t.element;if((0,I.default)(t.which,e.data.mouseButtonMask))return n.addEventListener("cornerstoneimagerendered",s),d.external.$(n).on("CornerstoneToolsMouseDrag",u),d.external.$(n).on("CornerstoneToolsMouseUp",i),d.external.$(n).on("CornerstoneToolsMouseClick",i),_.strategy(t),!1}function s(){S&&(_.strategy(S),S=null)}function u(e,t){var n=t.element;return S=t,d.external.cornerstone.updateImage(n),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.dragProbeTouch=t.dragProbe=void 0;var d=n(0),c=n(13),f=o(c),g=n(11),m=o(g),v=n(14),h=o(v),p=n(4),x=o(p),T=n(6),b=o(T),y=n(34),C=o(y),w=n(17),M=o(w),P=n(2),I=o(P),S=void 0,_=(0,f.default)(l);_.strategies={default:a,minimal:r},_.strategy=a;var O={fireOnTouchStart:!0},E=(0,m.default)(u,O);t.dragProbe=_,t.dragProbeTouch=E},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n,o){var a=d.external.cornerstone,r=a.pixelToCanvas(e,t.handles.start),i=a.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,i.x)+o/2,top:Math.min(r.y,i.y)+o/2,width:Math.abs(r.x-i.x)-o,height:Math.abs(r.y-i.y)-o},s={left:Math.min(r.x,i.x)-o/2,top:Math.min(r.y,i.y)-o/2,width:Math.abs(r.x-i.x)+o,height:Math.abs(r.y-i.y)+o},u=(0,I.default)(l,n);return!(!(0,I.default)(s,n)||u)}function i(e,t,n){return r(e,t,n,15)}function l(e,t,n){return r(e,t,n,25)}function s(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function u(e,t){var n=(0,k.getToolState)(e.currentTarget,D);if(n){var o=d.external.cornerstone,a=t.image,r=t.element,i=h.default.getToolWidth(),l=$.getConfiguration(),u=t.canvasContext.canvas.getContext("2d"),c=o.metaData.get("generalSeriesModule",a.imageId),f=void 0;c&&(f=c.modality),u.setTransform(1,0,0,1,0,0);for(var g=0;g<n.data.length;g++){u.save();var m=n.data[g];l&&l.shadow&&(u.shadowColor=l.shadowColor||"#000000",u.shadowOffsetX=l.shadowOffsetX||1,u.shadowOffsetY=l.shadowOffsetY||1);var v=x.default.getColorIfActive(m.active),p=o.pixelToCanvas(r,m.handles.start),T=o.pixelToCanvas(r,m.handles.end),y=Math.min(p.x,T.x),w=Math.min(p.y,T.y),P=Math.abs(p.x-T.x),I=Math.abs(p.y-T.y);if(u.beginPath(),u.strokeStyle=v,u.lineWidth=i,(0,M.default)(u,y,w,P,I),u.closePath(),l&&l.drawHandlesOnHover)if(!0===m.active)(0,b.default)(u,t,m.handles,v);else{var S={drawHandlesIfActive:!0};(0,b.default)(u,t,m.handles,v,S)}else(0,b.default)(u,t,m.handles,v);var O=void 0,j=void 0,R=void 0;if(!1===m.invalidated)j=m.meanStdDev,R=m.meanStdDevSUV,O=m.area;else{var L={left:Math.round(Math.min(m.handles.start.x,m.handles.end.x)),top:Math.round(Math.min(m.handles.start.y,m.handles.end.y)),width:Math.round(Math.abs(m.handles.start.x-m.handles.end.x)),height:Math.round(Math.abs(m.handles.start.y-m.handles.end.y))};if(!a.color){var A=o.getPixels(r,L.left,L.top,L.width,L.height);j=(0,_.default)(A,L),"PT"===f&&(R={mean:(0,E.default)(a,(j.mean-a.intercept)/a.slope),stdDev:(0,E.default)(a,(j.stdDev-a.intercept)/a.slope)}),j&&!isNaN(j.mean)&&(m.meanStdDev=j,m.meanStdDevSUV=R)}var B=a.columnPixelSpacing||1,V=a.rowPixelSpacing||1;O=Math.PI*(L.width*B/2)*(L.height*V/2),isNaN(O)||(m.area=O),m.invalidated=!1}var U=[];if(j&&void 0!==j.mean){var N="";"CT"===f&&(N=" HU");var W="Mean: "+s(j.mean.toFixed(2))+N,F="StdDev: "+s(j.stdDev.toFixed(2))+N;if(R&&void 0!==R.mean){W+=" SUV: "+s(R.mean.toFixed(2)),F+=" SUV: "+s(R.stdDev.toFixed(2))}U.push(W),U.push(F)}if(O){var z=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(z=" pixels"+String.fromCharCode(178));var H="Area: "+s(O.toFixed(2))+z;U.push(H)}m.handles.textBox.hasMoved||(m.handles.textBox.x=Math.max(m.handles.start.x,m.handles.end.x),m.handles.textBox.y=(m.handles.start.y+m.handles.end.y)/2);var Y=o.pixelToCanvas(r,m.handles.textBox),X={centering:{x:!1,y:!0}},G=(0,C.default)(u,U,Y.x,Y.y,v,X);if(m.handles.textBox.boundingBox=G,m.handles.textBox.hasMoved){var q={start:{},end:{x:Y.x,y:Y.y}},K=[{x:y+P/2,y:w},{x:y,y:w+I/2},{x:y+P/2,y:w+I},{x:y+P,y:w+I/2}];q.start=d.cornerstoneMath.point.findClosestPoint(K,q.end);var Z=[{x:G.left+G.width/2,y:G.top},{x:G.left,y:G.top+G.height/2},{x:G.left+G.width/2,y:G.top+G.height},{x:G.left+G.width,y:G.top+G.height/2}];q.end=d.cornerstoneMath.point.findClosestPoint(Z,q.start),u.beginPath(),u.strokeStyle=v,u.lineWidth=i,u.setLineDash([2,3]),u.moveTo(q.start.x,q.start.y),u.lineTo(q.end.x,q.end.y),u.stroke()}u.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ellipticalRoiTouch=t.ellipticalRoi=void 0;var d=n(0),c=n(7),f=o(c),g=n(9),m=o(g),v=n(5),h=o(v),p=n(4),x=o(p),T=n(8),b=o(T),y=n(6),C=o(y),w=n(47),M=o(w),P=n(32),I=o(P),S=n(50),_=o(S),O=n(17),E=o(O),k=n(1),D="ellipticalRoi",$=(0,f.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:i,toolType:D}),j=(0,m.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:l,toolType:D});t.ellipticalRoi=$,t.ellipticalRoiTouch=j},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,_.getToolState)(e.element,O);if(void 0!==t){var n=k.getConfiguration(),o=t.data[n.currentTool],a={x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,lines:[]};o.handles.length&&o.handles[n.currentHandle-1].lines.push(e.currentPoints.image),o.handles.push(a),n.currentHandle+=1,n.freehand=!1,T.external.cornerstone.updateImage(e.element)}}function r(e,t){var n=(0,_.getToolState)(e.element,O);if(void 0!==n){var o=n.data[t];if(void 0!==o.handles)for(var a=e.currentPoints.canvas,r=0;r<o.handles.length;r++){var i=T.external.cornerstone.pixelToCanvas(e.element,o.handles[r]);if(T.cornerstoneMath.point.distance(i,a)<5)return r}}}function i(e){var t=(0,_.getToolState)(e.element,O);if(t)for(var n=void 0,o=0;o<t.data.length;o++)if(void 0!==(n=r(e,o)))return{handleNearby:n,toolIndex:o}}function l(e,t){if(T.external.$(t.element).off("CornerstoneToolsMouseUp",l),void 0!==(0,_.getToolState)(t.element,O)){var n=k.getConfiguration();t.event.shiftKey||(n.freehand=!1),T.external.cornerstone.updateImage(t.element)}}function s(e,t){var n=(0,_.getToolState)(t.element,O);if(n){var o=k.getConfiguration(),a=n.data[o.currentTool],i=Math.max(t.currentPoints.image.x,0);i=Math.min(i,t.image.width),o.mouseLocation.handles.start.x=i;var l=Math.max(t.currentPoints.image.y,0);l=Math.min(l,t.image.height),o.mouseLocation.handles.start.y=l;var s=o.currentHandle;if(o.modifying&&(a.active=!0,a.highlight=!0,a.handles[s].x=o.mouseLocation.handles.start.x,a.handles[s].y=o.mouseLocation.handles.start.y,s)){var u=a.handles[s-1].lines.length-1,d=a.handles[s-1].lines[u];d.x=o.mouseLocation.handles.start.x,d.y=o.mouseLocation.handles.start.y}if(o.freehand)a.handles[s-1].lines.push(t.currentPoints.image);else{var c=r(t,o.currentTool);void 0!==c&&c<a.handles.length-1&&(o.mouseLocation.handles.start.x=a.handles[c].x,o.mouseLocation.handles.start.y=a.handles[c].y)}T.external.cornerstone.updateImage(t.element)}}function u(e){T.external.$(e.element).on("CornerstoneToolsMouseMove",s),T.external.$(e.element).on("CornerstoneToolsMouseUp",l);var t={visible:!0,active:!0,handles:[]},n=k.getConfiguration();n.mouseLocation.handles.start.x=e.currentPoints.image.x,n.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,_.addToolState)(e.element,O,t);var o=(0,_.getToolState)(e.element,O);n.currentTool=o.data.length-1}function d(e,t){var n=(0,_.getToolState)(e.element,O);if(n){var o=k.getConfiguration(),a=n.data[o.currentTool];a.active=!1,a.highlight=!1,void 0!==t&&a.handles[o.currentHandle-1].lines.push({x:a.handles[t].x,y:a.handles[t].y}),o.modifying&&(o.modifying=!1),o.currentHandle=0,o.currentTool=-1,T.external.$(e.element).off("CornerstoneToolsMouseMove",s),T.external.cornerstone.updateImage(e.element)}}function c(e,t){if((0,S.default)(t.which,e.data.mouseButtonMask)){var n=(0,_.getToolState)(t.element,O),o=void 0,c=void 0,f=k.getConfiguration(),g=f.currentTool;if(f.modifying)return void d(t);if(g<0){var m=i(t);m?(o=m.handleNearby,c=m.toolIndex,void 0!==o&&(T.external.$(t.element).on("CornerstoneToolsMouseMove",s),T.external.$(t.element).on("CornerstoneToolsMouseUp",l),f.modifying=!0,f.currentHandle=o,f.currentTool=c)):(u(t),a(t))}else g>=0&&n.data[g].active&&(o=r(t,g),void 0!==o?d(t,o):t.event.shiftKey?f.freehand=!0:a(t));return!1}}function f(e){var t=e.detail,n=(0,_.getToolState)(e.currentTarget,O);if(void 0!==n){var o=T.external.cornerstone,a=k.getConfiguration(),r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var i=void 0,l=y.default.getToolWidth(),s=w.default.getFillColor(),u=0;u<n.data.length;u++){r.save();var d=n.data[u];d.active?(i=w.default.getActiveColor(),s=w.default.getFillColor()):(i=w.default.getToolColor(),s=w.default.getToolColor());var c=void 0;if(d.handles.length)for(var f=0;f<d.handles.length;f++){c=d.handles[f];var g=o.pixelToCanvas(t.element,c);r.beginPath(),r.strokeStyle=i,r.lineWidth=l,r.moveTo(g.x,g.y);for(var m=0;m<d.handles[f].lines.length;m++){var v=o.pixelToCanvas(t.element,d.handles[f].lines[m]);r.lineTo(v.x,v.y),r.stroke()}var h=o.pixelToCanvas(t.element,a.mouseLocation.handles.start);f===d.handles.length-1&&(!d.active||a.freehand||a.modifying||(r.lineTo(h.x,h.y),r.stroke()))}var p={fill:s};d.active&&(0,P.default)(r,t,a.mouseLocation.handles,i,p),(0,P.default)(r,t,d.handles,i,p),r.restore()}}}function g(e){T.external.$(e).off("CornerstoneToolsMouseDown",c),T.external.$(e).off("CornerstoneToolsMouseUp",l),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstoneimagerendered",f),T.external.cornerstone.updateImage(e)}function m(e){T.external.$(e).off("CornerstoneToolsMouseDown",c),T.external.$(e).off("CornerstoneToolsMouseUp",l),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),T.external.cornerstone.updateImage(e)}function v(e,t){var n={mouseButtonMask:t};T.external.$(e).off("CornerstoneToolsMouseDown",n,c),T.external.$(e).off("CornerstoneToolsMouseUp",l),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstoneimagerendered",f),T.external.$(e).on("CornerstoneToolsMouseDown",n,c),T.external.cornerstone.updateImage(e)}function h(e){T.external.$(e).off("CornerstoneToolsMouseDown",c),T.external.$(e).off("CornerstoneToolsMouseUp",l),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstoneimagerendered",f),T.external.cornerstone.updateImage(e)}function p(){return E}function x(e){E=e}Object.defineProperty(t,"__esModule",{value:!0}),t.freehand=void 0;var T=n(0),b=n(5),y=o(b),C=n(4),w=o(C),M=n(8),P=o(M),I=n(2),S=o(I),_=n(1),O="freehand",E={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1},k={enable:g,disable:m,activate:v,deactivate:h,getConfiguration:p,setConfiguration:x};t.freehand=k},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,T.getToolState)(e.event.currentTarget,b);if(!(t&&t.data&&t.data.length>0)){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}}function r(e,t,n){var o=s.external.cornerstone,a=o.pixelToCanvas(e,t.handles.start),r=o.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)},l=!1;return n.x>=i.left&&n.x<=i.left+i.width&&n.y>=i.top&&n.y<=i.top+i.height&&(l=!0),l}function i(e,t,n){var o=s.external.cornerstone,a=o.pixelToCanvas(e,t.handles.start),r=o.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)};return s.cornerstoneMath.rect.distanceToPoint(i,n)<5}function l(e,t){var n=(0,T.getToolState)(e.currentTarget,b);if(void 0!==n){var o=s.external.cornerstone,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=void 0,i=m.default.getToolWidth();a.save();var l=n.data[0];if(l){r=l.active?h.default.getActiveColor():h.default.getToolColor();var u=o.pixelToCanvas(t.element,l.handles.start),d=o.pixelToCanvas(t.element,l.handles.end),c={left:Math.min(u.x,d.x),top:Math.min(u.y,d.y),width:Math.abs(u.x-d.x),height:Math.abs(u.y-d.y)};a.beginPath(),a.strokeStyle="transparent",a.rect(0,0,a.canvas.clientWidth,a.canvas.clientHeight),a.rect(c.width+c.left,c.top,-c.width,c.height),a.stroke(),a.fillStyle="rgba(0,0,0,0.7)",a.fill(),a.closePath(),a.beginPath(),a.strokeStyle=r,a.lineWidth=i,a.setLineDash([4]),a.strokeRect(c.left,c.top,c.width,c.height),a.setLineDash([]),(0,x.default)(a,t,l.handles,r),a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.highlightTouch=t.highlight=void 0;var s=n(0),u=n(56),d=o(u),c=n(9),f=o(c),g=n(5),m=o(g),v=n(4),h=o(v),p=n(8),x=o(p),T=n(1),b="highlight",y=(0,d.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,pointInsideRect:r,toolType:b},!0),C=(0,f.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,pointInsideRect:r,toolType:b},!0);t.highlight=y,t.highlightTouch=C},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=t.image,o=n.stats,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=[];Object.keys(o).forEach(function(e){var t=e+" : "+o[e];r.push(t)}),(0,s.default)(a,r,0,0,"orange"),r.forEach(function(e){console.log(e)})}Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),i=o(r),l=n(6),s=o(l),u=(0,i.default)(a);t.default=u},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n){var o=l.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.end)};return l.cornerstoneMath.lineSegment.distanceToPoint(a,n)<25}function i(e,t){var n=(0,b.getToolState)(e.currentTarget,y);if(n){var o=l.external.cornerstone,a=t.canvasContext.canvas.getContext("2d"),r=t.image,i=t.element;a.setTransform(1,0,0,1,0,0);var s=v.default.getToolWidth(),u=C.getConfiguration(),d=o.metaData.get("imagePlaneModule",r.imageId),c=void 0,f=void 0;d?(c=d.rowPixelSpacing||d.rowImagePixelSpacing,f=d.columnPixelSpacing||d.colImagePixelSpacing):(c=r.rowPixelSpacing,f=r.columnPixelSpacing);for(var m=0;m<n.data.length;m++){a.save(),u&&u.shadow&&(a.shadowColor=u.shadowColor||"#000000",a.shadowOffsetX=u.shadowOffsetX||1,a.shadowOffsetY=u.shadowOffsetY||1);var h=n.data[m],x=p.default.getColorIfActive(h.active),w=o.pixelToCanvas(i,h.handles.start),M=o.pixelToCanvas(i,h.handles.end);a.beginPath(),a.strokeStyle=x,a.lineWidth=s,a.moveTo(w.x,w.y),a.lineTo(M.x,M.y),a.stroke();var P={drawHandlesIfActive:u&&u.drawHandlesOnHover};(0,T.default)(a,t,h.handles,x,P),a.fillStyle=x;var I=(h.handles.end.x-h.handles.start.x)*(c||1),S=(h.handles.end.y-h.handles.start.y)*(f||1),_=Math.sqrt(I*I+S*S);h.length=_;var O=" mm";c&&f||(O=" pixels");var E=""+_.toFixed(2)+O;if(!h.handles.textBox.hasMoved){var k={x:Math.max(h.handles.start.x,h.handles.end.x)};k.x===h.handles.start.x?k.y=h.handles.start.y:k.y=h.handles.end.y,h.handles.textBox.x=k.x,h.handles.textBox.y=k.y}var D=o.pixelToCanvas(t.element,h.handles.textBox);D.x+=10;var $={centering:{x:!1,y:!0}},j=(0,g.default)(a,E,D.x,D.y,x,$);if(h.handles.textBox.boundingBox=j,h.handles.textBox.hasMoved){var R={start:{},end:{}},L={x:(w.x+M.x)/2,y:(w.y+M.y)/2},A=[w,M,L];R.end.x=D.x,R.end.y=D.y,R.start=l.cornerstoneMath.point.findClosestPoint(A,R.end);var B=[{x:j.left+j.width/2,y:j.top},{x:j.left,y:j.top+j.height/2},{x:j.left+j.width/2,y:j.top+j.height},{x:j.left+j.width,y:j.top+j.height/2}];R.end=l.cornerstoneMath.point.findClosestPoint(B,R.start),a.beginPath(),a.strokeStyle=x,a.lineWidth=s,a.setLineDash([2,3]),a.moveTo(R.start.x,R.start.y),a.lineTo(R.end.x,R.end.y),a.stroke()}a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.lengthTouch=t.length=void 0;var l=n(0),s=n(7),u=o(s),d=n(9),c=o(d),f=n(6),g=o(f),m=n(5),v=o(m),h=n(4),p=o(h),x=n(8),T=o(x),b=n(1),y="length",C=(0,u.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:y}),w=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:y});t.length=C,t.lengthTouch=w},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=t.element;x.external.$(n).off("CornerstoneToolsMouseDrag",u),x.external.$(n).off("CornerstoneToolsMouseUp",a),x.external.$(n).off("CornerstoneToolsMouseClick",a),n.removeEventListener("cornerstonenewimage",l),r(t)}function r(e){x.external.$(e.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function i(e,t){var n=t.element;if((0,w.default)(t.which,e.data.mouseButtonMask))return x.external.$(n).on("CornerstoneToolsMouseDrag",t,u),x.external.$(n).on("CornerstoneToolsMouseUp",t,a),x.external.$(n).on("CornerstoneToolsMouseClick",t,a),I=t.currentPoints,n.addEventListener("cornerstonenewimage",l),d(t),!1}function l(e){var t=e.detail;t.currentPoints=I,d(t)}function s(e,t){var n=t.element;x.external.$(t.element).off("CornerstoneToolsDragEnd",s),x.external.$(t.element).off("CornerstoneToolsTouchEnd",s),n.removeEventListener("cornerstonenewimage",l),r(t)}function u(e,t){return I=t.currentPoints,d(t),!0===t.isTouchEvent&&(x.external.$(t.element).on("CornerstoneToolsDragEnd",s),x.external.$(t.element).on("CornerstoneToolsTouchEnd",s)),!1}function d(e){var t=x.external.$(e.element).find(".magnifyTool").get(0);t||c(e.element);var n=S.getConfiguration(),o=n.magnifySize,a=n.magnificationLevel,r=x.external.$(e.element).find("canvas").not(".magnifyTool").get(0);r.getContext("2d").setTransform(1,0,0,1,0,0);var i=t.getContext("2d");i.setTransform(1,0,0,1,0,0);var l=o/a,s=x.external.cornerstone.pixelToCanvas(e.element,e.currentPoints.image);!0===e.isTouchEvent&&(s.y-=1.25*l),s.x=Math.max(s.x,0),s.x=Math.min(s.x,r.width),s.y=Math.max(s.y,0),s.y=Math.min(s.y,r.height),i.clearRect(0,0,o,o),i.fillStyle="transparent",i.fillRect(0,0,o,o);var u={x:s.x-.5*l,y:s.y-.5*l};"Safari"===P&&(u.x=Math.max(u.x,0),u.y=Math.max(u.y,0)),u.x=Math.min(u.x,r.width),u.y=Math.min(u.y,r.height);var d={x:(r.width-u.x)*a,y:(r.height-u.y)*a};i.drawImage(r,u.x,u.y,r.width-u.x,r.height-u.y,0,0,d.x,d.y),t.style.top=s.y-.5*o+"px",t.style.left=s.x-.5*o+"px",t.style.display="block",document.body.style.cursor="none"}function c(e){if(0===x.external.$(e).find(".magnifyTool").length){var t=document.createElement("canvas");t.classList.add("magnifyTool");var n=S.getConfiguration();t.width=n.magnifySize,t.height=n.magnifySize,t.style.position="absolute",e.appendChild(t)}}function f(e){x.external.$(e).find(".magnifyTool").remove()}function g(e){x.external.$(e).off("CornerstoneToolsMouseDown",i),f(e)}function m(e){if(!P){var t=(0,y.getBrowserInfo)(),n=t.split(" ");P=n[0]}c(e)}function v(e,t){var n={mouseButtonMask:t};x.external.$(e).off("CornerstoneToolsMouseDown",i),x.external.$(e).on("CornerstoneToolsMouseDown",n,i),c(e)}function h(){return M}function p(e){M=e}Object.defineProperty(t,"__esModule",{value:!0}),t.magnifyTouchDrag=t.magnify=void 0;var x=n(0),T=n(11),b=o(T),y=n(20),C=n(2),w=o(C),M={magnifySize:100,magnificationLevel:2},P=void 0,I=void 0,S={enable:m,activate:v,deactivate:g,disable:g,getConfiguration:h,setConfiguration:p},_={fireOnTouchStart:!0,activateCallback:c,disableCallback:f},O=(0,b.default)(u,_);t.magnify=S,t.magnifyTouchDrag=O},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=l.external.cornerstone,n=t.getEnabledElement(e),o=t.metaData.get("imagePlaneModule",n.image.imageId);if(o&&o.rowCosines&&o.columnCosines){var a=u.default.getOrientationString(o.rowCosines),r=u.default.getOrientationString(o.columnCosines),i=u.default.invertOrientationString(a);return{top:u.default.invertOrientationString(r),bottom:r,left:i,right:a}}}function r(e){var t=l.external.cornerstone,n=t.getEnabledElement(e),o=void 0;o={x:n.image.width/2,y:5};var a=t.pixelToCanvas(e,o);o={x:n.image.width/2,y:n.image.height-5};var r=t.pixelToCanvas(e,o);o={x:5,y:n.image.height/2};var i=t.pixelToCanvas(e,o);return o={x:n.image.width-10,y:n.image.height/2},{top:a,bottom:r,left:i,right:t.pixelToCanvas(e,o)}}function i(e,t){var n=t.element,o=a(n);if(o){var i=r(n,o),l=t.canvasContext.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0);var s=g.default.getToolColor(),u={top:l.measureText(o.top).width,left:l.measureText(o.left).width,right:l.measureText(o.right).width,bottom:l.measureText(o.bottom).width};(0,v.default)(l,o.top,i.top.x-u.top/2,i.top.y,s),(0,v.default)(l,o.left,i.left.x-u.left/2,i.left.y,s);var d=h.getConfiguration();d&&d.drawAllMarkers&&((0,v.default)(l,o.right,i.right.x-u.right/2,i.right.y,s),(0,v.default)(l,o.bottom,i.bottom.x-u.bottom/2,i.bottom.y,s))}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),s=n(42),u=o(s),d=n(24),c=o(d),f=n(4),g=o(f),m=n(6),v=o(m),h=(0,c.default)(i);t.default=h},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){l.external.$(t.element).off("CornerstoneToolsMouseDrag",i),l.external.$(t.element).off("CornerstoneToolsMouseUp",a),l.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,g.default)(t.which,e.data.mouseButtonMask))return l.external.$(t.element).on("CornerstoneToolsMouseDrag",i),l.external.$(t.element).on("CornerstoneToolsMouseUp",a),l.external.$(t.element).on("CornerstoneToolsMouseClick",a),!1}function i(e,t){var n=t.viewport.scale,o=t.viewport.scale;return t.image.rowPixelSpacing<t.image.columnPixelSpacing?n*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(o*=t.image.rowPixelSpacing/t.image.columnPixelSpacing),t.viewport.translation.x+=t.deltaPoints.page.x/n,t.viewport.translation.y+=t.deltaPoints.page.y/o,l.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.panTouchDrag=t.pan=void 0;var l=n(0),s=n(13),u=o(s),d=n(11),c=o(d),f=n(2),g=o(f),m=(0,u.default)(r),v=(0,c.default)(i);t.pan=m,t.panTouchDrag=v},function(e,t,n){"use strict";function o(e,t){var n=s.getConfiguration();if(n&&n.testPointers(t))return t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,a.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),r=n(29),i=function(e){return e&&e.__esModule?e:{default:e}}(r),l={testPointers:function(e){return e.numPointers>=2}},s=(0,i.default)(o);s.setConfiguration(l),t.default=s},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function r(e,t,n){var o=l.external.cornerstone.pixelToCanvas(e,t.handles.end);return l.cornerstoneMath.point.distance(o,n)<5}function i(e,t){var n=(0,M.getToolState)(e.currentTarget,P);if(n){var o=l.external.cornerstone,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r=void 0,i=v.default.getFont(),s=v.default.getFontSize(),u=0;u<n.data.length;u++){a.save();var d=n.data[u];r=d.active?g.default.getActiveColor():g.default.getToolColor(),(0,p.default)(a,t,d.handles,r);var c=Math.round(d.handles.end.x),f=Math.round(d.handles.end.y),m=void 0,h=void 0,x=void 0;if(c<0||f<0||c>=t.image.columns||f>=t.image.rows)return;if(t.image.color)h=c+", "+f,m=(0,y.default)(t.element,c,f,1,1),x="R: "+m[0]+" G: "+m[1]+" B: "+m[2];else{m=o.getStoredPixels(t.element,c,f,1,1);var b=m[0],C=b*t.image.slope+t.image.intercept,I=(0,w.default)(t.image,b);h=c+", "+f,x="SP: "+b+" MO: "+parseFloat(C.toFixed(3)),I&&(x+=" SUV: "+parseFloat(I.toFixed(3)))}var S={x:d.handles.end.x+3,y:d.handles.end.y-3},_=o.pixelToCanvas(t.element,S);a.font=i,a.fillStyle=r,(0,T.default)(a,x,_.x,_.y+s+5,r),(0,T.default)(a,h,_.x,_.y,r),a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.probeTouch=t.probe=void 0;var l=n(0),s=n(7),u=o(s),d=n(9),c=o(d),f=n(4),g=o(f),m=n(14),v=o(m),h=n(8),p=o(h),x=n(6),T=o(x),b=n(34),y=o(b),C=n(17),w=o(C),M=n(1),P="probe",I=(0,u.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P}),S=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P});t.probe=I,t.probeTouch=S},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n){var o=u.external.cornerstone,a=o.pixelToCanvas(e,t.handles.start),r=o.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)};return u.cornerstoneMath.rect.distanceToPoint(i,n)<5}function i(e,t){for(var n=0,o=0,a=0,r=0,i=t.top;i<t.top+t.height;i++)for(var l=t.left;l<t.left+t.width;l++)n+=e[r],o+=e[r]*e[r],a++,r++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var s=n/a,u=o/a-s*s;return{count:a,mean:s,variance:u,stdDev:Math.sqrt(u)}}function l(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function s(e,t){var n=(0,M.getToolState)(e.currentTarget,P);if(n){var o=u.external.cornerstone,a=t.image,r=t.element,s=v.default.getToolWidth(),d=I.getConfiguration(),c=t.canvasContext.canvas.getContext("2d"),f=o.metaData.get("generalSeriesModule",a.imageId),g=void 0;f&&(g=f.modality),c.setTransform(1,0,0,1,0,0);for(var m=0;m<n.data.length;m++){c.save();var h=n.data[m];d&&d.shadow&&(c.shadowColor=d.shadowColor||"#000000",c.shadowOffsetX=d.shadowOffsetX||1,c.shadowOffsetY=d.shadowOffsetY||1);var x=p.default.getColorIfActive(h.active),b=o.pixelToCanvas(r,h.handles.start),C=o.pixelToCanvas(r,h.handles.end),S=Math.min(b.x,C.x),_=Math.min(b.y,C.y),O=Math.abs(b.x-C.x),E=Math.abs(b.y-C.y);if(c.beginPath(),c.strokeStyle=x,c.lineWidth=s,c.rect(S,_,O,E),c.stroke(),d&&d.drawHandlesOnHover)if(!0===h.active)(0,T.default)(c,t,h.handles,x);else{var k={drawHandlesIfActive:!0};(0,T.default)(c,t,h.handles,x,k)}else(0,T.default)(c,t,h.handles,x);var D=void 0,$=void 0,j=void 0;if(!1===h.invalidated)$=h.meanStdDev,j=h.meanStdDevSUV,D=h.area;else{var R={left:Math.min(h.handles.start.x,h.handles.end.x),top:Math.min(h.handles.start.y,h.handles.end.y),width:Math.abs(h.handles.start.x-h.handles.end.x),height:Math.abs(h.handles.start.y-h.handles.end.y)};if(!a.color){$=i(o.getPixels(r,R.left,R.top,R.width,R.height),R),"PT"===g&&(j={mean:(0,w.default)(a,($.mean-a.intercept)/a.slope),stdDev:(0,w.default)(a,($.stdDev-a.intercept)/a.slope)}),$&&!isNaN($.mean)&&(h.meanStdDev=$,h.meanStdDevSUV=j)}D=R.width*(a.columnPixelSpacing||1)*(R.height*(a.rowPixelSpacing||1)),isNaN(D)||(h.area=D),h.invalidated=!1}var L=[];if($&&$.mean){var A="";"CT"===g&&(A=" HU");var B="Mean: "+l($.mean.toFixed(2))+A,V="StdDev: "+l($.stdDev.toFixed(2))+A;if(j&&void 0!==j.mean){B+=" SUV: "+l(j.mean.toFixed(2)),V+=" SUV: "+l(j.stdDev.toFixed(2))}L.push(B),L.push(V)}if(D){var U=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(U=" pixels"+String.fromCharCode(178));var N="Area: "+l(D.toFixed(2))+U;L.push(N)}h.handles.textBox.hasMoved||(h.handles.textBox.x=Math.max(h.handles.start.x,h.handles.end.x),h.handles.textBox.y=(h.handles.start.y+h.handles.end.y)/2);var W=o.pixelToCanvas(r,h.handles.textBox),F={centering:{x:!1,y:!0}},z=(0,y.default)(c,L,W.x,W.y,x,F);if(h.handles.textBox.boundingBox=z,h.handles.textBox.hasMoved){var H={start:{},end:{x:W.x,y:W.y}},Y=[{x:S+O/2,y:_},{x:S,y:_+E/2},{x:S+O/2,y:_+E},{x:S+O,y:_+E/2}];H.start=u.cornerstoneMath.point.findClosestPoint(Y,H.end);var X=[{x:z.left+z.width/2,y:z.top},{x:z.left,y:z.top+z.height/2},{x:z.left+z.width/2,y:z.top+z.height},{x:z.left+z.width,y:z.top+z.height/2}];H.end=u.cornerstoneMath.point.findClosestPoint(X,H.start),c.beginPath(),c.strokeStyle=x,c.lineWidth=s,c.setLineDash([2,3]),c.moveTo(H.start.x,H.start.y),c.lineTo(H.end.x,H.end.y),c.stroke()}c.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.rectangleRoiTouch=t.rectangleRoi=void 0;var u=n(0),d=n(7),c=o(d),f=n(9),g=o(f),m=n(5),v=o(m),h=n(4),p=o(h),x=n(8),T=o(x),b=n(6),y=o(b),C=n(17),w=o(C),M=n(1),P="rectangleRoi",I=(0,c.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:P}),S=(0,g.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:P});t.rectangleRoi=I,t.rectangleRoiTouch=S},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.element.getBoundingClientRect(e.element),n={x:e.currentPoints.client.x,y:e.currentPoints.client.y},o=e.element.clientWidth,a=e.element.clientHeight,r={x:n.x-t.left-o/2,y:-1*(n.y-t.top-a/2)},i=Math.atan2(r.y,r.x),l=i*(180/Math.PI),s=-1*l+90;e.viewport.rotation=s,d.external.cornerstone.setViewport(e.element,e.viewport)}function r(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,d.external.cornerstone.setViewport(e.element,e.viewport)}function i(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,d.external.cornerstone.setViewport(e.element,e.viewport)}function l(e,t){d.external.$(t.element).off("CornerstoneToolsMouseDrag",u),d.external.$(t.element).off("CornerstoneToolsMouseUp",l),d.external.$(t.element).off("CornerstoneToolsMouseClick",l)}function s(e,t){if((0,h.default)(t.which,e.data.mouseButtonMask))return d.external.$(t.element).on("CornerstoneToolsMouseDrag",u),d.external.$(t.element).on("CornerstoneToolsMouseUp",l),d.external.$(t.element).on("CornerstoneToolsMouseClick",l),!1}function u(e,t){return p.strategy(t),d.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.rotateTouchDrag=t.rotate=void 0;var d=n(0),c=n(13),f=o(c),g=n(11),m=o(g),v=n(2),h=o(v),p=(0,f.default)(s);p.strategies={default:a,horizontal:r,vertical:i},p.strategy=a;var x=(0,m.default)(u);t.rotate=p,t.rotateTouchDrag=x},function(e,t,n){"use strict";function o(e,t){return t.viewport.rotation+=t.rotation,i.external.cornerstone.setViewport(t.element,t.viewport),!1}function a(e){i.external.$(e).off("CornerstoneToolsTouchRotate",o)}function r(e){i.external.$(e).off("CornerstoneToolsTouchRotate",o),i.external.$(e).on("CornerstoneToolsTouchRotate",o)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),l={activate:r,disable:a};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){n=n||"image/png";var a=o.external.$(e).find("canvas").get(0),r=document.createElement("a");if(r.download=t,r.href=a.toDataURL(n),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(i)}else r.fireEvent&&r.fireEvent("onclick")};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,n){n(prompt("Change your annotation:"))}function i(e){function t(e){null===e?(0,B.removeToolState)(o,V,r):r.text=e,r.active=!1,n.updateImage(o)}var n=g.external.cornerstone,o=e.element,a=N.getConfiguration(),r=l(e);(0,B.addToolState)(o,V,r),n.updateImage(o),(0,O.default)(e,V,r,r.handles.end,function(){(0,S.default)(e,r.handles)&&(0,B.removeToolState)(o,V,r),void 0===r.text&&a.getTextCallback(t),n.updateImage(o)})}function l(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,n){if(t.handles.end){var o=g.external.cornerstone.pixelToCanvas(e,t.handles.end);return g.cornerstoneMath.point.distance(o,n)<25}}function u(e,t){var n=(0,B.getToolState)(e.currentTarget,V);if(n){var o=g.external.cornerstone,a=t.enabledElement,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var i=t.canvasContext.canvas.width,l=void 0,s=w.default.getToolWidth(),u=y.default.getFont(),d=N.getConfiguration(),c=0;c<n.data.length;c++){r.save(),d&&d.shadow&&(r.shadowColor=d.shadowColor||"#000000",r.shadowOffsetX=d.shadowOffsetX||1,r.shadowOffsetY=d.shadowOffsetY||1);var f=n.data[c];l=f.active?P.default.getActiveColor():P.default.getToolColor();var m=o.pixelToCanvas(t.element,f.handles.end);(0,$.default)(r,m,l,s);var v={drawHandlesIfActive:d&&d.drawHandlesOnHover};if(d.drawHandles&&(0,k.default)(r,t,m,l,v),f.text&&""!==f.text){r.font=u;var h="";h=d.showCoordinates?f.text+" x: "+Math.round(f.handles.end.x)+" y: "+Math.round(f.handles.end.y):f.text;var p=r.measureText(h).width+10,x=y.default.getFontSize()+10,b=Math.max(p,x)/2+5;m.x>i/2&&(b=-b);var C=void 0;if(!f.handles.textBox.hasMoved){C={x:m.x-p/2+b,y:m.y-x/2};var M=o.internal.getTransform(a);M.invert();var I=M.transformPoint(C.x,C.y);f.handles.textBox.x=I.x,f.handles.textBox.y=I.y}C=o.pixelToCanvas(t.element,f.handles.textBox);var S=(0,T.default)(r,h,C.x,C.y,l);if(f.handles.textBox.boundingBox=S,f.handles.textBox.hasMoved){var _={start:{},end:{}};_.end.x=C.x,_.end.y=C.y,_.start=m;var O=[{x:S.left+S.width/2,y:S.top},{x:S.left,y:S.top+S.height/2},{x:S.left+S.width/2,y:S.top+S.height},{x:S.left+S.width,y:S.top+S.height/2}];_.end=g.cornerstoneMath.point.findClosestPoint(O,_.start),r.beginPath(),r.strokeStyle=l,r.lineWidth=s,r.setLineDash([2,3]),r.moveTo(_.start.x,_.start.y),r.lineTo(_.end.x,_.end.y),r.stroke()}}r.restore()}}}function d(e){function t(e){null===e?(0,B.removeToolState)(o,V,r):r.text=e,r.active=!1,n.updateImage(o)}var n=g.external.cornerstone,o=e.element,a=N.getConfiguration(),r=l(e);(0,B.addToolState)(o,V,r),n.updateImage(o),(0,O.default)(e,V,r,r.handles.end,function(){(0,S.default)(e,r.handles)&&(0,B.removeToolState)(o,V,r),void 0===r.text&&a.getTextCallback(t),n.updateImage(o)})}function c(e,t){function n(e,t,n){!0===n?(0,B.removeToolState)(a,V,e):e.text=t,e.active=!1,o.updateImage(a)}var o=g.external.cornerstone,a=t.element,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,R.default)(t.which,e.data.mouseButtonMask)){var i=N.getConfiguration(),l=t.currentPoints.canvas,u=(0,B.getToolState)(a,V);if(u){for(var d=0;d<u.data.length;d++)if(r=u.data[d],s(a,r,l)||(0,A.default)(r.handles.textBox,l))return r.active=!0,o.updateImage(a),i.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1;return!1}}}function f(e,t){function n(e,t,n){console.log("pressCallback doneChangingTextCallback"),!0===n?(0,B.removeToolState)(a,V,e):e.text=t,e.active=!1,o.updateImage(a),g.external.$(a).on("CornerstoneToolsTouchStart",W.touchStartCallback),g.external.$(a).on("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(a).on("CornerstoneToolsTap",W.tapCallback)}var o=g.external.cornerstone,a=t.element,r=void 0;if(e.data&&e.data.mouseButtonMask&&!(0,R.default)(t.which,e.data.mouseButtonMask))return!1;var i=N.getConfiguration(),l=t.currentPoints.canvas,u=(0,B.getToolState)(a,V);if(!u)return!1;if(t.handlePressed)return g.external.$(a).off("CornerstoneToolsTouchStart",W.touchStartCallback),g.external.$(a).off("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(a).off("CornerstoneToolsTap",W.tapCallback),i.changeTextCallback(t.handlePressed,t,n),e.stopImmediatePropagation(),!1;for(var d=0;d<u.data.length;d++)if(r=u.data[d],s(a,r,l)||(0,A.default)(r.handles.textBox,l))return r.active=!0,o.updateImage(a),g.external.$(a).off("CornerstoneToolsTouchStart",W.touchStartCallback),g.external.$(a).off("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(a).off("CornerstoneToolsTap",W.tapCallback),i.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.seedAnnotateTouch=t.seedAnnotate=void 0;var g=n(0),m=n(7),v=o(m),h=n(9),p=o(h),x=n(6),T=o(x),b=n(14),y=o(b),C=n(5),w=o(C),M=n(4),P=o(M),I=n(12),S=o(I),_=n(22),O=o(_),E=n(8),k=o(E),D=n(48),$=o(D),j=n(2),R=o(j),L=n(16),A=o(L),B=n(1),V="seedAnnotate",U={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,currentLetter:"A",currentNumber:0,showCoordinates:!0,countUp:!0},N=(0,v.default)({addNewMeasurement:i,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:V,mouseDoubleClickCallback:c});N.setConfiguration(U);var W=(0,p.default)({addNewMeasurement:d,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:V,pressCallback:f});t.seedAnnotate=N,t.seedAnnotateTouch=W},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n){var o=d.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.middle)},r=d.cornerstoneMath.lineSegment.distanceToPoint(a,n);return r<25||(a.start=o.pixelToCanvas(e,t.handles.middle),a.end=o.pixelToCanvas(e,t.handles.end),(r=d.cornerstoneMath.lineSegment.distanceToPoint(a,n))<25)}function i(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function l(e,t){var n=(0,$.getToolState)(e.currentTarget,j);if(n){var o=d.external.cornerstone,a=t.enabledElement,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var l=void 0,s=b.default.getToolWidth(),u=x.default.getFont(),c=R.getConfiguration(),f=0;f<n.data.length;f++){r.save(),c&&c.shadow&&(r.shadowColor=c.shadowColor||"#000000",r.shadowOffsetX=c.shadowOffsetX||1,r.shadowOffsetY=c.shadowOffsetY||1);var g=n.data[f];l=g.active?C.default.getActiveColor():C.default.getToolColor();var v=o.pixelToCanvas(t.element,g.handles.start),p=o.pixelToCanvas(t.element,g.handles.middle),T=o.pixelToCanvas(t.element,g.handles.end);r.beginPath(),r.strokeStyle=l,r.lineWidth=s,r.moveTo(v.x,v.y),r.lineTo(p.x,p.y),r.lineTo(T.x,T.y),r.stroke();var y={drawHandlesIfActive:c&&c.drawHandlesOnHover};(0,E.default)(r,t,g.handles,l,y),r.fillStyle=l;var w=t.image.columnPixelSpacing||1,M=t.image.rowPixelSpacing||1,P="";t.image.rowPixelSpacing&&t.image.columnPixelSpacing||(P=" (isotropic)");var I={x:(Math.ceil(g.handles.middle.x)-Math.ceil(g.handles.start.x))*w,y:(Math.ceil(g.handles.middle.y)-Math.ceil(g.handles.start.y))*M},S={x:(Math.ceil(g.handles.end.x)-Math.ceil(g.handles.middle.x))*w,y:(Math.ceil(g.handles.end.y)-Math.ceil(g.handles.middle.y))*M},_={x:(Math.ceil(g.handles.end.x)-Math.ceil(g.handles.start.x))*w,y:(Math.ceil(g.handles.end.y)-Math.ceil(g.handles.start.y))*M},O=i(I),k=i(S),D=i(_),L=Math.acos((Math.pow(O,2)+Math.pow(k,2)-Math.pow(D,2))/(2*O*k));L*=180/Math.PI;var A=(0,h.default)(L,2);if(A){var B=A.toString()+String.fromCharCode(parseInt("00B0",16))+P,V=void 0;if(g.handles.textBox.hasMoved)V=o.pixelToCanvas(t.element,g.handles.textBox);else{V={x:p.x,y:p.y},r.font=u;var U=r.measureText(B).width;p.x<v.x?V.x-=15+U+10:V.x+=15;var N=o.internal.getTransform(a);N.invert();var W=N.transformPoint(V.x,V.y);g.handles.textBox.x=W.x,g.handles.textBox.y=W.y}var F={centering:{x:!1,y:!0}},z=(0,m.default)(r,B,V.x,V.y,l,F);if(g.handles.textBox.boundingBox=z,g.handles.textBox.hasMoved){var H={start:{},end:{}},Y=[v,T,p];H.end.x=V.x,H.end.y=V.y,H.start=d.cornerstoneMath.point.findClosestPoint(Y,H.end);var X=[{x:z.left+z.width/2,y:z.top},{x:z.left,y:z.top+z.height/2},{x:z.left+z.width/2,y:z.top+z.height},{x:z.left+z.width,y:z.top+z.height/2}];H.end=d.cornerstoneMath.point.findClosestPoint(X,H.start),r.beginPath(),r.strokeStyle=l,r.lineWidth=s,r.setLineDash([2,3]),r.moveTo(H.start.x,H.start.y),r.lineTo(H.end.x,H.end.y),r.stroke()}}r.restore()}}}function s(e){var t=d.external.cornerstone,n=a(e),o=e.element,r={mouseButtonMask:e.which};(0,$.addToolState)(o,j,n),d.external.$(o).off("CornerstoneToolsMouseMove",R.mouseMoveCallback),d.external.$(o).off("CornerstoneToolsMouseDrag",R.mouseMoveCallback),d.external.$(o).off("CornerstoneToolsMouseDown",R.mouseDownCallback),d.external.$(o).off("CornerstoneToolsMouseDownActivate",R.mouseDownActivateCallback),t.updateImage(o),(0,I.default)(e,j,n,n.handles.middle,function(){if(n.active=!1,(0,M.default)(e,n.handles))return(0,$.removeToolState)(o,j,n),d.external.$(o).on("CornerstoneToolsMouseMove",R.mouseMoveCallback),d.external.$(o).on("CornerstoneToolsMouseDrag",R.mouseMoveCallback),d.external.$(o).on("CornerstoneToolsMouseDown",r,R.mouseDownCallback),d.external.$(o).on("CornerstoneToolsMouseDownActivate",r,R.mouseDownActivateCallback),void t.updateImage(o);n.handles.end.active=!0,t.updateImage(o),(0,I.default)(e,j,n,n.handles.end,function(){n.active=!1,(0,M.default)(e,n.handles)&&(0,$.removeToolState)(o,j,n),d.external.$(o).on("CornerstoneToolsMouseMove",R.mouseMoveCallback),d.external.$(o).on("CornerstoneToolsMouseDrag",R.mouseMoveCallback),d.external.$(o).on("CornerstoneToolsMouseDown",r,R.mouseDownCallback),d.external.$(o).on("CornerstoneToolsMouseDownActivate",r,R.mouseDownActivateCallback),t.updateImage(o)})})}function u(e){var t=d.external.cornerstone,n=a(e),o=e.element;(0,$.addToolState)(o,j,n),d.external.$(o).off("CornerstoneToolsTouchDrag",L.touchMoveCallback),d.external.$(o).off("CornerstoneToolsTouchStartActive",L.touchDownActivateCallback),d.external.$(o).off("CornerstoneToolsTouchStart",L.touchStartCallback),d.external.$(o).off("CornerstoneToolsTap",L.tapCallback),t.updateImage(o),(0,_.default)(e,j,n,n.handles.middle,function(){if((0,M.default)(e,n.handles))return(0,$.removeToolState)(o,j,n),d.external.$(o).on("CornerstoneToolsTouchDrag",L.touchMoveCallback),d.external.$(o).on("CornerstoneToolsTouchStart",L.touchStartCallback),d.external.$(o).on("CornerstoneToolsTouchStartActive",L.touchDownActivateCallback),d.external.$(o).on("CornerstoneToolsTap",L.tapCallback),void t.updateImage(o);(0,_.default)(e,j,n,n.handles.end,function(){(0,M.default)(e,n.handles)&&((0,$.removeToolState)(o,j,n),t.updateImage(o)),d.external.$(o).on("CornerstoneToolsTouchDrag",L.touchMoveCallback),d.external.$(o).on("CornerstoneToolsTouchStart",L.touchStartCallback),d.external.$(o).on("CornerstoneToolsTouchStartActive",L.touchDownActivateCallback),d.external.$(o).on("CornerstoneToolsTap",L.tapCallback)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleAngleTouch=t.simpleAngle=void 0;var d=n(0),c=n(7),f=o(c),g=n(6),m=o(g),v=n(31),h=o(v),p=n(14),x=o(p),T=n(5),b=o(T),y=n(4),C=o(y),w=n(12),M=o(w),P=n(23),I=o(P),S=n(25),_=o(S),O=n(8),E=o(O),k=n(9),D=o(k),$=n(1),j="simpleAngle",R=(0,f.default)({createNewMeasurement:a,addNewMeasurement:s,onImageRendered:l,pointNearTool:r,toolType:j}),L=(0,D.default)({createNewMeasurement:a,addNewMeasurement:u,onImageRendered:l,pointNearTool:r,toolType:j});t.simpleAngle=R,t.simpleAngleTouch=L},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=M.getConfiguration();if(t.current){var n={visible:!0,active:!0,text:t.current,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},o={left:0,top:0,width:e.image.width,height:e.image.height};if(u.cornerstoneMath.point.insideRect(n.handles.end,o)){var a=t.markers.indexOf(t.current);return t.ascending?(a+=1)>=t.markers.length&&(t.loop?a-=t.markers.length:a=-1):(a-=1)<0&&(t.loop?a+=t.markers.length:a=-1),t.current=t.markers[a],n}}}function r(e,t,n){if(t.handles.end.boundingBox){var o=u.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),a=(0,v.default)(t.handles.end,n);return o<10||a}}function i(e,t){var n=(0,C.getToolState)(t.element,w);if(n){var o=t.canvasContext.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);for(var a=M.getConfiguration(),r=0;r<n.data.length;r++){var i=n.data[r],l=p.default.getToolColor();i.active&&(l=p.default.getActiveColor()),o.save(),a&&a.shadow&&(o.shadowColor=a.shadowColor||"#000000",o.shadowOffsetX=a.shadowOffsetX||1,o.shadowOffsetY=a.shadowOffsetY||1),o.fillStyle=l;var s=o.measureText(i.text);i.textWidth=s.width+10;var d=u.external.cornerstone.pixelToCanvas(t.element,i.handles.end),c={centering:{x:!0,y:!0}},f=(0,y.default)(o,i.text,d.x,d.y-10,l,c);i.handles.end.boundingBox=f,o.restore()}}}function l(e,t){function n(t,n,r){!0===r?(0,C.removeToolState)(a,w,t):t.text=n,t.active=!1,o.updateImage(a);var i={mouseButtonMask:e.data.mouseButtonMask};u.external.$(a).on("CornerstoneToolsMouseMove",i,M.mouseMoveCallback),u.external.$(a).on("CornerstoneToolsMouseDown",i,M.mouseDownCallback),u.external.$(a).on("CornerstoneToolsMouseDownActivate",i,M.mouseDownActivateCallback),u.external.$(a).on("CornerstoneToolsMouseDoubleClick",i,M.mouseDoubleClickCallback)}var o=u.external.cornerstone,a=t.element,i=void 0;if(!e.data||!e.data.mouseButtonMask||(0,T.default)(t.which,e.data.mouseButtonMask)){var l=M.getConfiguration(),s=t.currentPoints.canvas,d=(0,C.getToolState)(a,w);if(d){for(var c=0;c<d.data.length;c++)if(i=d.data[c],r(a,i,s))return i.active=!0,o.updateImage(a),u.external.$(a).off("CornerstoneToolsMouseMove",M.mouseMoveCallback),u.external.$(a).off("CornerstoneToolsMouseDown",M.mouseDownCallback),u.external.$(a).off("CornerstoneToolsMouseDownActivate",M.mouseDownActivateCallback),u.external.$(a).off("CornerstoneToolsMouseDoubleClick",M.mouseDoubleClickCallback),l.changeTextCallback(i,t,n),e.stopImmediatePropagation(),!1;return!1}}}function s(e,t){function n(e,t,n){!0===n?(0,C.removeToolState)(a,w,e):e.text=t,e.active=!1,o.updateImage(a),u.external.$(a).on("CornerstoneToolsTouchDrag",P.touchMoveCallback),u.external.$(a).on("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),u.external.$(a).on("CornerstoneToolsTouchStart",P.touchStartCallback),u.external.$(a).on("CornerstoneToolsTap",P.tapCallback),u.external.$(a).on("CornerstoneToolsTouchPress",P.pressCallback)}var o=u.external.cornerstone,a=t.element,i=void 0,l=M.getConfiguration(),s=t.currentPoints.canvas,d=(0,C.getToolState)(a,w);if(!d)return!1;if(t.handlePressed)return t.handlePressed.active=!0,o.updateImage(a),u.external.$(a).off("CornerstoneToolsTouchDrag",P.touchMoveCallback),u.external.$(a).off("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),u.external.$(a).off("CornerstoneToolsTouchStart",P.touchStartCallback),u.external.$(a).off("CornerstoneToolsTap",P.tapCallback),u.external.$(a).off("CornerstoneToolsTouchPress",P.pressCallback),l.changeTextCallback(t.handlePressed,t,n),e.stopImmediatePropagation(),!1;for(var c=0;c<d.data.length;c++)if(i=d.data[c],r(a,i,s))return i.active=!0,o.updateImage(a),u.external.$(a).off("CornerstoneToolsTouchDrag",P.touchMoveCallback),u.external.$(a).off("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),u.external.$(a).off("CornerstoneToolsTouchStart",P.touchStartCallback),u.external.$(a).off("CornerstoneToolsTap",P.tapCallback),u.external.$(a).off("CornerstoneToolsTouchPress",P.pressCallback),l.changeTextCallback(i,t,n),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.textMarkerTouch=t.textMarker=void 0;var u=n(0),d=n(7),c=o(d),f=n(9),g=o(f),m=n(16),v=o(m),h=n(4),p=o(h),x=n(2),T=o(x),b=n(6),y=o(b),C=n(1),w="textMarker",M=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:w,mouseDoubleClickCallback:l}),P=(0,g.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:w,pressCallback:s});t.textMarker=M,t.textMarkerTouch=P},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){u.external.$(t.element).off("CornerstoneToolsMouseDrag",l),u.external.$(t.element).off("CornerstoneToolsMouseUp",a),u.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,v.default)(t.which,e.data.mouseButtonMask))return u.external.$(t.element).on("CornerstoneToolsMouseDrag",l),u.external.$(t.element).on("CornerstoneToolsMouseUp",a),u.external.$(t.element).on("CornerstoneToolsMouseClick",a),!1}function i(e){var t=e.image.maxPixelValue*e.image.slope+e.image.intercept,n=e.image.minPixelValue*e.image.slope+e.image.intercept,o=t-n,a=o/1024,r=e.deltaPoints.page.x*a,i=e.deltaPoints.page.y*a;e.viewport.voi.windowWidth+=r,e.viewport.voi.windowCenter+=i}function l(e,t){return h.strategy(t),u.external.cornerstone.setViewport(t.element,t.viewport),!1}function s(e,t){e.stopImmediatePropagation();var n=t,o=n.image.maxPixelValue*n.image.slope+n.image.intercept,a=n.image.minPixelValue*n.image.slope+n.image.intercept,r=o-a,i=r/1024,l=n.deltaPoints.page.x*i,s=n.deltaPoints.page.y*i,d=h.getConfiguration();d.orientation?0===d.orientation?(n.viewport.voi.windowWidth+=l,n.viewport.voi.windowCenter+=s):(n.viewport.voi.windowWidth+=s,n.viewport.voi.windowCenter+=l):(n.viewport.voi.windowWidth+=l,n.viewport.voi.windowCenter+=s),u.external.cornerstone.setViewport(n.element,n.viewport)}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcTouchDrag=t.wwwc=void 0;var u=n(0),d=n(13),c=o(d),f=n(11),g=o(f),m=n(2),v=o(m),h=(0,c.default)(r);h.strategies={default:i},h.strategy=i;var p=(0,g.default)(s);t.wwwc=h,t.wwwcTouchDrag=p},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var o=e.length;if(o<2)return{min:t,max:n,mean:(t+n)/2};for(var a=n,r=t,i=0,l=0;l<o;l++){var s=e[l];a=Math.min(a,s),r=Math.max(r,s),i+=s}return{min:a,max:r,mean:i/o}}function r(e){var t=e.detail,n=(0,M.getToolState)(t.element,O);n&&n.data&&(n.data=[]),T.external.$(t.element).off("CornerstoneToolsMouseMove",c),T.external.$(t.element).off("CornerstoneToolsMouseDrag",c),T.external.$(t.element).off("CornerstoneToolsMouseUp",i),T.external.$(t.element).off("CornerstoneToolsMouseClick",i);var o={mouseButtonMask:k};T.external.$(t.element).on("CornerstoneToolsMouseDown",o,u)}function i(e,t){T.external.$(t.element).off("CornerstoneToolsMouseMove",c),T.external.$(t.element).off("CornerstoneToolsMouseDrag",c),T.external.$(t.element).off("CornerstoneToolsMouseUp",i),T.external.$(t.element).off("CornerstoneToolsMouseClick",i);var n={mouseButtonMask:k};T.external.$(t.element).on("CornerstoneToolsMouseDown",n,u);var o=(0,M.getToolState)(t.element,O);o&&o.data&&o.data.length&&(o.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},l(t))}function l(e){var t=T.external.cornerstone,n=(0,M.getToolState)(e.element,O);if(n&&n.data&&n.data.length){var o=n.data[0].startPoint,r=n.data[0].endPoint,i=Math.abs(o.x-r.x),l=Math.abs(o.y-r.y),s=Math.min(o.x,r.x),u=Math.min(o.y,r.y);s=Math.max(s,0),s=Math.min(s,e.image.width),u=Math.max(u,0),u=Math.min(u,e.image.height),i=Math.floor(Math.min(i,Math.abs(e.image.width-s))),l=Math.floor(Math.min(l,Math.abs(e.image.height-u)));var d=(0,I.default)(e.element,s,u,i,l),c=a(d,e.image.minPixelValue,e.image.maxPixelValue),f=D.getConfiguration(),g=t.getViewport(e.element);void 0===f.minWindowWidth&&(f.minWindowWidth=10),g.voi.windowWidth=Math.max(Math.abs(c.max-c.min),f.minWindowWidth),g.voi.windowCenter=c.mean,t.setViewport(e.element,g),n.data=[],t.updateImage(e.element)}}function s(e,t){var n=t.element;T.external.$(n).off("CornerstoneToolsMouseMove"),T.external.$(n).off("CornerstoneToolsMouseDrag"),T.external.$(n).on("CornerstoneToolsMouseMove",c),T.external.$(n).on("CornerstoneToolsMouseDrag",c),T.external.$(n).on("CornerstoneToolsMouseClick",i),"CornerstoneToolsMouseDrag"===e.type&&T.external.$(n).on("CornerstoneToolsMouseUp",i)}function u(e,t){if((0,_.default)(t.which,e.data.mouseButtonMask))return T.external.$(t.element).on("CornerstoneToolsMouseDrag",t,s),T.external.$(t.element).on("CornerstoneToolsMouseMove",t,s),T.external.$(t.element).off("CornerstoneToolsMouseDown",u),d(t),!1}function d(e){var t=(0,M.getToolState)(e.element,O);t&&t.data&&(t.data=[]);var n={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};(0,M.addToolState)(e.element,O,n)}function c(e,t){var n=(0,M.getToolState)(t.element,O);if(n&&n.data&&n.data.length){var o={x:t.currentPoints.image.x,y:t.currentPoints.image.y};n.data[0].endPoint=o,T.external.cornerstone.updateImage(t.element)}}function f(e){var t=e.detail,n=T.external.cornerstone,o=(0,M.getToolState)(t.element,O);if(o&&o.data&&o.data.length){var a=o.data[0].startPoint,r=o.data[0].endPoint;if(a&&r){var i=T.external.$(t.element).find("canvas").get(0),l=i.getContext("2d");l.setTransform(1,0,0,1,0,0);var s=w.default.getActiveColor(),u=n.pixelToCanvas(t.element,a),d=n.pixelToCanvas(t.element,r),c=Math.min(u.x,d.x),f=Math.min(u.y,d.y),g=Math.abs(u.x-d.x),m=Math.abs(u.y-d.y),v=y.default.getToolWidth(),h=D.getConfiguration();l.save(),h&&h.shadow&&(l.shadowColor=h.shadowColor||"#000000",l.shadowOffsetX=h.shadowOffsetX||1,l.shadowOffsetY=h.shadowOffsetY||1),l.beginPath(),l.strokeStyle=s,l.lineWidth=v,l.rect(c,f,g,m),l.stroke(),l.restore()}}}function g(e){T.external.$(e).off("CornerstoneToolsMouseDown",u),T.external.$(e).off("CornerstoneToolsMouseUp",i),T.external.$(e).off("CornerstoneToolsMouseClick",i),T.external.$(e).off("CornerstoneToolsMouseDrag",c),T.external.$(e).off("CornerstoneToolsMouseMove",c),e.removeEventListener("cornerstoneimagerendered",f),e.removeEventListener("cornerstonenewimage",r),T.external.cornerstone.updateImage(e)}function m(e,t){var n={mouseButtonMask:t};if(k=t,!(0,M.getToolState)(e,O)){var o=[];(0,M.addToolState)(e,O,o)}T.external.$(e).off("CornerstoneToolsMouseDown",u),T.external.$(e).off("CornerstoneToolsMouseUp",i),T.external.$(e).off("CornerstoneToolsMouseClick",i),T.external.$(e).off("CornerstoneToolsMouseDrag",c),T.external.$(e).off("CornerstoneToolsMouseMove",c),e.removeEventListener("cornerstoneimagerendered",f),e.removeEventListener("cornerstonenewimage",r),T.external.$(e).on("CornerstoneToolsMouseDown",n,u),e.addEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstonenewimage",r),T.external.cornerstone.updateImage(e)}function v(e){T.external.$(e).off("CornerstoneToolsTouchDrag",c),T.external.$(e).off("CornerstoneToolsTouchStart",d),T.external.$(e).off("CornerstoneToolsDragEnd",l),e.removeEventListener("cornerstoneimagerendered",f)}function h(e){if(!(0,M.getToolState)(e,O)){var t=[];(0,M.addToolState)(e,O,t)}T.external.$(e).off("CornerstoneToolsTouchDrag",c),T.external.$(e).off("CornerstoneToolsTouchStart",d),T.external.$(e).off("CornerstoneToolsDragEnd",l),e.removeEventListener("cornerstoneimagerendered",f),T.external.$(e).on("CornerstoneToolsTouchDrag",c),T.external.$(e).on("CornerstoneToolsTouchStart",d),T.external.$(e).on("CornerstoneToolsDragEnd",l),e.addEventListener("cornerstoneimagerendered",f)}function p(){return E}function x(e){E=e}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcRegionTouch=t.wwwcRegion=void 0;var T=n(0),b=n(5),y=o(b),C=n(4),w=o(C),M=n(1),P=n(46),I=o(P),S=n(2),_=o(S),O="wwwcRegion",E={minWindowWidth:10},k=void 0,D={activate:m,deactivate:g,disable:g,setConfiguration:x,getConfiguration:p},$={activate:h,deactivate:v,disable:v};t.wwwcRegion=D,t.wwwcRegionTouch=$},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=S.getConfiguration(),o=Math.log(e.scale)/Math.log(1.7),a=o+t,r=Math.pow(1.7,a);return n.maxScale&&r>n.maxScale?e.scale=n.maxScale:n.minScale&&r<n.minScale?e.scale=n.minScale:e.scale=r,e}function r(e,t,n){return e.x=Math.max(e.x,0),e.y=Math.max(e.y,0),e.x=Math.min(e.x,t),e.y=Math.min(e.y,n),e}function i(e,t){if(t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),0!==t.rotation){var n=t.rotation*Math.PI/180,o=Math.cos(n),a=Math.sin(n),r=e.x*o-e.y*a,i=e.x*a+e.y*o;e.x=r,e.y=i}return e}function l(e,t){var n=v.external.cornerstone,o=e.element,r=a(e.viewport,t);n.setViewport(o,r);var l=n.pageToPixel(o,e.startPoints.page.x,e.startPoints.page.y),s={x:e.startPoints.image.x-l.x,y:e.startPoints.image.y-l.y};s=i(s,r),r.translation.x-=s.x,r.translation.y-=s.y,n.setViewport(o,r)}function s(e,t){var n=e.element,o=e.image,l=S.getConfiguration(),s=a(e.viewport,t),u={x:0,y:0};if(t<0)s.scale<3&&(Math.abs(s.translation.x)<.01?s.translation.x=0:u.x=s.translation.x/8,Math.abs(s.translation.y)<.01?s.translation.y=0:u.y=s.translation.y/8);else{l&&l.preventZoomOutsideImage&&(I.image=r(I.image,o.width,o.height));var d={x:o.width/2-I.image.x,y:o.height/2-I.image.y};d=i(d,s);var c={x:s.translation.x-d.x,y:s.translation.y-d.y};Math.abs(c.x)<.01?s.translation.x=d.x:u.x=c.x/8,Math.abs(c.y)<.01?s.translation.y=d.y:u.y=c.y/8}s.translation.x-=u.x,s.translation.y-=u.y,v.external.cornerstone.setViewport(n,s)}function u(e,t){var n=e.element,o=a(e.viewport,t);v.external.cornerstone.setViewport(n,o)}function d(e,t){v.external.$(t.element).off("CornerstoneToolsMouseDrag",f),v.external.$(t.element).off("CornerstoneToolsMouseUp",d),v.external.$(t.element).off("CornerstoneToolsMouseClick",d)}function c(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask))return I=t.startPoints,v.external.$(t.element).on("CornerstoneToolsMouseDrag",f),v.external.$(t.element).on("CornerstoneToolsMouseUp",d),v.external.$(t.element).on("CornerstoneToolsMouseClick",d),!1}function f(e,t){if(!t.deltaPoints.page.y)return!1;var n=t.deltaPoints.page.y/100;return S.strategy(t,n),!1}function g(e,t){var n=-t.direction/4,o=S.getConfiguration();o&&o.invert&&(n*=-1);var r=a(t.viewport,n);v.external.cornerstone.setViewport(t.element,r)}function m(e,t){var n=v.external.cornerstone,o=S.getConfiguration(),a=t.viewport,r=t.element;a.scale+=t.scaleChange*a.scale,o.maxScale&&a.scale>o.maxScale?a.scale=o.maxScale:o.minScale&&a.scale<o.minScale&&(a.scale=o.minScale),n.setViewport(r,a);var l=n.pageToPixel(r,t.startPoints.page.x,t.startPoints.page.y),s={x:t.startPoints.image.x-l.x,y:t.startPoints.image.y-l.y};s=i(s,a),a.translation.x-=s.x,a.translation.y-=s.y,n.setViewport(r,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=void 0;var v=n(0),h=n(13),p=o(h),x=n(2),T=o(x),b=n(21),y=o(b),C=n(57),w=o(C),M=n(11),P=o(M),I=void 0,S=(0,p.default)(c);S.strategies={default:l,translate:s,zoomToCenter:u},S.strategy=l;var _=(0,y.default)(g),O=(0,w.default)(m),E=(0,P.default)(f);t.zoom=S,t.zoomWheel=_,t.zoomTouchPinch=O,t.zoomTouchDrag=E},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=y.getConfiguration(),n=e.element,o=d.external.cornerstone.getLayer(n,t.brushLayerId),a=o.image,r=a.rows,i=a.columns,l=e.currentPoints.image,s=l.x,u=l.y,f=(0,c.getToolState)(n,p),g=f.data[0].pixelData,m=t.draw,x=t.radius;if(!(s<0||s>i||u<0||u>r)){var T=(0,v.default)(x,r,i,s,u);(0,h.drawBrushPixels)(T,g,m,i),o.invalid=!0,d.external.cornerstone.updateImage(n)}}function r(e,t){T=t.currentPoints.image,b=!1}function i(e,t){a(t),b=!0,T=t.currentPoints.image}function l(e,t){T=t.currentPoints.image,d.external.cornerstone.updateImage(t.element)}function s(e,t){a(t),b=!0,T=t.currentPoints.image}function u(e,t){if(T){var n=t.image,o=n.rows,a=n.columns,r=T,i=r.x,l=r.y;if(!(i<0||i>a||l<0||l>o)){var s=y.getConfiguration(),u=s.radius,d=t.canvasContext,c=b?s.dragColor:s.hoverColor,f=t.element;d.setTransform(1,0,0,1,0,0);var g=(0,v.default)(u,o,a,i,l);(0,h.drawBrushOnCanvas)(g,d,c,f)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.brush=void 0;var d=n(0),c=n(1),f=n(58),g=o(f),m=n(59),v=o(m),h=n(60),p="brush",x={draw:1,radius:3,hoverColor:"green",dragColor:"yellow"},T=void 0,b=!1,y=(0,g.default)({onMouseMove:l,onMouseDown:i,onMouseUp:r,onDrag:s,toolType:"brush",onImageRendered:u});y.setConfiguration(x),t.brush=y},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var o=S.getConfiguration(),a=o.tolerance,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;e.forEach(function(e){var o=e[1]*n+e[0],a=t[o];r=Math.min(a,r),i=Math.max(a,i)}),M=r-a,w=i+a}function r(e,t,n,o){for(var a=S.getConfiguration(),r=a.draw,i=Math.round(C.x),l=Math.round(C.y),s=null,u=[],d=a.radius;0!==s&&d>a.minRadius;){s=0,u=(0,x.default)(d,n,o,i,l);for(var c=0;c<u.length;c++){var f=u[c][0],g=u[c][1],m=g*o+f,v=e[m];if(v>w||v<M){s++;break}}d--}return 0===s&&(0,T.drawBrushPixels)(u,t,r,o),d}function i(e){var t=S.getConfiguration(),n=e.element,o=g.external.cornerstone.getLayer(n,t.brushLayerId),a=g.external.cornerstone.getLayers(n)[0],i=o.image,l=i.rows,s=i.columns,u=(0,m.getToolState)(n,b),d=u.data[0];P=r(a.image.getPixelData(),d.pixelData,l,s),o.invalid=!0,g.external.cornerstone.updateImage(n)}function l(e){var t=S.getConfiguration(),n=e.element,o=g.external.cornerstone.getLayer(n,t.brushLayerId),a=o.image,r=a.rows,i=a.columns,l=e.currentPoints.image,s=l.x,u=l.y,d=(0,m.getToolState)(n,b),c=d.data[0].pixelData,f=t.draw,v=t.radius;if(!(s<0||s>i||u<0||u>r)){var h=(0,x.default)(v,r,i,s,u);(0,T.drawBrushPixels)(h,c,f,i),o.invalid=!0,g.external.cornerstone.updateImage(n)}}function s(e,t){C=t.currentPoints.image;var n=S.getConfiguration();I=!1,P=n.radius,g.external.cornerstone.updateImage(t.element)}function u(e,t){var n=t.element,o=S.getConfiguration(),r=g.external.cornerstone.getLayer(n,o.brushLayerId),s=g.external.cornerstone.getLayers(n)[0],u=t.currentPoints.image,d=u.x,c=u.y,f=r.image,m=f.rows,v=f.columns,h=(0,x.default)(o.radius,m,v,d,c);0===o.draw?l(t):(a(h,s.image.getPixelData(),v),i(t)),I=!0,C=t.currentPoints.image}function d(e,t){C=t.currentPoints.image,g.external.cornerstone.updateImage(t.element)}function c(e,t){0===y.draw?l(t):i(t),I=!0,C=t.currentPoints.image}function f(e,t){if(C){var n=t.image,o=n.rows,a=n.columns,r=C,i=r.x,l=r.y;if(!(i<0||i>a||l<0||l>o)){var s=S.getConfiguration(),u=t.canvasContext,d=I?s.dragColor:s.hoverColor,c=t.element;P=P||s.radius,u.setTransform(1,0,0,1,0,0);var f=(0,x.default)(P,o,a,i,l);(0,T.drawBrushOnCanvas)(f,u,d,c)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.adaptiveBrush=void 0;var g=n(0),m=n(1),v=n(58),h=o(v),p=n(59),x=o(p),T=n(60),b="brush",y={draw:1,radius:3,tolerance:5,minRadius:1,hoverColor:"green",dragColor:"yellow"},C=void 0,w=void 0,M=void 0,P=void 0,I=void 0,S=(0,h.default)({onMouseMove:d,onMouseDown:u,onMouseUp:s,onDrag:c,toolType:"adaptiveBrush",onImageRendered:f});S.setConfiguration(y),t.adaptiveBrush=S},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(26);Object.defineProperty(t,"regionsThreshold",{enumerable:!0,get:function(){return o(a).default}});var r=n(122);Object.defineProperty(t,"regionsGrow",{enumerable:!0,get:function(){return o(r).default}});var i=n(123);Object.defineProperty(t,"regionsDraw",{enumerable:!0,get:function(){return o(i).default}});var l=n(124);Object.defineProperty(t,"regionsScore",{enumerable:!0,get:function(){return o(l).default}});var s=n(125);Object.defineProperty(t,"regionsUndo",{enumerable:!0,get:function(){return o(s).default}})},function(e,t,n){"use strict";function o(e,t,n,o,a){var r=e*t,i=[a-1,a+1,a-e,a+e],l=Math.floor(a/r);return l<n&&i.push(a+r),l>o&&i.push(a-r),i}function a(e,t,n,a){return new Promise(function(n){function r(){for(var t=0;t<l;t++){if(0===O.length)return n();O.forEach(function(e){w[e]=u});var a=O.map(function(e){return o(g,v,y,C,e)}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e,t,n){return n.indexOf(e)===t}).filter(function(e){return w[e]===_});O=a}d.updateImage(e),setTimeout(r,0)}var i=(0,m.getConfiguration)(),l=i.growIterationsPerChunk,u=i.toolRegionValue,c=i.layersAbove,f=i.layersBelow,g=t.width,v=t.height,h=t.buffer,p=s(a,3),x=p[0],T=p[1],b=p[2],y=b+f,C=b-c,w=new Uint8Array(h),M=g*v,P=M*b,I=T*g+x,S=P+I,_=w[S];if(0!==_&&_!==u){var O=[S];r()}})}function r(e,t){var n=t.element;if((0,g.default)(t.which,e.data.mouseButtonMask)){(0,m.createUndoStep)(n);var o=s((0,c.getToolState)(n,"stack").data,1),r=o[0],i=s((0,c.getToolState)(n,"regions").data,1),l=i[0],u=r.currentImageIdIndex,d=r.imageIds,f=t.currentPoints.image,v=f.x,h=f.y,p=[Math.round(v),Math.round(h),u];a(n,l,d.length,p)}}function i(e,t){var n=(0,c.getToolState)(e,"stack"),o=(0,c.getToolState)(e,"regions");n&&n.data&&n.data.length&&o&&o.data&&o.data.length&&e.addEventListener("CornerstoneToolsMouseDown",{mouseButtonMask:t},r)}function l(e){e.removeEventListener("CornerstoneToolsMouseDown",r)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(o=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n(19),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),c=n(1),f=n(2),g=function(e){return e&&e.__esModule?e:{default:e}}(f),m=n(26);t.default={enable:i,disable:l,activate:i,deactivate:l}},function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e,t){for(var n=m(e,2),o=n[0],a=n[1],r=!1,i=0,l=t.length-1;i<t.length;l=i++){var s=m(t[i],2),u=s[0],d=s[1],c=m(t[l],2),f=c[0],g=c[1];d>a!=g>a&&o<(f-u)*(a-d)/(g-d)+u&&(r=!r)}return r}function r(e,t){var n=t.canvasContext,o=t.enabledElement,a=t.element;h.setToPixelCoordinateSystem(o,n);var r=(0,p.getToolState)(a,C),i=t.canvasContext,l=r.data[0].points;if(!(l.length<2)){var s=l[0],u=s[0],d=s[1];i.fillStyle="rgba(255,255,255,.2)",i.strokeStyle="white",i.beginPath(),i.moveTo(u,d),l.slice(1).forEach(function(e){i.lineTo(e[0],e[1])}),i.closePath(),i.stroke(),i.fill()}}function i(e){var t=y.getConfiguration(),n=t.toolRegionValue,o=t.layersAbove,r=t.layersBelow;y.createUndoStep(e);for(var i=(0,p.getToolState)(e,"stack"),l=(0,p.getToolState)(e,"regions"),s=(0,p.getToolState)(e,C),u=i.data[0].currentImageIdIndex,d=i.data[0].imageIds.length,c=l.data[0],f=s.data[0].points,g=c.buffer,m=c.width,v=c.height,h=Math.max(0,u-o),x=Math.min(d,u+r),T=m*v,b=h*T,M=new Uint8Array(g,b),P=0;P<=x-h;P+=1)for(var I=0;I<m;I+=1)for(var S=0;S<v;S+=1){var _=I+S*m+P*T,O=M[_],E=void 0;E=!w.snap||O>0,E&&a([I,S],f)&&(M[_]=n)}}function l(e,t){t.element.removeEventListener("CornerstoneToolsMouseDrag",u),t.element.removeEventListener("CornerstoneToolsMouseUp",l),t.element.removeEventListener("CornerstoneImageRendered",r),i(t.element),h.updateImage(t.element)}function s(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask)){return(0,p.getToolState)(e.currentTarget,C).data[0].points=[],t.element.addEventListener("CornerstoneToolsMouseDrag",u),t.element.addEventListener("CornerstoneToolsMouseUp",l),t.element.addEventListener("CornerstoneImageRendered",r),u(e,t)}}function u(e,t){e.stopImmediatePropagation();var n=(0,p.getToolState)(e.currentTarget,C);if(n){var o=t.currentPoints.image;return n.data[0].points.push([o.x,o.y]),h.updateImage(t.element),!1}}function d(e,t){var n={mouseButtonMask:t};(0,p.clearToolState)(e,C),(0,p.addToolState)(e,C,{points:[]}),e.removeEventListener("CornerstoneToolsMouseDown",s),e.addEventListener("CornerstoneToolsMouseDown",n,s)}function c(e){e.removeEventListener("CornerstoneToolsMouseDown",s)}function f(){return w}function g(e){w=e}Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(o=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.getConfiguration=f,t.setConfiguration=g;var v=n(19),h=o(v),p=n(1),x=n(2),T=function(e){return e&&e.__esModule?e:{default:e}}(x),b=n(26),y=o(b),C="drawing",w={snap:!1};t.default={enable:d,disable:c,activate:d,deactivate:c,getConfiguration:f,setConfiguration:g}},function(e,t,n){"use strict";function o(e){return e<200?1:e<300?2:e<400?3:4}function a(e){if(0==e.length)return null;for(var t={},n=e[0],o=1,a=0;a<e.length;a++){var r=e[a];null==t[r]?t[r]=1:t[r]++,t[r]>o&&(n=r,o=t[r])}return n}function r(){console.log("SCORE");var e=(0,s.getLastElement)(),t=(0,u.getToolState)(e,"regions"),n=(0,u.getToolState)(e,"stack"),r=n.data[0].imageIds,i=(0,s.getConfiguration)(),d=i.regionColorsRGB,c=i.kvpToMultiplier,f=d.slice(1).map(function(){return[]}),g=d.slice(1).map(function(){return-1/0}),m=t.data[0].buffer,v=new Uint8Array(m),h=void 0,p=void 0,x=void 0,T=void 0,b=void 0,y=void 0,C=void 0,w=void 0,M=[],P=r.map(function(e,t){return l.loadImage(e).then(function(e){var n=e.data,o=n.floatString("x00201041"),r=n.floatString("x00180050"),i=n.string("x00280030").split("\\").map(parseFloat),l=n.floatString("x00180060"),s=n.floatString("x00281053"),u=n.floatString("x00281052");if(h=r/3,p=i[0],x=i[1],T=h*p*x,b=c[l],y){var d=Math.abs(y),m=Math.abs(o),P=d>m?d-m:m-d;C=P<r?(r-P)/r:1,M.push(C),w=a(M),y=o}else y=o;for(var I=e.width,S=e.height,_=I*S,O=e.getPixelData(),E=t*_,k=0;k<O.length;k+=1){var D=v[E+k];if(D>1){var $=O[k],j=$*parseInt(s)+parseInt(u),R=g[D-2];f[D-2].push(j),j>R&&(g[D-2]=j)}}})});return Promise.all(P).then(function(){return f.map(function(e,t){console.log("SCORE -> voxelsEachRegion");var n=g[t],a=o(n),r=e.length*T,i=r*a*b;return w?i*w:i})})}Object.defineProperty(t,"__esModule",{value:!0}),t.score=r;var i=n(19),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i),s=n(26),u=n(1);t.default=r},function(e,t,n){"use strict";function o(e){console.log("ENABLE UNDO");var t=(0,l.getToolState)(e,"regions"),n=t.data[0];if(!(n.history.length<1)){var o=n.history.pop();console.log("HIST",n.history),n.buffer=o,i.updateImage(e)}}function a(e){}Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),l=n(1);t.default={activate:o,deactivate:a,enable:o,disable:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.1.0"}])});
//# sourceMappingURL=cornerstoneTools.min.js.map