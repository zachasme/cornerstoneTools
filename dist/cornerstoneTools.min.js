/*! cornerstone-tools - 1.1.0 - 2018-01-31 | (c) 2017 Chris Hafey | https://github.com/chafey/cornerstoneTools */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cornerstone-math")):"function"==typeof define&&define.amd?define("cornerstoneTools",["cornerstone-math"],t):"object"==typeof exports?exports.cornerstoneTools=t(require("cornerstone-math")):e.cornerstoneTools=t(e.cornerstoneMath)}(this,function(e){return function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=60)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.cornerstoneMath=void 0;var o=n(61),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o),r=window.cornerstone,l=window.$,i=window.Hammer,s={set cornerstone(e){r=e},get cornerstone(){return r},set $(e){l=e},get $(){return l},set Hammer(e){i=e},get Hammer(){return i}};t.cornerstoneMath=a,t.external=s},function(e,t,n){"use strict";function o(e){var t=u.external.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=c.globalImageIdSpecificToolStateManager),t.toolStateManager}function a(e,t,n){o(e).add(e,t,n);var a={toolType:t,element:e,measurementData:n};(0,f.default)(e,"CornerstoneToolsMeasurementAdded",a)}function r(e,t){return o(e).get(e,t)}function l(e,t,n){for(var a=o(e),r=a.get(e,t),l=-1,i=0;i<r.data.length;i++)r.data[i]===n&&(l=i);if(-1!==l){r.data.splice(l,1);var s={toolType:t,element:e,measurementData:n};(0,f.default)(e,"CornerstoneToolsMeasurementRemoved",s)}}function i(e,t){var n=o(e),a=n.get(e,t);void 0!==a&&(a.data=[])}function s(e,t){u.external.cornerstone.getEnabledElement(e).toolStateManager=t}Object.defineProperty(t,"__esModule",{value:!0}),t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=void 0;var u=n(0),c=n(15),d=n(3),f=function(e){return e&&e.__esModule?e:{default:e}}(d);t.addToolState=a,t.getToolState=r,t.removeToolState=l,t.clearToolState=i,t.setElementToolStateManager=s,t.getElementToolStateManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return 0!=(t&1<<e-1)}},function(e,t,n){"use strict";function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=void 0;"function"==typeof window.CustomEvent?o=new CustomEvent(t.toLocaleLowerCase(),{detail:n,cancelable:!0}):(o=document.createEvent("CustomEvent"),o.initCustomEvent(t.toLocaleLowerCase(),!0,!0,n));var r=a.external.$.Event(t,n);return a.external.$(e).trigger(r,n),!r.isImmediatePropagationStopped()&&e.dispatchEvent(o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var a=n(0)},function(e,t,n){"use strict";function o(e){f=e}function a(){return f}function r(e){c=e}function l(){return c}function i(e){d=e}function s(){return d}function u(e){return e?d:c}Object.defineProperty(t,"__esModule",{value:!0});var c="white",d="greenyellow",f="transparent",g={setFillColor:o,getFillColor:a,setToolColor:r,getToolColor:l,setActiveColor:i,getActiveColor:s,getColorIfActive:u};t.default=g},function(e,t,n){"use strict";function o(e){i=e}function a(){return i}function r(e){s=e}function l(){return s}Object.defineProperty(t,"__esModule",{value:!0});var i=1,s=2,u={setToolWidth:o,getToolWidth:a,setActiveWidth:r,getActiveWidth:l};t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r,l){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=a.default.getFont(),s=a.default.getFontSize(),u=a.default.getBackgroundColor();e.save(),e.font=i,e.textBaseline="top",e.strokeStyle=r;var c=0;t.forEach(function(t){var n=e.measureText(t).width;c=Math.max(c,n)}),e.fillStyle=u;var d={width:c+10,height:5+t.length*(s+5)};return l&&l.centering&&!0===l.centering.x&&(n-=d.width/2),l&&l.centering&&!0===l.centering.y&&(o-=d.height/2),d.left=n,d.top=o,l&&!0===l.debug&&(e.fillStyle="#FF0000"),e.fillRect(d.left,d.top,d.width,d.height),t.forEach(function(t,a){e.fillStyle=r,e.fillText(t,n+5,o+5+a*(s+5))}),e.restore(),d};var o=n(14),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){var l=a.external.cornerstone,i=t.element,s=e.createNewMeasurement(t);if(s){var u={mouseButtonMask:t.which};(0,y.addToolState)(t.element,e.toolType,s),a.external.$(i).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(i).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(i).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(i).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),l.updateImage(i);var c=void 0;c=1===Object.keys(s.handles).length?f.default:v.default;var d=void 0;d=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,c(t,e.toolType,s,s.handles.end,function(){s.active=!1,s.invalidated=!0,(0,x.default)(t,s.handles)&&(0,y.removeToolState)(i,e.toolType,s),a.external.$(i).on("CornerstoneToolsMouseMove",u,e.mouseMoveCallback||o),a.external.$(i).on("CornerstoneToolsMouseDown",u,e.mouseDownCallback||r),a.external.$(i).on("CornerstoneToolsMouseDownActivate",u,e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(i).on("CornerstoneToolsMouseDoubleClick",u,e.mouseDoubleClickCallback),l.updateImage(i)},d)}}function n(n,o){if((0,C.default)(o.which,n.data.mouseButtonMask))return e.addNewMeasurement?e.addNewMeasurement(o):t(o),!1}function o(t,n){if(l.default.setCoords(n),0===n.which){var o=(0,y.getToolState)(n.element,e.toolType);if(o){for(var r=!1,i=0;i<o.data.length;i++){var s=n.currentPoints.canvas,u=o.data[i];!0===(0,c.default)(n.element,u.handles,s)&&(r=!0),(e.pointNearTool(n.element,u,s)&&!u.active||!e.pointNearTool(n.element,u,s)&&u.active)&&(u.active=!u.active,r=!0)}!0===r&&a.external.cornerstone.updateImage(n.element)}}}function r(t,n){function r(){l.invalidated=!0,(0,x.default)(n,l.handles)&&(0,y.removeToolState)(i,e.toolType,l),a.external.cornerstone.updateImage(i),a.external.$(i).on("CornerstoneToolsMouseMove",n,e.mouseMoveCallback||o)}var l=void 0,i=n.element;if((0,C.default)(n.which,t.data.mouseButtonMask)){var u=n.startPoints.canvas,c=(0,y.getToolState)(t.currentTarget,e.toolType);if(c){var d=void 0,g=void 0;for(g=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,d=0;d<c.data.length;d++){l=c.data[d];var v=(0,s.default)(i,l.handles,u,6);if(v)return a.external.$(i).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),l.active=!0,(0,f.default)(n,e.toolType,l,v,r,g),t.stopImmediatePropagation(),!1}if(e.pointNearTool){var m=e.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(d=0;d<c.data.length;d++)if(l=c.data[d],l.active=!1,e.pointNearTool(i,l,u))return l.active=!0,a.external.$(i).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),(0,h.default)(t,l,c,e.toolType,m,r),t.stopImmediatePropagation(),!1}}}}function i(t){t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),a.external.cornerstone.updateImage(t)}function u(t){e.onImageRendered(t,t.detail)}function d(t){t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),t.addEventListener("cornerstoneimagerendered",u),a.external.cornerstone.updateImage(t)}function g(t,l){var i={mouseButtonMask:l};t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),t.addEventListener("cornerstoneimagerendered",u),a.external.$(t).on("CornerstoneToolsMouseMove",i,e.mouseMoveCallback||o),a.external.$(t).on("CornerstoneToolsMouseDown",i,e.mouseDownCallback||r),a.external.$(t).on("CornerstoneToolsMouseDownActivate",i,e.mouseDownActivateCallback||n),e.mouseDoubleClickCallback&&(a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),a.external.$(t).on("CornerstoneToolsMouseDoubleClick",i,e.mouseDoubleClickCallback)),a.external.cornerstone.updateImage(t)}function m(t,l){var i={mouseButtonMask:l},s="CornerstoneToolsToolDeactivated",c={mouseButtonMask:l,toolType:e.toolType,type:s};(0,M.default)(t,s,c),t.removeEventListener("cornerstoneimagerendered",u),a.external.$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||o),a.external.$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),a.external.$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||n),t.addEventListener("cornerstoneimagerendered",u),a.external.$(t).on("CornerstoneToolsMouseMove",i,e.mouseMoveCallback||o),a.external.$(t).on("CornerstoneToolsMouseDown",i,e.mouseDownCallback||r),e.mouseDoubleClickCallback&&(a.external.$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),a.external.$(t).on("CornerstoneToolsMouseDoubleClick",i,e.mouseDoubleClickCallback)),e.deactivate&&e.deactivate(t,l),a.external.cornerstone.updateImage(t)}function p(){return b}function T(e){b=e}var b={},P={enable:d,disable:i,activate:g,deactivate:m,getConfiguration:p,setConfiguration:T,mouseDownCallback:r,mouseMoveCallback:o,mouseDownActivateCallback:n};return e.pointNearTool&&(P.pointNearTool=e.pointNearTool),e.mouseDoubleClickCallback&&(P.mouseDoubleClickCallback=e.mouseDoubleClickCallback),e.addNewMeasurement&&(P.addNewMeasurement=e.addNewMeasurement),P};var a=n(0),r=n(35),l=o(r),i=n(18),s=o(i),u=n(36),c=o(u),d=n(21),f=o(d),g=n(22),v=o(g),m=n(37),h=o(m),p=n(12),x=o(p),T=n(2),C=o(T),y=n(1),b=n(3),M=o(b)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,i){e.strokeStyle=a,Object.keys(n).forEach(function(a){var s=n[a];if(!0!==s.drawnIndependently&&(!i||!0!==i.drawHandlesIfActive||s.active)){e.beginPath(),s.active?e.lineWidth=r.default.getActiveWidth():e.lineWidth=r.default.getToolWidth();var u=o.external.cornerstone.pixelToCanvas(t.element,s);e.arc(u.x,u.y,l,0,2*Math.PI),i&&i.fill&&(e.fillStyle=i.fill,e.fill()),e.stroke()}})};var o=n(0),a=n(5),r=function(e){return e&&e.__esModule?e:{default:e}}(a),l=6},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){Object.keys(e).forEach(function(t){e[t].active=!1})}function r(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&a(n.handles)}}function l(e){function t(t){var r=i.external.cornerstone,l=t.element,s=e.createNewMeasurement(t);if(s){if((0,x.addToolState)(l,e.toolType,s),1===Object.keys(s.handles).length&&"CornerstoneToolsTap"===t.type)return s.active=!1,s.handles.end.active=!1,s.handles.end.highlight=!1,s.invalidated=!0,(0,u.default)(t,s.handles)&&(0,x.removeToolState)(l,e.toolType,s),void r.updateImage(l);i.external.$(l).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),i.external.$(l).off("CornerstoneToolsTap",e.tapCallback||o),i.external.$(l).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),r.updateImage(l),(0,m.default)(t,e.toolType,s,s.handles.end,function(){s.active=!1,s.invalidated=!0,(0,u.default)(t,s.handles)&&(0,x.removeToolState)(l,e.toolType,s),i.external.$(l).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),i.external.$(l).on("CornerstoneToolsTap",e.tapCallback||o),i.external.$(l).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),r.updateImage(l)})}}function n(n,o){e.addNewMeasurement?e.addNewMeasurement(o):t(o),n.stopImmediatePropagation(),n.preventDefault()}function o(t,l){function s(){r(m),(0,u.default)(l,h.handles)&&(0,x.removeToolState)(f,e.toolType,h),c.updateImage(f),i.external.$(f).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(f).on("CornerstoneToolsTap",e.tapCallback||o)}var c=i.external.cornerstone,f=l.element,v=l.currentPoints.canvas,m=(0,x.getToolState)(t.currentTarget,e.toolType),h=void 0,T=void 0;if(r(m),m)for(T=0;T<m.data.length;T++){h=m.data[T];var C=(0,d.default)(f,h.handles,v,25);if(C)return i.external.$(f).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(f).off("CornerstoneToolsTap",e.tapCallback||o),h.active=!0,C.active=!0,c.updateImage(f),(0,g.default)(t,e.toolType,h,C,s),t.stopImmediatePropagation(),void t.preventDefault()}if(m&&e.pointNearTool)for(T=0;T<m.data.length;T++)if(h=m.data[T],e.pointNearTool(f,h,v))return i.external.$(f).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(f).off("CornerstoneToolsTap",e.tapCallback||o),h.active=!0,c.updateImage(f),(0,p.default)(t,h,m,e.toolType,!0,s),t.stopImmediatePropagation(),void t.preventDefault();return e.touchDownActivateCallback?e.touchDownActivateCallback(t,l):n(t,l),!1}function a(t,n){function r(t,r){f.active=!1,f.invalidated=!0,(0,u.default)(n,f.handles)&&(0,x.removeToolState)(n.element,e.toolType,f),l.updateImage(n.element),i.external.$(s).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(s).on("CornerstoneToolsTap",e.tapCallback||o),e.pressCallback&&i.external.$(s).on("CornerstoneToolsTouchPress",e.pressCallback),t&&"CornerstoneToolsTouchPress"===t.type&&(0,C.default)(s,t.type,r)}var l=i.external.cornerstone,s=n.element,c=n.startPoints.canvas,f=void 0,v=(0,x.getToolState)(t.currentTarget,e.toolType),m=void 0;if(v){for(m=0;m<v.data.length;m++){f=v.data[m];var h=(0,d.default)(n.element,f.handles,c,28);if(h)return i.external.$(s).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(s).off("CornerstoneToolsTap",e.tapCallback||o),e.pressCallback&&i.external.$(s).off("CornerstoneToolsTouchPress",e.pressCallback),f.active=!0,(0,g.default)(t,e.toolType,f,h,r),t.stopImmediatePropagation(),void t.preventDefault()}if(e.pointNearTool)for(m=0;m<v.data.length;m++)if(f=v.data[m],e.pointNearTool(n.element,f,c))return i.external.$(s).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(s).off("CornerstoneToolsTap",e.tapCallback||o),e.pressCallback&&i.external.$(s).off("CornerstoneToolsTouchPress",e.pressCallback),(0,p.default)(t,f,v,e.toolType,!0,r),t.stopImmediatePropagation(),void t.preventDefault()}}function l(t){t.removeEventListener("cornerstoneimagerendered",f),i.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),i.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),e.doubleTapCallback&&i.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&i.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),i.external.cornerstone.updateImage(t)}function s(t){t.removeEventListener("cornerstoneimagerendered",f),i.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),i.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),t.addEventListener("cornerstoneimagerendered",f),e.doubleTapCallback&&i.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&i.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),i.external.cornerstone.updateImage(t)}function c(t){t.removeEventListener("cornerstoneimagerendered",f),i.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),i.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),t.addEventListener("cornerstoneimagerendered",f),i.external.$(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(t).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),i.external.$(t).on("CornerstoneToolsTap",e.tapCallback||o),e.doubleTapCallback&&(i.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),i.external.$(t).on("CornerstoneToolsDoubleTap",e.doubleTapCallback)),e.pressCallback&&(i.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),i.external.$(t).on("CornerstoneToolsTouchPress",e.pressCallback)),i.external.cornerstone.updateImage(t)}function f(t){e.onImageRendered(t,t.detail)}function v(t){var r="CornerstoneToolsToolDeactivated",l={toolType:e.toolType,type:r};(0,C.default)(t,r,l),t.removeEventListener("cornerstoneimagerendered",f),i.external.$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),i.external.$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||n),i.external.$(t).off("CornerstoneToolsTap",e.tapCallback||o),t.addEventListener("cornerstoneimagerendered",f),i.external.$(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),e.doubleTapCallback&&i.external.$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&i.external.$(t).off("CornerstoneToolsTouchPress",e.pressCallback),i.external.cornerstone.updateImage(t)}var h={enable:s,disable:l,activate:c,deactivate:v,touchStartCallback:e.touchStartCallback||a,touchDownActivateCallback:e.touchDownActivateCallback||n,tapCallback:e.tapCallback||o};return e.pointNearTool&&(h.pointNearTool=e.pointNearTool),e.doubleTapCallback&&(h.doubleTapCallback=e.doubleTapCallback),e.pressCallback&&(h.pressCallback=e.pressCallback),e.addNewMeasurement&&(h.addNewMeasurement=e.addNewMeasurement),h}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(12),u=o(s),c=n(18),d=o(c),f=n(52),g=o(f),v=n(24),m=o(v),h=n(51),p=o(h),x=n(1),T=n(3),C=o(T);t.default=l},function(e,t,n){"use strict";function o(e){u=e}function a(){return u}function r(e){c=e}function l(){return c}function i(e){d=e}function s(){return d}Object.defineProperty(t,"__esModule",{value:!0});var u=void 0,c=void 0,d=void 0,f={setStartLoadHandler:o,getStartLoadHandler:a,setEndLoadHandler:r,getEndLoadHandler:l,setErrorLoadingHandler:i,getErrorLoadingHandler:s};t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n="CornerstoneToolsTouchDrag";return t&&!0===t.fireOnTouchStart&&(n+=" CornerstoneToolsTouchStart"),{activate:function(a){o.external.$(a).off(n,e),t&&t.eventData?o.external.$(a).on(n,t.eventData,e):o.external.$(a).on(n,e),t&&t.activateCallback&&t.activateCallback(a)},disable:function(a){o.external.$(a).off(n,e),t&&t.disableCallback&&t.disableCallback(a)},enable:function(a){o.external.$(a).off(n,e),t&&t.enableCallback&&t.enableCallback(a)},deactivate:function(a){o.external.$(a).off(n,e),t&&t.deactivateCallback&&t.deactivateCallback(a)}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},r=!1;return Object.keys(t).forEach(function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===o.cornerstoneMath.point.insideRect(n,a)&&(r=!0)}),r};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t,n,a){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e);var r={mouseButtonMask:n,options:a};o.external.$(t).on("CornerstoneToolsMouseDownActivate",r,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsMouseDownActivate",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var o=n(0)},function(e,t,n){"use strict";function o(e){c=e}function a(){return c}function r(e){u=e}function l(){return u}function i(e){d=e}function s(){return d}Object.defineProperty(t,"__esModule",{value:!0});var u=15,c=u+"px Arial",d="transparent",f={setFont:o,getFont:a,setFontSize:r,getFontSize:l,setBackgroundColor:i,getBackgroundColor:s};t.default=f},function(e,t,n){"use strict";function o(){function e(e){return s[e]}function t(e,t){s[e]=t}function n(){return s}function o(e){s=e}function r(e,t,n){var o=a.external.cornerstone.getEnabledElement(e);o.image&&!1!==s.hasOwnProperty(o.image.imageId)||(s[o.image.imageId]={});var r=s[o.image.imageId];!1===r.hasOwnProperty(t)&&(r[t]={data:[]}),r[t].data.push(n)}function l(e,t){var n=a.external.cornerstone.getEnabledElement(e);if(n.image&&!1!==s.hasOwnProperty(n.image.imageId)){var o=s[n.image.imageId];if(!1!==o.hasOwnProperty(t)){return o[t]}}}function i(e){var t=a.external.cornerstone.getEnabledElement(e);t.image&&!1!==s.hasOwnProperty(t.image.imageId)&&delete s[t.image.imageId]}var s={};return{get:l,add:r,clear:i,saveImageIdToolState:e,restoreImageIdToolState:t,saveToolState:n,restoreToolState:o,toolState:s}}Object.defineProperty(t,"__esModule",{value:!0}),t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=void 0;var a=n(0),r=o();t.newImageIdSpecificToolStateManager=o,t.globalImageIdSpecificToolStateManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.boundingBox)return o.cornerstoneMath.point.insideRect(t,e.boundingBox)};var o=n(0)},function(e,t,n){"use strict";function o(e){return parseFloat("."+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=a.external.cornerstone,r=n.metaData.get("patientStudyModule",e.imageId),l=n.metaData.get("generalSeriesModule",e.imageId);if(r&&l){if("PT"===l.modality){var i=t*e.slope+e.intercept,s=r.patientWeight;if(s){var u=n.metaData.get("petIsotopeModule",e.imageId);if(u){var c=u.radiopharmaceuticalInfo,d=c.radiopharmaceuticalStartTime,f=c.radionuclideTotalDose,g=c.radionuclideHalfLife,v=l.seriesTime;if(d&&f&&g&&v){var m=o(v.fractionalSeconds||0)+v.seconds+60*v.minutes+60*v.hours*60,h=o(d.fractionalSeconds)+d.seconds+60*d.minutes+60*d.hours*60,p=m-h;return i*s/(f*Math.exp(-p*Math.log(2)/g))*1e3}}}}}};var a=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){var l=void 0;if(t)return Object.keys(t).forEach(function(i){var s=t[i];if(s.hasOwnProperty("pointNearHandle")){if(s.pointNearHandle(e,s,n))return void(l=s)}else if(!0===s.hasBoundingBox){if((0,r.default)(s,n))return void(l=s)}else{var u=o.external.cornerstone.pixelToCanvas(e,s),c=o.cornerstoneMath.point.distance(u,n);if(c<=a)return void(l=s)}}),l};var o=n(0),a=n(16),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";function o(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],n=void 0;return/trident/i.test(t[1])?(n=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(n[1]||"")):"Chrome"===t[1]&&null!==(n=e.match(/\b(OPR|Edge)\/(\d+)/))?n.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(n=e.match(/version\/(\d+)/i))&&t.splice(1,1,n[1]),t.join(" "))}function a(e){s=e}function r(){return s||l()}function l(){var e=o(),t=e.split(" "),n=t[0],a=t[1],r=u[n];return r?r[a]?r[a]:r.default:u.default}function i(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}Object.defineProperty(t,"__esModule",{value:!0});var s=void 0,u={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};t.getDefaultSimultaneousRequests=l,t.getMaxSimultaneousRequests=r,t.setMaxSimultaneousRequests=a,t.getBrowserInfo=o,t.isMobileDevice=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e);var n={};o.external.$(t).on("CornerstoneToolsMouseWheel",n,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsMouseWheel",e)}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,l,i){function s(e,o){!1===a.hasMoved&&(a.hasMoved=!0),a.active=!0,a.x=o.currentPoints.image.x+f.x,a.y=o.currentPoints.image.y+f.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),c.updateImage(d);var l={toolType:t,element:d,measurementData:n};(0,r.default)(d,"CornerstoneToolsMeasurementModified",l)}function u(){a.active=!1,o.external.$(d).off("CornerstoneToolsMouseDrag",s),o.external.$(d).off("CornerstoneToolsMouseUp",u),o.external.$(d).off("CornerstoneToolsMouseClick",u),c.updateImage(d),"function"==typeof l&&l()}var c=o.external.cornerstone,d=e.element,f={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y};o.external.$(d).on("CornerstoneToolsMouseDrag",s),o.external.$(d).on("CornerstoneToolsMouseUp",u),o.external.$(d).on("CornerstoneToolsMouseClick",u)};var o=n(0),a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,l,i){function s(e,o){a.active=!0,a.x=o.currentPoints.image.x,a.y=o.currentPoints.image.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),g.updateImage(v);var l={toolType:t,element:v,measurementData:n};(0,r.default)(v,"CornerstoneToolsMeasurementModified",l)}function u(e){o.external.$(v).off("CornerstoneToolsMouseMove",u),o.external.$(v).off("CornerstoneToolsMouseDrag",u),o.external.$(v).on("CornerstoneToolsMouseMove",s),o.external.$(v).on("CornerstoneToolsMouseDrag",s),o.external.$(v).on("CornerstoneToolsMouseClick",f),"CornerstoneToolsMouseDrag"===e.type&&o.external.$(v).on("CornerstoneToolsMouseUp",f)}function c(e,t){t.measurementData===n&&f()}function d(e,n){n.toolType===t&&(o.external.$(v).off("CornerstoneToolsMouseMove",s),o.external.$(v).off("CornerstoneToolsMouseDrag",s),o.external.$(v).off("CornerstoneToolsMouseClick",f),o.external.$(v).off("CornerstoneToolsMouseUp",f),o.external.$(v).off("CornerstoneToolsMeasurementRemoved",c),o.external.$(v).off("CornerstoneToolsToolDeactivated",d),a.active=!1,g.updateImage(v))}function f(){o.external.$(v).off("CornerstoneToolsMouseMove",s),o.external.$(v).off("CornerstoneToolsMouseDrag",s),o.external.$(v).off("CornerstoneToolsMouseClick",f),o.external.$(v).off("CornerstoneToolsMouseUp",f),o.external.$(v).off("CornerstoneToolsMeasurementRemoved",c),o.external.$(v).off("CornerstoneToolsToolDeactivated",d),a.active=!1,g.updateImage(v),"function"==typeof l&&l()}var g=o.external.cornerstone,v=e.element;o.external.$(v).on("CornerstoneToolsMouseDrag",u),o.external.$(v).on("CornerstoneToolsMouseMove",u),o.external.$(v).on("CornerstoneToolsMeasurementRemoved",c),o.external.$(v).on("CornerstoneToolsToolDeactivated",d)};var o=n(0),a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){e(t,t.detail)}var n={};return{disable:function(e){e.removeEventListener("cornerstoneimagerendered",t)},enable:function(e){e.removeEventListener("cornerstoneimagerendered",t),e.addEventListener("cornerstoneimagerendered",t),o.external.cornerstone.updateImage(e)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,l,i){function s(e,o){a.x=o.currentPoints.image.x+m.x,a.y=o.currentPoints.image.y+m.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),f.updateImage(g);var l={toolType:t,element:g,measurementData:n};(0,r.default)(g,"CornerstoneToolsMeasurementModified",l)}function u(e,t){if(o.external.$(g).off("CornerstoneToolsTouchDrag",s),o.external.$(g).off("CornerstoneToolsTouchPinch",u),o.external.$(g).off("CornerstoneToolsTouchEnd",u),o.external.$(g).off("CornerstoneToolsTap",u),o.external.$(g).off("CornerstoneToolsTouchStart",c),o.external.$(g).off("CornerstoneToolsToolDeactivated",d),"CornerstoneToolsTouchPinch"===e.type||"CornerstoneToolsTouchPress"===e.type)return a.active=!1,f.updateImage(g),void l();a.active=!1,n.active=!1,a.x=t.currentPoints.image.x+m.x,a.y=t.currentPoints.image.y+m.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,t.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,t.image.height)),f.updateImage(g),"function"==typeof l&&l()}function c(e){return e.stopImmediatePropagation(),!1}function d(){o.external.$(g).off("CornerstoneToolsTouchDrag",s),o.external.$(g).off("CornerstoneToolsTouchPinch",u),o.external.$(g).off("CornerstoneToolsTouchEnd",u),o.external.$(g).off("CornerstoneToolsTap",u),o.external.$(g).off("CornerstoneToolsTouchStart",c),o.external.$(g).off("CornerstoneToolsToolDeactivated",d),a.active=!1,n.active=!1,a.x=e.currentPoints.image.x+m.x,a.y=e.currentPoints.image.y+m.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,e.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,e.image.height)),f.updateImage(g)}var f=o.external.cornerstone,g=e.element,v=f.pageToPixel(g,e.currentPoints.page.x,e.currentPoints.page.y+50),m={x:a.x-v.x,y:a.y-v.y};a.active=!0,n.active=!0,o.external.$(g).on("CornerstoneToolsTouchDrag",s),o.external.$(g).on("CornerstoneToolsTouchPinch",u),o.external.$(g).on("CornerstoneToolsTouchEnd",u),o.external.$(g).on("CornerstoneToolsTap",u),o.external.$(g).on("CornerstoneToolsTouchStart",c),o.external.$(g).on("CornerstoneToolsToolDeactivated",d)};var o=n(0),a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";function o(){return v}function a(e,t){var n=void 0,o=void 0,a=e.imageIds,r=a.length;return f.external.cornerstone.loadImage(a[0]).then(function(e){n=e.width,o=e.height;var l=n*o*r*m,i=new ArrayBuffer(l),s=new Uint8Array(i),u=a.map(function(e,t){return f.external.cornerstone.loadImage(e).then(function(e){var a=e.slope,r=e.intercept,l=e.getPixelData(),i=n*o;console.log("pixelData: ",l.length),console.log("n: ",i);for(var u=0;u<i;u++){var c=l[u],d=c*a+r,f=d>=h.calciumThresholdHu?1:0;s[t*i+u]=f}})});return Promise.all(u).then(function(){var e={buffer:i,width:n,height:o};return t&&t(e),e})})}function r(e){var t=e.detail,n=t.element,o=(0,g.getToolState)(n,"stack"),a=(0,g.getToolState)(n,"regions");if(a&&a.data&&a.data.length){var r=o.data[0].currentImageIdIndex,l=a.data[0].buffer,i=t.canvasContext,s=t.enabledElement,u=t.image,c=u.width,d=u.height,v=document.createElement("canvas"),m=v.getContext("2d");v.width=c,v.height=d,p=p||m.createImageData(c,d);for(var x=p.data,T=c*d,C=r*T,y=new Uint8Array(l,C,T),b=0;b<y.length;b+=1){var M=y[b],P=4*b;if(M){var w=h.regionColorsRGB[M-1];x[P+0]=w[0],x[P+1]=w[1],x[P+2]=w[2],x[P+3]=255*h.drawAlpha}else x[P+3]=0}m.putImageData(p,0,0),f.external.cornerstone.setToPixelCoordinateSystem(s,i),i.drawImage(v,0,0)}}function l(e,t){var n=(0,g.getToolState)(e,"regions");if(p=null,!n.data[0]||!n.data[0].enabled){v=e;var o=(0,g.getToolState)(e,"stack");if(o&&o.data&&o.data.length){var l={enabled:1,buffer:null,width:null,height:null,history:[]};(0,g.addToolState)(e,"regions",l);var i=o.data[0];setTimeout(function(){a(i,function(n){var o=(0,g.getToolState)(e,"regions");o.data[0].buffer=n.buffer,o.data[0].width=n.width,o.data[0].height=n.height,e.addEventListener("cornerstoneimagerendered",r),f.external.cornerstone.updateImage(e),"function"==typeof t&&t()})},100)}}}function i(e){var t=(0,g.getToolState)(e,"regions");t&&t.data.length&&(t.data[0].enabled=!1)}function s(e){var t=e||v;return new Promise(function(e,n){i(t),l(t,function(){e()})})}function u(e){var t=(0,g.getToolState)(e,"regions"),n=t.data[0],o=n.buffer.slice();n.history.push(o),n.history.length>h.historySize&&n.history.shift()}function c(){return h}function d(e){h=e}Object.defineProperty(t,"__esModule",{value:!0}),t.getLastElement=o,t.update=s,t.createUndoStep=u,t.getConfiguration=c,t.setConfiguration=d;var f=n(0),g=n(1),v=null,m=1,h={historySize:4,historyPosition:0,toolRegionValue:2,calciumThresholdHu:"-",layersAbove:0,layersBelow:0,drawAlpha:1,regionColorsRGB:[[255,0,255],[246,193,91],[237,148,69],[230,103,49],[184,74,41],[106,58,45]],KVPToMultiplier:{150:1.06,140:1.04,130:1.02,120:1,110:.98,100:.96,90:.93,80:.89,70:.85},growIterationsPerChunk:2};h.calciumThresholdHuParsed=parseInt(h.calciumThresholdHu);var p=null;t.default={activate:l,deactivate:i,update:s,enable:l,disable:i,getConfiguration:c,setConfiguration:d}},function(e,t,n){"use strict";function o(e,t){var n=e.clone().sub(t.imagePositionPatient);return{x:t.rowCosines.dot(n)/t.columnPixelSpacing,y:t.columnCosines.dot(n)/t.rowPixelSpacing}}function a(e,t){var n=t.rowCosines.clone().multiplyScalar(e.x);n.multiplyScalar(t.columnPixelSpacing);var o=t.columnCosines.clone().multiplyScalar(e.y);o.multiplyScalar(t.rowPixelSpacing);var a=n.add(o);return a.add(t.imagePositionPatient),a}function r(e){var t=a({x:0,y:0},e),n=a({x:e.columns,y:0},e),o=a({x:0,y:e.rows},e),r=a({x:e.columns,y:e.rows},e);return{top:new s.cornerstoneMath.Line3(t,n),left:new s.cornerstoneMath.Line3(t,o),right:new s.cornerstoneMath.Line3(n,r),bottom:new s.cornerstoneMath.Line3(o,r)}}function l(e,t){var n=[];return Object.keys(t).forEach(function(o){var a=t[o],r=e.intersectLine(a);r&&n.push(r)}),n}function i(e,t){var n=e.rowCosines.clone().cross(e.columnCosines),o=new s.cornerstoneMath.Plane;o.setFromNormalAndCoplanarPoint(n,e.imagePositionPatient);var i=t.rowCosines.clone().cross(t.columnCosines),u=new s.cornerstoneMath.Plane;u.setFromNormalAndCoplanarPoint(i,t.imagePositionPatient);var c=u.clone().intersectPlane(o),d=c.origin,f=c.direction,g=a({x:t.columns,y:t.rows},t),v=t.imagePositionPatient.distanceTo(g),m=new s.cornerstoneMath.Line3;m.start=d,m.end=d.clone().add(f.multiplyScalar(v));var h=r(t),p=l(m,h);if(2===p.length)return{start:p[0],end:p[1]}}Object.defineProperty(t,"__esModule",{value:!0}),t.projectPatientPointToImagePlane=o,t.imagePointToPatientPoint=a,t.planePlaneIntersection=i;var s=n(0)},function(e,t,n){"use strict";function o(e,t,n,o,a,r){if(!f.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var l={type:n,imageId:t,preventCache:o,doneCallback:a,failCallback:r},i=c.external.cornerstone.imageCache.getImagePromise(t);if(i)return void i.then(function(e){a(e)},function(e){r(e)});f[n].push(l)}}function a(e){if(!f.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");f[e]=[]}function r(){m&&setTimeout(function(){i()},h)}function l(e){var t=c.external.cornerstone,n=e.type;g[n]++,m=!0;var o=e.imageId,a=e.doneCallback,l=e.failCallback,i=t.imageCache.getImagePromise(o);if(i)return void i.then(function(e){g[n]--,a(e),r()},function(e){g[n]--,l(e),r()});var s=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e),u=void 0;u=!0===e.preventCache?t.loadImage(o,{priority:s,type:e.type}):t.loadAndCacheImage(o,{priority:s,type:e.type}),u.then(function(e){g[n]--,a(e),r()},function(e){g[n]--,l(e),r()})}function i(){var e=(0,d.getMaxSimultaneousRequests)();v={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=g.interaction+g.thumbnail+g.prefetch,n=e-t,o=0;o<n;o++){var a=s();a&&l(a)}}function s(){return f.interaction.length&&g.interaction<v.interaction?f.interaction.shift():f.thumbnail.length&&g.thumbnail<v.thumbnail?f.thumbnail.shift():f.prefetch.length&&g.prefetch<v.prefetch?f.prefetch.shift():(f.interaction.length||f.thumbnail.length||f.prefetch.length||(m=!1),!1)}function u(){return f}Object.defineProperty(t,"__esModule",{value:!0});var c=n(0),d=n(19),f={interaction:[],thumbnail:[],prefetch:[]},g={interaction:0,thumbnail:0,prefetch:0},v={interaction:6,thumbnail:6,prefetch:5},m=!1,h=20;t.default={addRequest:o,clearRequestStack:a,startGrabbing:i,getRequestPool:u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n={},a="CornerstoneToolsMultiTouchDrag";return t&&!0===t.fireOnTouchStart&&(a+=" CornerstoneToolsMultiTouchStart"),{activate:function(n){o.external.$(n).off(a,e),t&&t.eventData?o.external.$(n).on(a,t.eventData,e):o.external.$(n).on(a,e),t&&t.activateCallback&&t.activateCallback(n)},disable:function(n){o.external.$(n).off(a,e),t&&t.disableCallback&&t.disableCallback(n)},enable:function(n){o.external.$(n).off(a,e),t&&t.enableCallback&&t.enableCallback(n)},deactivate:function(n){o.external.$(n).off(a,e),t&&t.deactivateCallback&&t.deactivateCallback(n)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(0,r.getToolState)(e,"stack");if(o&&o.data&&o.data.length){var l=o.data[0],i=l.currentImageIdIndex+t;if(n){i%=l.imageIds.length}else i=Math.min(l.imageIds.length-1,i),i=Math.max(0,i);(0,a.default)(e,i)}};var o=n(43),a=function(e){return e&&e.__esModule?e:{default:e}}(o),r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.width/2,o=e.height/2;if(n<=0||o<=0)return!1;var a={x:e.left+n,y:e.top+o},r={x:t.x-a.x,y:t.y-a.y};return r.x*r.x/(n*n)+r.y*r.y/(o*o)<=1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,r){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var l=o.external.cornerstone.getEnabledElement(e),i=[],s=0,u=l.image.getPixelData(),c=void 0,d=void 0,f=void 0;if(l.image.color)for(d=0;d<r;d++)for(f=0;f<a;f++){c=4*((d+n)*l.image.columns+(f+t));var g=u[c],v=u[c+1],m=u[c+2],h=u[c+3];i[s++]=g,i[s++]=v,i[s++]=m,i[s++]=h}return i};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{page:o.cornerstoneMath.point.copy(e.page),image:o.cornerstoneMath.point.copy(e.image),client:o.cornerstoneMath.point.copy(e.client),canvas:o.cornerstoneMath.point.copy(e.canvas)}};var o=n(0)},function(e,t,n){"use strict";function o(e){r=e.currentPoints.canvas}function a(){return r}Object.defineProperty(t,"__esModule",{value:!0});var r=void 0,l={setCoords:o,getCoords:a};t.default=l},function(e,t,n){"use strict";function o(e){var t=void 0;return Object.keys(e).forEach(function(n){var o=e[n];if(!0===o.active)return void(t=o)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a){a||(a=6);var l=o(t),i=(0,r.default)(e,t,n,a);return l!==i&&(void 0!==i&&(i.active=!0),void 0!==l&&(l.active=!1),!0)};var a=n(18),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r,s){function c(e,n){t.active=!0,Object.keys(t.handles).forEach(function(e){var o=t.handles[e];!0!==o.movesIndependently&&(o.x+=n.deltaPoints.image.x,o.y+=n.deltaPoints.image.y,!0===r.preventHandleOutsideImage&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,n.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,n.image.height)))}),f.updateImage(g);var a={toolType:o,element:g,measurementData:t};return(0,u.default)(g,"CornerstoneToolsMeasurementModified",a),!1}function d(e,n){t.invalidated=!0,a.external.$(g).off("CornerstoneToolsMouseDrag",c),a.external.$(g).off("CornerstoneToolsMouseUp",d),a.external.$(g).off("CornerstoneToolsMouseClick",d),!0===r.deleteIfHandleOutsideImage&&(0,l.default)(n,t.handles)&&(0,i.removeToolState)(g,o,t),f.updateImage(g),"function"==typeof s&&s()}var f=a.external.cornerstone,g=e.element;return a.external.$(g).on("CornerstoneToolsMouseDrag",c),a.external.$(g).on("CornerstoneToolsMouseUp",d),a.external.$(g).on("CornerstoneToolsMouseClick",d),!0};var a=n(0),r=n(12),l=o(r),i=n(1),s=n(3),u=o(s)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=(0,a.getToolState)(e,"timeSeries");if(r&&r.data&&r.data.length){var i=o.external.cornerstone,s=r.data[0],u=s.stacks[s.currentStackIndex],c=u.currentImageIdIndex,d=s.currentStackIndex+t;if(n?(d>=s.stacks.length&&(d=0),d<0&&(d=s.stacks.length-1)):(d=Math.min(s.stacks.length-1,d),d=Math.max(0,d)),d!==s.currentStackIndex){var f=i.getViewport(e),g=s.stacks[d],v=l.default.getStartLoadHandler(),m=l.default.getEndLoadHandler(),h=l.default.getErrorLoadingHandler();v&&v(e);var p=void 0;p=!0===g.preventCache?i.loadImage(g.imageIds[c]):i.loadAndCacheImage(g.imageIds[c]),p.then(function(t){s.currentImageIdIndex!==c&&(g.currentImageIdIndex=c,s.currentStackIndex=d,i.displayImage(e,t,f),m&&m(e,t))},function(t){var n=g.imageIds[c];h&&h(e,n,t)})}}};var o=n(0),a=n(1),r=n(10),l=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,o.planePlaneIntersection)(e,t);if(n)return{start:(0,o.projectPatientPointToImagePlane)(n.start,e),end:(0,o.projectPatientPointToImagePlane)(n.end,e)}};var o=n(26)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){var r=a.external.cornerstone,i=r.getEnabledElement(n).image,u=r.getEnabledElement(o).image;if(i&&u){var d=r.metaData.get("imagePlaneModule",i.imageId),f=r.metaData.get("imagePlaneModule",u.imageId);if(d&&f&&d.rowCosines&&d.columnCosines&&d.imagePositionPatient&&f.rowCosines&&f.columnCosines&&f.imagePositionPatient&&d.frameOfReferenceUID===f.frameOfReferenceUID){var g=d.rowCosines.clone().cross(d.columnCosines),v=f.rowCosines.clone().cross(f.columnCosines),m=g.angleTo(v);if(!((m=Math.abs(m))<.5)){var h=(0,l.default)(d,f);if(h){var p=r.pixelToCanvas(t.element,h.start),x=r.pixelToCanvas(t.element,h.end),T=s.default.getActiveColor(),C=c.default.getToolWidth();e.setTransform(1,0,0,1,0,0),e.save(),e.beginPath(),e.strokeStyle=T,e.lineWidth=C,e.moveTo(p.x,p.y),e.lineTo(x.x,x.y),e.stroke(),e.restore()}}}}};var a=n(0),r=n(39),l=o(r),i=n(4),s=o(i),u=n(5),c=o(u)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(64),r=o(a),l=n(65),i=o(l),s={getOrientationString:r.default,invertOrientationString:i.default};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return o.external.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function n(n){if(v.currentImageIdIndex===t){try{s.getEnabledElement(e)}catch(e){return}d?(d.currentImageIdIndex=t,d.render(e,l.data)):s.displayImage(e,n),h&&h(e,n)}}function o(n){var o=v.imageIds[t];p&&p(e,o,n)}var l=(0,r.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var s=a.external.cornerstone,d=void 0;if(l.data.length>1){var g=(0,r.getToolState)(e,"stackRenderer");g&&g.data&&g.data.length&&(d=g.data[0])}var v=l.data[0];t<0&&(t+=v.imageIds.length);var m=u.default.getStartLoadHandler(),h=u.default.getEndLoadHandler(),p=u.default.getErrorLoadingHandler();if(t!==v.currentImageIdIndex){m&&m(e);var x={newImageIdIndex:t,direction:t-v.currentImageIdIndex};v.currentImageIdIndex=t;var T=v.imageIds[t],C=c.stackScroll.getConfiguration();if(C&&!0===C.retryLoadOnScroll){var y=s.imageCache.getImagePromise(T);y&&"rejected"===y.state()&&s.imageCache.removeImagePromise(T)}var b=Boolean(v.preventCache),M=void 0;M=b?s.loadImage(T):s.loadAndCacheImage(T),M.then(n,o),i.default.startGrabbing(),(0,f.default)(e,"CornerstoneStackScroll",x)}}};var a=n(0),r=n(1),l=n(27),i=o(l),s=n(10),u=o(s),c=n(44),d=n(3),f=o(d)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){u.external.$(t.element).off("CornerstoneToolsMouseDrag",i),u.external.$(t.element).off("CornerstoneToolsMouseUp",a),u.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask)){var n={deltaY:0};return u.external.$(t.element).on("CornerstoneToolsMouseDrag",n,i),u.external.$(t.element).on("CornerstoneToolsMouseUp",a),u.external.$(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function l(e,t){var n=-t.direction,o=M.getConfiguration(),a=!1;o&&o.loop&&(a=o.loop),(0,y.default)(t.element,n,a)}function i(e,t){var n=t.element,o=(0,b.getToolState)(n,"stack");if(o&&o.data&&o.data.length){var a=o.data[0],r=M.getConfiguration(),l=Math.max(2,u.external.$(n).height()/Math.max(a.imageIds.length,8));if(r&&r.stackScrollSpeed&&(l=r.stackScrollSpeed),e.data.deltaY=e.data.deltaY||0,e.data.deltaY+=t.deltaPoints.page.y,Math.abs(e.data.deltaY)>=l){var i=e.data.deltaY/l,s=Math.round(i),c=e.data.deltaY%l;e.data.deltaY=c,(0,y.default)(n,s)}return!1}}function s(e,t){var n=k.getConfiguration();n&&n.testPointers(t)&&i(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=void 0;var u=n(0),c=n(11),d=o(c),f=n(28),g=o(f),v=n(13),m=o(v),h=n(20),p=o(h),x=n(2),T=o(x),C=n(29),y=o(C),b=n(1),M=(0,m.default)(r),P=(0,p.default)(l),w={eventData:{deltaY:0}},S=(0,d.default)(i,w),I={testPointers:function(e){return e.numPointers>=3}},k=(0,g.default)(s,w);k.setConfiguration(I),t.stackScroll=M,t.stackScrollWheel=P,t.stackScrollTouchDrag=S,t.stackScrollMultiTouch=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,a,r){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var l=o.external.cornerstone.getEnabledElement(e),i=l.image,s=[],u=0,c=i.getPixelData(),d=void 0,f=void 0,g=void 0;if(i.color)for(f=0;f<r;f++)for(g=0;g<a;g++){d=4*((f+n)*i.columns+(g+t));var v=c[d],m=c[d+1],h=c[d+2];s[u++]=.2126*v+.7152*m+.0722*h}else for(f=0;f<r;f++)for(g=0;g<a;g++)d=(f+n)*i.columns+(g+t),s[u++]=c[d]*i.slope+i.intercept;return s};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,a){var r=o/2*.5522848,l=a/2*.5522848,i=t+o,s=n+a,u=t+o/2,c=n+a/2;e.beginPath(),e.moveTo(t,c),e.bezierCurveTo(t,c-l,u-r,n,u,n),e.bezierCurveTo(u+r,n,i,c-l,i,c),e.bezierCurveTo(i,c+l,u+r,s,u,s),e.bezierCurveTo(u-r,s,t,c+l,t,c),e.closePath(),e.stroke()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o){e.beginPath(),e.strokeStyle=n,e.lineWidth=o,e.arc(t.x,t.y,6,0,2*Math.PI),e.stroke()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,a){var r=Math.atan2(n.y-t.y,n.x-t.x);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.strokeStyle=o,e.lineWidth=a,e.stroke(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x-10*Math.cos(r-Math.PI/7),n.y-10*Math.sin(r-Math.PI/7)),e.lineTo(n.x-10*Math.cos(r+Math.PI/7),n.y-10*Math.sin(r+Math.PI/7)),e.lineTo(n.x,n.y),e.lineTo(n.x-10*Math.cos(r-Math.PI/7),n.y-10*Math.sin(r-Math.PI/7)),e.strokeStyle=o,e.lineWidth=a,e.stroke(),e.fillStyle=o,e.fill()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=0,o=0,r=0,l=0,i=t.top;i<t.top+t.height;i++)for(var s=t.left;s<t.left+t.width;s++){var u={x:s,y:i};(0,a.default)(t,u)&&(n+=e[l],o+=e[l]*e[l],r++),l++}if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var c=n/r,d=o/r-c*c;return{count:r,mean:c,variance:d,stdDev:Math.sqrt(d)}};var o=n(31),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e),o.external.$(t).on("CornerstoneToolsKeyDown",e)},disable:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsKeyDown",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,o,r,s){function c(e,n){t.active=!0,Object.keys(t.handles).forEach(function(e){var o=t.handles[e];!0!==o.movesIndependently&&(o.x+=n.deltaPoints.image.x,o.y+=n.deltaPoints.image.y)}),g.updateImage(f);var a={toolType:o,element:f,measurementData:t};return(0,u.default)(f,"CornerstoneToolsMeasurementModified",a),!1}function d(e,n){t.active=!1,t.invalidated=!1,a.external.$(f).off("CornerstoneToolsTouchDrag",c),a.external.$(f).off("CornerstoneToolsTouchPinch",d),a.external.$(f).off("CornerstoneToolsTouchPress",d),a.external.$(f).off("CornerstoneToolsTouchEnd",d),a.external.$(f).off("CornerstoneToolsDragEnd",d),a.external.$(f).off("CornerstoneToolsTap",d),!0===r&&(0,l.default)(n,t.handles)&&(0,i.removeToolState)(f,o,t),g.updateImage(f),"function"==typeof s&&s(e,n)}var f=e.element,g=a.external.cornerstone;return a.external.$(f).on("CornerstoneToolsTouchDrag",c),a.external.$(f).on("CornerstoneToolsTouchPinch",d),a.external.$(f).on("CornerstoneToolsTouchPress",d),a.external.$(f).on("CornerstoneToolsTouchEnd",d),a.external.$(f).on("CornerstoneToolsDragEnd",d),a.external.$(f).on("CornerstoneToolsTap",d),!0};var a=n(0),r=n(12),l=o(r),i=n(1),s=n(3),u=o(s)},function(e,t,n){"use strict";function o(e,t,n,r,l){if(n.value){var i=a.external.cornerstone,s=(new Date).getTime(),u=Math.abs(t.y-l.y),c=u/10;if(console.log("distanceRemaining: "+u),u<1)return t.y=l.y,void(n.value=!1);t.y>l.y?t.y-=c:t.y<l.y&&(t.y+=c),i.updateImage(r.element),i.requestAnimationFrame(function(){o(s,t,n,r,l)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,u){function c(e,o){i.value=!1,!1===r.hasMoved&&(r.hasMoved=!0),r.active=!0;var a=o.currentPoints,s={x:a.page.x,y:a.page.y+h};x=f.pageToPixel(g,s.x,s.y),r.x=x.x,r.y=x.y,f.updateImage(g);var u={toolType:t,element:g,measurementData:n};(0,l.default)(g,"CornerstoneToolsMeasurementModified",u)}function d(t,o){i.value=!1,r.active=!1,a.external.$(g).off("CornerstoneToolsTouchDrag",c),a.external.$(g).off(s,d),f.updateImage(g),"CornerstoneToolsTouchPress"===t.type&&(o.handlePressed=n,r.x=e.currentPoints.image.x,r.y=e.currentPoints.image.y),"function"==typeof u&&u(t,o)}i.value=!0;var f=a.external.cornerstone,g=e.element,v=f.getEnabledElement(g),m=(new Date).getTime(),h=-57,p={x:e.currentPoints.page.x,y:e.currentPoints.page.y+h},x=f.pageToPixel(g,p.x,p.y);a.external.$(g).on("CornerstoneToolsTouchDrag",c),a.external.$(g).on(s,d),o(m,r,i,v,x)};var a=n(0),r=n(3),l=function(e){return e&&e.__esModule?e:{default:e}}(r),i={value:!1},s=["CornerstoneToolsTouchEnd","CornerstoneToolsDragEnd","CornerstoneToolsTouchPinch","CornerstoneToolsTouchPress","CornerstoneToolsTap"].join(" ")},function(e,t,n){"use strict";function o(e,t){var n=Date.now();if(e!==d){if(n-f<=u)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;d=e}f=n}function a(e,t,n){var o=n?g:v;t.forEach(function(t){s.external.$(e).on(t,o)})}function r(e,t,n){var o=n?g:v;t.forEach(function(t){s.external.$(e).off(t,o)})}function l(e){r(e,m,c.mouse),r(e,h,c.touch)}function i(e){l(e),a(e,m,c.mouse),a(e,h,c.touch)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),u=2e3,c={mouse:0,touch:1},d=void 0,f=void 0,g=o.bind(null,c.mouse),v=o.bind(null,c.touch),m=["mousedown","mouseup"],h=["touchstart","touchend"],p={enable:i,disable:l};t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e);var n={};o.external.$(t).on("CornerstoneToolsDoubleTap",n,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsDoubleTap",e)}}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function n(n){var o=e.createNewMeasurement(n);o&&((0,T.addToolState)(n.element,e.toolType,o),a.external.$(n.element).off("CornerstoneToolsMouseMove",r),(0,f.default)(n,e.toolType,o,o.handles.end,function(){o.active=!1,(0,h.default)(n,o.handles)&&(0,T.removeToolState)(n.element,e.toolType,o),a.external.$(n.element).on("CornerstoneToolsMouseMove",r)},t))}function o(e,t){if((0,x.default)(t.which,e.data.mouseButtonMask))return n(t),!1}function r(t,n){if(l.default.setCoords(n),0===n.which){var o=(0,T.getToolState)(n.element,e.toolType);if(void 0!==o){for(var r=!1,i=n.currentPoints.canvas,s=0;s<o.data.length;s++){var u=o.data[s];!0===(0,c.default)(n.element,u.handles,i)&&(r=!0),(e.pointInsideRect(n.element,u,i)&&!u.active||!e.pointInsideRect(n.element,u,i)&&u.active)&&(u.active=!u.active,r=!0)}!0===r&&a.external.cornerstone.updateImage(n.element)}}}function i(n,o){function l(){u.active=!1,(0,h.default)(o,u.handles)&&(0,T.removeToolState)(o.element,e.toolType,u),i.updateImage(o.element),a.external.$(o.element).on("CornerstoneToolsMouseMove",r)}var i=a.external.cornerstone,u=void 0;if((0,x.default)(o.which,n.data.mouseButtonMask)){var c=o.startPoints.canvas,d=(0,T.getToolState)(n.currentTarget,e.toolType),g=void 0;if(void 0!==d)for(g=0;g<d.data.length;g++){u=d.data[g];var m=(0,s.default)(o.element,u.handles,c,25);if(void 0!==m)return a.external.$(o.element).off("CornerstoneToolsMouseMove",r),u.active=!0,(0,f.default)(o,e.toolType,u,m,l,t),n.stopImmediatePropagation(),!1}var p={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:t};if(void 0!==d&&void 0!==e.pointInsideRect)for(g=0;g<d.data.length;g++)if(u=d.data[g],e.pointInsideRect(o.element,u,c))return a.external.$(o.element).off("CornerstoneToolsMouseMove",r),(0,v.default)(n,u,d,e.toolType,p,l),a.external.$(o.element).on("CornerstoneToolsMouseMove",r),n.stopImmediatePropagation(),!1}}function u(t){e.onImageRendered(t,t.detail)}function d(e){e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",i),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),a.external.cornerstone.updateImage(e)}function g(e){e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",i),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),e.addEventListener("cornerstoneimagerendered",u),a.external.cornerstone.updateImage(e)}function m(e,t){var n={mouseButtonMask:t};e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",i),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),e.addEventListener("cornerstoneimagerendered",u),a.external.$(e).on("CornerstoneToolsMouseMove",n,r),a.external.$(e).on("CornerstoneToolsMouseDown",n,i),a.external.$(e).on("CornerstoneToolsMouseDownActivate",n,o),a.external.cornerstone.updateImage(e)}function p(e,t){var n={mouseButtonMask:t};e.removeEventListener("cornerstoneimagerendered",u),a.external.$(e).off("CornerstoneToolsMouseMove",r),a.external.$(e).off("CornerstoneToolsMouseDown",i),a.external.$(e).off("CornerstoneToolsMouseDownActivate",o),e.addEventListener("cornerstoneimagerendered",u),a.external.$(e).on("CornerstoneToolsMouseMove",n,r),a.external.$(e).on("CornerstoneToolsMouseDown",n,i),a.external.cornerstone.updateImage(e)}return{enable:g,disable:d,activate:m,deactivate:p}};var a=n(0),r=n(35),l=o(r),i=n(18),s=o(i),u=n(36),c=o(u),d=n(21),f=o(d),g=n(37),v=o(g),m=n(12),h=o(m),p=n(2),x=o(p),T=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e);var n={};o.external.$(t).on("CornerstoneToolsTouchPinch",n,e)},disable:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e)},enable:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e)},deactivate:function(t){o.external.$(t).off("CornerstoneToolsTouchPinch",e)}}};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t,n){e.onMouseMove(t,n)}function n(r,l){e.onMouseUp(r,l),a.external.$(l.element).off("CornerstoneToolsMouseDrag",t),a.external.$(l.element).off("CornerstoneToolsMouseDrag",o),a.external.$(l.element).off("CornerstoneToolsMouseUp",n),a.external.$(l.element).off("CornerstoneToolsMouseClick",n)}function o(t,n){return e.onDrag(t,n),!1}function l(r,l){if((0,u.default)(l.which,r.data.mouseButtonMask))return a.external.$(l.element).on("CornerstoneToolsMouseDrag",o),a.external.$(l.element).on("CornerstoneToolsMouseUp",n),a.external.$(l.element).on("CornerstoneToolsMouseClick",n),e.onMouseDown(r,l),!1;a.external.$(l.element).on("CornerstoneToolsMouseDrag",t),a.external.$(l.element).on("CornerstoneToolsMouseUp",n)}function s(t){var n=t.detail,o=n.element,l=(0,r.getToolState)(o,c),i=void 0;l?i=l.data[0].pixelData:(i=new Uint8ClampedArray(n.image.width*n.image.height),(0,r.addToolState)(o,c,{pixelData:i}));var s=a.external.cornerstone.getLayer(n.element,d);s.image.setPixelData(i),s.invalid=!0,a.external.cornerstone.updateImage(o),e.onImageRendered(t,n)}function f(e,n){e.removeEventListener("cornerstoneimagerendered",s),e.addEventListener("cornerstoneimagerendered",s);var o={mouseButtonMask:n};a.external.$(e).off("CornerstoneToolsMouseDownActivate",l),a.external.$(e).on("CornerstoneToolsMouseDownActivate",o,l),a.external.$(e).off("CornerstoneToolsMouseMove",t),a.external.$(e).on("CornerstoneToolsMouseMove",t);var i=a.external.cornerstone.getEnabledElement(e),u=i.image,f=u.width,g=u.height,m=new Uint8ClampedArray(f*g),h=v.getConfiguration(),p=h.colormapId;if(!p){p="BrushColorMap";var x=a.external.cornerstone.colors.getColormap(p);x.setNumberOfColors(2),x.setColor(0,[0,0,0,0]),x.setColor(1,[255,0,0,255])}var T={minPixelValue:0,maxPixelValue:1,slope:1,intercept:0,getPixelData:function(){return m},rows:i.image.height,columns:i.image.width,height:g,width:f,pixelData:m,setPixelData:function(e){m=e},colormap:p,color:!1,rgba:!1,labelmap:!0,invert:!1,columnPixelSpacing:1,rowPixelSpacing:1,sizeInBytes:i.image.width*i.image.height},C=void 0,y={viewport:{pixelReplication:!0}};d&&(C=a.external.cornerstone.getLayer(e,d)),C||(d=a.external.cornerstone.addLayer(e,T,y)),(0,r.addToolState)(e,c,{pixelData:m}),h.brushLayerId=d,v.setConfiguration(h),a.external.cornerstone.updateImage(e)}function g(e){e.removeEventListener("cornerstoneimagerendered",s),a.external.$(e).off("CornerstoneToolsMouseDownActivate",l),a.external.$(e).off("CornerstoneToolsMouseMove",t)}var v=(0,i.default)({mouseMoveCallback:t,mouseDownActivateCallback:l,onImageRendered:s,deactivate:g});return v.activate=f,v};var a=n(0),r=n(1),l=n(7),i=o(l),s=n(2),u=o(s),c="brush",d=void 0},function(e,t,n){"use strict";function o(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=Math.round(o),l=Math.round(a);if(1===e)return[[r,l]];for(var i=[],s=0,u=-e;u<=e;u++){var c=l+u;if(!(c>t||c<0))for(var d=-e;d<=e;d++){var f=r+d;f>n||f<0||d*d+u*u<e*e&&(i[s++]=[r+d,l+u])}}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";function o(e,t,n,o){var a=function(e,t){return t*o+e};e.forEach(function(e){var o=a(e[0],e[1]);t[o]=n})}function a(e,t,n,o){var a=r.external.cornerstone.pixelToCanvas(o,{x:0,y:0}),l=r.external.cornerstone.pixelToCanvas(o,{x:1,y:1}),i=l.x-a.x,s=l.y-a.y;t.save(),t.fillStyle=n,e.forEach(function(e){var n=r.external.cornerstone.pixelToCanvas(o,{x:e[0],y:e[1]});t.fillRect(n.x,n.y,i,s)}),t.restore()}Object.defineProperty(t,"__esModule",{value:!0}),t.drawBrushOnCanvas=t.drawBrushPixels=void 0;var r=n(0);t.drawBrushPixels=o,t.drawBrushOnCanvas=a},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return a.external}});var r=n(62);Object.defineProperty(t,"referenceLines",{enumerable:!0,get:function(){return o(r).default}});var l=n(41);Object.defineProperty(t,"orientation",{enumerable:!0,get:function(){return o(l).default}});var i=n(27);Object.defineProperty(t,"requestPoolManager",{enumerable:!0,get:function(){return o(i).default}});var s=n(42);Object.defineProperty(t,"setContextToDisplayFontSize",{enumerable:!0,get:function(){return o(s).default}});var u=n(43);Object.defineProperty(t,"scrollToIndex",{enumerable:!0,get:function(){return o(u).default}});var c=n(29);Object.defineProperty(t,"scroll",{enumerable:!0,get:function(){return o(c).default}});var d=n(30);Object.defineProperty(t,"roundToDecimal",{enumerable:!0,get:function(){return o(d).default}});var f=n(26);Object.defineProperty(t,"projectPatientPointToImagePlane",{enumerable:!0,get:function(){return f.projectPatientPointToImagePlane}}),Object.defineProperty(t,"imagePointToPatientPoint",{enumerable:!0,get:function(){return f.imagePointToPatientPoint}}),Object.defineProperty(t,"planePlaneIntersection",{enumerable:!0,get:function(){return f.planePlaneIntersection}});var g=n(16);Object.defineProperty(t,"pointInsideBoundingBox",{enumerable:!0,get:function(){return o(g).default}});var v=n(31);Object.defineProperty(t,"pointInEllipse",{enumerable:!0,get:function(){return o(v).default}});var m=n(32);Object.defineProperty(t,"pauseEvent",{enumerable:!0,get:function(){return o(m).default}});var h=n(2);Object.defineProperty(t,"isMouseButtonEnabled",{enumerable:!0,get:function(){return o(h).default}});var p=n(33);Object.defineProperty(t,"getRGBPixels",{enumerable:!0,get:function(){return o(p).default}});var x=n(19);Object.defineProperty(t,"getDefaultSimultaneousRequests",{enumerable:!0,get:function(){return x.getDefaultSimultaneousRequests}}),Object.defineProperty(t,"getMaxSimultaneousRequests",{enumerable:!0,get:function(){return x.getMaxSimultaneousRequests}}),Object.defineProperty(t,"getBrowserInfo",{enumerable:!0,get:function(){return x.getBrowserInfo}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return x.isMobileDevice}});var T=n(45);Object.defineProperty(t,"getLuminance",{enumerable:!0,get:function(){return o(T).default}});var C=n(6);Object.defineProperty(t,"drawTextBox",{enumerable:!0,get:function(){return o(C).default}});var y=n(46);Object.defineProperty(t,"drawEllipse",{enumerable:!0,get:function(){return o(y).default}});var b=n(47);Object.defineProperty(t,"drawCircle",{enumerable:!0,get:function(){return o(b).default}});var M=n(48);Object.defineProperty(t,"drawArrow",{enumerable:!0,get:function(){return o(M).default}});var P=n(34);Object.defineProperty(t,"copyPoints",{enumerable:!0,get:function(){return o(P).default}});var w=n(17);Object.defineProperty(t,"calculateSUV",{enumerable:!0,get:function(){return o(w).default}});var S=n(49);Object.defineProperty(t,"calculateEllipseStatistics",{enumerable:!0,get:function(){return o(S).default}});var I=n(66);Object.defineProperty(t,"probeTool4D",{enumerable:!0,get:function(){return o(I).default}});var k=n(38);Object.defineProperty(t,"incrementTimePoint",{enumerable:!0,get:function(){return o(k).default}});var $=n(69);Object.defineProperty(t,"timeSeriesPlayer",{enumerable:!0,get:function(){return o($).default}});var O=n(70);Object.defineProperty(t,"timeSeriesScroll",{enumerable:!0,get:function(){return O.timeSeriesScroll}}),Object.defineProperty(t,"timeSeriesScrollWheel",{enumerable:!0,get:function(){return O.timeSeriesScrollWheel}}),Object.defineProperty(t,"timeSeriesScrollTouchDrag",{enumerable:!0,get:function(){return O.timeSeriesScrollTouchDrag}});var D=n(71);Object.defineProperty(t,"wwwcSynchronizer",{enumerable:!0,get:function(){return o(D).default}});var _=n(72);Object.defineProperty(t,"updateImageSynchronizer",{enumerable:!0,get:function(){return o(_).default}});var E=n(73);Object.defineProperty(t,"Synchronizer",{enumerable:!0,get:function(){return o(E).default}});var j=n(74);Object.defineProperty(t,"stackScrollSynchronizer",{enumerable:!0,get:function(){return o(j).default}});var A=n(75);Object.defineProperty(t,"stackImagePositionSynchronizer",{enumerable:!0,get:function(){return o(A).default}});var B=n(76);Object.defineProperty(t,"stackImagePositionOffsetSynchronizer",{enumerable:!0,get:function(){return o(B).default}});var L=n(77);Object.defineProperty(t,"stackImageIndexSynchronizer",{enumerable:!0,get:function(){return o(L).default}});var R=n(78);Object.defineProperty(t,"panZoomSynchronizer",{enumerable:!0,get:function(){return o(R).default}});var V=n(5);Object.defineProperty(t,"toolStyle",{enumerable:!0,get:function(){return o(V).default}});var H=n(1);Object.defineProperty(t,"addToolState",{enumerable:!0,get:function(){return H.addToolState}}),Object.defineProperty(t,"getToolState",{enumerable:!0,get:function(){return H.getToolState}}),Object.defineProperty(t,"removeToolState",{enumerable:!0,get:function(){return H.removeToolState}}),Object.defineProperty(t,"clearToolState",{enumerable:!0,get:function(){return H.clearToolState}}),Object.defineProperty(t,"setElementToolStateManager",{enumerable:!0,get:function(){return H.setElementToolStateManager}}),Object.defineProperty(t,"getElementToolStateManager",{enumerable:!0,get:function(){return H.getElementToolStateManager}});var N=n(35);Object.defineProperty(t,"toolCoordinates",{enumerable:!0,get:function(){return o(N).default}});var U=n(4);Object.defineProperty(t,"toolColors",{enumerable:!0,get:function(){return o(U).default}});var F=n(79);Object.defineProperty(t,"addTimeSeriesStateManager",{enumerable:!0,get:function(){return F.addTimeSeriesStateManager}}),Object.defineProperty(t,"newTimeSeriesSpecificToolStateManager",{enumerable:!0,get:function(){return F.newTimeSeriesSpecificToolStateManager}});var W=n(14);Object.defineProperty(t,"textStyle",{enumerable:!0,get:function(){return o(W).default}});var Y=n(80);Object.defineProperty(t,"stackSpecificStateManager",{enumerable:!0,get:function(){return Y.stackSpecificStateManager}}),Object.defineProperty(t,"newStackSpecificToolStateManager",{enumerable:!0,get:function(){return Y.newStackSpecificToolStateManager}}),Object.defineProperty(t,"addStackStateManager",{enumerable:!0,get:function(){return Y.addStackStateManager}});var z=n(10);Object.defineProperty(t,"loadHandlerManager",{enumerable:!0,get:function(){return o(z).default}});var X=n(15);Object.defineProperty(t,"newImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.newImageIdSpecificToolStateManager}}),Object.defineProperty(t,"globalImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.globalImageIdSpecificToolStateManager}});var q=n(81);Object.defineProperty(t,"newFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return q.newFrameOfReferenceSpecificToolStateManager}}),Object.defineProperty(t,"globalFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return q.globalFrameOfReferenceSpecificToolStateManager}});var K=n(82);Object.defineProperty(t,"appState",{enumerable:!0,get:function(){return o(K).default}});var G=n(83);Object.defineProperty(t,"stackScrollKeyboard",{enumerable:!0,get:function(){return o(G).default}});var Z=n(44);Object.defineProperty(t,"stackScroll",{enumerable:!0,get:function(){return Z.stackScroll}}),Object.defineProperty(t,"stackScrollWheel",{enumerable:!0,get:function(){return Z.stackScrollWheel}}),Object.defineProperty(t,"stackScrollTouchDrag",{enumerable:!0,get:function(){return Z.stackScrollTouchDrag}}),Object.defineProperty(t,"stackScrollMultiTouch",{enumerable:!0,get:function(){return Z.stackScrollMultiTouch}});var J=n(84);Object.defineProperty(t,"stackPrefetch",{enumerable:!0,get:function(){return o(J).default}});var Q=n(85);Object.defineProperty(t,"scrollIndicator",{enumerable:!0,get:function(){return o(Q).default}});var ee=n(86);Object.defineProperty(t,"stackRenderers",{enumerable:!0,get:function(){return o(ee).default}});var te=n(88);Object.defineProperty(t,"playClip",{enumerable:!0,get:function(){return te.playClip}}),Object.defineProperty(t,"stopClip",{enumerable:!0,get:function(){return te.stopClip}});var ne=n(12);Object.defineProperty(t,"anyHandlesOutsideImage",{enumerable:!0,get:function(){return o(ne).default}});var oe=n(8);Object.defineProperty(t,"drawHandles",{enumerable:!0,get:function(){return o(oe).default}});var ae=n(18);Object.defineProperty(t,"getHandleNearImagePoint",{enumerable:!0,get:function(){return o(ae).default}});var re=n(36);Object.defineProperty(t,"handleActivator",{enumerable:!0,get:function(){return o(re).default}});var le=n(37);Object.defineProperty(t,"moveAllHandles",{enumerable:!0,get:function(){return o(le).default}});var ie=n(21);Object.defineProperty(t,"moveHandle",{enumerable:!0,get:function(){return o(ie).default}});var se=n(22);Object.defineProperty(t,"moveNewHandle",{enumerable:!0,get:function(){return o(se).default}});var ue=n(24);Object.defineProperty(t,"moveNewHandleTouch",{enumerable:!0,get:function(){return o(ue).default}});var ce=n(51);Object.defineProperty(t,"touchMoveAllHandles",{enumerable:!0,get:function(){return o(ce).default}});var de=n(52);Object.defineProperty(t,"touchMoveHandle",{enumerable:!0,get:function(){return o(de).default}});var fe=n(89);Object.defineProperty(t,"keyboardInput",{enumerable:!0,get:function(){return o(fe).default}});var ge=n(90);Object.defineProperty(t,"mouseInput",{enumerable:!0,get:function(){return o(ge).default}});var ve=n(91);Object.defineProperty(t,"mouseWheelInput",{enumerable:!0,get:function(){return o(ve).default}});var me=n(53);Object.defineProperty(t,"preventGhostClick",{enumerable:!0,get:function(){return o(me).default}});var he=n(92);Object.defineProperty(t,"touchInput",{enumerable:!0,get:function(){return o(he).default}});var pe=n(93);Object.defineProperty(t,"angle",{enumerable:!0,get:function(){return pe.angle}}),Object.defineProperty(t,"angleTouch",{enumerable:!0,get:function(){return pe.angleTouch}});var xe=n(94);Object.defineProperty(t,"arrowAnnotate",{enumerable:!0,get:function(){return xe.arrowAnnotate}}),Object.defineProperty(t,"arrowAnnotateTouch",{enumerable:!0,get:function(){return xe.arrowAnnotateTouch}});var Te=n(95);Object.defineProperty(t,"crosshairs",{enumerable:!0,get:function(){return Te.crosshairs}}),Object.defineProperty(t,"crosshairsTouch",{enumerable:!0,get:function(){return Te.crosshairsTouch}});var Ce=n(23);Object.defineProperty(t,"displayTool",{enumerable:!0,get:function(){return o(Ce).default}});var ye=n(54);Object.defineProperty(t,"doubleTapTool",{enumerable:!0,get:function(){return o(ye).default}});var be=n(96);Object.defineProperty(t,"doubleTapZoom",{enumerable:!0,get:function(){return o(be).default}});var Me=n(97);Object.defineProperty(t,"dragProbe",{enumerable:!0,get:function(){return Me.dragProbe}}),Object.defineProperty(t,"dragProbeTouch",{enumerable:!0,get:function(){return Me.dragProbeTouch}});var Pe=n(98);Object.defineProperty(t,"ellipticalRoi",{enumerable:!0,get:function(){return Pe.ellipticalRoi}}),Object.defineProperty(t,"ellipticalRoiTouch",{enumerable:!0,get:function(){return Pe.ellipticalRoiTouch}});var we=n(99);Object.defineProperty(t,"freehand",{enumerable:!0,get:function(){return we.freehand}});var Se=n(100);Object.defineProperty(t,"highlight",{enumerable:!0,get:function(){return Se.highlight}}),Object.defineProperty(t,"highlightTouch",{enumerable:!0,get:function(){return Se.highlightTouch}});var Ie=n(101);Object.defineProperty(t,"imageStats",{enumerable:!0,get:function(){return o(Ie).default}});var ke=n(50);Object.defineProperty(t,"keyboardTool",{enumerable:!0,get:function(){return o(ke).default}});var $e=n(102);Object.defineProperty(t,"length",{enumerable:!0,get:function(){return $e.length}}),Object.defineProperty(t,"lengthTouch",{enumerable:!0,get:function(){return $e.lengthTouch}});var Oe=n(103);Object.defineProperty(t,"magnify",{enumerable:!0,get:function(){return Oe.magnify}}),Object.defineProperty(t,"magnifyTouchDrag",{enumerable:!0,get:function(){return Oe.magnifyTouchDrag}});var De=n(55);Object.defineProperty(t,"mouseButtonRectangleTool",{enumerable:!0,get:function(){return o(De).default}});var _e=n(7);Object.defineProperty(t,"mouseButtonTool",{enumerable:!0,get:function(){return o(_e).default}});var Ee=n(20);Object.defineProperty(t,"mouseWheelTool",{enumerable:!0,get:function(){return o(Ee).default}});var je=n(28);Object.defineProperty(t,"multiTouchDragTool",{enumerable:!0,get:function(){return o(je).default}});var Ae=n(104);Object.defineProperty(t,"orientationMarkers",{enumerable:!0,get:function(){return o(Ae).default}});var Be=n(105);Object.defineProperty(t,"pan",{enumerable:!0,get:function(){return Be.pan}}),Object.defineProperty(t,"panTouchDrag",{enumerable:!0,get:function(){return Be.panTouchDrag}});var Le=n(106);Object.defineProperty(t,"panMultiTouch",{enumerable:!0,get:function(){return o(Le).default}});var Re=n(107);Object.defineProperty(t,"probe",{enumerable:!0,get:function(){return Re.probe}}),Object.defineProperty(t,"probeTouch",{enumerable:!0,get:function(){return Re.probeTouch}});var Ve=n(108);Object.defineProperty(t,"rectangleRoi",{enumerable:!0,get:function(){return Ve.rectangleRoi}}),Object.defineProperty(t,"rectangleRoiTouch",{enumerable:!0,get:function(){return Ve.rectangleRoiTouch}});var He=n(109);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return He.rotate}}),Object.defineProperty(t,"rotateTouchDrag",{enumerable:!0,get:function(){return He.rotateTouchDrag}});var Ne=n(110);Object.defineProperty(t,"rotateTouch",{enumerable:!0,get:function(){return o(Ne).default}});var Ue=n(111);Object.defineProperty(t,"saveAs",{enumerable:!0,get:function(){return o(Ue).default}});var Fe=n(112);Object.defineProperty(t,"seedAnnotate",{enumerable:!0,get:function(){return Fe.seedAnnotate}}),Object.defineProperty(t,"seedAnnotateTouch",{enumerable:!0,get:function(){return Fe.seedAnnotateTouch}});var We=n(113);Object.defineProperty(t,"simpleAngle",{enumerable:!0,get:function(){return We.simpleAngle}}),Object.defineProperty(t,"simpleAngleTouch",{enumerable:!0,get:function(){return We.simpleAngleTouch}});var Ye=n(13);Object.defineProperty(t,"simpleMouseButtonTool",{enumerable:!0,get:function(){return o(Ye).default}});var ze=n(114);Object.defineProperty(t,"textMarker",{enumerable:!0,get:function(){return ze.textMarker}}),Object.defineProperty(t,"textMarkerTouch",{enumerable:!0,get:function(){return ze.textMarkerTouch}});var Xe=n(11);Object.defineProperty(t,"touchDragTool",{enumerable:!0,get:function(){return o(Xe).default}});var qe=n(56);Object.defineProperty(t,"touchPinchTool",{enumerable:!0,get:function(){return o(qe).default}});var Ke=n(9);Object.defineProperty(t,"touchTool",{enumerable:!0,get:function(){return o(Ke).default}});var Ge=n(115);Object.defineProperty(t,"wwwc",{enumerable:!0,get:function(){return Ge.wwwc}}),Object.defineProperty(t,"wwwcTouchDrag",{enumerable:!0,get:function(){return Ge.wwwcTouchDrag}});var Ze=n(116);Object.defineProperty(t,"wwwcRegion",{enumerable:!0,get:function(){return Ze.wwwcRegion}}),Object.defineProperty(t,"wwwcRegionTouch",{enumerable:!0,get:function(){return Ze.wwwcRegionTouch}});var Je=n(117);Object.defineProperty(t,"zoom",{enumerable:!0,get:function(){return Je.zoom}}),Object.defineProperty(t,"zoomWheel",{enumerable:!0,get:function(){return Je.zoomWheel}}),Object.defineProperty(t,"zoomTouchPinch",{enumerable:!0,get:function(){return Je.zoomTouchPinch}}),Object.defineProperty(t,"zoomTouchDrag",{enumerable:!0,get:function(){return Je.zoomTouchDrag}});var Qe=n(118);Object.defineProperty(t,"brush",{enumerable:!0,get:function(){return Qe.brush}});var et=n(119);Object.defineProperty(t,"adaptiveBrush",{enumerable:!0,get:function(){return et.adaptiveBrush}});var tt=n(120);Object.defineProperty(t,"regionsThreshold",{enumerable:!0,get:function(){return tt.regionsThreshold}}),Object.defineProperty(t,"regionsGrow",{enumerable:!0,get:function(){return tt.regionsGrow}}),Object.defineProperty(t,"regionsDraw",{enumerable:!0,get:function(){return tt.regionsDraw}}),Object.defineProperty(t,"regionsScore",{enumerable:!0,get:function(){return tt.regionsScore}}),Object.defineProperty(t,"regionsUndo",{enumerable:!0,get:function(){return tt.regionsUndo}});var nt=n(125);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return o(nt).default}})},function(t,n){t.exports=e},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(39),r=o(a),l=n(63),i=o(l),s=n(40),u=o(s),c={calculateReferenceLine:r.default,tool:i.default,renderActiveReferenceLine:u.default};t.default=c},function(e,t,n){"use strict";function o(e){var t=e.detail,n=(0,i.getToolState)(e.currentTarget,c);if(void 0!==n){var o=n.data[0].synchronizationContext,a=o.getSourceElements(),r=n.data[0].renderer,s=t.canvasContext.canvas.getContext("2d");l.external.cornerstone.setToPixelCoordinateSystem(t.enabledElement,s),a.forEach(function(n){n!==e.currentTarget&&r(s,t,e.currentTarget,n)})}}function a(e,t,n){n=n||u.default,(0,i.addToolState)(e,c,{synchronizationContext:t,renderer:n}),e.removeEventListener("cornerstoneimagerendered",o),e.addEventListener("cornerstoneimagerendered",o),l.external.cornerstone.updateImage(e)}function r(e){e.removeEventListener("cornerstoneimagerendered",o),l.external.cornerstone.updateImage(e)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),i=n(1),s=n(40),u=function(e){return e&&e.__esModule?e:{default:e}}(s),c="referenceLines",d={enable:a,disable:r};t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t="",n=e.x<0?"R":"L",a=e.y<0?"A":"P",r=e.z<0?"F":"H",l=new o.cornerstoneMath.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),i=0;i<3;i++)if(l.x>1e-4&&l.x>l.y&&l.x>l.z)t+=n,l.x=0;else if(l.y>1e-4&&l.y>l.x&&l.y>l.z)t+=a,l.y=0;else{if(!(l.z>1e-4&&l.z>l.x&&l.z>l.y))break;t+=r,l.z=0}return t};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.replace("H","f");return t=t.replace("F","h"),t=t.replace("R","l"),t=t.replace("L","r"),t=t.replace("A","p"),t=t.replace("P","a"),t=t.toUpperCase()}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=i.external.cornerstone,n=[];e.timeSeries.stacks.forEach(function(o){var a=void 0;a=!0===o.preventCache?t.loadImage(o.imageIds[e.imageIdIndex]):t.loadAndCacheImage(o.imageIds[e.imageIdIndex]),a.then(function(t){var o=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*t.width,a=t.getPixelData()[o];n.push(a)})}),e.lineSample.set(n)}function r(e){var t=(0,v.getToolState)(e.element,"timeSeries");if(void 0!==t&&void 0!==t.data&&0!==t.data.length){var n=t.data[0],o={timeSeries:n,lineSample:new x.default,imageIdIndex:n.stacks[n.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return a(o),h.default.add(o),o}}function l(e,t){var n=(0,v.getToolState)(e.currentTarget,T);if(n){var o=t.canvasContext.canvas.getContext("2d");i.external.cornerstone.setToPixelCoordinateSystem(t.enabledElement,o);for(var a=0;a<n.data.length;a++){o.save();var r=n.data[a];o.beginPath(),(0,d.default)(o,t,r.handles,"white"),o.stroke();var l=(0,g.default)(t.enabledElement,t.canvasContext,15);o.font=l.fontSize+"px Arial";var s=Math.round(r.handles.end.x),u=Math.round(r.handles.end.y),c=r.handles.end.x+3,f=r.handles.end.y-3;o.fillStyle="white",o.fillText(s+","+u,c,f),o.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(7),u=o(s),c=n(8),d=o(c),f=n(42),g=o(f),v=n(1),m=n(67),h=o(m),p=n(68),x=o(p),T="probe4D",C=(0,u.default)({createNewMeasurement:r,onImageRendered:l,toolType:T});t.default=C},function(e,t,n){"use strict";function o(){var e=this;e.measurements=[],this.add=function(t){var n=e.measurements.push(t),o={index:n,measurement:t};(0,r.default)(e,"CornerstoneMeasurementAdded",o)},this.remove=function(t){var n=e.measurements[t];e.measurements.splice(t,1);var o={index:t,measurement:n};(0,r.default)(e,"CornerstoneMeasurementRemoved",o)}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(a),l=new o;t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;e.samples=[],this.set=function(t){e.samples=t,(0,a.default)(e,"CornerstoneLineSampleUpdated")}};var o=n(3),a=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function o(e,t){if(void 0===e)throw new Error("playClip: element must not be undefined");void 0===t&&(t=30);var n=(0,r.getToolState)(e,"timeSeries");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var o=(0,r.getToolState)(e,s),a=void 0;void 0===o||0===o.data.length?(a={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},(0,r.addToolState)(e,s,a)):(a=o.data[0],a.framesPerSecond=t),void 0===a.intervalId&&(a.intervalId=setInterval(function(){a.framesPerSecond>0?(0,i.default)(e,1,!0):(0,i.default)(e,-1,!0)},1e3/Math.abs(a.framesPerSecond)))}}function a(e){var t=(0,r.getToolState)(e,s);if(t&&t.data&&t.data.length){var n=t.data[0];clearInterval(n.intervalId),n.intervalId=void 0}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),l=n(38),i=function(e){return e&&e.__esModule?e:{default:e}}(l),s="timeSeriesPlayer",u={start:o,stop:a};t.default=u},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){u.external.$(t.element).off("CornerstoneToolsMouseDrag",l),u.external.$(t.element).off("CornerstoneToolsMouseUp",a),u.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask)){var n={deltaY:0,options:e.data.options};return u.external.$(t.element).on("CornerstoneToolsMouseDrag",n,l),u.external.$(t.element).on("CornerstoneToolsMouseUp",a),u.external.$(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function l(e,t){e.data.deltaY+=t.deltaPoints.page.y;var n=(0,C.getToolState)(t.element,"timeSeries");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var o=n.data[0],a=u.external.$(t.element).height()/o.stacks.length;if(void 0!==e.data.options&&void 0!==e.data.options.timeSeriesScrollSpeed&&(a=e.data.options.timeSeriesScrollSpeed),e.data.deltaY>=a||e.data.deltaY<=-a){var r=Math.round(e.data.deltaY/a),l=e.data.deltaY%a;(0,p.default)(t.element,r),e.data.deltaY=l}return!1}}function i(e,t){var n=-t.direction;(0,p.default)(t.element,n)}function s(e){var t=e.originalEvent.detail,n={deltaY:0};n.deltaY+=t.deltaPoints.page.y;var o=(0,C.getToolState)(t.element,"stack");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){if(n.deltaY>=3||n.deltaY<=-3){var a=n.deltaY/3,r=n.deltaY%3;(0,p.default)(n.element,a),n.deltaY=r}return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=void 0;var u=n(0),c=n(13),d=o(c),f=n(11),g=o(f),v=n(20),m=o(v),h=n(38),p=o(h),x=n(2),T=o(x),C=n(1),y=(0,d.default)(r),b=(0,m.default)(i),M=(0,g.default)(s);t.timeSeriesScroll=y,t.timeSeriesScrollWheel=b,t.timeSeriesScrollTouchDrag=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var a=o.external.cornerstone,r=a.getViewport(t),l=a.getViewport(n);l.voi.windowWidth===r.voi.windowWidth&&l.voi.windowCenter===r.voi.windowCenter&&l.invert===r.invert||(l.voi.windowWidth=r.voi.windowWidth,l.voi.windowCenter=r.voi.windowCenter,l.invert=r.invert,e.setViewport(n,l))}};var o=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){n!==t&&o.external.cornerstone.updateImage(n)};var o=n(0)},function(e,t,n){"use strict";function o(e,t){function n(e,t){s.length&&u.length&&(c=!0,u.forEach(function(n){var o=u.indexOf(n);if(-1!==o){var a=d.imageIds.targetElements[o],r=s.indexOf(e);if(-1!==r){var l=d.imageIds.sourceElements[r],c=void 0;l===a?c=0:void 0!==d.distances[l]&&(c=d.distances[l][a]),f(i,e,n,t,c)}}}),c=!1)}function o(e,t){!0!==c&&n(e.currentTarget,t)}function r(e){var t=e.detail.element;i.remove(t)}var l=a.external.cornerstone,i=this,s=[],u=[],c=!1,d={},f=t;this.setHandler=function(e){f=e},this.getHandler=function(){return f},this.getDistances=function(){s.length&&u.length&&(d.distances={},d.imageIds={sourceElements:[],targetElements:[]},s.forEach(function(e){var t=l.getEnabledElement(e);if(t&&t.image){var n=t.image.imageId,o=l.metaData.get("imagePlaneModule",n);if(o&&o.imagePositionPatient){var a=o.imagePositionPatient;d.hasOwnProperty(t)||(d.distances[n]={},d.imageIds.sourceElements.push(n),u.forEach(function(t){var o=l.getEnabledElement(t);if(o&&o.image){var r=o.image.imageId;if(d.imageIds.targetElements.push(r),e!==t&&n!==r&&!d.distances[n].hasOwnProperty(r)){var i=l.metaData.get("imagePlaneModule",r);if(i&&i.imagePositionPatient){var s=i.imagePositionPatient;d.distances[n][r]=s.clone().sub(a)}}}}),Object.keys(d.distances[n]).length||delete d.distances[n])}}}))},this.addSource=function(t){-1===s.indexOf(t)&&(s.push(t),a.external.$(t).on(e,o),i.getDistances(),i.updateDisableHandlers())},this.addTarget=function(e){-1===u.indexOf(e)&&(u.push(e),i.getDistances(),f(i,e,e,0),i.updateDisableHandlers())},this.add=function(e){i.addSource(e),i.addTarget(e)},this.removeSource=function(t){var r=s.indexOf(t);-1!==r&&(s.splice(r,1),a.external.$(t).off(e,o),i.getDistances(),n(t),i.updateDisableHandlers())},this.removeTarget=function(e){var t=u.indexOf(e);-1!==t&&(u.splice(t,1),i.getDistances(),f(i,e,e,0),i.updateDisableHandlers())},this.remove=function(e){i.removeTarget(e),i.removeSource(e)},this.getSourceElements=function(){return s},this.getTargetElements=function(){return u},this.displayImage=function(e,t,n){c=!0,l.displayImage(e,t,n),c=!1},this.setViewport=function(e,t){c=!0,l.setViewport(e,t),c=!1},this.updateDisableHandlers=function(){a.external.$.unique(s.concat(u)).forEach(function(e){e.removeEventListener("cornerstoneelementdisabled",r),e.addEventListener("cornerstoneelementdisabled",r)})},this.destroy=function(){a.external.$.unique(s.concat(u)).forEach(function(e){i.remove(e)})}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){if(t!==n&&r&&r.direction){var i=o.external.cornerstone,s=(0,a.getToolState)(n,"stack"),u=s.data[0],c=u.currentImageIdIndex+r.direction;if(c=Math.min(Math.max(c,0),u.imageIds.length-1),u.currentImageIdIndex!==c){var d=l.default.getStartLoadHandler(),f=l.default.getEndLoadHandler(),g=l.default.getErrorLoadingHandler();d&&d(n);var v=void 0;v=!0===u.preventCache?i.loadImage(u.imageIds[c]):i.loadAndCacheImage(u.imageIds[c]),v.then(function(t){var o=i.getViewport(n);u.currentImageIdIndex=c,e.displayImage(n,t,o),f&&f(n,t)},function(e){var t=u.imageIds[c];g&&g(n,t,e)})}}};var o=n(0),a=n(1),r=n(10),l=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var r=o.external.cornerstone,i=r.getEnabledElement(t).image,s=r.metaData.get("imagePlaneModule",i.imageId),u=s.imagePositionPatient,c=(0,a.getToolState)(n,"stack"),d=c.data[0],f=Number.MAX_VALUE,g=-1;if(d.imageIds.forEach(function(e,t){var n=r.metaData.get("imagePlaneModule",e),o=n.imagePositionPatient,a=o.distanceToSquared(u);a<f&&(f=a,g=t)}),g!==d.currentImageIdIndex){var v=l.default.getStartLoadHandler(),m=l.default.getEndLoadHandler(),h=l.default.getErrorLoadingHandler();if(v&&v(n),-1!==g){var p=void 0;p=!0===d.preventCache?r.loadImage(d.imageIds[g]):r.loadAndCacheImage(d.imageIds[g]),p.then(function(t){var o=r.getViewport(n);d.currentImageIdIndex=g,e.displayImage(n,t,o),m&&m(n,t)},function(e){var t=d.imageIds[g];h&&h(n,t,e)})}}}};var o=n(0),a=n(1),r=n(10),l=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,i){if(n!==t){var s=o.external.cornerstone,u=s.getEnabledElement(t),c=s.metaData.get("imagePlaneModule",u.image.imageId),d=c.imagePositionPatient,f=(0,a.getToolState)(n,"stack"),g=f.data[0],v=Number.MAX_VALUE,m=-1;if(i){var h=d.clone().add(i);if(g.imageIds.forEach(function(e,t){var n=s.metaData.get("imagePlaneModule",e),o=n.imagePositionPatient,a=h.distanceToSquared(o);a<v&&(v=a,m=t)}),m!==g.currentImageIdIndex&&-1!==m){var p=l.default.getStartLoadHandler(),x=l.default.getEndLoadHandler(),T=l.default.getErrorLoadingHandler();p&&p(n);var C=void 0;C=!0===g.preventCache?s.loadImage(g.imageIds[m]):s.loadAndCacheImage(g.imageIds[m]),C.then(function(t){var o=s.getViewport(n);g.currentImageIdIndex=m,e.displayImage(n,t,o),x&&x(n,t)},function(e){var t=g.imageIds[m];T&&T(n,t,e)})}}}};var o=n(0),a=n(1),r=n(10),l=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var r=o.external.cornerstone,i=(0,a.getToolState)(t,"stack"),s=i.data[0],u=(0,a.getToolState)(n,"stack"),c=u.data[0],d=s.currentImageIdIndex;if((d=Math.min(Math.max(d,0),c.imageIds.length-1))!==c.currentImageIdIndex){var f=l.default.getStartLoadHandler(),g=l.default.getEndLoadHandler(),v=l.default.getErrorLoadingHandler();f&&f(n);var m=void 0;m=!0===c.preventCache?r.loadImage(c.imageIds[d]):r.loadAndCacheImage(c.imageIds[d]),m.then(function(t){var o=r.getViewport(n);c.currentImageIdIndex=d,e.displayImage(n,t,o),g&&g(n,t)},function(e){var t=c.imageIds[d];v&&v(n,t,e)})}}};var o=n(0),a=n(1),r=n(10),l=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n!==t){var a=o.external.cornerstone,r=a.getViewport(t),l=a.getViewport(n);l.scale===r.scale&&l.translation.x===r.translation.x&&l.translation.y===r.translation.y||(l.scale=r.scale,l.translation.x=r.translation.x,l.translation.y=r.translation.y,e.setViewport(n,l))}};var o=n(0)},function(e,t,n){"use strict";function o(e,t){function n(n,o,r){if(!(e.indexOf(o)>=0))return t.add(n,o,r);!1===a.hasOwnProperty(o)&&(a[o]={data:[]}),a[o].data.push(r)}function o(n,o){return e.indexOf(o)>=0?(!1===a.hasOwnProperty(o)&&(a[o]={data:[]}),a[o]):t.get(n,o)}var a={};return{get:o,add:n}}function a(e,t){t=t||["timeSeries"];var n=(0,l.getElementToolStateManager)(e);void 0===n&&(n=r.globalImageIdSpecificToolStateManager);var a=o(t,n);i.push(a),(0,l.setElementToolStateManager)(e,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=void 0;var r=n(15),l=n(1),i=[];t.addTimeSeriesStateManager=a,t.newTimeSeriesSpecificToolStateManager=o},function(e,t,n){"use strict";function o(e,t){function n(){return l}function o(e){l=e}function a(n,o,a){if(!(e.indexOf(o)>=0))return t.add(n,o,a);!1===l.hasOwnProperty(o)&&(l[o]={data:[]}),l[o].data.push(a)}function r(n,o){return e.indexOf(o)>=0?(!1===l.hasOwnProperty(o)&&(l[o]={data:[]}),l[o]):t.get(n,o)}var l={};return{get:r,add:a,saveToolState:n,restoreToolState:o,toolState:l}}function a(e,t){var n=(0,l.getElementToolStateManager)(e);n||(n=r.globalImageIdSpecificToolStateManager);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(a=a.concat(t));var s=o(a,n);i.push(s),(0,l.setElementToolStateManager)(e,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=void 0;var r=n(15),l=n(1),i=[],s={newStackSpecificToolStateManager:o,addStackStateManager:a};t.stackSpecificStateManager=s,t.newStackSpecificToolStateManager=o,t.addStackStateManager=a},function(e,t,n){"use strict";function o(){function e(e,t,n){!1===o.hasOwnProperty(e)&&(o[e]={});var a=o[e];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(n)}function t(e,t){if(!1!==o.hasOwnProperty(e)){var n=o[e];if(!1!==n.hasOwnProperty(t)){return n[t]}}}function n(e,t,n){if(!1!==o.hasOwnProperty(e)){var a=o[e];if(!1!==a.hasOwnProperty(t)){for(var r=a[t],l=-1,i=0;i<r.data.length;i++)r.data[i]===n&&(l=i);-1!==l&&r.data.splice(l,1)}}}var o={};return{get:t,add:e,remove:n}}Object.defineProperty(t,"__esModule",{value:!0});var a=o();t.newFrameOfReferenceSpecificToolStateManager=o,t.globalFrameOfReferenceSpecificToolStateManager=a},function(e,t,n){"use strict";function o(e){var t={imageIdToolState:l.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach(function(e){var n=(0,i.getElementToolStateManager)(e);n!==l.globalImageIdSpecificToolStateManager&&(t.elementToolState[e.id]=n.saveToolState(),t.elementViewport[e.id]=r.external.cornerstone.getViewport(e))}),t}function a(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport")){var t=r.external.cornerstone;return l.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach(function(n){var o=document.getElementById(n);if(o&&e.elementToolState.hasOwnProperty(n)){var a=(0,i.getElementToolStateManager)(o);if(a!==l.globalImageIdSpecificToolStateManager){a.restoreToolState(e.elementToolState[n]);var r=e.elementViewport[n];t.setViewport(o,r),t.updateImage(o)}}}),e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),l=n(15),i=n(1),s={save:o,restore:a};t.default=s},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=t.keyCode;if(n===u.UP||n===u.DOWN){var o=1;n===u.DOWN&&(o=-1),(0,l.default)(t.element,o)}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(29),l=o(r),i=n(50),s=o(i),u={UP:38,DOWN:40},c=(0,s.default)(a);t.default=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e=Math.round(e)||0,t=Math.round(t)||0;var n=[],o=t-e+1;if(o<=0)return n;for(;o--;)n[o]=t--;return n}function r(e,t){var n=[],o=[];return e.forEach(function(e){e<t?n.push(e):e>t&&o.push(e)}),{low:e.indexOf(w(n)),high:e.indexOf(S(o))}}function l(e){function t(e){var t=s.indicesToRequest.indexOf(e);t>-1&&s.indicesToRequest.splice(t,1)}function n(e){t(l.imageIds.indexOf(e.imageId))}function o(t){console.log("prefetch errored: "+t),f&&f(e,c,t,"stackPrefetch")}var a=(0,x.getToolState)(e,"stack");if(a&&a.data&&a.data.length){var l=a.data[0],i=(0,x.getToolState)(e,C);if(i){var s=i.data[0]||{};if(s.indicesToRequest&&s.indicesToRequest.length||(s.enabled=!1),!1!==s.enabled){i.data[0].indicesToRequest.sort(function(e,t){return e-t});if(s.indicesToRequest.slice().forEach(function(e){var n=l.imageIds[e];if(n){var o=g.external.cornerstone.imageCache.getImagePromise(n);o&&"resolved"===o.state()&&t(e)}}),s.indicesToRequest.length){m.default.clearRequestStack(y);for(var u=r(s.indicesToRequest,l.currentImageIdIndex),c=void 0,d=void 0,f=p.default.getErrorLoadingHandler(),v=u.low,h=u.high;v>=0||h<s.indicesToRequest.length;){var T=l.currentImageIdIndex,M=T-s.indicesToRequest[v]>b.maxImagesToPrefetch,P=s.indicesToRequest[h]-T>b.maxImagesToPrefetch,w=!M&&v>=0,S=!P&&h<s.indicesToRequest.length;if(!S&&!w)break;w&&(d=s.indicesToRequest[v--],c=l.imageIds[d],m.default.addRequest(e,c,y,!1,n,o)),S&&(d=s.indicesToRequest[h++],c=l.imageIds[d],m.default.addRequest(e,c,y,!1,n,o))}m.default.startGrabbing()}}}}}function i(e){return function(t){var n=t.detail,o=void 0;try{o=(0,x.getToolState)(e,"stack")}catch(e){return}if(o&&o.data&&o.data.length){var a=o.data[0],r=a.imageIds.indexOf(n.imageId);if(!(r<0)){var l=(0,x.getToolState)(e,C);l&&l.data&&l.data.length&&l.data[0].indicesToRequest.push(r)}}}}function s(e){clearTimeout(M),M=setTimeout(function(){var t=e.target;try{l(t)}catch(e){return}},P)}function u(e){(0,x.getToolState)(e,C).data=[];var t=(0,x.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0===n.preventCache)return void console.warn("A stack that should not be cached was given the stackPrefetch");var o={indicesToRequest:a(0,n.imageIds.length-1),enabled:!0,direction:1},r=o.indicesToRequest.indexOf(n.currentImageIdIndex);o.indicesToRequest.splice(r,1),(0,x.addToolState)(e,C,o),l(e),e.removeEventListener("cornerstonenewimage",s),e.addEventListener("cornerstonenewimage",s);var u=i(e);g.external.cornerstone.events.removeEventListener("cornerstoneimagecachepromiseremoved",u),g.external.cornerstone.events.addEventListener("cornerstoneimagecachepromiseremoved",u)}}function c(e){clearTimeout(M),e.removeEventListener("cornerstonenewimage",s);var t=i(e);g.external.cornerstone.events.removeEventListener("cornerstoneimagecachepromiseremoved",t);var n=(0,x.getToolState)(e,C);n&&n.data.length&&(n.data[0].enabled=!1,m.default.clearRequestStack(y))}function d(){return b}function f(e){b=e,e.maxSimultaneousRequests&&(0,T.setMaxSimultaneousRequests)(e.maxSimultaneousRequests)}Object.defineProperty(t,"__esModule",{value:!0});var g=n(0),v=n(27),m=o(v),h=n(10),p=o(h),x=n(1),T=n(19),C="stackPrefetch",y="prefetch",b={maxImagesToPrefetch:1/0},M=void 0,P=10,w=function(e){return Math.max.apply(null,e)},S=function(e){return Math.min.apply(null,e)},I={enable:u,disable:c,getConfiguration:d,setConfiguration:f};t.default=I},function(e,t,n){"use strict";function o(e,t){var n=t.element,o=t.enabledElement.canvas.width,a=t.enabledElement.canvas.height;if(!o||!a)return!1;var r=t.enabledElement.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.save();var s=u.getConfiguration();r.fillStyle=s.backgroundColor,"horizontal"===s.orientation?r.fillRect(0,a-i,o,i):r.fillRect(0,0,i,a);var c=(0,l.getToolState)(n,"stack");if(c&&c.data&&c.data.length){var d=c.data[0].imageIds,f=c.data[0].currentImageIdIndex,g=o/d.length,v=a/d.length,m=g*f,h=v*f;r.fillStyle=s.fillColor,"horizontal"===s.orientation?r.fillRect(m,a-i,g,i):r.fillRect(0,h,i,v),r.restore()}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(23),r=function(e){return e&&e.__esModule?e:{default:e}}(a),l=n(1),i=6,s={backgroundColor:"rgb(19, 63, 141)",fillColor:"white",orientation:"horizontal"},u=(0,r.default)(o);u.setConfiguration(s),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(87),a=function(e){return e&&e.__esModule?e:{default:e}}(o),r={};r.FusionRenderer=a.default,t.default=r},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),l=n(1),i=function(){function e(){o(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return a(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");if(!t){t=(0,l.getToolState)(e,"stack").data}var o=r.external.cornerstone,a=t[0],i=a.imageIds[this.currentImageIdIndex],s=t.slice(1,t.length);o.loadAndCacheImage(i).then(function(t){var r=n.layerIds[0];r?o.setLayerImage(e,t,r):(r=o.addLayer(e,t,a.options),n.layerIds.push(r)),o.displayImage(e,t),s.forEach(function(t,a){var l=n.findImageFn(t.imageIds,i),s=a+1,u=n.layerIds[s];u||(u=o.addLayer(e,void 0,t.options),n.layerIds.push(u)),l?o.loadAndCacheImage(l).then(function(t){o.setLayerImage(e,t,u),o.updateImage(e)}):(o.setLayerImage(e,void 0,u),o.setActiveLayer(e,r),o.updateImage(e))})})}}]),e}();t.default=i},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=void 0,o=void 0,a=void 0,r=0,l=e.length,i=[];for(i.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<l;n++)a=Number(e[n])/t|0,i.push(a),1===n?o=a:a!==o&&(i.isTimeVarying=!0),r+=a;return i.length>0&&(a=i.isTimeVarying?r/i.length|0:i[0],i.push(a)),i}function r(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function l(e){var t={element:e};(0,v.default)(e,"CornerstoneToolsClipStopped",t)}function i(e,t){var n=void 0,o=void 0;if(void 0===e)throw new Error("playClip: element must not be undefined");var i=(0,f.getToolState)(e,"stack");if(i&&i.data&&i.data.length){var s=u.external.cornerstone,c=void 0;if(i.data.length>1){var g=(0,f.getToolState)(e,"stackRenderer");g&&g.data&&g.data.length&&(c=g.data[0])}var v=i.data[0],h=(0,f.getToolState)(e,m);h&&h.data&&h.data.length?(n=h.data[0],r(n)):(n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},(0,f.addToolState)(e,m,n)),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===v.imageIds.length&&(o=a(n.frameTimeVector,n.speed));var p=function(){var t=void 0,o=void 0,a=void 0,u=void 0,f=v.currentImageIdIndex,g=v.imageIds.length;if(n.reverse?f--:f++,!n.loop&&(f<0||f>=g))return r(n),void l(e);f>=g&&(f=0),f<0&&(f=g-1),f!==v.currentImageIdIndex&&(o=d.default.getStartLoadHandler(),a=d.default.getEndLoadHandler(),u=d.default.getErrorLoadingHandler(),o&&o(e),t=!0===v.preventCache?s.loadImage(v.imageIds[f]):s.loadAndCacheImage(v.imageIds[f]),t.then(function(t){try{v.currentImageIdIndex=f,c?(c.currentImageIdIndex=f,c.render(e,i.data)):s.displayImage(e,t),a&&a(e,t)}catch(e){return}},function(t){var n=v.imageIds[f];u&&u(e,n,t)}))};o&&o.length>0&&o.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout(function e(){n.intervalId=setTimeout(e,o[v.currentImageIdIndex]),p()},0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(p,1e3/Math.abs(n.framesPerSecond)))}}function s(e){var t=(0,f.getToolState)(e,m);t&&t.data&&t.data.length&&r(t.data[0])}Object.defineProperty(t,"__esModule",{value:!0}),t.stopClip=t.playClip=void 0;var u=n(0),c=n(10),d=o(c),f=n(1),g=n(3),v=o(g),m="playClip";t.playClip=i,t.stopClip=s},function(e,t,n){"use strict";function o(e){var t=i.external.cornerstone,n=e.currentTarget,o={event:window.event||e,element:n,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,currentPoints:{page:{x:c,y:d},image:t.pageToPixel(n,c,d)},keyCode:e.keyCode,which:e.which};o.currentPoints.canvas=t.pixelToCanvas(n,o.currentPoints.image);var a={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};(0,u.default)(n,a[e.type],o)}function a(e){c=e.pageX||e.originalEvent.pageX,d=e.pageY||e.originalEvent.pageY}function r(e){l(e),i.external.$(e).on(f,o),i.external.$(e).on("mousemove",a)}function l(e){i.external.$(e).off(f,o),i.external.$(e).off("mousemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(3),u=function(e){return e&&e.__esModule?e:{default:e}}(s),c=void 0,d=void 0,f="keydown keypress keyup",g={enable:r,disable:l};t.default=g},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return"number"!=typeof e.buttons?e.which:0===e.buttons?0:e.buttons%2==1?1:e.buttons%4==2?3:e.buttons%8==4?2:0}function r(){x=!1}function l(e){var t=d.external.cornerstone,n=e.currentTarget,o="CornerstoneToolsMouseDoubleClick",r={page:d.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=t.pixelToCanvas(n,r.image);var l=(0,g.default)(r),i={event:e,which:a(e),viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:r,lastPoints:l,currentPoints:r,deltaPoints:{x:0,y:0},type:o};(0,p.default)(i.element,o,i)}function i(e){function t(e){var t={page:d.cornerstoneMath.point.pageToPoint(e),image:o.pageToPixel(l,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};t.canvas=o.pixelToCanvas(l,t.image);var n={page:d.cornerstoneMath.point.subtract(t.page,u.page),image:d.cornerstoneMath.point.subtract(t.image,u.image),client:d.cornerstoneMath.point.subtract(t.client,u.client),canvas:d.cornerstoneMath.point.subtract(t.canvas,u.canvas)},a={which:f,viewport:o.getViewport(l),image:o.getEnabledElement(l).image,element:l,startPoints:i,lastPoints:u,currentPoints:t,deltaPoints:n,type:"CornerstoneToolsMouseDrag",ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};return(0,p.default)(a.element,"CornerstoneToolsMouseDrag",a),u=(0,g.default)(t),(0,m.default)(e)}function n(e){clearTimeout(T);var a="CornerstoneToolsMouseUp";x&&(a="CornerstoneToolsMouseClick");var r={page:d.cornerstoneMath.point.pageToPoint(e),image:o.pageToPixel(l,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=o.pixelToCanvas(l,r.image);var c={page:d.cornerstoneMath.point.subtract(r.page,u.page),image:d.cornerstoneMath.point.subtract(r.image,u.image),client:d.cornerstoneMath.point.subtract(r.client,u.client),canvas:d.cornerstoneMath.point.subtract(r.canvas,u.canvas)},g={event:e,which:f,viewport:o.getViewport(l),image:o.getEnabledElement(l).image,element:l,startPoints:i,lastPoints:u,currentPoints:r,deltaPoints:c,type:a};(0,p.default)(g.element,a,g),d.external.$(document).off("mousemove",t),d.external.$(document).off("mouseup",n),d.external.$(g.element).on("mousemove",s),x=!0}T=setTimeout(r,C);var o=d.external.cornerstone,l=e.currentTarget;d.external.$(l).off("mousemove",s);var i={page:d.cornerstoneMath.point.pageToPoint(e),image:o.pageToPixel(l,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=o.pixelToCanvas(l,i.image);var u=(0,g.default)(i),c={event:e,which:a(e),viewport:o.getViewport(l),image:o.getEnabledElement(l).image,element:l,startPoints:i,lastPoints:u,currentPoints:i,deltaPoints:{x:0,y:0},type:"CornerstoneToolsMouseDown"};(0,p.default)(c.element,"CornerstoneToolsMouseDown",c)&&(c.type="CornerstoneToolsMouseDownActivate",(0,p.default)(c.element,"CornerstoneToolsMouseDownActivate",c));var f=a(e);return d.external.$(document).on("mousemove",t),d.external.$(document).on("mouseup",n),(0,m.default)(e)}function s(e){var t=d.external.cornerstone,n=e.currentTarget,o={page:d.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=t.pixelToCanvas(n,o.image);var r=(0,g.default)(o),l=a(e),i={page:d.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=t.pixelToCanvas(n,i.image);var s={page:d.cornerstoneMath.point.subtract(i.page,r.page),image:d.cornerstoneMath.point.subtract(i.image,r.image),client:d.cornerstoneMath.point.subtract(i.client,r.client),canvas:d.cornerstoneMath.point.subtract(i.canvas,r.canvas)},u={which:l,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:o,lastPoints:r,currentPoints:i,deltaPoints:s,type:"CornerstoneToolsMouseMove"};(0,p.default)(n,"CornerstoneToolsMouseMove",u),r=(0,g.default)(i)}function u(e){d.external.$(e).off("mousedown",i),d.external.$(e).off("mousemove",s),d.external.$(e).off("dblclick",l)}function c(e){u(e),d.external.$(e).on("mousedown",i),d.external.$(e).on("mousemove",s),d.external.$(e).on("dblclick",l)}Object.defineProperty(t,"__esModule",{value:!0});var d=n(0),f=n(34),g=o(f),v=n(32),m=o(v),h=n(3),p=o(h),x=!0,T=void 0,C=200,y={enable:c,disable:u};t.default=y},function(e,t,n){"use strict";function o(e){if(!("mousewheel"===e.originalEvent.type&&0===e.originalEvent.wheelDeltaY||"DOMMouseScroll"===e.originalEvent.type&&1===e.originalEvent.axis)){e.preventDefault();var t=l.external.cornerstone,n=e.currentTarget,o=void 0,a=void 0;void 0!==e.pageX&&void 0!==e.pageY?(o=e.pageX,a=e.pageY):e.originalEvent&&void 0!==e.originalEvent.pageX&&void 0!==e.originalEvent.pageY?(o=e.originalEvent.pageX,a=e.originalEvent.pageY):(o=e.x,a=e.y);var r=t.pageToPixel(n,o,a);e=window.event&&window.event.wheelDelta?window.event:e;var i=void 0;i=e.originalEvent&&e.originalEvent.wheelDelta?-e.originalEvent.wheelDelta:e.originalEvent&&e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent&&e.originalEvent.detail?-e.originalEvent.detail:e.wheelDelta;var u=i<0?-1:1,c={element:n,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,direction:u,pageX:o,pageY:a,imageX:r.x,imageY:r.y};(0,s.default)(n,"CornerstoneToolsMouseWheel",c)}}function a(e){r(e),l.external.$(e).on(u,o)}function r(e){l.external.$(e).unbind(u,o)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),i=n(3),s=function(e){return e&&e.__esModule?e:{default:e}}(i),u="mousewheel DOMMouseScroll",c={enable:a,disable:r};t.default=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=i.external.cornerstone,n=e.currentTarget||e.srcEvent.currentTarget,o=void 0,a=void 0,r=void 0,l=void 0,s=void 0;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(I=!1,clearTimeout(b)),e.type){case"tap":I=!1,clearTimeout(b),p={page:i.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),o="CornerstoneToolsTap",C={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,currentPoints:p,type:o,isTouchEvent:!0},(0,m.default)(n,o,C);break;case"doubletap":I=!1,clearTimeout(b),p={page:i.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),o="CornerstoneToolsDoubleTap",C={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,currentPoints:p,type:o,isTouchEvent:!0},(0,m.default)(n,o,C);break;case"pinchstart":I=!1,clearTimeout(b),P=1;break;case"pinchmove":if(I=!1,clearTimeout(b),!0===S){P=e.scale,S=!1;break}a=(e.scale-P)/P,h={page:e.center,image:t.pageToPixel(n,e.center.x,e.center.y)},h.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchPinch",C={event:e,startPoints:h,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,direction:e.scale<1?1:-1,scaleChange:a,type:o,isTouchEvent:!0},(0,m.default)(n,o,C),P=e.scale;break;case"touchstart":P=1,clearTimeout(b),clearTimeout(y),y=setTimeout(function(){h={page:i.cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:t.pageToPixel(n,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},h.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(o="CornerstoneToolsMultiTouchStart"),C={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,currentPoints:h,type:o,isTouchEvent:!0},!0===(0,m.default)(n,o,C)&&(o="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(o="CornerstoneToolsMultiTouchStartActive"),C.type=o,(0,m.default)(n,o,C)),x=(0,u.default)(h)},50),I=!0,M=0,b=setTimeout(function(){I&&(p={page:i.cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:t.pageToPixel(n,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},p.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchPress",C={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,currentPoints:p,type:o,isTouchEvent:!0},(0,m.default)(n,o,C))},$);break;case"touchend":P=1,I=!1,clearTimeout(b),setTimeout(function(){h={page:i.cornerstoneMath.point.pageToPoint(e.originalEvent.changedTouches[0]),image:t.pageToPixel(n,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},h.canvas=t.pixelToCanvas(n,h.image),o="CornerstoneToolsTouchEnd",C={event:e,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,currentPoints:h,type:o,isTouchEvent:!0},(0,m.default)(n,o,C)},50);break;case"panmove":r={x:e.deltaX-k.x,y:e.deltaY-k.y},k={x:e.deltaX,y:e.deltaY},p={page:{x:x.page.x+r.x,y:x.page.y+r.y},image:t.pageToPixel(n,x.page.x+r.x,x.page.y+r.y),client:{x:x.client.x+r.x,y:x.client.y+r.y}},p.canvas=t.pixelToCanvas(n,p.image),T={page:i.cornerstoneMath.point.subtract(p.page,x.page),image:i.cornerstoneMath.point.subtract(p.image,x.image),client:i.cornerstoneMath.point.subtract(p.client,x.client),canvas:i.cornerstoneMath.point.subtract(p.canvas,x.canvas)},M+=Math.sqrt(T.page.x*T.page.x+T.page.y*T.page.y),M>O&&(I=!1,clearTimeout(b)),o="CornerstoneToolsTouchDrag",e.pointers.length>1&&(o="CornerstoneToolsMultiTouchDrag"),C={viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,lastPoints:x,currentPoints:p,deltaPoints:T,numPointers:e.pointers.length,type:o,isTouchEvent:!0},(0,m.default)(n,o,C),x=(0,u.default)(p);break;case"panstart":k={x:e.deltaX,y:e.deltaY},p={page:i.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),x=(0,u.default)(p);break;case"panend":return I=!1,(clearTimeout(b),x)?(p={page:i.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},p.canvas=t.pixelToCanvas(n,p.image),T={page:i.cornerstoneMath.point.subtract(p.page,x.page),image:i.cornerstoneMath.point.subtract(p.image,x.image),client:i.cornerstoneMath.point.subtract(p.client,x.client),canvas:i.cornerstoneMath.point.subtract(p.canvas,x.canvas)},o="CornerstoneToolsDragEnd",C={event:e.srcEvent,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,startPoints:h,lastPoints:x,currentPoints:p,deltaPoints:T,type:o,isTouchEvent:!0},(0,m.default)(n,o,C),l=e.pointers.length-e.changedPointers.length,2===l&&(S=!0),(0,d.default)(e)):!1;case"rotatemove":I=!1,clearTimeout(b),s=e.rotation-w,w=e.rotation,o="CornerstoneToolsTouchRotate",C={event:e.srcEvent,viewport:t.getViewport(n),image:t.getEnabledElement(n).image,element:n,rotation:s,type:o},(0,m.default)(n,o,C)}return!1}function r(e){l(e);var t=i.external.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},o=new t.Manager(e,n),r={pointers:0,direction:t.DIRECTION_ALL,threshold:0},s=new t.Pan(r),u=new t.Pinch({threshold:0}),c=new t.Rotate({threshold:0});u.recognizeWith(s),u.recognizeWith(c),c.recognizeWith(s);var d=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});d.recognizeWith(s),o.add([d,s,c,u]),o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",a),g.default.enable(e),i.external.$(e).on("touchstart touchend",a),i.external.$(e).data("hammer",o)}function l(e){g.default.disable(e),i.external.$(e).off("touchstart touchend",a);var t=i.external.$(e).data("hammer");t&&t.off("tap doubletap panstart panmove panend pinchmove rotatemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(34),u=o(s),c=n(32),d=o(c),f=n(53),g=o(f),v=n(3),m=o(v),h=void 0,p=void 0,x=void 0,T=void 0,C=void 0,y=void 0,b=void 0,M=void 0,P=1,w=0,S=!1,I=!1,k=void 0,$=700,O=5,D={enable:r,disable:l};t.default=D},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function r(e,t,n){var o=i.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.end)},r=i.cornerstoneMath.lineSegment.distanceToPoint(a,n);return r<5||(a.start=o.pixelToCanvas(e,t.handles.start2),a.end=o.pixelToCanvas(e,t.handles.end2),(r=i.cornerstoneMath.lineSegment.distanceToPoint(a,n))<5)}function l(e,t){var n=(0,P.getToolState)(e.currentTarget,w);if(void 0!==n){var o=t.canvasContext.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);for(var a=void 0,r=p.default.getToolWidth(),l=T.default.getFont(),s=S.getConfiguration(),u=i.external.cornerstone,c=0;c<n.data.length;c++){o.save(),s&&s.shadow&&(o.shadowColor=s.shadowColor||"#000000",o.shadowOffsetX=s.shadowOffsetX||1,o.shadowOffsetY=s.shadowOffsetY||1);var d=n.data[c];a=d.active?y.default.getActiveColor():y.default.getToolColor(),o.beginPath(),o.strokeStyle=a,o.lineWidth=r;var f=u.pixelToCanvas(t.element,d.handles.start),v=u.pixelToCanvas(t.element,d.handles.end);o.moveTo(f.x,f.y),o.lineTo(v.x,v.y),f=u.pixelToCanvas(t.element,d.handles.start2),v=u.pixelToCanvas(t.element,d.handles.end2),o.moveTo(f.x,f.y),o.lineTo(v.x,v.y),o.stroke(),(0,M.default)(o,t,d.handles),o.fillStyle=a;var h=(Math.ceil(d.handles.start.x)-Math.ceil(d.handles.end.x))*t.image.columnPixelSpacing,x=(Math.ceil(d.handles.start.y)-Math.ceil(d.handles.end.y))*t.image.rowPixelSpacing,C=(Math.ceil(d.handles.start2.x)-Math.ceil(d.handles.end2.x))*t.image.columnPixelSpacing,b=(Math.ceil(d.handles.start2.y)-Math.ceil(d.handles.end2.y))*t.image.rowPixelSpacing,I=Math.acos(Math.abs((h*C+x*b)/(Math.sqrt(h*h+x*x)*Math.sqrt(C*C+b*b))));I*=180/Math.PI;var k=(0,m.default)(I,2),$=k.toString()+String.fromCharCode(parseInt("00B0",16)),O=(f.x+v.x)/2,D=(f.y+v.y)/2;o.font=l,(0,g.default)(o,$,O,D,a),o.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.angleTouch=t.angle=void 0;var i=n(0),s=n(7),u=o(s),c=n(9),d=o(c),f=n(6),g=o(f),v=n(30),m=o(v),h=n(5),p=o(h),x=n(14),T=o(x),C=n(4),y=o(C),b=n(8),M=o(b),P=n(1),w="angle",S=(0,u.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:w}),I=(0,d.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:w});t.angle=S,t.angleTouch=I},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,n){n(prompt("Change your annotation:"))}function l(e){function t(t){null===t?(0,H.removeToolState)(e.element,N,n):n.text=t,n.active=!1,o.updateImage(e.element),g.external.$(e.element).on("CornerstoneToolsMouseMove",a,F.mouseMoveCallback),g.external.$(e.element).on("CornerstoneToolsMouseDown",a,F.mouseDownCallback),g.external.$(e.element).on("CornerstoneToolsMouseDownActivate",a,F.mouseDownActivateCallback),g.external.$(e.element).on("CornerstoneToolsMouseDoubleClick",a,F.mouseDoubleClickCallback)}var n=i(e),o=g.external.cornerstone,a={mouseButtonMask:e.which};(0,H.addToolState)(e.element,N,n),g.external.$(e.element).off("CornerstoneToolsMouseMove",F.mouseMoveCallback),g.external.$(e.element).off("CornerstoneToolsMouseDown",F.mouseDownCallback),g.external.$(e.element).off("CornerstoneToolsMouseDownActivate",F.mouseDownActivateCallback),g.external.$(e.element).off("CornerstoneToolsMouseDoubleClick",F.mouseDoubleClickCallback),o.updateImage(e.element),(0,D.default)(e,N,n,n.handles.end,function(){(0,A.default)(e,n.handles)&&(0,H.removeToolState)(e.element,N,n);var a=F.getConfiguration();void 0===n.text&&a.getTextCallback(t),o.updateImage(e.element)})}function i(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,n){var o=g.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.end)};return g.cornerstoneMath.lineSegment.distanceToPoint(a,n)<25}function u(e,t){var n=(0,H.getToolState)(e.currentTarget,N);if(n){var o=t.enabledElement,a=g.external.cornerstone,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var l=void 0,i=y.default.getToolWidth(),s=M.default.getFont(),u=F.getConfiguration(),c=0;c<n.data.length;c++){r.save(),u&&u.shadow&&(r.shadowColor=u.shadowColor||"#000000",r.shadowOffsetX=u.shadowOffsetX||1,r.shadowOffsetY=u.shadowOffsetY||1);var d=n.data[c];l=d.active?w.default.getActiveColor():w.default.getToolColor();var f=a.pixelToCanvas(t.element,d.handles.start),v=a.pixelToCanvas(t.element,d.handles.end);u.arrowFirst?(0,$.default)(r,v,f,l,i):(0,$.default)(r,f,v,l,i);var m={drawHandlesIfActive:u&&u.drawHandlesOnHover};if(u.drawHandles&&(0,I.default)(r,t,d.handles,l,m),d.text&&""!==d.text){r.font=s;var h=r.measureText(d.text).width+10,p=M.default.getFontSize()+10,x=Math.max(h,p)/2+5;v.x<f.x&&(x=-x);var C=void 0;if(!d.handles.textBox.hasMoved){C=u.arrowFirst?{x:v.x-h/2+x,y:v.y-p/2}:{x:f.x-h/2-x,y:f.y-p/2};var b=a.internal.getTransform(o);b.invert();var P=b.transformPoint(C.x,C.y);d.handles.textBox.x=P.x,d.handles.textBox.y=P.y}C=a.pixelToCanvas(t.element,d.handles.textBox);var S=(0,T.default)(r,d.text,C.x,C.y,l);if(d.handles.textBox.boundingBox=S,d.handles.textBox.hasMoved){var k={start:{},end:{}},O={x:(f.x+v.x)/2,y:(f.y+v.y)/2},D=[f,v,O];k.end.x=C.x,k.end.y=C.y,k.start=g.cornerstoneMath.point.findClosestPoint(D,k.end);var _=[{x:S.left+S.width/2,y:S.top},{x:S.left,y:S.top+S.height/2},{x:S.left+S.width/2,y:S.top+S.height},{x:S.left+S.width,y:S.top+S.height/2}];k.end=g.cornerstoneMath.point.findClosestPoint(_,k.start),r.beginPath(),r.strokeStyle=l,r.lineWidth=i,r.setLineDash([2,3]),r.moveTo(k.start.x,k.start.y),r.lineTo(k.end.x,k.end.y),r.stroke()}}r.restore()}}}function c(e){function t(e){null===e?(0,H.removeToolState)(n,N,o):o.text=e,o.active=!1,a.updateImage(n),g.external.$(n).on("CornerstoneToolsTouchPress",W.pressCallback),g.external.$(n).on("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(n).on("CornerstoneToolsTap",W.tapCallback)}var n=e.element,o=i(e),a=g.external.cornerstone;(0,H.addToolState)(n,N,o),g.external.$(n).off("CornerstoneToolsTouchPress",W.pressCallback),g.external.$(n).off("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(n).off("CornerstoneToolsTap",W.tapCallback),a.updateImage(n),(0,E.default)(e,N,o,o.handles.end,function(){a.updateImage(n),(0,A.default)(e,o.handles)&&(0,H.removeToolState)(n,N,o);var r=F.getConfiguration();void 0===o.text&&r.getTextCallback(t)})}function d(e,t){function n(e,t,n){!0===n?(0,H.removeToolState)(o,N,e):e.text=t,e.active=!1,a.updateImage(o)}var o=t.element,a=g.external.cornerstone,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,L.default)(t.which,e.data.mouseButtonMask)){var l=F.getConfiguration(),i=t.currentPoints.canvas,u=(0,H.getToolState)(o,N);if(u)for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(o,r,i)||(0,V.default)(r.handles.textBox,i))return r.active=!0,a.updateImage(o),l.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1}}function f(e,t){function n(e,t,n){console.log("pressCallback doneChangingTextCallback"),!0===n?(0,H.removeToolState)(o,N,e):e.text=t,e.active=!1,a.updateImage(o),g.external.$(o).on("CornerstoneToolsTouchStart",W.touchStartCallback),g.external.$(o).on("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(o).on("CornerstoneToolsTap",W.tapCallback)}var o=t.element,a=g.external.cornerstone,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,L.default)(t.which,e.data.mouseButtonMask)){var l=F.getConfiguration(),i=t.currentPoints.canvas,u=(0,H.getToolState)(o,N);if(u){if(t.handlePressed)return g.external.$(o).off("CornerstoneToolsTouchStart",W.touchStartCallback),g.external.$(o).off("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(o).off("CornerstoneToolsTap",W.tapCallback),l.changeTextCallback(t.handlePressed,t,n),e.stopImmediatePropagation(),!1;for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(o,r,i)||(0,V.default)(r.handles.textBox,i))return r.active=!0,a.updateImage(o),g.external.$(o).off("CornerstoneToolsTouchStart",W.touchStartCallback),g.external.$(o).off("CornerstoneToolsTouchStartActive",W.touchDownActivateCallback),g.external.$(o).off("CornerstoneToolsTap",W.tapCallback),l.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1;return!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.arrowAnnotateTouch=t.arrowAnnotate=void 0;var g=n(0),v=n(7),m=o(v),h=n(9),p=o(h),x=n(6),T=o(x),C=n(5),y=o(C),b=n(14),M=o(b),P=n(4),w=o(P),S=n(8),I=o(S),k=n(48),$=o(k),O=n(22),D=o(O),_=n(24),E=o(_),j=n(12),A=o(j),B=n(2),L=o(B),R=n(16),V=o(R),H=n(1),N="arrowAnnotate",U={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0},F=(0,m.default)({addNewMeasurement:l,createNewMeasurement:i,onImageRendered:u,pointNearTool:s,toolType:N,mouseDoubleClickCallback:d});F.setConfiguration(U);var W=(0,p.default)({addNewMeasurement:c,createNewMeasurement:i,onImageRendered:u,pointNearTool:s,toolType:N,pressCallback:f});t.arrowAnnotate=F,t.arrowAnnotateTouch=W},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e.stopImmediatePropagation();var n=(0,x.getToolState)(e.currentTarget,b);if(n){var o=m.external.cornerstone,a=e.currentTarget,r=o.getEnabledElement(a),l=r.image.imageId,i=o.metaData.get("imagePlaneModule",l),s=t.currentPoints.image,u=(0,y.imagePointToPatientPoint)(s,i);n.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==a){var t=Number.MAX_VALUE,n=-1,r=(0,x.getToolState)(e,"stack");if(void 0!==r){var l=r.data[0];if(l.imageIds.forEach(function(e,a){var r=o.metaData.get("imagePlaneModule",e),l=r.imagePositionPatient,i=r.rowCosines.clone(),s=r.columnCosines.clone(),c=s.clone().cross(i.clone()),d=Math.abs(c.clone().dot(l)-c.clone().dot(u));d<t&&(t=d,n=a)}),n!==l.currentImageIdIndex&&-1!==n&&void 0!==l.imageIds[n]){var i=p.default.getStartLoadHandler(),s=p.default.getEndLoadHandler(),c=p.default.getErrorLoadingHandler();i&&i(e);var d=void 0;d=!0===l.preventCache?o.loadImage(l.imageIds[n]):o.loadAndCacheImage(l.imageIds[n]),d.then(function(t){var a=o.getViewport(e);l.currentImageIdIndex=n,o.displayImage(e,t,a),s&&s(e,t)},function(t){var o=l.imageIds[n];c&&c(e,o,t)})}}}})}}function r(e,t){m.external.$(t.element).off("CornerstoneToolsMouseDrag",i),m.external.$(t.element).off("CornerstoneToolsMouseUp",r)}function l(e,t){if((0,C.default)(t.which,e.data.mouseButtonMask))return m.external.$(t.element).on("CornerstoneToolsMouseDrag",i),m.external.$(t.element).on("CornerstoneToolsMouseUp",r),a(e,t),!1}function i(e,t){return a(e,t),!1}function s(e,t,n){var o={mouseButtonMask:t};(0,x.clearToolState)(e,b),(0,x.addToolState)(e,b,{synchronizationContext:n}),m.external.$(e).off("CornerstoneToolsMouseDown",l),m.external.$(e).on("CornerstoneToolsMouseDown",o,l)}function u(e){m.external.$(e).off("CornerstoneToolsMouseDown",l)}function c(e,t){m.external.$(t.element).off("CornerstoneToolsTouchDrag",f),m.external.$(t.element).off("CornerstoneToolsDragEnd",c)}function d(e,t){return m.external.$(t.element).on("CornerstoneToolsTouchDrag",f),m.external.$(t.element).on("CornerstoneToolsDragEnd",c),a(e,t),!1}function f(e,t){return a(e,t),!1}function g(e,t){(0,x.clearToolState)(e,b),(0,x.addToolState)(e,b,{synchronizationContext:t}),m.external.$(e).off("CornerstoneToolsTouchStart",d),m.external.$(e).on("CornerstoneToolsTouchStart",d)}function v(e){m.external.$(e).off("CornerstoneToolsTouchStart",d)}Object.defineProperty(t,"__esModule",{value:!0}),t.crosshairsTouch=t.crosshairs=void 0;var m=n(0),h=n(10),p=o(h),x=n(1),T=n(2),C=o(T),y=n(26),b="crosshairs",M={activate:s,deactivate:u,enable:s,disable:u},P={activate:g,deactivate:v,enable:g,disable:v};t.crosshairs=M,t.crosshairsTouch=P},function(e,t,n){"use strict";function o(e){r.external.cornerstone.fitToWindow(e.element)}function a(e,t){return s.strategy(t),!1}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),l=n(54),i=function(e){return e&&e.__esModule?e:{default:e}}(l),s=(0,i.default)(a);s.strategies={default:o},s.strategy=o,t.default=s},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=c.external.cornerstone,n=t.getEnabledElement(e.element),o=n.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);var a=x.default.getActiveColor(),r=h.default.getFont(),l=h.default.getFontSize(),i=k.getConfiguration();o.save(),i&&i.shadow&&(o.shadowColor=i.shadowColor||"#000000",o.shadowOffsetX=i.shadowOffsetX||1,o.shadowOffsetY=i.shadowOffsetY||1);var s=Math.round(e.currentPoints.image.x),u=Math.round(e.currentPoints.image.y),d=void 0,f=void 0,g=void 0;if(!(s<0||u<0||s>=e.image.columns||u>=e.image.rows)){if(e.image.color)d=(0,b.default)(e.element,s,u,1,1),f=s+", "+u,g="R: "+d[0]+" G: "+d[1]+" B: "+d[2]+" A: "+d[3];else{d=t.getStoredPixels(e.element,s,u,1,1);var v=d[0],m=v*e.image.slope+e.image.intercept,p=(0,P.default)(e.image,v);f=s+", "+u,g="SP: "+v+" MO: "+parseFloat(m.toFixed(3)),p&&(g+=" SUV: "+parseFloat(p.toFixed(3)))}var T={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},y=t.pixelToCanvas(e.element,T);o.font=r,o.fillStyle=a,(0,C.default)(o,g,y.x,y.y+l+5,a),(0,C.default)(o,f,y.x,y.y,a),o.restore()}}function r(e){var t=c.external.cornerstone,n=e.element,o=t.getEnabledElement(n),a=o.image,r=o.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);var l=x.default.getActiveColor(),i=h.default.getFont(),s=k.getConfiguration();r.save(),s&&s.shadow&&(r.shadowColor=s.shadowColor||"#000000",r.shadowOffsetX=s.shadowOffsetX||1,r.shadowOffsetY=s.shadowOffsetY||1);var u=t.metaData.get("generalSeriesModule",a.imageId),d=void 0;u&&(d=u.modality);var f=void 0;f=!0===e.isTouchEvent?t.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-4*h.default.getFontSize()):t.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-h.default.getFontSize()/2);var g=void 0,v="";if(!(f.x<0||f.y<0||f.x>=a.columns||f.y>=a.rows)){if(a.color)g=(0,b.default)(n,f.x,f.y,1,1),v="R: "+g[0]+" G: "+g[1]+" B: "+g[2];else{g=t.getStoredPixels(n,f.x,f.y,1,1);var m=g[0],p=m*e.image.slope+e.image.intercept,T=parseFloat(p.toFixed(2));if("CT"===d)v+="HU: "+T;else if("PT"===d){v+=T;var y=(0,P.default)(e.image,m);y&&(v+=" SUV: "+parseFloat(y.toFixed(2)))}else v+=T}var M=t.pixelToCanvas(n,f);r.font=i,r.fillStyle=l;var w=void 0,S=r.measureText(v).width;w=!0===e.isTouchEvent?{x:-S/2-5,y:-h.default.getFontSize()-10-12}:{x:12,y:-(h.default.getFontSize()+10)/2},r.beginPath(),r.strokeStyle=l,r.arc(M.x,M.y,6,0,2*Math.PI),r.stroke(),(0,C.default)(r,v,M.x+w.x,M.y+w.y,l),r.restore()}}function l(e,t){var n=t.element;n.removeEventListener("cornerstoneimagerendered",s),c.external.$(n).off("CornerstoneToolsMouseDrag",u),c.external.$(n).off("CornerstoneToolsMouseUp",l),c.external.$(n).off("CornerstoneToolsMouseClick",l),c.external.cornerstone.updateImage(t.element)}function i(e,t){var n=t.element;if((0,S.default)(t.which,e.data.mouseButtonMask))return n.addEventListener("cornerstoneimagerendered",s),c.external.$(n).on("CornerstoneToolsMouseDrag",u),c.external.$(n).on("CornerstoneToolsMouseUp",l),c.external.$(n).on("CornerstoneToolsMouseClick",l),k.strategy(t),!1}function s(){I&&(k.strategy(I),I=null)}function u(e,t){var n=t.element;return I=t,c.external.cornerstone.updateImage(n),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.dragProbeTouch=t.dragProbe=void 0;var c=n(0),d=n(13),f=o(d),g=n(11),v=o(g),m=n(14),h=o(m),p=n(4),x=o(p),T=n(6),C=o(T),y=n(33),b=o(y),M=n(17),P=o(M),w=n(2),S=o(w),I=void 0,k=(0,f.default)(i);k.strategies={default:a,minimal:r},k.strategy=a;var $={fireOnTouchStart:!0},O=(0,v.default)(u,$);t.dragProbe=k,t.dragProbeTouch=O},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n,o){var a=c.external.cornerstone,r=a.pixelToCanvas(e,t.handles.start),l=a.pixelToCanvas(e,t.handles.end),i={left:Math.min(r.x,l.x)+o/2,top:Math.min(r.y,l.y)+o/2,width:Math.abs(r.x-l.x)-o,height:Math.abs(r.y-l.y)-o},s={left:Math.min(r.x,l.x)-o/2,top:Math.min(r.y,l.y)-o/2,width:Math.abs(r.x-l.x)+o,height:Math.abs(r.y-l.y)+o},u=(0,S.default)(i,n);return!(!(0,S.default)(s,n)||u)}function l(e,t,n){return r(e,t,n,15)}function i(e,t,n){return r(e,t,n,25)}function s(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function u(e,t){var n=(0,D.getToolState)(e.currentTarget,_);if(n){var o=c.external.cornerstone,a=t.image,r=t.element,l=h.default.getToolWidth(),i=E.getConfiguration(),u=t.canvasContext.canvas.getContext("2d"),d=o.metaData.get("generalSeriesModule",a.imageId),f=void 0;d&&(f=d.modality),u.setTransform(1,0,0,1,0,0);for(var g=0;g<n.data.length;g++){u.save();var v=n.data[g];i&&i.shadow&&(u.shadowColor=i.shadowColor||"#000000",u.shadowOffsetX=i.shadowOffsetX||1,u.shadowOffsetY=i.shadowOffsetY||1);var m=x.default.getColorIfActive(v.active),p=o.pixelToCanvas(r,v.handles.start),T=o.pixelToCanvas(r,v.handles.end),y=Math.min(p.x,T.x),M=Math.min(p.y,T.y),w=Math.abs(p.x-T.x),S=Math.abs(p.y-T.y);if(u.beginPath(),u.strokeStyle=m,u.lineWidth=l,(0,P.default)(u,y,M,w,S),u.closePath(),i&&i.drawHandlesOnHover)if(!0===v.active)(0,C.default)(u,t,v.handles,m);else{var I={drawHandlesIfActive:!0};(0,C.default)(u,t,v.handles,m,I)}else(0,C.default)(u,t,v.handles,m);var $=void 0,j=void 0,A=void 0;if(!1===v.invalidated)j=v.meanStdDev,A=v.meanStdDevSUV,$=v.area;else{var B={left:Math.round(Math.min(v.handles.start.x,v.handles.end.x)),top:Math.round(Math.min(v.handles.start.y,v.handles.end.y)),width:Math.round(Math.abs(v.handles.start.x-v.handles.end.x)),height:Math.round(Math.abs(v.handles.start.y-v.handles.end.y))};if(!a.color){var L=o.getPixels(r,B.left,B.top,B.width,B.height);j=(0,k.default)(L,B),"PT"===f&&(A={mean:(0,O.default)(a,(j.mean-a.intercept)/a.slope),stdDev:(0,O.default)(a,(j.stdDev-a.intercept)/a.slope)}),j&&!isNaN(j.mean)&&(v.meanStdDev=j,v.meanStdDevSUV=A)}var R=a.columnPixelSpacing||1,V=a.rowPixelSpacing||1;$=Math.PI*(B.width*R/2)*(B.height*V/2),isNaN($)||(v.area=$),v.invalidated=!1}var H=[];if(j&&void 0!==j.mean){var N="";"CT"===f&&(N=" HU");var U="Mean: "+s(j.mean.toFixed(2))+N,F="StdDev: "+s(j.stdDev.toFixed(2))+N;if(A&&void 0!==A.mean){U+=" SUV: "+s(A.mean.toFixed(2)),F+=" SUV: "+s(A.stdDev.toFixed(2))}H.push(U),H.push(F)}if($){var W=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(W=" pixels"+String.fromCharCode(178));var Y="Area: "+s($.toFixed(2))+W;H.push(Y)}v.handles.textBox.hasMoved||(v.handles.textBox.x=Math.max(v.handles.start.x,v.handles.end.x),v.handles.textBox.y=(v.handles.start.y+v.handles.end.y)/2);var z=o.pixelToCanvas(r,v.handles.textBox),X={centering:{x:!1,y:!0}},q=(0,b.default)(u,H,z.x,z.y,m,X);if(v.handles.textBox.boundingBox=q,v.handles.textBox.hasMoved){var K={start:{},end:{x:z.x,y:z.y}},G=[{x:y+w/2,y:M},{x:y,y:M+S/2},{x:y+w/2,y:M+S},{x:y+w,y:M+S/2}];K.start=c.cornerstoneMath.point.findClosestPoint(G,K.end);var Z=[{x:q.left+q.width/2,y:q.top},{x:q.left,y:q.top+q.height/2},{x:q.left+q.width/2,y:q.top+q.height},{x:q.left+q.width,y:q.top+q.height/2}];K.end=c.cornerstoneMath.point.findClosestPoint(Z,K.start),u.beginPath(),u.strokeStyle=m,u.lineWidth=l,u.setLineDash([2,3]),u.moveTo(K.start.x,K.start.y),u.lineTo(K.end.x,K.end.y),u.stroke()}u.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ellipticalRoiTouch=t.ellipticalRoi=void 0;var c=n(0),d=n(7),f=o(d),g=n(9),v=o(g),m=n(5),h=o(m),p=n(4),x=o(p),T=n(8),C=o(T),y=n(6),b=o(y),M=n(46),P=o(M),w=n(31),S=o(w),I=n(49),k=o(I),$=n(17),O=o($),D=n(1),_="ellipticalRoi",E=(0,f.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:l,toolType:_}),j=(0,v.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:i,toolType:_});t.ellipticalRoi=E,t.ellipticalRoiTouch=j},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,k.getToolState)(e.element,$);if(void 0!==t){var n=D.getConfiguration(),o=t.data[n.currentTool],a={x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,lines:[]};o.handles.length&&o.handles[n.currentHandle-1].lines.push(e.currentPoints.image),o.handles.push(a),n.currentHandle+=1,n.freehand=!1,T.external.cornerstone.updateImage(e.element)}}function r(e,t){var n=(0,k.getToolState)(e.element,$);if(void 0!==n){var o=n.data[t];if(void 0!==o.handles)for(var a=e.currentPoints.canvas,r=0;r<o.handles.length;r++){var l=T.external.cornerstone.pixelToCanvas(e.element,o.handles[r]);if(T.cornerstoneMath.point.distance(l,a)<5)return r}}}function l(e){var t=(0,k.getToolState)(e.element,$);if(t)for(var n=void 0,o=0;o<t.data.length;o++)if(void 0!==(n=r(e,o)))return{handleNearby:n,toolIndex:o}}function i(e,t){if(T.external.$(t.element).off("CornerstoneToolsMouseUp",i),void 0!==(0,k.getToolState)(t.element,$)){var n=D.getConfiguration();t.event.shiftKey||(n.freehand=!1),T.external.cornerstone.updateImage(t.element)}}function s(e,t){var n=(0,k.getToolState)(t.element,$);if(n){var o=D.getConfiguration(),a=n.data[o.currentTool],l=Math.max(t.currentPoints.image.x,0);l=Math.min(l,t.image.width),o.mouseLocation.handles.start.x=l;var i=Math.max(t.currentPoints.image.y,0);i=Math.min(i,t.image.height),o.mouseLocation.handles.start.y=i;var s=o.currentHandle;if(o.modifying&&(a.active=!0,a.highlight=!0,a.handles[s].x=o.mouseLocation.handles.start.x,a.handles[s].y=o.mouseLocation.handles.start.y,s)){var u=a.handles[s-1].lines.length-1,c=a.handles[s-1].lines[u];c.x=o.mouseLocation.handles.start.x,c.y=o.mouseLocation.handles.start.y}if(o.freehand)a.handles[s-1].lines.push(t.currentPoints.image);else{var d=r(t,o.currentTool);void 0!==d&&d<a.handles.length-1&&(o.mouseLocation.handles.start.x=a.handles[d].x,o.mouseLocation.handles.start.y=a.handles[d].y)}T.external.cornerstone.updateImage(t.element)}}function u(e){T.external.$(e.element).on("CornerstoneToolsMouseMove",s),T.external.$(e.element).on("CornerstoneToolsMouseUp",i);var t={visible:!0,active:!0,handles:[]},n=D.getConfiguration();n.mouseLocation.handles.start.x=e.currentPoints.image.x,n.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,k.addToolState)(e.element,$,t);var o=(0,k.getToolState)(e.element,$);n.currentTool=o.data.length-1}function c(e,t){var n=(0,k.getToolState)(e.element,$);if(n){var o=D.getConfiguration(),a=n.data[o.currentTool];a.active=!1,a.highlight=!1,void 0!==t&&a.handles[o.currentHandle-1].lines.push({x:a.handles[t].x,y:a.handles[t].y}),o.modifying&&(o.modifying=!1),o.currentHandle=0,o.currentTool=-1,T.external.$(e.element).off("CornerstoneToolsMouseMove",s),T.external.cornerstone.updateImage(e.element)}}function d(e,t){if((0,I.default)(t.which,e.data.mouseButtonMask)){var n=(0,k.getToolState)(t.element,$),o=void 0,d=void 0,f=D.getConfiguration(),g=f.currentTool;if(f.modifying)return void c(t);if(g<0){var v=l(t);v?(o=v.handleNearby,d=v.toolIndex,void 0!==o&&(T.external.$(t.element).on("CornerstoneToolsMouseMove",s),T.external.$(t.element).on("CornerstoneToolsMouseUp",i),f.modifying=!0,f.currentHandle=o,f.currentTool=d)):(u(t),a(t))}else g>=0&&n.data[g].active&&(o=r(t,g),void 0!==o?c(t,o):t.event.shiftKey?f.freehand=!0:a(t));return!1}}function f(e){var t=e.detail,n=(0,k.getToolState)(e.currentTarget,$);if(void 0!==n){var o=T.external.cornerstone,a=D.getConfiguration(),r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var l=void 0,i=y.default.getToolWidth(),s=M.default.getFillColor(),u=0;u<n.data.length;u++){r.save();var c=n.data[u];c.active?(l=M.default.getActiveColor(),s=M.default.getFillColor()):(l=M.default.getToolColor(),s=M.default.getToolColor());var d=void 0;if(c.handles.length)for(var f=0;f<c.handles.length;f++){d=c.handles[f];var g=o.pixelToCanvas(t.element,d);r.beginPath(),r.strokeStyle=l,r.lineWidth=i,r.moveTo(g.x,g.y);for(var v=0;v<c.handles[f].lines.length;v++){var m=o.pixelToCanvas(t.element,c.handles[f].lines[v]);r.lineTo(m.x,m.y),r.stroke()}var h=o.pixelToCanvas(t.element,a.mouseLocation.handles.start);f===c.handles.length-1&&(!c.active||a.freehand||a.modifying||(r.lineTo(h.x,h.y),r.stroke()))}var p={fill:s};c.active&&(0,w.default)(r,t,a.mouseLocation.handles,l,p),(0,w.default)(r,t,c.handles,l,p),r.restore()}}}function g(e){T.external.$(e).off("CornerstoneToolsMouseDown",d),T.external.$(e).off("CornerstoneToolsMouseUp",i),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstoneimagerendered",f),T.external.cornerstone.updateImage(e)}function v(e){T.external.$(e).off("CornerstoneToolsMouseDown",d),T.external.$(e).off("CornerstoneToolsMouseUp",i),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),T.external.cornerstone.updateImage(e)}function m(e,t){var n={mouseButtonMask:t};T.external.$(e).off("CornerstoneToolsMouseDown",n,d),T.external.$(e).off("CornerstoneToolsMouseUp",i),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstoneimagerendered",f),T.external.$(e).on("CornerstoneToolsMouseDown",n,d),T.external.cornerstone.updateImage(e)}function h(e){T.external.$(e).off("CornerstoneToolsMouseDown",d),T.external.$(e).off("CornerstoneToolsMouseUp",i),T.external.$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstoneimagerendered",f),T.external.cornerstone.updateImage(e)}function p(){return O}function x(e){O=e}Object.defineProperty(t,"__esModule",{value:!0}),t.freehand=void 0;var T=n(0),C=n(5),y=o(C),b=n(4),M=o(b),P=n(8),w=o(P),S=n(2),I=o(S),k=n(1),$="freehand",O={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1},D={enable:g,disable:v,activate:m,deactivate:h,getConfiguration:p,setConfiguration:x};t.freehand=D},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,T.getToolState)(e.event.currentTarget,C);if(!(t&&t.data&&t.data.length>0)){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}}function r(e,t,n){var o=s.external.cornerstone,a=o.pixelToCanvas(e,t.handles.start),r=o.pixelToCanvas(e,t.handles.end),l={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)},i=!1;return n.x>=l.left&&n.x<=l.left+l.width&&n.y>=l.top&&n.y<=l.top+l.height&&(i=!0),i}function l(e,t,n){var o=s.external.cornerstone,a=o.pixelToCanvas(e,t.handles.start),r=o.pixelToCanvas(e,t.handles.end),l={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)};return s.cornerstoneMath.rect.distanceToPoint(l,n)<5}function i(e,t){var n=(0,T.getToolState)(e.currentTarget,C);if(void 0!==n){var o=s.external.cornerstone,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=void 0,l=v.default.getToolWidth();a.save();var i=n.data[0];if(i){r=i.active?h.default.getActiveColor():h.default.getToolColor();var u=o.pixelToCanvas(t.element,i.handles.start),c=o.pixelToCanvas(t.element,i.handles.end),d={left:Math.min(u.x,c.x),top:Math.min(u.y,c.y),width:Math.abs(u.x-c.x),height:Math.abs(u.y-c.y)};a.beginPath(),a.strokeStyle="transparent",a.rect(0,0,a.canvas.clientWidth,a.canvas.clientHeight),a.rect(d.width+d.left,d.top,-d.width,d.height),a.stroke(),a.fillStyle="rgba(0,0,0,0.7)",a.fill(),a.closePath(),a.beginPath(),a.strokeStyle=r,a.lineWidth=l,a.setLineDash([4]),a.strokeRect(d.left,d.top,d.width,d.height),a.setLineDash([]),(0,x.default)(a,t,i.handles,r),a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.highlightTouch=t.highlight=void 0;var s=n(0),u=n(55),c=o(u),d=n(9),f=o(d),g=n(5),v=o(g),m=n(4),h=o(m),p=n(8),x=o(p),T=n(1),C="highlight",y=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:l,pointInsideRect:r,toolType:C},!0),b=(0,f.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:l,pointInsideRect:r,toolType:C},!0);t.highlight=y,t.highlightTouch=b},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=t.image,o=n.stats,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=[];Object.keys(o).forEach(function(e){var t=e+" : "+o[e];r.push(t)}),(0,s.default)(a,r,0,0,"orange"),r.forEach(function(e){console.log(e)})}Object.defineProperty(t,"__esModule",{value:!0});var r=n(23),l=o(r),i=n(6),s=o(i),u=(0,l.default)(a);t.default=u},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n){var o=i.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.end)};return i.cornerstoneMath.lineSegment.distanceToPoint(a,n)<25}function l(e,t){var n=(0,C.getToolState)(e.currentTarget,y);if(n){var o=i.external.cornerstone,a=t.canvasContext.canvas.getContext("2d"),r=t.image,l=t.element;a.setTransform(1,0,0,1,0,0);var s=m.default.getToolWidth(),u=b.getConfiguration(),c=o.metaData.get("imagePlaneModule",r.imageId),d=void 0,f=void 0;c?(d=c.rowPixelSpacing||c.rowImagePixelSpacing,f=c.columnPixelSpacing||c.colImagePixelSpacing):(d=r.rowPixelSpacing,f=r.columnPixelSpacing);for(var v=0;v<n.data.length;v++){a.save(),u&&u.shadow&&(a.shadowColor=u.shadowColor||"#000000",a.shadowOffsetX=u.shadowOffsetX||1,a.shadowOffsetY=u.shadowOffsetY||1);var h=n.data[v],x=p.default.getColorIfActive(h.active),M=o.pixelToCanvas(l,h.handles.start),P=o.pixelToCanvas(l,h.handles.end);a.beginPath(),a.strokeStyle=x,a.lineWidth=s,a.moveTo(M.x,M.y),a.lineTo(P.x,P.y),a.stroke();var w={drawHandlesIfActive:u&&u.drawHandlesOnHover};(0,T.default)(a,t,h.handles,x,w),a.fillStyle=x;var S=(h.handles.end.x-h.handles.start.x)*(d||1),I=(h.handles.end.y-h.handles.start.y)*(f||1),k=Math.sqrt(S*S+I*I);h.length=k;var $=" mm";d&&f||($=" pixels");var O=""+k.toFixed(2)+$;if(!h.handles.textBox.hasMoved){var D={x:Math.max(h.handles.start.x,h.handles.end.x)};D.x===h.handles.start.x?D.y=h.handles.start.y:D.y=h.handles.end.y,h.handles.textBox.x=D.x,h.handles.textBox.y=D.y}var _=o.pixelToCanvas(t.element,h.handles.textBox);_.x+=10;var E={centering:{x:!1,y:!0}},j=(0,g.default)(a,O,_.x,_.y,x,E);if(h.handles.textBox.boundingBox=j,h.handles.textBox.hasMoved){var A={start:{},end:{}},B={x:(M.x+P.x)/2,y:(M.y+P.y)/2},L=[M,P,B];A.end.x=_.x,A.end.y=_.y,A.start=i.cornerstoneMath.point.findClosestPoint(L,A.end);var R=[{x:j.left+j.width/2,y:j.top},{x:j.left,y:j.top+j.height/2},{x:j.left+j.width/2,y:j.top+j.height},{x:j.left+j.width,y:j.top+j.height/2}];A.end=i.cornerstoneMath.point.findClosestPoint(R,A.start),a.beginPath(),a.strokeStyle=x,a.lineWidth=s,a.setLineDash([2,3]),a.moveTo(A.start.x,A.start.y),a.lineTo(A.end.x,A.end.y),a.stroke()}a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.lengthTouch=t.length=void 0;var i=n(0),s=n(7),u=o(s),c=n(9),d=o(c),f=n(6),g=o(f),v=n(5),m=o(v),h=n(4),p=o(h),x=n(8),T=o(x),C=n(1),y="length",b=(0,u.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:y}),M=(0,d.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:y});t.length=b,t.lengthTouch=M},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=t.element;x.external.$(n).off("CornerstoneToolsMouseDrag",u),x.external.$(n).off("CornerstoneToolsMouseUp",a),x.external.$(n).off("CornerstoneToolsMouseClick",a),n.removeEventListener("cornerstonenewimage",i),r(t)}function r(e){x.external.$(e.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function l(e,t){var n=t.element;if((0,M.default)(t.which,e.data.mouseButtonMask))return x.external.$(n).on("CornerstoneToolsMouseDrag",t,u),x.external.$(n).on("CornerstoneToolsMouseUp",t,a),x.external.$(n).on("CornerstoneToolsMouseClick",t,a),S=t.currentPoints,n.addEventListener("cornerstonenewimage",i),c(t),!1}function i(e){var t=e.detail;t.currentPoints=S,c(t)}function s(e,t){var n=t.element;x.external.$(t.element).off("CornerstoneToolsDragEnd",s),x.external.$(t.element).off("CornerstoneToolsTouchEnd",s),n.removeEventListener("cornerstonenewimage",i),r(t)}function u(e,t){return S=t.currentPoints,c(t),!0===t.isTouchEvent&&(x.external.$(t.element).on("CornerstoneToolsDragEnd",s),x.external.$(t.element).on("CornerstoneToolsTouchEnd",s)),!1}function c(e){var t=x.external.$(e.element).find(".magnifyTool").get(0);t||d(e.element);var n=I.getConfiguration(),o=n.magnifySize,a=n.magnificationLevel,r=x.external.$(e.element).find("canvas").not(".magnifyTool").get(0);r.getContext("2d").setTransform(1,0,0,1,0,0);var l=t.getContext("2d");l.setTransform(1,0,0,1,0,0);var i=o/a,s=x.external.cornerstone.pixelToCanvas(e.element,e.currentPoints.image);!0===e.isTouchEvent&&(s.y-=1.25*i),s.x=Math.max(s.x,0),s.x=Math.min(s.x,r.width),s.y=Math.max(s.y,0),s.y=Math.min(s.y,r.height),l.clearRect(0,0,o,o),l.fillStyle="transparent",l.fillRect(0,0,o,o);var u={x:s.x-.5*i,y:s.y-.5*i};"Safari"===w&&(u.x=Math.max(u.x,0),u.y=Math.max(u.y,0)),u.x=Math.min(u.x,r.width),u.y=Math.min(u.y,r.height);var c={x:(r.width-u.x)*a,y:(r.height-u.y)*a};l.drawImage(r,u.x,u.y,r.width-u.x,r.height-u.y,0,0,c.x,c.y),t.style.top=s.y-.5*o+"px",t.style.left=s.x-.5*o+"px",t.style.display="block",document.body.style.cursor="none"}function d(e){if(0===x.external.$(e).find(".magnifyTool").length){var t=document.createElement("canvas");t.classList.add("magnifyTool");var n=I.getConfiguration();t.width=n.magnifySize,t.height=n.magnifySize,t.style.position="absolute",e.appendChild(t)}}function f(e){x.external.$(e).find(".magnifyTool").remove()}function g(e){x.external.$(e).off("CornerstoneToolsMouseDown",l),f(e)}function v(e){if(!w){var t=(0,y.getBrowserInfo)(),n=t.split(" ");w=n[0]}d(e)}function m(e,t){var n={mouseButtonMask:t};x.external.$(e).off("CornerstoneToolsMouseDown",l),x.external.$(e).on("CornerstoneToolsMouseDown",n,l),d(e)}function h(){return P}function p(e){P=e}Object.defineProperty(t,"__esModule",{value:!0}),t.magnifyTouchDrag=t.magnify=void 0;var x=n(0),T=n(11),C=o(T),y=n(19),b=n(2),M=o(b),P={magnifySize:100,magnificationLevel:2},w=void 0,S=void 0,I={enable:v,activate:m,deactivate:g,disable:g,getConfiguration:h,setConfiguration:p},k={fireOnTouchStart:!0,activateCallback:d,disableCallback:f},$=(0,C.default)(u,k);t.magnify=I,t.magnifyTouchDrag=$},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=i.external.cornerstone,n=t.getEnabledElement(e),o=t.metaData.get("imagePlaneModule",n.image.imageId);if(o&&o.rowCosines&&o.columnCosines){var a=u.default.getOrientationString(o.rowCosines),r=u.default.getOrientationString(o.columnCosines),l=u.default.invertOrientationString(a);return{top:u.default.invertOrientationString(r),bottom:r,left:l,right:a}}}function r(e){var t=i.external.cornerstone,n=t.getEnabledElement(e),o=void 0;o={x:n.image.width/2,y:5};var a=t.pixelToCanvas(e,o);o={x:n.image.width/2,y:n.image.height-5};var r=t.pixelToCanvas(e,o);o={x:5,y:n.image.height/2};var l=t.pixelToCanvas(e,o);return o={x:n.image.width-10,y:n.image.height/2},{top:a,bottom:r,left:l,right:t.pixelToCanvas(e,o)}}function l(e,t){var n=t.element,o=a(n);if(o){var l=r(n,o),i=t.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);var s=g.default.getToolColor(),u={top:i.measureText(o.top).width,left:i.measureText(o.left).width,right:i.measureText(o.right).width,bottom:i.measureText(o.bottom).width};(0,m.default)(i,o.top,l.top.x-u.top/2,l.top.y,s),(0,m.default)(i,o.left,l.left.x-u.left/2,l.left.y,s);var c=h.getConfiguration();c&&c.drawAllMarkers&&((0,m.default)(i,o.right,l.right.x-u.right/2,l.right.y,s),(0,m.default)(i,o.bottom,l.bottom.x-u.bottom/2,l.bottom.y,s))}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(41),u=o(s),c=n(23),d=o(c),f=n(4),g=o(f),v=n(6),m=o(v),h=(0,d.default)(l);t.default=h},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){i.external.$(t.element).off("CornerstoneToolsMouseDrag",l),i.external.$(t.element).off("CornerstoneToolsMouseUp",a),i.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,g.default)(t.which,e.data.mouseButtonMask))return i.external.$(t.element).on("CornerstoneToolsMouseDrag",l),i.external.$(t.element).on("CornerstoneToolsMouseUp",a),i.external.$(t.element).on("CornerstoneToolsMouseClick",a),!1}function l(e,t){var n=t.viewport.scale,o=t.viewport.scale;return t.image.rowPixelSpacing<t.image.columnPixelSpacing?n*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(o*=t.image.rowPixelSpacing/t.image.columnPixelSpacing),t.viewport.translation.x+=t.deltaPoints.page.x/n,t.viewport.translation.y+=t.deltaPoints.page.y/o,i.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.panTouchDrag=t.pan=void 0;var i=n(0),s=n(13),u=o(s),c=n(11),d=o(c),f=n(2),g=o(f),v=(0,u.default)(r),m=(0,d.default)(l);t.pan=v,t.panTouchDrag=m},function(e,t,n){"use strict";function o(e,t){var n=s.getConfiguration();if(n&&n.testPointers(t))return t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,a.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),r=n(28),l=function(e){return e&&e.__esModule?e:{default:e}}(r),i={testPointers:function(e){return e.numPointers>=2}},s=(0,l.default)(o);s.setConfiguration(i),t.default=s},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function r(e,t,n){var o=i.external.cornerstone.pixelToCanvas(e,t.handles.end);return i.cornerstoneMath.point.distance(o,n)<5}function l(e,t){var n=(0,P.getToolState)(e.currentTarget,w);if(n){var o=i.external.cornerstone,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r=void 0,l=m.default.getFont(),s=m.default.getFontSize(),u=0;u<n.data.length;u++){a.save();var c=n.data[u];r=c.active?g.default.getActiveColor():g.default.getToolColor(),(0,p.default)(a,t,c.handles,r);var d=Math.round(c.handles.end.x),f=Math.round(c.handles.end.y),v=void 0,h=void 0,x=void 0;if(d<0||f<0||d>=t.image.columns||f>=t.image.rows)return;if(t.image.color)h=d+", "+f,v=(0,y.default)(t.element,d,f,1,1),x="R: "+v[0]+" G: "+v[1]+" B: "+v[2];else{v=o.getStoredPixels(t.element,d,f,1,1);var C=v[0],b=C*t.image.slope+t.image.intercept,S=(0,M.default)(t.image,C);h=d+", "+f,x="SP: "+C+" MO: "+parseFloat(b.toFixed(3)),S&&(x+=" SUV: "+parseFloat(S.toFixed(3)))}var I={x:c.handles.end.x+3,y:c.handles.end.y-3},k=o.pixelToCanvas(t.element,I);a.font=l,a.fillStyle=r,(0,T.default)(a,x,k.x,k.y+s+5,r),(0,T.default)(a,h,k.x,k.y,r),a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.probeTouch=t.probe=void 0;var i=n(0),s=n(7),u=o(s),c=n(9),d=o(c),f=n(4),g=o(f),v=n(14),m=o(v),h=n(8),p=o(h),x=n(6),T=o(x),C=n(33),y=o(C),b=n(17),M=o(b),P=n(1),w="probe",S=(0,u.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:w}),I=(0,d.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:w});t.probe=S,t.probeTouch=I},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n){var o=u.external.cornerstone,a=o.pixelToCanvas(e,t.handles.start),r=o.pixelToCanvas(e,t.handles.end),l={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)};return u.cornerstoneMath.rect.distanceToPoint(l,n)<5}function l(e,t){for(var n=0,o=0,a=0,r=0,l=t.top;l<t.top+t.height;l++)for(var i=t.left;i<t.left+t.width;i++)n+=e[r],o+=e[r]*e[r],a++,r++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var s=n/a,u=o/a-s*s;return{count:a,mean:s,variance:u,stdDev:Math.sqrt(u)}}function i(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function s(e,t){var n=(0,P.getToolState)(e.currentTarget,w);if(n){var o=u.external.cornerstone,a=t.image,r=t.element,s=m.default.getToolWidth(),c=S.getConfiguration(),d=t.canvasContext.canvas.getContext("2d"),f=o.metaData.get("generalSeriesModule",a.imageId),g=void 0;f&&(g=f.modality),d.setTransform(1,0,0,1,0,0);for(var v=0;v<n.data.length;v++){d.save();var h=n.data[v];c&&c.shadow&&(d.shadowColor=c.shadowColor||"#000000",d.shadowOffsetX=c.shadowOffsetX||1,d.shadowOffsetY=c.shadowOffsetY||1);var x=p.default.getColorIfActive(h.active),C=o.pixelToCanvas(r,h.handles.start),b=o.pixelToCanvas(r,h.handles.end),I=Math.min(C.x,b.x),k=Math.min(C.y,b.y),$=Math.abs(C.x-b.x),O=Math.abs(C.y-b.y);if(d.beginPath(),d.strokeStyle=x,d.lineWidth=s,d.rect(I,k,$,O),d.stroke(),c&&c.drawHandlesOnHover)if(!0===h.active)(0,T.default)(d,t,h.handles,x);else{var D={drawHandlesIfActive:!0};(0,T.default)(d,t,h.handles,x,D)}else(0,T.default)(d,t,h.handles,x);var _=void 0,E=void 0,j=void 0;if(!1===h.invalidated)E=h.meanStdDev,j=h.meanStdDevSUV,_=h.area;else{var A={left:Math.min(h.handles.start.x,h.handles.end.x),top:Math.min(h.handles.start.y,h.handles.end.y),width:Math.abs(h.handles.start.x-h.handles.end.x),height:Math.abs(h.handles.start.y-h.handles.end.y)};if(!a.color){E=l(o.getPixels(r,A.left,A.top,A.width,A.height),A),"PT"===g&&(j={mean:(0,M.default)(a,(E.mean-a.intercept)/a.slope),stdDev:(0,M.default)(a,(E.stdDev-a.intercept)/a.slope)}),E&&!isNaN(E.mean)&&(h.meanStdDev=E,h.meanStdDevSUV=j)}_=A.width*(a.columnPixelSpacing||1)*(A.height*(a.rowPixelSpacing||1)),isNaN(_)||(h.area=_),h.invalidated=!1}var B=[];if(E&&E.mean){var L="";"CT"===g&&(L=" HU");var R="Mean: "+i(E.mean.toFixed(2))+L,V="StdDev: "+i(E.stdDev.toFixed(2))+L;if(j&&void 0!==j.mean){R+=" SUV: "+i(j.mean.toFixed(2)),V+=" SUV: "+i(j.stdDev.toFixed(2))}B.push(R),B.push(V)}if(_){var H=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(H=" pixels"+String.fromCharCode(178));var N="Area: "+i(_.toFixed(2))+H;B.push(N)}h.handles.textBox.hasMoved||(h.handles.textBox.x=Math.max(h.handles.start.x,h.handles.end.x),h.handles.textBox.y=(h.handles.start.y+h.handles.end.y)/2);var U=o.pixelToCanvas(r,h.handles.textBox),F={centering:{x:!1,y:!0}},W=(0,y.default)(d,B,U.x,U.y,x,F);if(h.handles.textBox.boundingBox=W,h.handles.textBox.hasMoved){var Y={start:{},end:{x:U.x,y:U.y}},z=[{x:I+$/2,y:k},{x:I,y:k+O/2},{x:I+$/2,y:k+O},{x:I+$,y:k+O/2}];Y.start=u.cornerstoneMath.point.findClosestPoint(z,Y.end);var X=[{x:W.left+W.width/2,y:W.top},{x:W.left,y:W.top+W.height/2},{x:W.left+W.width/2,y:W.top+W.height},{x:W.left+W.width,y:W.top+W.height/2}];Y.end=u.cornerstoneMath.point.findClosestPoint(X,Y.start),d.beginPath(),d.strokeStyle=x,d.lineWidth=s,d.setLineDash([2,3]),d.moveTo(Y.start.x,Y.start.y),d.lineTo(Y.end.x,Y.end.y),d.stroke()}d.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.rectangleRoiTouch=t.rectangleRoi=void 0;var u=n(0),c=n(7),d=o(c),f=n(9),g=o(f),v=n(5),m=o(v),h=n(4),p=o(h),x=n(8),T=o(x),C=n(6),y=o(C),b=n(17),M=o(b),P=n(1),w="rectangleRoi",S=(0,d.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:w}),I=(0,g.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:w});t.rectangleRoi=S,t.rectangleRoiTouch=I},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.element.getBoundingClientRect(e.element),n={x:e.currentPoints.client.x,y:e.currentPoints.client.y},o=e.element.clientWidth,a=e.element.clientHeight,r={x:n.x-t.left-o/2,y:-1*(n.y-t.top-a/2)},l=Math.atan2(r.y,r.x),i=l*(180/Math.PI),s=-1*i+90;e.viewport.rotation=s,c.external.cornerstone.setViewport(e.element,e.viewport)}function r(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,c.external.cornerstone.setViewport(e.element,e.viewport)}function l(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,c.external.cornerstone.setViewport(e.element,e.viewport)}function i(e,t){c.external.$(t.element).off("CornerstoneToolsMouseDrag",u),c.external.$(t.element).off("CornerstoneToolsMouseUp",i),c.external.$(t.element).off("CornerstoneToolsMouseClick",i)}function s(e,t){if((0,h.default)(t.which,e.data.mouseButtonMask))return c.external.$(t.element).on("CornerstoneToolsMouseDrag",u),c.external.$(t.element).on("CornerstoneToolsMouseUp",i),c.external.$(t.element).on("CornerstoneToolsMouseClick",i),!1}function u(e,t){return p.strategy(t),c.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.rotateTouchDrag=t.rotate=void 0;var c=n(0),d=n(13),f=o(d),g=n(11),v=o(g),m=n(2),h=o(m),p=(0,f.default)(s);p.strategies={default:a,horizontal:r,vertical:l},p.strategy=a;var x=(0,v.default)(u);t.rotate=p,t.rotateTouchDrag=x},function(e,t,n){"use strict";function o(e,t){return t.viewport.rotation+=t.rotation,l.external.cornerstone.setViewport(t.element,t.viewport),!1}function a(e){l.external.$(e).off("CornerstoneToolsTouchRotate",o)}function r(e){l.external.$(e).off("CornerstoneToolsTouchRotate",o),l.external.$(e).on("CornerstoneToolsTouchRotate",o)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),i={activate:r,disable:a};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){n=n||"image/png";var a=o.external.$(e).find("canvas").get(0),r=document.createElement("a");if(r.download=t,r.href=a.toDataURL(n),document.createEvent){var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(l)}else r.fireEvent&&r.fireEvent("onclick")};var o=n(0)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,n){n(prompt("Change your annotation:"))}function l(e){function t(e){null===e?(0,R.removeToolState)(o,V,r):r.text=e,r.active=!1,n.updateImage(o)}var n=g.external.cornerstone,o=e.element,a=N.getConfiguration(),r=i(e);(0,R.addToolState)(o,V,r),n.updateImage(o),(0,$.default)(e,V,r,r.handles.end,function(){(0,I.default)(e,r.handles)&&(0,R.removeToolState)(o,V,r),void 0===r.text&&a.getTextCallback(t),n.updateImage(o)})}function i(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,n){if(t.handles.end){var o=g.external.cornerstone.pixelToCanvas(e,t.handles.end);return g.cornerstoneMath.point.distance(o,n)<25}}function u(e,t){var n=(0,R.getToolState)(e.currentTarget,V);if(n){var o=g.external.cornerstone,a=t.enabledElement,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var l=t.canvasContext.canvas.width,i=void 0,s=M.default.getToolWidth(),u=y.default.getFont(),c=N.getConfiguration(),d=0;d<n.data.length;d++){r.save(),c&&c.shadow&&(r.shadowColor=c.shadowColor||"#000000",r.shadowOffsetX=c.shadowOffsetX||1,r.shadowOffsetY=c.shadowOffsetY||1);var f=n.data[d];i=f.active?w.default.getActiveColor():w.default.getToolColor();var v=o.pixelToCanvas(t.element,f.handles.end);(0,E.default)(r,v,i,s);var m={drawHandlesIfActive:c&&c.drawHandlesOnHover};if(c.drawHandles&&(0,D.default)(r,t,v,i,m),f.text&&""!==f.text){r.font=u;var h="";h=c.showCoordinates?f.text+" x: "+Math.round(f.handles.end.x)+" y: "+Math.round(f.handles.end.y):f.text;var p=r.measureText(h).width+10,x=y.default.getFontSize()+10,C=Math.max(p,x)/2+5;v.x>l/2&&(C=-C);var b=void 0;if(!f.handles.textBox.hasMoved){b={x:v.x-p/2+C,y:v.y-x/2};var P=o.internal.getTransform(a);P.invert();var S=P.transformPoint(b.x,b.y);f.handles.textBox.x=S.x,f.handles.textBox.y=S.y}b=o.pixelToCanvas(t.element,f.handles.textBox);var I=(0,T.default)(r,h,b.x,b.y,i);if(f.handles.textBox.boundingBox=I,f.handles.textBox.hasMoved){var k={start:{},end:{}};k.end.x=b.x,k.end.y=b.y,k.start=v;var $=[{x:I.left+I.width/2,y:I.top},{x:I.left,y:I.top+I.height/2},{x:I.left+I.width/2,y:I.top+I.height},{x:I.left+I.width,y:I.top+I.height/2}];k.end=g.cornerstoneMath.point.findClosestPoint($,k.start),r.beginPath(),r.strokeStyle=i,r.lineWidth=s,r.setLineDash([2,3]),r.moveTo(k.start.x,k.start.y),r.lineTo(k.end.x,k.end.y),r.stroke()}}r.restore()}}}function c(e){function t(e){null===e?(0,R.removeToolState)(o,V,r):r.text=e,r.active=!1,n.updateImage(o)}var n=g.external.cornerstone,o=e.element,a=N.getConfiguration(),r=i(e);(0,R.addToolState)(o,V,r),n.updateImage(o),(0,$.default)(e,V,r,r.handles.end,function(){(0,I.default)(e,r.handles)&&(0,R.removeToolState)(o,V,r),void 0===r.text&&a.getTextCallback(t),n.updateImage(o)})}function d(e,t){function n(e,t,n){!0===n?(0,R.removeToolState)(a,V,e):e.text=t,e.active=!1,o.updateImage(a)}var o=g.external.cornerstone,a=t.element,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,A.default)(t.which,e.data.mouseButtonMask)){var l=N.getConfiguration(),i=t.currentPoints.canvas,u=(0,R.getToolState)(a,V);if(u){for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(a,r,i)||(0,L.default)(r.handles.textBox,i))return r.active=!0,o.updateImage(a),l.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1;return!1}}}function f(e,t){function n(e,t,n){console.log("pressCallback doneChangingTextCallback"),!0===n?(0,R.removeToolState)(a,V,e):e.text=t,e.active=!1,o.updateImage(a),g.external.$(a).on("CornerstoneToolsTouchStart",U.touchStartCallback),g.external.$(a).on("CornerstoneToolsTouchStartActive",U.touchDownActivateCallback),g.external.$(a).on("CornerstoneToolsTap",U.tapCallback)}var o=g.external.cornerstone,a=t.element,r=void 0;if(e.data&&e.data.mouseButtonMask&&!(0,A.default)(t.which,e.data.mouseButtonMask))return!1;var l=N.getConfiguration(),i=t.currentPoints.canvas,u=(0,R.getToolState)(a,V);if(!u)return!1;if(t.handlePressed)return g.external.$(a).off("CornerstoneToolsTouchStart",U.touchStartCallback),g.external.$(a).off("CornerstoneToolsTouchStartActive",U.touchDownActivateCallback),g.external.$(a).off("CornerstoneToolsTap",U.tapCallback),l.changeTextCallback(t.handlePressed,t,n),e.stopImmediatePropagation(),!1;for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(a,r,i)||(0,L.default)(r.handles.textBox,i))return r.active=!0,o.updateImage(a),g.external.$(a).off("CornerstoneToolsTouchStart",U.touchStartCallback),g.external.$(a).off("CornerstoneToolsTouchStartActive",U.touchDownActivateCallback),g.external.$(a).off("CornerstoneToolsTap",U.tapCallback),l.changeTextCallback(r,t,n),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.seedAnnotateTouch=t.seedAnnotate=void 0;var g=n(0),v=n(7),m=o(v),h=n(9),p=o(h),x=n(6),T=o(x),C=n(14),y=o(C),b=n(5),M=o(b),P=n(4),w=o(P),S=n(12),I=o(S),k=n(21),$=o(k),O=n(8),D=o(O),_=n(47),E=o(_),j=n(2),A=o(j),B=n(16),L=o(B),R=n(1),V="seedAnnotate",H={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,currentLetter:"A",currentNumber:0,showCoordinates:!0,countUp:!0},N=(0,m.default)({addNewMeasurement:l,createNewMeasurement:i,onImageRendered:u,pointNearTool:s,toolType:V,mouseDoubleClickCallback:d});N.setConfiguration(H);var U=(0,p.default)({addNewMeasurement:c,createNewMeasurement:i,onImageRendered:u,pointNearTool:s,toolType:V,pressCallback:f});t.seedAnnotate=N,t.seedAnnotateTouch=U},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,n){var o=c.external.cornerstone,a={start:o.pixelToCanvas(e,t.handles.start),end:o.pixelToCanvas(e,t.handles.middle)},r=c.cornerstoneMath.lineSegment.distanceToPoint(a,n);return r<25||(a.start=o.pixelToCanvas(e,t.handles.middle),a.end=o.pixelToCanvas(e,t.handles.end),(r=c.cornerstoneMath.lineSegment.distanceToPoint(a,n))<25)}function l(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function i(e,t){var n=(0,E.getToolState)(e.currentTarget,j);if(n){var o=c.external.cornerstone,a=t.enabledElement,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var i=void 0,s=C.default.getToolWidth(),u=x.default.getFont(),d=A.getConfiguration(),f=0;f<n.data.length;f++){r.save(),d&&d.shadow&&(r.shadowColor=d.shadowColor||"#000000",r.shadowOffsetX=d.shadowOffsetX||1,r.shadowOffsetY=d.shadowOffsetY||1);var g=n.data[f];i=g.active?b.default.getActiveColor():b.default.getToolColor();var m=o.pixelToCanvas(t.element,g.handles.start),p=o.pixelToCanvas(t.element,g.handles.middle),T=o.pixelToCanvas(t.element,g.handles.end);r.beginPath(),r.strokeStyle=i,r.lineWidth=s,r.moveTo(m.x,m.y),r.lineTo(p.x,p.y),r.lineTo(T.x,T.y),r.stroke();var y={drawHandlesIfActive:d&&d.drawHandlesOnHover};(0,O.default)(r,t,g.handles,i,y),r.fillStyle=i;var M=t.image.columnPixelSpacing||1,P=t.image.rowPixelSpacing||1,w="";t.image.rowPixelSpacing&&t.image.columnPixelSpacing||(w=" (isotropic)");var S={x:(Math.ceil(g.handles.middle.x)-Math.ceil(g.handles.start.x))*M,y:(Math.ceil(g.handles.middle.y)-Math.ceil(g.handles.start.y))*P},I={x:(Math.ceil(g.handles.end.x)-Math.ceil(g.handles.middle.x))*M,y:(Math.ceil(g.handles.end.y)-Math.ceil(g.handles.middle.y))*P},k={x:(Math.ceil(g.handles.end.x)-Math.ceil(g.handles.start.x))*M,y:(Math.ceil(g.handles.end.y)-Math.ceil(g.handles.start.y))*P},$=l(S),D=l(I),_=l(k),B=Math.acos((Math.pow($,2)+Math.pow(D,2)-Math.pow(_,2))/(2*$*D));B*=180/Math.PI;var L=(0,h.default)(B,2);if(L){var R=L.toString()+String.fromCharCode(parseInt("00B0",16))+w,V=void 0;if(g.handles.textBox.hasMoved)V=o.pixelToCanvas(t.element,g.handles.textBox);else{V={x:p.x,y:p.y},r.font=u;var H=r.measureText(R).width;p.x<m.x?V.x-=15+H+10:V.x+=15;var N=o.internal.getTransform(a);N.invert();var U=N.transformPoint(V.x,V.y);g.handles.textBox.x=U.x,g.handles.textBox.y=U.y}var F={centering:{x:!1,y:!0}},W=(0,v.default)(r,R,V.x,V.y,i,F);if(g.handles.textBox.boundingBox=W,g.handles.textBox.hasMoved){var Y={start:{},end:{}},z=[m,T,p];Y.end.x=V.x,Y.end.y=V.y,Y.start=c.cornerstoneMath.point.findClosestPoint(z,Y.end);var X=[{x:W.left+W.width/2,y:W.top},{x:W.left,y:W.top+W.height/2},{x:W.left+W.width/2,y:W.top+W.height},{x:W.left+W.width,y:W.top+W.height/2}];Y.end=c.cornerstoneMath.point.findClosestPoint(X,Y.start),r.beginPath(),r.strokeStyle=i,r.lineWidth=s,r.setLineDash([2,3]),r.moveTo(Y.start.x,Y.start.y),r.lineTo(Y.end.x,Y.end.y),r.stroke()}}r.restore()}}}function s(e){var t=c.external.cornerstone,n=a(e),o=e.element,r={mouseButtonMask:e.which};(0,E.addToolState)(o,j,n),c.external.$(o).off("CornerstoneToolsMouseMove",A.mouseMoveCallback),c.external.$(o).off("CornerstoneToolsMouseDrag",A.mouseMoveCallback),c.external.$(o).off("CornerstoneToolsMouseDown",A.mouseDownCallback),c.external.$(o).off("CornerstoneToolsMouseDownActivate",A.mouseDownActivateCallback),t.updateImage(o),(0,S.default)(e,j,n,n.handles.middle,function(){if(n.active=!1,(0,P.default)(e,n.handles))return(0,E.removeToolState)(o,j,n),c.external.$(o).on("CornerstoneToolsMouseMove",A.mouseMoveCallback),c.external.$(o).on("CornerstoneToolsMouseDrag",A.mouseMoveCallback),c.external.$(o).on("CornerstoneToolsMouseDown",r,A.mouseDownCallback),c.external.$(o).on("CornerstoneToolsMouseDownActivate",r,A.mouseDownActivateCallback),void t.updateImage(o);n.handles.end.active=!0,t.updateImage(o),(0,S.default)(e,j,n,n.handles.end,function(){n.active=!1,(0,P.default)(e,n.handles)&&(0,E.removeToolState)(o,j,n),c.external.$(o).on("CornerstoneToolsMouseMove",A.mouseMoveCallback),c.external.$(o).on("CornerstoneToolsMouseDrag",A.mouseMoveCallback),c.external.$(o).on("CornerstoneToolsMouseDown",r,A.mouseDownCallback),c.external.$(o).on("CornerstoneToolsMouseDownActivate",r,A.mouseDownActivateCallback),t.updateImage(o)})})}function u(e){var t=c.external.cornerstone,n=a(e),o=e.element;(0,E.addToolState)(o,j,n),c.external.$(o).off("CornerstoneToolsTouchDrag",B.touchMoveCallback),c.external.$(o).off("CornerstoneToolsTouchStartActive",B.touchDownActivateCallback),c.external.$(o).off("CornerstoneToolsTouchStart",B.touchStartCallback),c.external.$(o).off("CornerstoneToolsTap",B.tapCallback),t.updateImage(o),(0,k.default)(e,j,n,n.handles.middle,function(){if((0,P.default)(e,n.handles))return(0,E.removeToolState)(o,j,n),c.external.$(o).on("CornerstoneToolsTouchDrag",B.touchMoveCallback),c.external.$(o).on("CornerstoneToolsTouchStart",B.touchStartCallback),c.external.$(o).on("CornerstoneToolsTouchStartActive",B.touchDownActivateCallback),c.external.$(o).on("CornerstoneToolsTap",B.tapCallback),void t.updateImage(o);(0,k.default)(e,j,n,n.handles.end,function(){(0,P.default)(e,n.handles)&&((0,E.removeToolState)(o,j,n),t.updateImage(o)),c.external.$(o).on("CornerstoneToolsTouchDrag",B.touchMoveCallback),c.external.$(o).on("CornerstoneToolsTouchStart",B.touchStartCallback),c.external.$(o).on("CornerstoneToolsTouchStartActive",B.touchDownActivateCallback),c.external.$(o).on("CornerstoneToolsTap",B.tapCallback)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleAngleTouch=t.simpleAngle=void 0;var c=n(0),d=n(7),f=o(d),g=n(6),v=o(g),m=n(30),h=o(m),p=n(14),x=o(p),T=n(5),C=o(T),y=n(4),b=o(y),M=n(12),P=o(M),w=n(22),S=o(w),I=n(24),k=o(I),$=n(8),O=o($),D=n(9),_=o(D),E=n(1),j="simpleAngle",A=(0,f.default)({createNewMeasurement:a,addNewMeasurement:s,onImageRendered:i,pointNearTool:r,toolType:j}),B=(0,_.default)({createNewMeasurement:a,addNewMeasurement:u,onImageRendered:i,pointNearTool:r,toolType:j});t.simpleAngle=A,t.simpleAngleTouch=B},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=P.getConfiguration();if(t.current){var n={visible:!0,active:!0,text:t.current,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},o={left:0,top:0,width:e.image.width,height:e.image.height};if(u.cornerstoneMath.point.insideRect(n.handles.end,o)){var a=t.markers.indexOf(t.current);return t.ascending?(a+=1)>=t.markers.length&&(t.loop?a-=t.markers.length:a=-1):(a-=1)<0&&(t.loop?a+=t.markers.length:a=-1),t.current=t.markers[a],n}}}function r(e,t,n){if(t.handles.end.boundingBox){var o=u.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),a=(0,m.default)(t.handles.end,n);return o<10||a}}function l(e,t){var n=(0,b.getToolState)(t.element,M);if(n){var o=t.canvasContext.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);for(var a=P.getConfiguration(),r=0;r<n.data.length;r++){var l=n.data[r],i=p.default.getToolColor();l.active&&(i=p.default.getActiveColor()),o.save(),a&&a.shadow&&(o.shadowColor=a.shadowColor||"#000000",o.shadowOffsetX=a.shadowOffsetX||1,o.shadowOffsetY=a.shadowOffsetY||1),o.fillStyle=i;var s=o.measureText(l.text);l.textWidth=s.width+10;var c=u.external.cornerstone.pixelToCanvas(t.element,l.handles.end),d={centering:{x:!0,y:!0}},f=(0,y.default)(o,l.text,c.x,c.y-10,i,d);l.handles.end.boundingBox=f,o.restore()}}}function i(e,t){function n(t,n,r){!0===r?(0,b.removeToolState)(a,M,t):t.text=n,t.active=!1,o.updateImage(a);var l={mouseButtonMask:e.data.mouseButtonMask};u.external.$(a).on("CornerstoneToolsMouseMove",l,P.mouseMoveCallback),u.external.$(a).on("CornerstoneToolsMouseDown",l,P.mouseDownCallback),u.external.$(a).on("CornerstoneToolsMouseDownActivate",l,P.mouseDownActivateCallback),u.external.$(a).on("CornerstoneToolsMouseDoubleClick",l,P.mouseDoubleClickCallback)}var o=u.external.cornerstone,a=t.element,l=void 0;if(!e.data||!e.data.mouseButtonMask||(0,T.default)(t.which,e.data.mouseButtonMask)){var i=P.getConfiguration(),s=t.currentPoints.canvas,c=(0,b.getToolState)(a,M);if(c){for(var d=0;d<c.data.length;d++)if(l=c.data[d],r(a,l,s))return l.active=!0,o.updateImage(a),u.external.$(a).off("CornerstoneToolsMouseMove",P.mouseMoveCallback),u.external.$(a).off("CornerstoneToolsMouseDown",P.mouseDownCallback),u.external.$(a).off("CornerstoneToolsMouseDownActivate",P.mouseDownActivateCallback),u.external.$(a).off("CornerstoneToolsMouseDoubleClick",P.mouseDoubleClickCallback),i.changeTextCallback(l,t,n),e.stopImmediatePropagation(),!1;return!1}}}function s(e,t){function n(e,t,n){!0===n?(0,b.removeToolState)(a,M,e):e.text=t,e.active=!1,o.updateImage(a),u.external.$(a).on("CornerstoneToolsTouchDrag",w.touchMoveCallback),u.external.$(a).on("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),u.external.$(a).on("CornerstoneToolsTouchStart",w.touchStartCallback),u.external.$(a).on("CornerstoneToolsTap",w.tapCallback),u.external.$(a).on("CornerstoneToolsTouchPress",w.pressCallback)}var o=u.external.cornerstone,a=t.element,l=void 0,i=P.getConfiguration(),s=t.currentPoints.canvas,c=(0,b.getToolState)(a,M);if(!c)return!1;if(t.handlePressed)return t.handlePressed.active=!0,o.updateImage(a),u.external.$(a).off("CornerstoneToolsTouchDrag",w.touchMoveCallback),u.external.$(a).off("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),u.external.$(a).off("CornerstoneToolsTouchStart",w.touchStartCallback),u.external.$(a).off("CornerstoneToolsTap",w.tapCallback),u.external.$(a).off("CornerstoneToolsTouchPress",w.pressCallback),i.changeTextCallback(t.handlePressed,t,n),e.stopImmediatePropagation(),!1;for(var d=0;d<c.data.length;d++)if(l=c.data[d],r(a,l,s))return l.active=!0,o.updateImage(a),u.external.$(a).off("CornerstoneToolsTouchDrag",w.touchMoveCallback),u.external.$(a).off("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),u.external.$(a).off("CornerstoneToolsTouchStart",w.touchStartCallback),u.external.$(a).off("CornerstoneToolsTap",w.tapCallback),u.external.$(a).off("CornerstoneToolsTouchPress",w.pressCallback),i.changeTextCallback(l,t,n),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.textMarkerTouch=t.textMarker=void 0;var u=n(0),c=n(7),d=o(c),f=n(9),g=o(f),v=n(16),m=o(v),h=n(4),p=o(h),x=n(2),T=o(x),C=n(6),y=o(C),b=n(1),M="textMarker",P=(0,d.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:M,mouseDoubleClickCallback:i}),w=(0,g.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:r,toolType:M,pressCallback:s});t.textMarker=P,t.textMarkerTouch=w},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){u.external.$(t.element).off("CornerstoneToolsMouseDrag",i),u.external.$(t.element).off("CornerstoneToolsMouseUp",a),u.external.$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,m.default)(t.which,e.data.mouseButtonMask))return u.external.$(t.element).on("CornerstoneToolsMouseDrag",i),u.external.$(t.element).on("CornerstoneToolsMouseUp",a),u.external.$(t.element).on("CornerstoneToolsMouseClick",a),!1}function l(e){var t=e.image.maxPixelValue*e.image.slope+e.image.intercept,n=e.image.minPixelValue*e.image.slope+e.image.intercept,o=t-n,a=o/1024,r=e.deltaPoints.page.x*a,l=e.deltaPoints.page.y*a;e.viewport.voi.windowWidth+=r,e.viewport.voi.windowCenter+=l}function i(e,t){return h.strategy(t),u.external.cornerstone.setViewport(t.element,t.viewport),!1}function s(e,t){e.stopImmediatePropagation();var n=t,o=n.image.maxPixelValue*n.image.slope+n.image.intercept,a=n.image.minPixelValue*n.image.slope+n.image.intercept,r=o-a,l=r/1024,i=n.deltaPoints.page.x*l,s=n.deltaPoints.page.y*l,c=h.getConfiguration();c.orientation?0===c.orientation?(n.viewport.voi.windowWidth+=i,n.viewport.voi.windowCenter+=s):(n.viewport.voi.windowWidth+=s,n.viewport.voi.windowCenter+=i):(n.viewport.voi.windowWidth+=i,n.viewport.voi.windowCenter+=s),u.external.cornerstone.setViewport(n.element,n.viewport)}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcTouchDrag=t.wwwc=void 0;var u=n(0),c=n(13),d=o(c),f=n(11),g=o(f),v=n(2),m=o(v),h=(0,d.default)(r);h.strategies={default:l},h.strategy=l;var p=(0,g.default)(s);t.wwwc=h,t.wwwcTouchDrag=p},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var o=e.length;if(o<2)return{min:t,max:n,mean:(t+n)/2};for(var a=n,r=t,l=0,i=0;i<o;i++){var s=e[i];a=Math.min(a,s),r=Math.max(r,s),l+=s}return{min:a,max:r,mean:l/o}}function r(e){var t=e.detail,n=(0,P.getToolState)(t.element,$);n&&n.data&&(n.data=[]),T.external.$(t.element).off("CornerstoneToolsMouseMove",d),T.external.$(t.element).off("CornerstoneToolsMouseDrag",d),T.external.$(t.element).off("CornerstoneToolsMouseUp",l),T.external.$(t.element).off("CornerstoneToolsMouseClick",l);var o={mouseButtonMask:D};T.external.$(t.element).on("CornerstoneToolsMouseDown",o,u)}function l(e,t){T.external.$(t.element).off("CornerstoneToolsMouseMove",d),T.external.$(t.element).off("CornerstoneToolsMouseDrag",d),T.external.$(t.element).off("CornerstoneToolsMouseUp",l),T.external.$(t.element).off("CornerstoneToolsMouseClick",l);var n={mouseButtonMask:D};T.external.$(t.element).on("CornerstoneToolsMouseDown",n,u);var o=(0,P.getToolState)(t.element,$);o&&o.data&&o.data.length&&(o.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},i(t))}function i(e){var t=T.external.cornerstone,n=(0,P.getToolState)(e.element,$);if(n&&n.data&&n.data.length){var o=n.data[0].startPoint,r=n.data[0].endPoint,l=Math.abs(o.x-r.x),i=Math.abs(o.y-r.y),s=Math.min(o.x,r.x),u=Math.min(o.y,r.y);s=Math.max(s,0),s=Math.min(s,e.image.width),u=Math.max(u,0),u=Math.min(u,e.image.height),l=Math.floor(Math.min(l,Math.abs(e.image.width-s))),i=Math.floor(Math.min(i,Math.abs(e.image.height-u)));var c=(0,S.default)(e.element,s,u,l,i),d=a(c,e.image.minPixelValue,e.image.maxPixelValue),f=_.getConfiguration(),g=t.getViewport(e.element);void 0===f.minWindowWidth&&(f.minWindowWidth=10),g.voi.windowWidth=Math.max(Math.abs(d.max-d.min),f.minWindowWidth),g.voi.windowCenter=d.mean,t.setViewport(e.element,g),n.data=[],t.updateImage(e.element)}}function s(e,t){var n=t.element;T.external.$(n).off("CornerstoneToolsMouseMove"),T.external.$(n).off("CornerstoneToolsMouseDrag"),T.external.$(n).on("CornerstoneToolsMouseMove",d),T.external.$(n).on("CornerstoneToolsMouseDrag",d),T.external.$(n).on("CornerstoneToolsMouseClick",l),"CornerstoneToolsMouseDrag"===e.type&&T.external.$(n).on("CornerstoneToolsMouseUp",l)}function u(e,t){if((0,k.default)(t.which,e.data.mouseButtonMask))return T.external.$(t.element).on("CornerstoneToolsMouseDrag",t,s),T.external.$(t.element).on("CornerstoneToolsMouseMove",t,s),T.external.$(t.element).off("CornerstoneToolsMouseDown",u),c(t),!1}function c(e){var t=(0,P.getToolState)(e.element,$);t&&t.data&&(t.data=[]);var n={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};(0,P.addToolState)(e.element,$,n)}function d(e,t){var n=(0,P.getToolState)(t.element,$);if(n&&n.data&&n.data.length){var o={x:t.currentPoints.image.x,y:t.currentPoints.image.y};n.data[0].endPoint=o,T.external.cornerstone.updateImage(t.element)}}function f(e){var t=e.detail,n=T.external.cornerstone,o=(0,P.getToolState)(t.element,$);if(o&&o.data&&o.data.length){var a=o.data[0].startPoint,r=o.data[0].endPoint;if(a&&r){var l=T.external.$(t.element).find("canvas").get(0),i=l.getContext("2d");i.setTransform(1,0,0,1,0,0);var s=M.default.getActiveColor(),u=n.pixelToCanvas(t.element,a),c=n.pixelToCanvas(t.element,r),d=Math.min(u.x,c.x),f=Math.min(u.y,c.y),g=Math.abs(u.x-c.x),v=Math.abs(u.y-c.y),m=y.default.getToolWidth(),h=_.getConfiguration();i.save(),h&&h.shadow&&(i.shadowColor=h.shadowColor||"#000000",i.shadowOffsetX=h.shadowOffsetX||1,i.shadowOffsetY=h.shadowOffsetY||1),i.beginPath(),i.strokeStyle=s,i.lineWidth=m,i.rect(d,f,g,v),i.stroke(),i.restore()}}}function g(e){T.external.$(e).off("CornerstoneToolsMouseDown",u),T.external.$(e).off("CornerstoneToolsMouseUp",l),T.external.$(e).off("CornerstoneToolsMouseClick",l),T.external.$(e).off("CornerstoneToolsMouseDrag",d),T.external.$(e).off("CornerstoneToolsMouseMove",d),e.removeEventListener("cornerstoneimagerendered",f),e.removeEventListener("cornerstonenewimage",r),T.external.cornerstone.updateImage(e)}function v(e,t){var n={mouseButtonMask:t};if(D=t,!(0,P.getToolState)(e,$)){var o=[];(0,P.addToolState)(e,$,o)}T.external.$(e).off("CornerstoneToolsMouseDown",u),T.external.$(e).off("CornerstoneToolsMouseUp",l),T.external.$(e).off("CornerstoneToolsMouseClick",l),T.external.$(e).off("CornerstoneToolsMouseDrag",d),T.external.$(e).off("CornerstoneToolsMouseMove",d),e.removeEventListener("cornerstoneimagerendered",f),e.removeEventListener("cornerstonenewimage",r),T.external.$(e).on("CornerstoneToolsMouseDown",n,u),e.addEventListener("cornerstoneimagerendered",f),e.addEventListener("cornerstonenewimage",r),T.external.cornerstone.updateImage(e)}function m(e){T.external.$(e).off("CornerstoneToolsTouchDrag",d),T.external.$(e).off("CornerstoneToolsTouchStart",c),T.external.$(e).off("CornerstoneToolsDragEnd",i),e.removeEventListener("cornerstoneimagerendered",f)}function h(e){if(!(0,P.getToolState)(e,$)){var t=[];(0,P.addToolState)(e,$,t)}T.external.$(e).off("CornerstoneToolsTouchDrag",d),T.external.$(e).off("CornerstoneToolsTouchStart",c),T.external.$(e).off("CornerstoneToolsDragEnd",i),e.removeEventListener("cornerstoneimagerendered",f),T.external.$(e).on("CornerstoneToolsTouchDrag",d),T.external.$(e).on("CornerstoneToolsTouchStart",c),T.external.$(e).on("CornerstoneToolsDragEnd",i),e.addEventListener("cornerstoneimagerendered",f)}function p(){return O}function x(e){O=e}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcRegionTouch=t.wwwcRegion=void 0;var T=n(0),C=n(5),y=o(C),b=n(4),M=o(b),P=n(1),w=n(45),S=o(w),I=n(2),k=o(I),$="wwwcRegion",O={minWindowWidth:10},D=void 0,_={activate:v,deactivate:g,disable:g,setConfiguration:x,getConfiguration:p},E={activate:h,deactivate:m,disable:m};t.wwwcRegion=_,t.wwwcRegionTouch=E},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=I.getConfiguration(),o=Math.log(e.scale)/Math.log(1.7),a=o+t,r=Math.pow(1.7,a);return n.maxScale&&r>n.maxScale?e.scale=n.maxScale:n.minScale&&r<n.minScale?e.scale=n.minScale:e.scale=r,e}function r(e,t,n){return e.x=Math.max(e.x,0),e.y=Math.max(e.y,0),e.x=Math.min(e.x,t),e.y=Math.min(e.y,n),e}function l(e,t){if(t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),0!==t.rotation){var n=t.rotation*Math.PI/180,o=Math.cos(n),a=Math.sin(n),r=e.x*o-e.y*a,l=e.x*a+e.y*o;e.x=r,e.y=l}return e}function i(e,t){var n=m.external.cornerstone,o=e.element,r=a(e.viewport,t);n.setViewport(o,r);var i=n.pageToPixel(o,e.startPoints.page.x,e.startPoints.page.y),s={x:e.startPoints.image.x-i.x,y:e.startPoints.image.y-i.y};s=l(s,r),r.translation.x-=s.x,r.translation.y-=s.y,n.setViewport(o,r)}function s(e,t){var n=e.element,o=e.image,i=I.getConfiguration(),s=a(e.viewport,t),u={x:0,y:0};if(t<0)s.scale<3&&(Math.abs(s.translation.x)<.01?s.translation.x=0:u.x=s.translation.x/8,Math.abs(s.translation.y)<.01?s.translation.y=0:u.y=s.translation.y/8);else{i&&i.preventZoomOutsideImage&&(S.image=r(S.image,o.width,o.height));var c={x:o.width/2-S.image.x,y:o.height/2-S.image.y};c=l(c,s);var d={x:s.translation.x-c.x,y:s.translation.y-c.y};Math.abs(d.x)<.01?s.translation.x=c.x:u.x=d.x/8,Math.abs(d.y)<.01?s.translation.y=c.y:u.y=d.y/8}s.translation.x-=u.x,s.translation.y-=u.y,m.external.cornerstone.setViewport(n,s)}function u(e,t){var n=e.element,o=a(e.viewport,t);m.external.cornerstone.setViewport(n,o)}function c(e,t){m.external.$(t.element).off("CornerstoneToolsMouseDrag",f),m.external.$(t.element).off("CornerstoneToolsMouseUp",c),m.external.$(t.element).off("CornerstoneToolsMouseClick",c)}function d(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask))return S=t.startPoints,m.external.$(t.element).on("CornerstoneToolsMouseDrag",f),m.external.$(t.element).on("CornerstoneToolsMouseUp",c),m.external.$(t.element).on("CornerstoneToolsMouseClick",c),!1}function f(e,t){if(!t.deltaPoints.page.y)return!1;var n=t.deltaPoints.page.y/100;return I.strategy(t,n),!1}function g(e,t){var n=-t.direction/4,o=I.getConfiguration();o&&o.invert&&(n*=-1);var r=a(t.viewport,n);m.external.cornerstone.setViewport(t.element,r)}function v(e,t){var n=m.external.cornerstone,o=I.getConfiguration(),a=t.viewport,r=t.element;a.scale+=t.scaleChange*a.scale,o.maxScale&&a.scale>o.maxScale?a.scale=o.maxScale:o.minScale&&a.scale<o.minScale&&(a.scale=o.minScale),n.setViewport(r,a);var i=n.pageToPixel(r,t.startPoints.page.x,t.startPoints.page.y),s={x:t.startPoints.image.x-i.x,y:t.startPoints.image.y-i.y};s=l(s,a),a.translation.x-=s.x,a.translation.y-=s.y,n.setViewport(r,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=void 0;var m=n(0),h=n(13),p=o(h),x=n(2),T=o(x),C=n(20),y=o(C),b=n(56),M=o(b),P=n(11),w=o(P),S=void 0,I=(0,p.default)(d);I.strategies={default:i,translate:s,zoomToCenter:u},I.strategy=i;var k=(0,y.default)(g),$=(0,M.default)(v),O=(0,w.default)(f);t.zoom=I,t.zoomWheel=k,t.zoomTouchPinch=$,t.zoomTouchDrag=O},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=y.getConfiguration(),n=e.element,o=c.external.cornerstone.getLayer(n,t.brushLayerId),a=o.image,r=a.rows,l=a.columns,i=e.currentPoints.image,s=i.x,u=i.y,f=(0,d.getToolState)(n,p),g=f.data[0].pixelData,v=t.draw,x=t.radius;if(!(s<0||s>l||u<0||u>r)){var T=(0,m.default)(x,r,l,s,u);(0,h.drawBrushPixels)(T,g,v,l),o.invalid=!0,c.external.cornerstone.updateImage(n)}}function r(e,t){T=t.currentPoints.image,C=!1}function l(e,t){a(t),C=!0,T=t.currentPoints.image}function i(e,t){T=t.currentPoints.image,c.external.cornerstone.updateImage(t.element)}function s(e,t){a(t),C=!0,T=t.currentPoints.image}function u(e,t){if(T){var n=t.image,o=n.rows,a=n.columns,r=T,l=r.x,i=r.y;if(!(l<0||l>a||i<0||i>o)){var s=y.getConfiguration(),u=s.radius,c=t.canvasContext,d=C?s.dragColor:s.hoverColor,f=t.element;c.setTransform(1,0,0,1,0,0);var g=(0,m.default)(u,o,a,l,i);(0,h.drawBrushOnCanvas)(g,c,d,f)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.brush=void 0;var c=n(0),d=n(1),f=n(57),g=o(f),v=n(58),m=o(v),h=n(59),p="brush",x={draw:1,radius:3,hoverColor:"green",dragColor:"yellow"},T=void 0,C=!1,y=(0,g.default)({onMouseMove:i,onMouseDown:l,onMouseUp:r,onDrag:s,toolType:"brush",onImageRendered:u});y.setConfiguration(x),t.brush=y},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){var o=I.getConfiguration(),a=o.tolerance,r=Number.MAX_VALUE,l=-Number.MAX_VALUE;e.forEach(function(e){var o=e[1]*n+e[0],a=t[o];r=Math.min(a,r),l=Math.max(a,l)}),P=r-a,M=l+a}function r(e,t,n,o){for(var a=I.getConfiguration(),r=a.draw,l=Math.round(b.x),i=Math.round(b.y),s=null,u=[],c=a.radius;0!==s&&c>a.minRadius;){s=0,u=(0,x.default)(c,n,o,l,i);for(var d=0;d<u.length;d++){var f=u[d][0],g=u[d][1],v=g*o+f,m=e[v];if(m>M||m<P){s++;break}}c--}return 0===s&&(0,T.drawBrushPixels)(u,t,r,o),c}function l(e){var t=I.getConfiguration(),n=e.element,o=g.external.cornerstone.getLayer(n,t.brushLayerId),a=g.external.cornerstone.getLayers(n)[0],l=o.image,i=l.rows,s=l.columns,u=(0,v.getToolState)(n,C),c=u.data[0];w=r(a.image.getPixelData(),c.pixelData,i,s),o.invalid=!0,g.external.cornerstone.updateImage(n)}function i(e){var t=I.getConfiguration(),n=e.element,o=g.external.cornerstone.getLayer(n,t.brushLayerId),a=o.image,r=a.rows,l=a.columns,i=e.currentPoints.image,s=i.x,u=i.y,c=(0,v.getToolState)(n,C),d=c.data[0].pixelData,f=t.draw,m=t.radius;if(!(s<0||s>l||u<0||u>r)){var h=(0,x.default)(m,r,l,s,u);(0,T.drawBrushPixels)(h,d,f,l),o.invalid=!0,g.external.cornerstone.updateImage(n)}}function s(e,t){b=t.currentPoints.image;var n=I.getConfiguration();S=!1,w=n.radius,g.external.cornerstone.updateImage(t.element)}function u(e,t){var n=t.element,o=I.getConfiguration(),r=g.external.cornerstone.getLayer(n,o.brushLayerId),s=g.external.cornerstone.getLayers(n)[0],u=t.currentPoints.image,c=u.x,d=u.y,f=r.image,v=f.rows,m=f.columns,h=(0,x.default)(o.radius,v,m,c,d);0===o.draw?i(t):(a(h,s.image.getPixelData(),m),l(t)),S=!0,b=t.currentPoints.image}function c(e,t){b=t.currentPoints.image,g.external.cornerstone.updateImage(t.element)}function d(e,t){0===y.draw?i(t):l(t),S=!0,b=t.currentPoints.image}function f(e,t){if(b){var n=t.image,o=n.rows,a=n.columns,r=b,l=r.x,i=r.y;if(!(l<0||l>a||i<0||i>o)){var s=I.getConfiguration(),u=t.canvasContext,c=S?s.dragColor:s.hoverColor,d=t.element;w=w||s.radius,u.setTransform(1,0,0,1,0,0);var f=(0,x.default)(w,o,a,l,i);(0,T.drawBrushOnCanvas)(f,u,c,d)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.adaptiveBrush=void 0;var g=n(0),v=n(1),m=n(57),h=o(m),p=n(58),x=o(p),T=n(59),C="brush",y={draw:1,radius:3,tolerance:5,minRadius:1,hoverColor:"green",dragColor:"yellow"},b=void 0,M=void 0,P=void 0,w=void 0,S=void 0,I=(0,h.default)({onMouseMove:c,onMouseDown:u,onMouseUp:s,onDrag:d,toolType:"adaptiveBrush",onImageRendered:f});I.setConfiguration(y),t.adaptiveBrush=I},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(25);Object.defineProperty(t,"regionsThreshold",{enumerable:!0,get:function(){return o(a).default}});var r=n(121);Object.defineProperty(t,"regionsGrow",{enumerable:!0,get:function(){return o(r).default}});var l=n(122);Object.defineProperty(t,"regionsDraw",{enumerable:!0,get:function(){return o(l).default}});var i=n(123);Object.defineProperty(t,"regionsScore",{enumerable:!0,get:function(){return o(i).default}});var s=n(124);Object.defineProperty(t,"regionsUndo",{enumerable:!0,get:function(){return o(s).default}})},function(e,t,n){"use strict";function o(e,t,n,o,a){var r=e*t,l=[a-1,a+1,a-e,a+e],i=Math.floor(a/r);return i<n&&l.push(a+r),i>o&&l.push(a-r),l}function a(e,t,n,a){return new Promise(function(n){function r(){for(var t=0;t<i;t++){if(0===$.length)return n();$.forEach(function(e){M[e]=c});var a=$.map(function(e){return o(v,m,y,b,e)}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e,t,n){return n.indexOf(e)===t}).filter(function(e){return M[e]===k});$=a}u.external.cornerstone.updateImage(e),setTimeout(r,0)}var l=(0,g.getConfiguration)(),i=l.growIterationsPerChunk,c=l.toolRegionValue,d=l.layersAbove,f=l.layersBelow,v=t.width,m=t.height,h=t.buffer,p=s(a,3),x=p[0],T=p[1],C=p[2],y=C+f,b=C-d,M=new Uint8Array(h),P=v*m,w=P*C,S=T*v+x,I=w+S,k=M[I];if(0!==k&&k!==c){var $=[I];r()}})}function r(e,t){var n=t.element;if(console.log("*** e.data (grow.js) ***",e.data),console.log("*** eventData (grow.js) ***",t),(0,f.default)(t.which,e.data.mouseButtonMask)){(0,g.createUndoStep)(n);var o=s((0,c.getToolState)(n,"stack").data,1),r=o[0],l=s((0,c.getToolState)(n,"regions").data,1),i=l[0],u=r.currentImageIdIndex,d=r.imageIds,v=t.currentPoints.image,m=v.x,h=v.y,p=[Math.round(m),Math.round(h),u];a(n,i,d.length,p)}}function l(e,t){var n=(0,c.getToolState)(e,"stack"),o=(0,c.getToolState)(e,"regions");n&&n.data&&n.data.length&&o&&o.data&&o.data.length&&u.external.$(e).on("CornerstoneToolsMouseDown",{mouseButtonMask:t},r)}function i(e){u.external.$(e).off("CornerstoneToolsMouseDown",r)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var l,i=e[Symbol.iterator]();!(o=(l=i.next()).done)&&(n.push(l.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&i.return&&i.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n(0),c=n(1),d=n(2),f=function(e){return e&&e.__esModule?e:{default:e}}(d),g=n(25);t.default={enable:l,disable:i,activate:l,deactivate:i}},function(e,t,n){"use strict";function o(e,t){for(var n=g(e,2),o=n[0],a=n[1],r=!1,l=0,i=t.length-1;l<t.length;i=l++){var s=g(t[l],2),u=s[0],c=s[1],d=g(t[i],2),f=d[0],v=d[1];c>a!=v>a&&o<(f-u)*(a-c)/(v-c)+u&&(r=!r)}return r}function a(e,t){var n=t.canvasContext,o=t.enabledElement,a=t.element;v.external.cornerstone.setToPixelCoordinateSystem(o,n);var r=(0,m.getToolState)(a,C),l=t.canvasContext,i=r.data[0].points;if(!(i.length<2)){var s=i[0],u=s[0],c=s[1];l.fillStyle="rgba(255,255,255,.2)",l.strokeStyle="white",l.beginPath(),l.moveTo(u,c),i.slice(1).forEach(function(e){l.lineTo(e[0],e[1])}),l.closePath(),l.stroke(),l.fill()}}function r(e){var t=T.getConfiguration(),n=t.toolRegionValue,a=t.layersAbove,r=t.layersBelow;T.createUndoStep(e);for(var l=(0,m.getToolState)(e,"stack"),i=(0,m.getToolState)(e,"regions"),s=(0,m.getToolState)(e,C),u=l.data[0].currentImageIdIndex,c=l.data[0].imageIds.length,d=i.data[0],f=s.data[0].points,g=d.buffer,v=d.width,h=d.height,p=Math.max(0,u-a),x=Math.min(c,u+r),b=v*h,M=p*b,P=new Uint8Array(g,M),w=0;w<=x-p;w+=1)for(var S=0;S<v;S+=1)for(var I=0;I<h;I+=1){var k=S+I*v+w*b,$=P[k],O=void 0;O=!y.snap||$>0,O&&o([S,I],f)&&(P[k]=n)}}function l(e,t){v.external.$(t.element).off("CornerstoneToolsMouseDrag",s),v.external.$(t.element).off("CornerstoneToolsMouseUp",l),v.external.$(t.element).off("CornerstoneImageRendered",a),r(t.element),v.external.cornerstone.updateImage(t.element)}function i(e,t){if(console.log("*** e.data (draw.js) ***",e.data),console.log("*** eventData (draw.js) ***",t),(0,p.default)(t.which,e.data.mouseButtonMask)){return(0,m.getToolState)(e.currentTarget,C).data[0].points=[],v.external.$(t.element).on("CornerstoneToolsMouseDrag",s),v.external.$(t.element).on("CornerstoneToolsMouseUp",l),v.external.$(t.element).on("CornerstoneImageRendered",a),s(e,t)}}function s(e,t){e.stopImmediatePropagation();var n=(0,m.getToolState)(e.currentTarget,C);if(n){var o=t.currentPoints.image;return n.data[0].points.push([o.x,o.y]),v.external.cornerstone.updateImage(t.element),!1}}function u(e,t){var n={mouseButtonMask:t};(0,m.clearToolState)(e,C),(0,m.addToolState)(e,C,{points:[]}),v.external.$(e).off("CornerstoneToolsMouseDown",i),v.external.$(e).on("CornerstoneToolsMouseDown",n,i)}function c(e){v.external.$(e).off("CornerstoneToolsMouseDown",i)}function d(){return y}function f(e){y=e}Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var l,i=e[Symbol.iterator]();!(o=(l=i.next()).done)&&(n.push(l.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&i.return&&i.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.getConfiguration=d,t.setConfiguration=f;var v=n(0),m=n(1),h=n(2),p=function(e){return e&&e.__esModule?e:{default:e}}(h),x=n(25),T=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(x),C="drawing",y={snap:!1};t.default={enable:u,disable:c,activate:u,deactivate:c,getConfiguration:d,setConfiguration:f}},function(e,t,n){"use strict";function o(e){return e<130?0:e<200?1:e<300?2:e<400?3:4}function a(e){if(0===e.length)return null;for(var t={},n=e[0],o=1,a=0;a<e.length;a++){var r=e[a];null===t[r]?t[r]=1:t[r]++,t[r]>o&&(n=r,o=t[r])}return n}function r(e){if(0===e.sliceThickness||0===e.pixelSpacing[0]||0===e.pixelSpacing[1])throw new Error("sliceThickness or pixelSpacing was 0");return e.sliceThickness*e.pixelSpacing[0]*e.pixelSpacing[1]}function l(e,t){var n=r(e)/3,a=o(e.maxHU),l=t.length*n,i=(0,d.getConfiguration)(),s=i.KVPToMultiplier,u=s[e.KVP],c=l*a*u;return console.log('modeOverlapFactor", '+e.modeOverlapFactor),console.log("voxels.length: "+t.length),console.log("voxelSizeScaled: "+n),console.log("Volume: "+l),console.log("Max HU: "+e.maxHU),console.log("densityFactor: "+a),console.log("KVPMultiplier: "+u),console.log("CAscore: "+c),e.modeOverlapFactor?c*e.modeOverlapFactor:c}function i(e,t){var n=new c.cornerstoneMath.Vector3;n.fromArray(e[0]);var o=new c.cornerstoneMath.Vector3;o.fromArray(e[1]);var a=new c.cornerstoneMath.Vector3;a.fromArray(t[0]);var r=new c.cornerstoneMath.Vector3;r.fromArray(t[1]);var l=new c.cornerstoneMath.Vector3;l.crossVectors(a,r);var i=n.projectOnVector(l),s=o.projectOnVector(l);return i.distanceTo(s)}function s(e,t){if(e<=0)throw new Error("Distance must be > 0");return e>=t?1:(t+e)/(2*t)}function u(){var e=(0,d.getLastElement)(),t=(0,f.getToolState)(e,"regions"),n=(0,f.getToolState)(e,"stack"),o=n.data[0].imageIds,r=(0,d.getConfiguration)(),u=r.regionColorsRGB,g=(r.KVPToMultiplier,u.slice(1).map(function(){return[]})),v=u.slice(1).map(function(){return-1/0}),m=t.data[0].buffer,h=new Uint8Array(m),p=void 0,x=void 0,T=[],C={},y=o.map(function(e,t){return c.external.cornerstone.loadImage(e).then(function(e){var n=e.data;C.sliceThickness=n.floatString("x00180050"),C.pixelSpacing=n.string("x00280030").split("\\").map(parseFloat),C.KVP=n.floatString("x00180060"),C.rescaleSlope=n.floatString("x00281053"),C.rescaleIntercept=n.floatString("x00281052"),C.rescaleType=n.string("x00281054");var o=(n.floatString("x00201041"),n.string("x00200032").split("\\").map(parseFloat)),r=n.string("x00200037").split("\\").map(parseFloat),l=[r.slice(0,3),r.slice(3)];if("HU"!==C.rescaleType)return void console.warn("Modality LUT does not convert to Hounsfield units but to "+C.rescaleType+". Agatston score is not defined for this unit type.");if(x){var u=i([x,o],l);p=s(u,C.sliceThickness),T.push(p),C.modeOverlapFactor=a(T),x=o}else x=o;for(var c=e.width,d=e.height,f=c*d,m=e.getPixelData(),y=t*f,b=0;b<m.length;b+=1){var M=h[y+b];if(M>1){var P=m[b],w=P*parseInt(C.rescaleSlope)+parseInt(C.rescaleIntercept),S=v[M-2];w>130&&(g[M-2].push(w),w>S&&(v[M-2]=w))}}})});return Promise.all(y).then(function(){return g.map(function(e,t){C.maxHU=v[t];var n=l(C,e);return C.modeOverlapFactor?n*C.modeOverlapFactor:n})})}Object.defineProperty(t,"__esModule",{value:!0}),t.score=u;var c=n(0),d=n(25),f=n(1);t.default=u},function(e,t,n){"use strict";function o(e){console.log("ENABLE UNDO");var t=(0,l.getToolState)(e,"regions"),n=t.data[0];if(!(n.history.length<1)){var o=n.history.pop();console.log("HIST",n.history),n.buffer=o,r.external.cornerstone.updateImage(e)}}function a(e){}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),l=n(1);t.default={activate:o,deactivate:a,enable:o,disable:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="1.1.0"}])});
//# sourceMappingURL=cornerstoneTools.min.js.map