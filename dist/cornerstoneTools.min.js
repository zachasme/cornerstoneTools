/*! cornerstone-tools - 0.8.6 - 2017-06-14 | (c) 2017 Chris Hafey | https://github.com/chafey/cornerstoneTools */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Hammer")):"function"==typeof define&&define.amd?define("cornerstoneTools",["Hammer"],t):"object"==typeof exports?exports.cornerstoneTools=t(require("Hammer")):e.cornerstoneTools=t(e.Hammer)}(this,function(e){return function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=106)}([function(e,t,o){"use strict";function n(e){var t=cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=u.globalImageIdSpecificToolStateManager),t.toolStateManager}function a(e,t,o){n(e).add(e,t,o);var a={toolType:t,element:e,measurementData:o};$(e).trigger("CornerstoneToolsMeasurementAdded",a)}function r(e,t){return n(e).get(e,t)}function i(e,t,o){for(var a=n(e),r=a.get(e,t),i=-1,l=0;l<r.data.length;l++)r.data[l]===o&&(i=l);if(-1!==i){r.data.splice(i,1);var s={toolType:t,element:e,measurementData:o};$(e).trigger("CornerstoneToolsMeasurementRemoved",s)}}function l(e,t){var o=n(e),a=o.get(e,t);void 0!==a&&(a.data=[])}function s(e,t){cornerstone.getEnabledElement(e).toolStateManager=t}Object.defineProperty(t,"__esModule",{value:!0}),t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=void 0;var u=o(14);t.addToolState=a,t.getToolState=r,t.removeToolState=i,t.clearToolState=l,t.setElementToolStateManager=s,t.getElementToolStateManager=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return 0!=(t&1<<e-1)}},function(e,t,o){"use strict";function n(e){f=e}function a(){return f}function r(e){c=e}function i(){return c}function l(e){d=e}function s(){return d}function u(e){return e?d:c}Object.defineProperty(t,"__esModule",{value:!0});var c="white",d="greenyellow",f="transparent",g={setFillColor:n,getFillColor:a,setToolColor:r,getToolColor:i,setActiveColor:l,getActiveColor:s,getColorIfActive:u};t.default=g},function(e,t,o){"use strict";function n(e){l=e}function a(){return l}function r(e){s=e}function i(){return s}Object.defineProperty(t,"__esModule",{value:!0});var l=1,s=2,u={setToolWidth:n,getToolWidth:a,setActiveWidth:r,getActiveWidth:i};t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,r,i){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var l=a.default.getFont(),s=a.default.getFontSize(),u=a.default.getBackgroundColor();e.save(),e.font=l,e.textBaseline="top",e.strokeStyle=r;var c=0;t.forEach(function(t){var o=e.measureText(t).width;c=Math.max(c,o)}),e.fillStyle=u;var d={width:c+10,height:5+t.length*(s+5)};return i&&i.centering&&!0===i.centering.x&&(o-=d.width/2),i&&i.centering&&!0===i.centering.y&&(n-=d.height/2),d.left=o,d.top=n,i&&!0===i.debug&&(e.fillStyle="#FF0000"),e.fillRect(d.left,d.top,d.width,d.height),t.forEach(function(t,a){e.fillStyle=r,e.fillText(t,o+5,n+5+a*(s+5))}),e.restore(),d};var n=o(12),a=function(e){return e&&e.__esModule?e:{default:e}}(n)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,i){e.strokeStyle=n,Object.keys(o).forEach(function(n){var l=o[n];if(!0!==l.drawnIndependently&&(!i||!0!==i.drawHandlesIfActive||l.active)){e.beginPath(),l.active?e.lineWidth=a.default.getActiveWidth():e.lineWidth=a.default.getToolWidth();var s=cornerstone.pixelToCanvas(t.element,l);e.arc(s.x,s.y,r,0,2*Math.PI),i&&i.fill&&(e.fillStyle=i.fill,e.fill()),e.stroke()}})};var n=o(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n),r=6},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){var r=t.element,i=e.createNewMeasurement(t);if(i){var l={mouseButtonMask:t.which};(0,y.addToolState)(t.element,e.toolType,i),$(r).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(r).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(r).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(r).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),cornerstone.updateImage(r);var s=void 0;s=1===Object.keys(i.handles).length?d.default:g.default;var u=void 0;u=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,s(t,e.toolType,i,i.handles.end,function(){i.active=!1,i.invalidated=!0,(0,p.default)(t,i.handles)&&(0,y.removeToolState)(r,e.toolType,i),$(r).on("CornerstoneToolsMouseMove",l,e.mouseMoveCallback||n),$(r).on("CornerstoneToolsMouseDown",l,e.mouseDownCallback||a),$(r).on("CornerstoneToolsMouseDownActivate",l,e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(r).on("CornerstoneToolsMouseDoubleClick",l,e.mouseDoubleClickCallback),cornerstone.updateImage(r)},u)}}function o(o,n){if((0,C.default)(n.which,o.data.mouseButtonMask))return e.addNewMeasurement?e.addNewMeasurement(n):t(n),!1}function n(t,o){if(r.default.setCoords(o),0===o.which){var n=(0,y.getToolState)(o.element,e.toolType);if(n){for(var a=!1,i=0;i<n.data.length;i++){var l=o.currentPoints.canvas,s=n.data[i];!0===(0,u.default)(o.element,s.handles,l)&&(a=!0),(e.pointNearTool(o.element,s,l)&&!s.active||!e.pointNearTool(o.element,s,l)&&s.active)&&(s.active=!s.active,a=!0)}!0===a&&cornerstone.updateImage(o.element)}}}function a(t,o){function a(){r.invalidated=!0,(0,p.default)(o,r.handles)&&(0,y.removeToolState)(i,e.toolType,r),cornerstone.updateImage(i),$(i).on("CornerstoneToolsMouseMove",o,e.mouseMoveCallback||n)}var r=void 0,i=o.element;if((0,C.default)(o.which,t.data.mouseButtonMask)){var s=o.startPoints.canvas,u=(0,y.getToolState)(t.currentTarget,e.toolType);if(u){var c=void 0,f=void 0;for(f=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,c=0;c<u.data.length;c++){r=u.data[c];var g=(0,l.default)(i,r.handles,s,6);if(g)return $(i).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),r.active=!0,(0,d.default)(o,e.toolType,r,g,a,f),t.stopImmediatePropagation(),!1}if(e.pointNearTool){var m=e.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(c=0;c<u.data.length;c++)if(r=u.data[c],r.active=!1,e.pointNearTool(i,r,s))return r.active=!0,$(i).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),(0,v.default)(t,r,u,e.toolType,m,a),t.stopImmediatePropagation(),!1}}}}function i(t){$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),cornerstone.updateImage(t)}function s(t){$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),$(t).on("CornerstoneImageRendered",e.onImageRendered),cornerstone.updateImage(t)}function c(t,r){var i={mouseButtonMask:r};$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),$(t).on("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",i,e.mouseMoveCallback||n),$(t).on("CornerstoneToolsMouseDown",i,e.mouseDownCallback||a),$(t).on("CornerstoneToolsMouseDownActivate",i,e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&($(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),$(t).on("CornerstoneToolsMouseDoubleClick",i,e.mouseDoubleClickCallback)),cornerstone.updateImage(t)}function f(t,r){var i={mouseButtonMask:r},l="CornerstoneToolsToolDeactivated",s={mouseButtonMask:r,toolType:e.toolType,type:l},u=$.Event(l,s);$(t).trigger(u,s),$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),$(t).on("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",i,e.mouseMoveCallback||n),$(t).on("CornerstoneToolsMouseDown",i,e.mouseDownCallback||a),e.mouseDoubleClickCallback&&($(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),$(t).on("CornerstoneToolsMouseDoubleClick",i,e.mouseDoubleClickCallback)),cornerstone.updateImage(t)}function m(){return T}function h(e){T=e}var T={},b={enable:s,disable:i,activate:c,deactivate:f,getConfiguration:m,setConfiguration:h,mouseDownCallback:a,mouseMoveCallback:n,mouseDownActivateCallback:o};return e.pointNearTool&&(b.pointNearTool=e.pointNearTool),e.mouseDoubleClickCallback&&(b.mouseDoubleClickCallback=e.mouseDoubleClickCallback),e.addNewMeasurement&&(b.addNewMeasurement=e.addNewMeasurement),b};var a=o(26),r=n(a),i=o(13),l=n(i),s=o(23),u=n(s),c=o(19),d=n(c),f=o(20),g=n(f),m=o(24),v=n(m),h=o(10),p=n(h),T=o(1),C=n(T),y=o(0)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){Object.keys(e).forEach(function(t){e[t].active=!1})}function r(e){if(e)for(var t=0;t<e.data.length;t++){var o=e.data[t];o.active=!1,o.handles&&a(o.handles)}}function i(e){function t(t){var r=t.element,i=e.createNewMeasurement(t);if(i){if((0,p.addToolState)(r,e.toolType,i),1===Object.keys(i.handles).length&&"CornerstoneToolsTap"===t.type)return i.active=!1,i.handles.end.active=!1,i.handles.end.highlight=!1,i.invalidated=!0,(0,s.default)(t,i.handles)&&(0,p.removeToolState)(r,e.toolType,i),void cornerstone.updateImage(r);$(r).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),$(r).off("CornerstoneToolsTap",e.tapCallback||n),$(r).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),cornerstone.updateImage(r),(0,m.default)(t,e.toolType,i,i.handles.end,function(){i.active=!1,i.invalidated=!0,(0,s.default)(t,i.handles)&&(0,p.removeToolState)(r,e.toolType,i),$(r).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),$(r).on("CornerstoneToolsTap",e.tapCallback||n),$(r).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),cornerstone.updateImage(r)})}}function o(o,n){return e.addNewMeasurement?e.addNewMeasurement(n):t(n),!1}function n(t,i){function l(){r(g),(0,s.default)(i,m.handles)&&(0,p.removeToolState)(u,e.toolType,m),cornerstone.updateImage(u),$(u).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(u).on("CornerstoneToolsTap",e.tapCallback||n)}var u=i.element,d=i.currentPoints.canvas,g=(0,p.getToolState)(t.currentTarget,e.toolType),m=void 0,v=void 0;if(r(g),g)for(v=0;v<g.data.length;v++){m=g.data[v];var T=(0,c.default)(u,m.handles,d,25);if(T)return $(u).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(u).off("CornerstoneToolsTap",e.tapCallback||n),m.active=!0,T.active=!0,cornerstone.updateImage(u),(0,f.default)(t,e.toolType,m,T,l),t.stopImmediatePropagation(),!1}if(g&&e.pointNearTool)for(v=0;v<g.data.length;v++)if(m=g.data[v],e.pointNearTool(u,m,d))return $(u).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(u).off("CornerstoneToolsTap",e.tapCallback||n),m.active=!0,cornerstone.updateImage(u),(0,h.default)(t,m,g,e.toolType,!0,l),t.stopImmediatePropagation(),!1;return e.touchDownActivateCallback?e.touchDownActivateCallback(t,i):o(t,i),!1}function a(t,o){function r(t,r){if(u.active=!1,u.invalidated=!0,(0,s.default)(o,u.handles)&&(0,p.removeToolState)(o.element,e.toolType,u),cornerstone.updateImage(o.element),$(i).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(i).on("CornerstoneToolsTap",e.tapCallback||n),e.pressCallback&&$(i).on("CornerstoneToolsTouchPress",e.pressCallback),t&&"CornerstoneToolsTouchPress"===t.type){var l=$.Event(t.type,r);$(i).trigger(l,r)}}var i=o.element,l=o.startPoints.canvas,u=void 0,d=(0,p.getToolState)(t.currentTarget,e.toolType),g=void 0;if(d){for(g=0;g<d.data.length;g++){u=d.data[g];var m=(0,c.default)(o.element,u.handles,l,28);if(m)return $(i).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(i).off("CornerstoneToolsTap",e.tapCallback||n),e.pressCallback&&$(i).off("CornerstoneToolsTouchPress",e.pressCallback),u.active=!0,(0,f.default)(t,e.toolType,u,m,r),t.stopImmediatePropagation(),!1}if(e.pointNearTool)for(g=0;g<d.data.length;g++)if(u=d.data[g],e.pointNearTool(o.element,u,l))return $(i).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(i).off("CornerstoneToolsTap",e.tapCallback||n),e.pressCallback&&$(i).off("CornerstoneToolsTouchPress",e.pressCallback),(0,h.default)(t,u,d,e.toolType,!0,r),t.stopImmediatePropagation(),!1}}function i(t){$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),$(t).off("CornerstoneToolsTap",e.tapCallback||n),e.doubleTapCallback&&$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&$(t).off("CornerstoneToolsTouchPress",e.pressCallback),cornerstone.updateImage(t)}function l(t){$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),$(t).off("CornerstoneToolsTap",e.tapCallback||n),$(t).on("CornerstoneImageRendered",e.onImageRendered),e.doubleTapCallback&&$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&$(t).off("CornerstoneToolsTouchPress",e.pressCallback),cornerstone.updateImage(t)}function u(t){$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),$(t).off("CornerstoneToolsTap",e.tapCallback||n),$(t).on("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(t).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),$(t).on("CornerstoneToolsTap",e.tapCallback||n),e.doubleTapCallback&&($(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),$(t).on("CornerstoneToolsDoubleTap",e.doubleTapCallback)),e.pressCallback&&($(t).off("CornerstoneToolsTouchPress",e.pressCallback),$(t).on("CornerstoneToolsTouchPress",e.pressCallback)),cornerstone.updateImage(t)}function d(t){var r="CornerstoneToolsToolDeactivated",i={toolType:e.toolType,type:r},l=$.Event(r,i);$(t).trigger(l,i),$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),$(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),$(t).off("CornerstoneToolsTap",e.tapCallback||n),$(t).on("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),e.doubleTapCallback&&$(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&$(t).off("CornerstoneToolsTouchPress",e.pressCallback),cornerstone.updateImage(t)}var g={enable:l,disable:i,activate:u,deactivate:d,touchStartCallback:e.touchStartCallback||a,touchDownActivateCallback:e.touchDownActivateCallback||o,tapCallback:e.tapCallback||n};return e.pointNearTool&&(g.pointNearTool=e.pointNearTool),e.doubleTapCallback&&(g.doubleTapCallback=e.doubleTapCallback),e.pressCallback&&(g.pressCallback=e.pressCallback),e.addNewMeasurement&&(g.addNewMeasurement=e.addNewMeasurement),g}Object.defineProperty(t,"__esModule",{value:!0});var l=o(10),s=n(l),u=o(13),c=n(u),d=o(40),f=n(d),g=o(21),m=n(g),v=o(39),h=n(v),p=o(0);t.default=i},function(e,t,o){"use strict";function n(e){u=e}function a(){return u}function r(e){c=e}function i(){return c}function l(e){d=e}function s(){return d}Object.defineProperty(t,"__esModule",{value:!0});var u=void 0,c=void 0,d=void 0,f={setStartLoadHandler:n,getStartLoadHandler:a,setEndLoadHandler:r,getEndLoadHandler:i,setErrorLoadingHandler:l,getErrorLoadingHandler:s};t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o="CornerstoneToolsTouchDrag";return t&&!0===t.fireOnTouchStart&&(o+=" CornerstoneToolsTouchStart"),{activate:function(n){$(n).off(o,e),t&&t.eventData?$(n).on(o,t.eventData,e):$(n).on(o,e),t&&t.activateCallback&&t.activateCallback(n)},disable:function(n){$(n).off(o,e),t&&t.disableCallback&&t.disableCallback(n)},enable:function(n){$(n).off(o,e),t&&t.enableCallback&&t.enableCallback(n)},deactivate:function(n){$(n).off(o,e),t&&t.deactivateCallback&&t.deactivateCallback(n)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=e.image,n={left:0,top:0,width:o.width,height:o.height},a=!1;return Object.keys(t).forEach(function(e){var o=t[e];!0!==o.allowedOutsideImage&&!1===cornerstoneMath.point.insideRect(o,n)&&(a=!0)}),a}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t,o,n){$(t).off("CornerstoneToolsMouseDownActivate",e);var a={mouseButtonMask:o,options:n};$(t).on("CornerstoneToolsMouseDownActivate",a,e)},disable:function(t){$(t).off("CornerstoneToolsMouseDownActivate",e)},enable:function(t){$(t).off("CornerstoneToolsMouseDownActivate",e)},deactivate:function(t){$(t).off("CornerstoneToolsMouseDownActivate",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}}},function(e,t,o){"use strict";function n(e){c=e}function a(){return c}function r(e){u=e}function i(){return u}function l(e){d=e}function s(){return d}Object.defineProperty(t,"__esModule",{value:!0});var u=15,c=u+"px Arial",d="transparent",f={setFont:n,getFont:a,setFontSize:r,getFontSize:i,setBackgroundColor:l,getBackgroundColor:s};t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){var r=void 0;if(t)return Object.keys(t).forEach(function(i){var l=t[i];if(l.hasOwnProperty("pointNearHandle")){if(l.pointNearHandle(e,l,o))return void(r=l)}else if(!0===l.hasBoundingBox){if((0,a.default)(l,o))return void(r=l)}else{var s=cornerstone.pixelToCanvas(e,l),u=cornerstoneMath.point.distance(s,o);if(u<=n)return void(r=l)}}),r};var n=o(16),a=function(e){return e&&e.__esModule?e:{default:e}}(n)},function(e,t,o){"use strict";function n(){function e(e){return l[e]}function t(e,t){l[e]=t}function o(){return l}function n(e){l=e}function a(e,t,o){var n=cornerstone.getEnabledElement(e);n.image&&!1!==l.hasOwnProperty(n.image.imageId)||(l[n.image.imageId]={});var a=l[n.image.imageId];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(o)}function r(e,t){var o=cornerstone.getEnabledElement(e);if(o.image&&!1!==l.hasOwnProperty(o.image.imageId)){var n=l[o.image.imageId];if(!1!==n.hasOwnProperty(t)){return n[t]}}}function i(e){var t=cornerstone.getEnabledElement(e);t.image&&!1!==l.hasOwnProperty(t.image.imageId)&&delete l[t.image.imageId]}var l={};return{get:r,add:a,clear:i,saveImageIdToolState:e,restoreImageIdToolState:t,saveToolState:o,restoreToolState:n,toolState:l}}Object.defineProperty(t,"__esModule",{value:!0});var a=n();t.newImageIdSpecificToolStateManager=n,t.globalImageIdSpecificToolStateManager=a},function(e,t,o){"use strict";function n(e){return parseFloat("."+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=cornerstone.metaData.get("patientStudyModule",e.imageId),a=cornerstone.metaData.get("generalSeriesModule",e.imageId);if(o&&a){if("PT"===a.modality){var r=t*e.slope+e.intercept,i=o.patientWeight;if(i){var l=cornerstone.metaData.get("petIsotopeModule",e.imageId);if(l){var s=l.radiopharmaceuticalInfo,u=s.radiopharmaceuticalStartTime,c=s.radionuclideTotalDose,d=s.radionuclideHalfLife,f=a.seriesTime;if(u&&c&&d&&f){var g=n(f.fractionalSeconds||0)+f.seconds+60*f.minutes+60*f.hours*60,m=n(u.fractionalSeconds)+u.seconds+60*u.minutes+60*u.hours*60,v=g-m;return r*i/(c*Math.exp(-v*Math.log(2)/d))*1e3}}}}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.boundingBox)return cornerstoneMath.point.insideRect(t,e.boundingBox)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{disable:function(t){$(t).off("CornerstoneImageRendered",e)},enable:function(t){$(t).off("CornerstoneImageRendered",e),$(t).on("CornerstoneImageRendered",e),cornerstone.updateImage(t)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){$(t).off("CornerstoneToolsMouseWheel",e);var o={};$(t).on("CornerstoneToolsMouseWheel",o,e)},disable:function(t){$(t).off("CornerstoneToolsMouseWheel",e)},enable:function(t){$(t).off("CornerstoneToolsMouseWheel",e)},deactivate:function(t){$(t).off("CornerstoneToolsMouseWheel",e)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,a){!1===n.hasMoved&&(n.hasMoved=!0),n.active=!0,n.x=a.currentPoints.image.x+u.x,n.y=a.currentPoints.image.y+u.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,a.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,a.image.height)),cornerstone.updateImage(s);var i={toolType:t,element:s,measurementData:o};$(s).trigger("CornerstoneToolsMeasurementModified",i)}function l(){n.active=!1,$(s).off("CornerstoneToolsMouseDrag",i),$(s).off("CornerstoneToolsMouseUp",l),$(s).off("CornerstoneToolsMouseClick",l),cornerstone.updateImage(s),"function"==typeof a&&a()}var s=e.element,u={x:n.x-e.currentPoints.image.x,y:n.y-e.currentPoints.image.y};$(s).on("CornerstoneToolsMouseDrag",i),$(s).on("CornerstoneToolsMouseUp",l),$(s).on("CornerstoneToolsMouseClick",l)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,a){n.active=!0,n.x=a.currentPoints.image.x,n.y=a.currentPoints.image.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,a.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,a.image.height)),cornerstone.updateImage(d);var i={toolType:t,element:d,measurementData:o};$(d).trigger("CornerstoneToolsMeasurementModified",i)}function l(e){$(d).off("CornerstoneToolsMouseMove"),$(d).off("CornerstoneToolsMouseDrag"),$(d).on("CornerstoneToolsMouseMove",i),$(d).on("CornerstoneToolsMouseDrag",i),$(d).on("CornerstoneToolsMouseClick",c),"CornerstoneToolsMouseDrag"===e.type&&$(d).on("CornerstoneToolsMouseUp",c)}function s(e,t){t.measurementData===o&&c()}function u(e,o){o.toolType===t&&($(d).off("CornerstoneToolsMouseMove",i),$(d).off("CornerstoneToolsMouseDrag",i),$(d).off("CornerstoneToolsMouseClick",c),$(d).off("CornerstoneToolsMouseUp",c),$(d).off("CornerstoneToolsMeasurementRemoved",s),$(d).off("CornerstoneToolsToolDeactivated",u),n.active=!1,cornerstone.updateImage(d))}function c(){$(d).off("CornerstoneToolsMouseMove",i),$(d).off("CornerstoneToolsMouseDrag",i),$(d).off("CornerstoneToolsMouseClick",c),$(d).off("CornerstoneToolsMouseUp",c),$(d).off("CornerstoneToolsMeasurementRemoved",s),$(d).off("CornerstoneToolsToolDeactivated",u),n.active=!1,cornerstone.updateImage(d),"function"==typeof a&&a()}var d=e.element;$(d).on("CornerstoneToolsMouseDrag",l),$(d).on("CornerstoneToolsMouseMove",l),$(d).on("CornerstoneToolsMeasurementRemoved",s),$(d).on("CornerstoneToolsToolDeactivated",u)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,a){n.x=a.currentPoints.image.x+f.x,n.y=a.currentPoints.image.y+f.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,a.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,a.image.height)),cornerstone.updateImage(c);var i={toolType:t,element:c,measurementData:o};$(c).trigger("CornerstoneToolsMeasurementModified",i)}function l(e,t){if($(c).off("CornerstoneToolsTouchDrag",i),$(c).off("CornerstoneToolsTouchPinch",l),$(c).off("CornerstoneToolsTouchEnd",l),$(c).off("CornerstoneToolsTap",l),$(c).off("CornerstoneToolsTouchStart",s),$(c).off("CornerstoneToolsToolDeactivated",u),"CornerstoneToolsTouchPinch"===e.type||"CornerstoneToolsTouchPress"===e.type)return n.active=!1,cornerstone.updateImage(c),void a();n.active=!1,o.active=!1,n.x=t.currentPoints.image.x+f.x,n.y=t.currentPoints.image.y+f.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,t.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,t.image.height)),cornerstone.updateImage(c),"function"==typeof a&&a()}function s(e){return e.stopImmediatePropagation(),!1}function u(){$(c).off("CornerstoneToolsTouchDrag",i),$(c).off("CornerstoneToolsTouchPinch",l),$(c).off("CornerstoneToolsTouchEnd",l),$(c).off("CornerstoneToolsTap",l),$(c).off("CornerstoneToolsTouchStart",s),$(c).off("CornerstoneToolsToolDeactivated",u),n.active=!1,o.active=!1,n.x=e.currentPoints.image.x+f.x,n.y=e.currentPoints.image.y+f.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,e.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,e.image.height)),cornerstone.updateImage(c)}var c=e.element,d=cornerstone.pageToPixel(c,e.currentPoints.page.x,e.currentPoints.page.y+50),f={x:n.x-d.x,y:n.y-d.y};n.active=!0,o.active=!0,$(c).on("CornerstoneToolsTouchDrag",i),$(c).on("CornerstoneToolsTouchPinch",l),$(c).on("CornerstoneToolsTouchEnd",l),$(c).on("CornerstoneToolsTap",l),$(c).on("CornerstoneToolsTouchStart",s),$(c).on("CornerstoneToolsToolDeactivated",u)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o={},n="CornerstoneToolsMultiTouchDrag";return t&&!0===t.fireOnTouchStart&&(n+=" CornerstoneToolsMultiTouchStart"),{activate:function(o){$(o).off(n,e),t&&t.eventData?$(o).on(n,t.eventData,e):$(o).on(n,e),t&&t.activateCallback&&t.activateCallback(o)},disable:function(o){$(o).off(n,e),t&&t.disableCallback&&t.disableCallback(o)},enable:function(o){$(o).off(n,e),t&&t.enableCallback&&t.enableCallback(o)},deactivate:function(o){$(o).off(n,e),t&&t.deactivateCallback&&t.deactivateCallback(o)},getConfiguration:function(){return o},setConfiguration:function(e){o=e}}}},function(e,t,o){"use strict";function n(e){var t=void 0;return Object.keys(e).forEach(function(o){var n=e[o];if(!0===n.active)return void(t=n)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a){a||(a=6);var i=n(t),l=(0,r.default)(e,t,o,a);return i!==l&&(void 0!==l&&(l.active=!0),void 0!==i&&(i.active=!1),!0)};var a=o(13),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,i,l){function s(e,o){t.active=!0,Object.keys(t.handles).forEach(function(e){var n=t.handles[e];!0!==n.movesIndependently&&(n.x+=o.deltaPoints.image.x,n.y+=o.deltaPoints.image.y,!0===i.preventHandleOutsideImage&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,o.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,o.image.height)))}),cornerstone.updateImage(c);var a={toolType:n,element:c,measurementData:t};return $(c).trigger("CornerstoneToolsMeasurementModified",a),!1}function u(e,o){t.invalidated=!0,$(c).off("CornerstoneToolsMouseDrag",s),$(c).off("CornerstoneToolsMouseUp",u),$(c).off("CornerstoneToolsMouseClick",u),!0===i.deleteIfHandleOutsideImage&&(0,a.default)(o,t.handles)&&(0,r.removeToolState)(c,n,t),cornerstone.updateImage(c),"function"==typeof l&&l()}var c=e.element;return $(c).on("CornerstoneToolsMouseDrag",s),$(c).on("CornerstoneToolsMouseUp",u),$(c).on("CornerstoneToolsMouseClick",u),!0};var n=o(10),a=function(e){return e&&e.__esModule?e:{default:e}}(n),r=o(0)},function(e,t,o){"use strict";function n(e,t,o,n,a,r){if(!d.hasOwnProperty(o))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var i={type:o,imageId:t,preventCache:n,doneCallback:a,failCallback:r},l=cornerstone.imageCache.getImagePromise(t);if(l)return void l.then(function(e){a(e)},function(e){r(e)});d[o].push(i)}}function a(e){if(!d.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");d[e]=[]}function r(){m&&setTimeout(function(){l()},v)}function i(e){var t=e.type;f[t]++,m=!0;var o=e.imageId,n=e.doneCallback,a=e.failCallback,i=cornerstone.imageCache.getImagePromise(o);if(i)return void i.then(function(e){f[t]--,n(e),r()},function(e){f[t]--,a(e),r()});var l=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e),s=void 0;s=!0===e.preventCache?cornerstone.loadImage(o,{priority:l,type:e.type}):cornerstone.loadAndCacheImage(o,{priority:l,type:e.type}),s.then(function(e){f[t]--,n(e),r()},function(e){f[t]--,a(e),r()})}function l(){var e=(0,c.getMaxSimultaneousRequests)();g={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=f.interaction+f.thumbnail+f.prefetch,o=e-t,n=0;n<o;n++){var a=s();a&&i(a)}}function s(){return d.interaction.length&&f.interaction<g.interaction?d.interaction.shift():d.thumbnail.length&&f.thumbnail<g.thumbnail?d.thumbnail.shift():d.prefetch.length&&f.prefetch<g.prefetch?d.prefetch.shift():(d.interaction.length||d.thumbnail.length||d.prefetch.length||(m=!1),!1)}function u(){return d}Object.defineProperty(t,"__esModule",{value:!0});var c=o(29),d={interaction:[],thumbnail:[],prefetch:[]},f={interaction:0,thumbnail:0,prefetch:0},g={interaction:6,thumbnail:6,prefetch:5},m=!1,v=20;t.default={addRequest:n,clearRequestStack:a,startGrabbing:l,getRequestPool:u}},function(e,t,o){"use strict";function n(e){r=e.currentPoints.canvas}function a(){return r}Object.defineProperty(t,"__esModule",{value:!0});var r=void 0,i={setCoords:n,getCoords:a};t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){var a=(0,n.getToolState)(e,"timeSeries");if(a&&a.data&&a.data.length){var i=a.data[0],l=i.stacks[i.currentStackIndex],s=l.currentImageIdIndex,u=i.currentStackIndex+t;if(o?(u>=i.stacks.length&&(u=0),u<0&&(u=i.stacks.length-1)):(u=Math.min(i.stacks.length-1,u),u=Math.max(0,u)),u!==i.currentStackIndex){var c=cornerstone.getViewport(e),d=i.stacks[u],f=r.default.getStartLoadHandler(),g=r.default.getEndLoadHandler(),m=r.default.getErrorLoadingHandler();f&&f(e);var v=void 0;v=!0===d.preventCache?cornerstone.loadImage(d.imageIds[s]):cornerstone.loadAndCacheImage(d.imageIds[s]),v.then(function(t){i.currentImageIdIndex!==s&&(d.currentImageIdIndex=s,i.currentStackIndex=u,cornerstone.displayImage(e,t,c),g&&g(e,t))},function(t){var o=d.imageIds[s];m&&m(e,o,t)})}}};var n=o(0),a=o(8),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{page:cornerstoneMath.point.copy(e.page),image:cornerstoneMath.point.copy(e.image),client:cornerstoneMath.point.copy(e.client),canvas:cornerstoneMath.point.copy(e.canvas)}}},function(e,t,o){"use strict";function n(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],o=void 0;return/trident/i.test(t[1])?(o=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(o[1]||"")):"Chrome"===t[1]&&null!==(o=e.match(/\b(OPR|Edge)\/(\d+)/))?o.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(o=e.match(/version\/(\d+)/i))&&t.splice(1,1,o[1]),t.join(" "))}function a(){var e=s.default.getConfiguration();return e.maxSimultaneousRequests?e.maxSimultaneousRequests:r()}function r(){var e=n(),t=e.split(" "),o=t[0],a=t[1],r=u[o];return r?r[a]?r[a]:r.default:u.default}function i(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}Object.defineProperty(t,"__esModule",{value:!0}),t.isMobileDevice=t.getBrowserInfo=t.getMaxSimultaneousRequests=t.getDefaultSimultaneousRequests=void 0;var l=o(42),s=function(e){return e&&e.__esModule?e:{default:e}}(l),u={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};t.getDefaultSimultaneousRequests=r,t.getMaxSimultaneousRequests=a,t.getBrowserInfo=n,t.isMobileDevice=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),o=Math.round(o);var r=cornerstone.getEnabledElement(e),i=[],l=0,s=r.image.getPixelData(),u=void 0,c=void 0,d=void 0;if(r.image.color)for(c=0;c<a;c++)for(d=0;d<n;d++){u=4*((c+o)*r.image.columns+(d+t));var f=s[u],g=s[u+1],m=s[u+2],v=s[u+3];i[l++]=f,i[l++]=g,i[l++]=m,i[l++]=v}return i}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=e.width/2,n=e.height/2;if(o<=0||n<=0)return!1;var a={x:e.left+o,y:e.top+n},r={x:t.x-a.x,y:t.y-a.y};return r.x*r.x/(o*o)+r.y*r.y/(n*n)<=1}},function(e,t,o){"use strict";function n(e,t){var o=e.clone().sub(t.imagePositionPatient);return{x:t.rowCosines.dot(o)/t.columnPixelSpacing,y:t.columnCosines.dot(o)/t.rowPixelSpacing}}function a(e,t){var o=t.rowCosines.clone().multiplyScalar(e.x);o.multiplyScalar(t.columnPixelSpacing);var n=t.columnCosines.clone().multiplyScalar(e.y);n.multiplyScalar(t.rowPixelSpacing);var a=o.add(n);return a.add(t.imagePositionPatient),a}function r(e){var t=a({x:0,y:0},e),o=a({x:e.columns,y:0},e),n=a({x:0,y:e.rows},e),r=a({x:e.columns,y:e.rows},e);return{top:new cornerstoneMath.Line3(t,o),left:new cornerstoneMath.Line3(t,n),right:new cornerstoneMath.Line3(o,r),bottom:new cornerstoneMath.Line3(n,r)}}function i(e,t){var o=[];return Object.keys(t).forEach(function(n){var a=t[n],r=e.intersectLine(a);r&&o.push(r)}),o}function l(e,t){var o=e.rowCosines.clone().cross(e.columnCosines),n=new cornerstoneMath.Plane;n.setFromNormalAndCoplanarPoint(o,e.imagePositionPatient);var l=t.rowCosines.clone().cross(t.columnCosines),s=new cornerstoneMath.Plane;s.setFromNormalAndCoplanarPoint(l,t.imagePositionPatient);var u=s.clone().intersectPlane(n),c=u.origin,d=u.direction,f=a({x:t.columns,y:t.rows},t),g=t.imagePositionPatient.distanceTo(f),m=new cornerstoneMath.Line3;m.start=c,m.end=c.clone().add(d.multiplyScalar(g));var v=r(t),h=i(m,v);if(2===h.length)return{start:h[0],end:h[1]}}Object.defineProperty(t,"__esModule",{value:!0}),t.projectPatientPointToImagePlane=n,t.imagePointToPatientPoint=a,t.planePlaneIntersection=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=Math.pow(10,t);return Math.round(e*o)/o}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){$(t).off("CornerstoneToolsDoubleTap",e);var o={};$(t).on("CornerstoneToolsDoubleTap",o,e)},disable:function(t){$(t).off("CornerstoneToolsDoubleTap",e)},enable:function(t){$(t).off("CornerstoneToolsDoubleTap",e)},deactivate:function(t){$(t).off("CornerstoneToolsDoubleTap",e)}}}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function o(o){var n=e.createNewMeasurement(o);n&&((0,T.addToolState)(o.element,e.toolType,n),$(o.element).off("CornerstoneToolsMouseMove",a),(0,d.default)(o,e.toolType,n,n.handles.end,function(){n.active=!1,(0,v.default)(o,n.handles)&&(0,T.removeToolState)(o.element,e.toolType,n),$(o.element).on("CornerstoneToolsMouseMove",a)},t))}function n(e,t){if((0,p.default)(t.which,e.data.mouseButtonMask))return o(t),!1}function a(t,o){if(r.default.setCoords(o),0===o.which){var n=(0,T.getToolState)(o.element,e.toolType);if(void 0!==n){for(var a=!1,i=o.currentPoints.canvas,l=0;l<n.data.length;l++){var s=n.data[l];!0===(0,u.default)(o.element,s.handles,i)&&(a=!0),(e.pointInsideRect(o.element,s,i)&&!s.active||!e.pointInsideRect(o.element,s,i)&&s.active)&&(s.active=!s.active,a=!0)}!0===a&&cornerstone.updateImage(o.element)}}}function i(o,n){function r(){i.active=!1,(0,v.default)(n,i.handles)&&(0,T.removeToolState)(n.element,e.toolType,i),cornerstone.updateImage(n.element),$(n.element).on("CornerstoneToolsMouseMove",a)}var i=void 0;if((0,p.default)(n.which,o.data.mouseButtonMask)){var s=n.startPoints.canvas,u=(0,T.getToolState)(o.currentTarget,e.toolType),c=void 0;if(void 0!==u)for(c=0;c<u.data.length;c++){i=u.data[c];var f=(0,l.default)(n.element,i.handles,s,25);if(void 0!==f)return $(n.element).off("CornerstoneToolsMouseMove",a),i.active=!0,(0,d.default)(n,e.toolType,i,f,r,t),o.stopImmediatePropagation(),!1}var m={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:t};if(void 0!==u&&void 0!==e.pointInsideRect)for(c=0;c<u.data.length;c++)if(i=u.data[c],e.pointInsideRect(n.element,i,s))return $(n.element).off("CornerstoneToolsMouseMove",a),(0,g.default)(o,i,u,e.toolType,m,r),$(n.element).on("CornerstoneToolsMouseMove",a),o.stopImmediatePropagation(),!1}}function s(t){$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",i),$(t).off("CornerstoneToolsMouseDownActivate",n),cornerstone.updateImage(t)}function c(t){$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",i),$(t).off("CornerstoneToolsMouseDownActivate",n),$(t).on("CornerstoneImageRendered",e.onImageRendered),cornerstone.updateImage(t)}function f(t,o){var r={mouseButtonMask:o};$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",i),$(t).off("CornerstoneToolsMouseDownActivate",n),$(t).on("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",r,a),$(t).on("CornerstoneToolsMouseDown",r,i),$(t).on("CornerstoneToolsMouseDownActivate",r,n),cornerstone.updateImage(t)}function m(t,o){var r={mouseButtonMask:o};$(t).off("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",i),$(t).off("CornerstoneToolsMouseDownActivate",n),$(t).on("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",r,a),$(t).on("CornerstoneToolsMouseDown",r,i),cornerstone.updateImage(t)}return{enable:c,disable:s,activate:f,deactivate:m}};var a=o(26),r=n(a),i=o(13),l=n(i),s=o(23),u=n(s),c=o(19),d=n(c),f=o(24),g=n(f),m=o(10),v=n(m),h=o(1),p=n(h),T=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){$(t).off("CornerstoneToolsTouchPinch",e);var o={};$(t).on("CornerstoneToolsTouchPinch",o,e)},disable:function(t){$(t).off("CornerstoneToolsTouchPinch",e)},enable:function(t){$(t).off("CornerstoneToolsTouchPinch",e)},deactivate:function(t){$(t).off("CornerstoneToolsTouchPinch",e)}}}},function(e,t,o){"use strict";function n(e,t){var o=Date.now();if(e!==c){if(o-d<=s)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;c=e}d=o}function a(e,t,o){var n=o?f:g;t.forEach(function(t){$(e).on(t,n)})}function r(e,t,o){var n=o?f:g;t.forEach(function(t){$(e).off(t,n)})}function i(e){r(e,m,u.mouse),r(e,v,u.touch)}function l(e){i(e),a(e,m,u.mouse),a(e,v,u.touch)}Object.defineProperty(t,"__esModule",{value:!0});var s=2e3,u={mouse:0,touch:1},c=void 0,d=void 0,f=n.bind(null,u.mouse),g=n.bind(null,u.touch),m=["mousedown","mouseup"],v=["touchstart","touchend"],h={enable:l,disable:i};t.default=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,i,l){function s(e,o){t.active=!0,Object.keys(t.handles).forEach(function(e){var n=t.handles[e];!0!==n.movesIndependently&&(n.x+=o.deltaPoints.image.x,n.y+=o.deltaPoints.image.y)}),cornerstone.updateImage(c);var a={toolType:n,element:c,measurementData:t};return $(c).trigger("CornerstoneToolsMeasurementModified",a),!1}function u(e,o){t.active=!1,t.invalidated=!1,$(c).off("CornerstoneToolsTouchDrag",s),$(c).off("CornerstoneToolsTouchPinch",u),$(c).off("CornerstoneToolsTouchPress",u),$(c).off("CornerstoneToolsTouchEnd",u),$(c).off("CornerstoneToolsDragEnd",u),$(c).off("CornerstoneToolsTap",u),!0===i&&(0,a.default)(o,t.handles)&&(0,r.removeToolState)(c,n,t),cornerstone.updateImage(c),"function"==typeof l&&l(e,o)}var c=e.element;return $(c).on("CornerstoneToolsTouchDrag",s),$(c).on("CornerstoneToolsTouchPinch",u),$(c).on("CornerstoneToolsTouchPress",u),$(c).on("CornerstoneToolsTouchEnd",u),$(c).on("CornerstoneToolsDragEnd",u),$(c).on("CornerstoneToolsTap",u),!0};var n=o(10),a=function(e){return e&&e.__esModule?e:{default:e}}(n),r=o(0)},function(e,t,o){"use strict";function n(e,t,o,a,r){if(o.value){var i=(new Date).getTime(),l=Math.abs(t.y-r.y),s=l/10;if(console.log("distanceRemaining: "+l),l<1)return t.y=r.y,void(o.value=!1);t.y>r.y?t.y-=s:t.y<r.y&&(t.y+=s),cornerstone.updateImage(a.element),cornerstone.requestAnimationFrame(function(){n(i,t,o,a,r)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,i,l){function s(e,n){a.value=!1,!1===i.hasMoved&&(i.hasMoved=!0),i.active=!0;var r=n.currentPoints,l={x:r.page.x,y:r.page.y+g};v=cornerstone.pageToPixel(c,l.x,l.y),i.x=v.x,i.y=v.y,cornerstone.updateImage(c);var s={toolType:t,element:c,measurementData:o};$(c).trigger("CornerstoneToolsMeasurementModified",s)}function u(t,n){a.value=!1,i.active=!1,$(c).off("CornerstoneToolsTouchDrag",s),$(c).off(r,u),cornerstone.updateImage(c),"CornerstoneToolsTouchPress"===t.type&&(n.handlePressed=o,i.x=e.currentPoints.image.x,i.y=e.currentPoints.image.y),"function"==typeof l&&l(t,n)}a.value=!0;var c=e.element,d=cornerstone.getEnabledElement(c),f=(new Date).getTime(),g=-57,m={x:e.currentPoints.page.x,y:e.currentPoints.page.y+g},v=cornerstone.pageToPixel(c,m.x,m.y);$(c).on("CornerstoneToolsTouchDrag",s),$(c).on(r,u),n(f,i,a,d,v)};var a={value:!1},r=["CornerstoneToolsTouchEnd","CornerstoneToolsDragEnd","CornerstoneToolsTouchPinch","CornerstoneToolsTouchPress","CornerstoneToolsTap"].join(" ")},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(109),r=n(a),i=o(110),l=n(i),s={getOrientationString:r.default,invertOrientationString:l.default};t.default=s},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e=Math.round(e)||0,t=Math.round(t)||0;var o=[],n=t-e+1;if(n<=0)return o;for(;n--;)o[n]=t--;return o}function r(e,t){var o=[],n=[];return e.forEach(function(e){e<t?o.push(e):e>t&&n.push(e)}),{low:e.indexOf(x(o)),high:e.indexOf(P(n))}}function i(e){function t(e){var t=s.indicesToRequest.indexOf(e);t>-1&&s.indicesToRequest.splice(t,1)}function o(e){t(i.imageIds.indexOf(e.imageId))}function n(t){console.log("prefetch errored: "+t),f&&f(e,c,t,"stackPrefetch")}var a=(0,p.getToolState)(e,"stack");if(a&&a.data&&a.data.length){var i=a.data[0],l=(0,p.getToolState)(e,T);if(l){var s=l.data[0];if(s&&s.indicesToRequest&&s.indicesToRequest.length||(s.enabled=!1),!1!==s.enabled){l.data[0].indicesToRequest.sort(function(e,t){return e-t});if(s.indicesToRequest.slice().forEach(function(e){var o=i.imageIds[e];if(o){var n=cornerstone.imageCache.getImagePromise(o);n&&"resolved"===n.state()&&t(e)}}),s.indicesToRequest.length){m.default.clearRequestStack(C);for(var u=r(s.indicesToRequest,i.currentImageIdIndex),c=void 0,d=void 0,f=h.default.getErrorLoadingHandler(),g=u.low,v=u.high;g>0||v<s.indicesToRequest.length;)g>=0&&(d=s.indicesToRequest[g--],c=i.imageIds[d],m.default.addRequest(e,c,C,!1,o,n)),v<s.indicesToRequest.length&&(d=s.indicesToRequest[v++],c=i.imageIds[d],m.default.addRequest(e,c,C,!1,o,n));m.default.startGrabbing()}}}}}function l(e,t){var o=e.data.element,n=void 0;try{n=(0,p.getToolState)(o,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var a=n.data[0],r=a.imageIds.indexOf(t.imageId);if(!(r<0)){var i=(0,p.getToolState)(o,T);i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(r)}}}function s(e){clearTimeout(b),b=setTimeout(function(){var t=e.target;try{i(t)}catch(e){return}},M)}function u(e){(0,p.getToolState)(e,T).data=[];var t=(0,p.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var o=t.data[0];if(!0===o.preventCache)return void console.warn("A stack that should not be cached was given the stackPrefetch");var n={indicesToRequest:a(0,o.imageIds.length-1),enabled:!0,direction:1},r=n.indicesToRequest.indexOf(o.currentImageIdIndex);n.indicesToRequest.splice(r,1),(0,p.addToolState)(e,T,n),i(e),$(e).off("CornerstoneNewImage",s),$(e).on("CornerstoneNewImage",s),$(cornerstone).off("CornerstoneImageCachePromiseRemoved",l),$(cornerstone).on("CornerstoneImageCachePromiseRemoved",{element:e},l)}}function c(e){clearTimeout(b),$(e).off("CornerstoneNewImage",s),$(cornerstone).off("CornerstoneImageCachePromiseRemoved",l);var t=(0,p.getToolState)(e,T);t&&t.data.length&&(t.data[0].enabled=!1,m.default.clearRequestStack(C))}function d(){return y}function f(e){y=e}Object.defineProperty(t,"__esModule",{value:!0});var g=o(25),m=n(g),v=o(8),h=n(v),p=o(0),T="stackPrefetch",C="prefetch",y={},b=void 0,M=300,x=function(e){return Math.max.apply(null,e)},P=function(e){return Math.min.apply(null,e)},w={enable:u,disable:c,getConfiguration:d,setConfiguration:f};t.default=w},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){$(t.element).off("CornerstoneToolsMouseDrag",l),$(t.element).off("CornerstoneToolsMouseUp",a),$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask)){var o={deltaY:0};return $(t.element).on("CornerstoneToolsMouseDrag",o,l),$(t.element).on("CornerstoneToolsMouseUp",a),$(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function i(e,t){var o=-t.direction;(0,y.default)(t.element,o)}function l(e,t){var o=t.element,n=(0,b.getToolState)(o,"stack");if(n&&n.data&&n.data.length){var a=n.data[0],r=M.getConfiguration(),i=$(o).height()/Math.max(a.imageIds.length,8);if(r&&r.stackScrollSpeed&&(i=r.stackScrollSpeed),e.data.deltaY=e.data.deltaY||0,e.data.deltaY+=t.deltaPoints.page.y,Math.abs(e.data.deltaY)>=i){var l=e.data.deltaY/i,s=Math.round(l),u=e.data.deltaY%i;e.data.deltaY=u,(0,y.default)(o,s)}return!1}}function s(e,t){var o=I.getConfiguration();o&&o.testPointers(t)&&l(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=void 0;var u=o(9),c=n(u),d=o(22),f=n(d),g=o(11),m=n(g),v=o(18),h=n(v),p=o(1),T=n(p),C=o(49),y=n(C),b=o(0),M=(0,m.default)(r),x=(0,h.default)(i),P={eventData:{deltaY:0}},w=(0,c.default)(l,P),S={testPointers:function(e){return e.numPointers>=3}},I=(0,f.default)(s,P);I.setConfiguration(S),t.stackScroll=M,t.stackScrollWheel=x,t.stackScrollTouchDrag=w,t.stackScrollMultiTouch=I},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var o=0,n=0,r=0,i=0,l=t.top;l<t.top+t.height;l++)for(var s=t.left;s<t.left+t.width;s++){var u={x:s,y:l};(0,a.default)(t,u)&&(o+=e[i],n+=e[i]*e[i],r++),i++}if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var c=o/r,d=n/r-c*c;return{count:r,mean:c,variance:d,stdDev:Math.sqrt(d)}};var n=o(32),a=function(e){return e&&e.__esModule?e:{default:e}}(n)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){var r=Math.atan2(o.y-t.y,o.x-t.x);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(o.x-10*Math.cos(r-Math.PI/7),o.y-10*Math.sin(r-Math.PI/7)),e.lineTo(o.x-10*Math.cos(r+Math.PI/7),o.y-10*Math.sin(r+Math.PI/7)),e.lineTo(o.x,o.y),e.lineTo(o.x-10*Math.cos(r-Math.PI/7),o.y-10*Math.sin(r-Math.PI/7)),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.fillStyle=n,e.fill()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){e.beginPath(),e.strokeStyle=o,e.lineWidth=n,e.arc(t.x,t.y,6,0,2*Math.PI),e.stroke()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){var r=n/2*.5522848,i=a/2*.5522848,l=t+n,s=o+a,u=t+n/2,c=o+a/2;e.beginPath(),e.moveTo(t,c),e.bezierCurveTo(t,c-i,u-r,o,u,o),e.bezierCurveTo(u+r,o,l,c-i,l,c),e.bezierCurveTo(l,c+i,u+r,s,u,s),e.bezierCurveTo(u-r,s,t,c+i,t,c),e.closePath(),e.stroke()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),o=Math.round(o);var r=cornerstone.getEnabledElement(e),i=r.image,l=[],s=0,u=i.getPixelData(),c=void 0,d=void 0,f=void 0;if(i.color)for(d=0;d<a;d++)for(f=0;f<n;f++){c=4*((d+o)*i.columns+(f+t));var g=u[c],m=u[c+1],v=u[c+2];l[s++]=.2126*g+.7152*m+.0722*v}else for(d=0;d<a;d++)for(f=0;f<n;f++)c=(d+o)*i.columns+(f+t),l[s++]=u[c]*i.slope+i.intercept;return l}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=(0,r.getToolState)(e,"stack");if(o&&o.data&&o.data.length){var n=o.data[0],i=n.currentImageIdIndex+t;i=Math.min(n.imageIds.length-1,i),i=Math.max(0,i),(0,a.default)(e,i)}};var n=o(50),a=function(e){return e&&e.__esModule?e:{default:e}}(n),r=o(0)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function o(o){if(l.currentImageIdIndex===t){try{cornerstone.getEnabledElement(e)}catch(e){return}cornerstone.displayImage(e,o,g),d&&d(e,o)}}function n(o){var n=l.imageIds[t];f&&f(e,n,o)}var r=(0,a.getToolState)(e,"stack");if(r&&r.data&&r.data.length){var l=r.data[0];t<0&&(t+=l.imageIds.length);var c=s.default.getStartLoadHandler(),d=s.default.getEndLoadHandler(),f=s.default.getErrorLoadingHandler(),g=cornerstone.getViewport(e);if(t!==l.currentImageIdIndex){c&&c(e);var m={newImageIdIndex:t,direction:t-l.currentImageIdIndex};l.currentImageIdIndex=t;var v=l.imageIds[t],h=u.stackScroll.getConfiguration();if(h&&!0===h.retryLoadOnScroll){var p=cornerstone.imageCache.getImagePromise(v);p&&"rejected"===p.state()&&cornerstone.imageCache.removeImagePromise(v)}var T=Boolean(l.preventCache),C=void 0;C=T?cornerstone.loadImage(v):cornerstone.loadAndCacheImage(v),C.then(o,n),i.default.startGrabbing(),$(e).trigger("CornerstoneStackScroll",m)}}};var a=o(0),r=o(25),i=n(r),l=o(8),s=n(l),u=o(43)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){return cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:o/e.viewport.scale/.1,lineHeight:o/e.viewport.scale/.1,fontScale:.1}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=(0,n.planePlaneIntersection)(e,t);if(o)return{start:(0,n.projectPatientPointToImagePlane)(o.start,e),end:(0,n.projectPatientPointToImagePlane)(o.end,e)}};var n=o(33)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){var a=cornerstone.getEnabledElement(o).image,i=cornerstone.getEnabledElement(n).image;if(a&&i){var s=cornerstone.metaData.get("imagePlane",a.imageId),c=cornerstone.metaData.get("imagePlane",i.imageId);if(s&&c&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&c.rowCosines&&c.columnCosines&&c.imagePositionPatient&&s.frameOfReferenceUID===c.frameOfReferenceUID){var d=s.rowCosines.clone().cross(s.columnCosines),f=c.rowCosines.clone().cross(c.columnCosines),g=d.angleTo(f);if(!((g=Math.abs(g))<.5)){var m=(0,r.default)(s,c);if(m){var v=cornerstone.pixelToCanvas(t.element,m.start),h=cornerstone.pixelToCanvas(t.element,m.end),p=l.default.getActiveColor(),T=u.default.getToolWidth();e.setTransform(1,0,0,1,0,0),e.save(),e.beginPath(),e.strokeStyle=p,e.lineWidth=T,e.moveTo(v.x,v.y),e.lineTo(h.x,h.y),e.stroke(),e.restore()}}}}};var a=o(52),r=n(a),i=o(2),l=n(i),s=o(3),u=n(s)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function r(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.end)},a=cornerstoneMath.lineSegment.distanceToPoint(n,o);return a<5||(n.start=cornerstone.pixelToCanvas(e,t.handles.start2),n.end=cornerstone.pixelToCanvas(e,t.handles.end2),(a=cornerstoneMath.lineSegment.distanceToPoint(n,o))<5)}function i(e,t){var o=(0,x.getToolState)(e.currentTarget,P);if(void 0!==o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=void 0,r=h.default.getToolWidth(),i=T.default.getFont(),l=w.getConfiguration(),s=0;s<o.data.length;s++){n.save(),l&&l.shadow&&(n.shadowColor=l.shadowColor||"#000000",n.shadowOffsetX=l.shadowOffsetX||1,n.shadowOffsetY=l.shadowOffsetY||1);var u=o.data[s];a=u.active?y.default.getActiveColor():y.default.getToolColor(),n.beginPath(),n.strokeStyle=a,n.lineWidth=r;var c=cornerstone.pixelToCanvas(t.element,u.handles.start),d=cornerstone.pixelToCanvas(t.element,u.handles.end);n.moveTo(c.x,c.y),n.lineTo(d.x,d.y),c=cornerstone.pixelToCanvas(t.element,u.handles.start2),d=cornerstone.pixelToCanvas(t.element,u.handles.end2),n.moveTo(c.x,c.y),n.lineTo(d.x,d.y),n.stroke(),(0,M.default)(n,t,u.handles),n.fillStyle=a;var g=(Math.ceil(u.handles.start.x)-Math.ceil(u.handles.end.x))*t.image.columnPixelSpacing,v=(Math.ceil(u.handles.start.y)-Math.ceil(u.handles.end.y))*t.image.rowPixelSpacing,p=(Math.ceil(u.handles.start2.x)-Math.ceil(u.handles.end2.x))*t.image.columnPixelSpacing,C=(Math.ceil(u.handles.start2.y)-Math.ceil(u.handles.end2.y))*t.image.rowPixelSpacing,b=Math.acos(Math.abs((g*p+v*C)/(Math.sqrt(g*g+v*v)*Math.sqrt(p*p+C*C))));b*=180/Math.PI;var S=(0,m.default)(b,2),I=S.toString()+String.fromCharCode(parseInt("00B0",16)),$=(c.x+d.x)/2,k=(c.y+d.y)/2;n.font=i,(0,f.default)(n,I,$,k,a),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.angleTouch=t.angle=void 0;var l=o(6),s=n(l),u=o(7),c=n(u),d=o(4),f=n(d),g=o(34),m=n(g),v=o(3),h=n(v),p=o(12),T=n(p),C=o(2),y=n(C),b=o(5),M=n(b),x=o(0),P="angle",w=(0,s.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P}),S=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P});t.angle=w,t.angleTouch=S},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,o){o(prompt("Change your annotation:"))}function i(e){function t(t){null===t?(0,V.removeToolState)(e.element,W,o):o.text=t,o.active=!1,cornerstone.updateImage(e.element),$(e.element).on("CornerstoneToolsMouseMove",n,L.mouseMoveCallback),$(e.element).on("CornerstoneToolsMouseDown",n,L.mouseDownCallback),$(e.element).on("CornerstoneToolsMouseDownActivate",n,L.mouseDownActivateCallback),$(e.element).on("CornerstoneToolsMouseDoubleClick",n,L.mouseDoubleClickCallback)}var o=l(e),n={mouseButtonMask:e.which};(0,V.addToolState)(e.element,W,o),$(e.element).off("CornerstoneToolsMouseMove",L.mouseMoveCallback),$(e.element).off("CornerstoneToolsMouseDown",L.mouseDownCallback),$(e.element).off("CornerstoneToolsMouseDownActivate",L.mouseDownActivateCallback),$(e.element).off("CornerstoneToolsMouseDoubleClick",L.mouseDoubleClickCallback),cornerstone.updateImage(e.element),(0,D.default)(e,W,o,o.handles.end,function(){(0,R.default)(e,o.handles)&&(0,V.removeToolState)(e.element,W,o);var n=L.getConfiguration();void 0===o.text&&n.getTextCallback(t),cornerstone.updateImage(e.element)})}function l(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.end)};return cornerstoneMath.lineSegment.distanceToPoint(n,o)<25}function u(e,t){var o=(0,V.getToolState)(e.currentTarget,W);if(o){var n=t.enabledElement,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r=void 0,i=y.default.getToolWidth(),l=M.default.getFont(),s=L.getConfiguration(),u=0;u<o.data.length;u++){a.save(),s&&s.shadow&&(a.shadowColor=s.shadowColor||"#000000",a.shadowOffsetX=s.shadowOffsetX||1,a.shadowOffsetY=s.shadowOffsetY||1);var c=o.data[u];r=c.active?P.default.getActiveColor():P.default.getToolColor();var d=cornerstone.pixelToCanvas(t.element,c.handles.start),f=cornerstone.pixelToCanvas(t.element,c.handles.end);s.arrowFirst?(0,k.default)(a,f,d,r,i):(0,k.default)(a,d,f,r,i);var g={drawHandlesIfActive:s&&s.drawHandlesOnHover};if(s.drawHandles&&(0,S.default)(a,t,c.handles,r,g),c.text&&""!==c.text){a.font=l;var m=a.measureText(c.text).width+10,v=M.default.getFontSize()+10,h=Math.max(m,v)/2+5;f.x<d.x&&(h=-h);var p=void 0;if(!c.handles.textBox.hasMoved){p=s.arrowFirst?{x:f.x-m/2+h,y:f.y-v/2}:{x:d.x-m/2-h,y:d.y-v/2};var C=cornerstone.internal.getTransform(n);C.invert();var b=C.transformPoint(p.x,p.y);c.handles.textBox.x=b.x,c.handles.textBox.y=b.y}p=cornerstone.pixelToCanvas(t.element,c.handles.textBox);var x=(0,T.default)(a,c.text,p.x,p.y,r);if(c.handles.textBox.boundingBox=x,c.handles.textBox.hasMoved){var w={start:{},end:{}},I={x:(d.x+f.x)/2,y:(d.y+f.y)/2},$=[d,f,I];w.end.x=p.x,w.end.y=p.y,w.start=cornerstoneMath.point.findClosestPoint($,w.end);var O=[{x:x.left+x.width/2,y:x.top},{x:x.left,y:x.top+x.height/2},{x:x.left+x.width/2,y:x.top+x.height},{x:x.left+x.width,y:x.top+x.height/2}];w.end=cornerstoneMath.point.findClosestPoint(O,w.start),a.beginPath(),a.strokeStyle=r,a.lineWidth=i,a.setLineDash([2,3]),a.moveTo(w.start.x,w.start.y),a.lineTo(w.end.x,w.end.y),a.stroke()}}a.restore()}}}function c(e){function t(e){null===e?(0,V.removeToolState)(o,W,n):n.text=e,n.active=!1,cornerstone.updateImage(o),$(o).on("CornerstoneToolsTouchPress",F.pressCallback),$(o).on("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),$(o).on("CornerstoneToolsTap",F.tapCallback)}var o=e.element,n=l(e);(0,V.addToolState)(o,W,n),$(o).off("CornerstoneToolsTouchPress",F.pressCallback),$(o).off("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),$(o).off("CornerstoneToolsTap",F.tapCallback),cornerstone.updateImage(o),(0,j.default)(e,W,n,n.handles.end,function(){cornerstone.updateImage(o),(0,R.default)(e,n.handles)&&(0,V.removeToolState)(o,W,n);var a=L.getConfiguration();void 0===n.text&&a.getTextCallback(t)})}function d(e,t){function o(e,t,o){!0===o?(0,V.removeToolState)(n,W,e):e.text=t,e.active=!1,cornerstone.updateImage(n)}var n=t.element,a=void 0;if(!e.data||!e.data.mouseButtonMask||(0,B.default)(t.which,e.data.mouseButtonMask)){var r=L.getConfiguration(),i=t.currentPoints.canvas,l=(0,V.getToolState)(n,W);if(l)for(var u=0;u<l.data.length;u++)if(a=l.data[u],s(n,a,i)||(0,H.default)(a.handles.textBox,i))return a.active=!0,cornerstone.updateImage(n),r.changeTextCallback(a,t,o),e.stopImmediatePropagation(),!1}}function f(e,t){function o(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?(0,V.removeToolState)(n,W,e):e.text=t,e.active=!1,cornerstone.updateImage(n),$(n).on("CornerstoneToolsTouchStart",F.touchStartCallback),$(n).on("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),$(n).on("CornerstoneToolsTap",F.tapCallback)}var n=t.element,a=void 0;if(!e.data||!e.data.mouseButtonMask||(0,B.default)(t.which,e.data.mouseButtonMask)){var r=L.getConfiguration(),i=t.currentPoints.canvas,l=(0,V.getToolState)(n,W);if(l){if(t.handlePressed)return $(n).off("CornerstoneToolsTouchStart",F.touchStartCallback),$(n).off("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),$(n).off("CornerstoneToolsTap",F.tapCallback),r.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var u=0;u<l.data.length;u++)if(a=l.data[u],s(n,a,i)||(0,H.default)(a.handles.textBox,i))return a.active=!0,cornerstone.updateImage(n),$(n).off("CornerstoneToolsTouchStart",F.touchStartCallback),$(n).off("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),$(n).off("CornerstoneToolsTap",F.tapCallback),r.changeTextCallback(a,t,o),e.stopImmediatePropagation(),!1;return!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.arrowAnnotateTouch=t.arrowAnnotate=void 0;var g=o(6),m=n(g),v=o(7),h=n(v),p=o(4),T=n(p),C=o(3),y=n(C),b=o(12),M=n(b),x=o(2),P=n(x),w=o(5),S=n(w),I=o(45),k=n(I),O=o(20),D=n(O),_=o(21),j=n(_),E=o(10),R=n(E),A=o(1),B=n(A),N=o(16),H=n(N),V=o(0),W="arrowAnnotate",Y={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0},L=(0,m.default)({addNewMeasurement:i,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:W,mouseDoubleClickCallback:d});L.setConfiguration(Y);var F=(0,h.default)({addNewMeasurement:c,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:W,pressCallback:f});t.arrowAnnotate=L,t.arrowAnnotateTouch=F},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e.stopImmediatePropagation();var o=(0,p.getToolState)(e.currentTarget,b);if(o){var n=e.currentTarget,a=cornerstone.getEnabledElement(n),r=a.image.imageId,i=cornerstone.metaData.get("imagePlane",r),l=t.currentPoints.image,s=(0,y.imagePointToPatientPoint)(l,i);o.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==n){var t=Number.MAX_VALUE,o=-1,a=(0,p.getToolState)(e,"stack");if(void 0!==a){var r=a.data[0];if(r.imageIds.forEach(function(e,n){var a=cornerstone.metaData.get("imagePlane",e),r=a.imagePositionPatient,i=a.rowCosines.clone(),l=a.columnCosines.clone(),u=l.clone().cross(i.clone()),c=Math.abs(u.clone().dot(r)-u.clone().dot(s));c<t&&(t=c,o=n)}),o!==r.currentImageIdIndex&&-1!==o&&void 0!==r.imageIds[o]){var i=h.default.getStartLoadHandler(),l=h.default.getEndLoadHandler(),u=h.default.getErrorLoadingHandler();i&&i(e);var c=void 0;c=!0===r.preventCache?cornerstone.loadImage(r.imageIds[o]):cornerstone.loadAndCacheImage(r.imageIds[o]),c.then(function(t){var n=cornerstone.getViewport(e);r.currentImageIdIndex=o,cornerstone.displayImage(e,t,n),l&&l(e,t)},function(t){var n=r.imageIds[o];u&&u(e,n,t)})}}}})}}function r(e,t){$(t.element).off("CornerstoneToolsMouseDrag",l),$(t.element).off("CornerstoneToolsMouseUp",r)}function i(e,t){if((0,C.default)(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",l),$(t.element).on("CornerstoneToolsMouseUp",r),a(e,t),!1}function l(e,t){return a(e,t),!1}function s(e,t,o){var n={mouseButtonMask:t};(0,p.clearToolState)(e,b),(0,p.addToolState)(e,b,{synchronizationContext:o}),$(e).off("CornerstoneToolsMouseDown",i),$(e).on("CornerstoneToolsMouseDown",n,i)}function u(e){$(e).off("CornerstoneToolsMouseDown",i)}function c(e,t){$(t.element).off("CornerstoneToolsTouchDrag",f),$(t.element).off("CornerstoneToolsDragEnd",c)}function d(e,t){return $(t.element).on("CornerstoneToolsTouchDrag",f),$(t.element).on("CornerstoneToolsDragEnd",c),a(e,t),!1}function f(e,t){return a(e,t),!1}function g(e,t){(0,p.clearToolState)(e,b),(0,p.addToolState)(e,b,{synchronizationContext:t}),$(e).off("CornerstoneToolsTouchStart",d),$(e).on("CornerstoneToolsTouchStart",d)}function m(e){$(e).off("CornerstoneToolsTouchStart",d)}Object.defineProperty(t,"__esModule",{value:!0}),t.crosshairsTouch=t.crosshairs=void 0;var v=o(8),h=n(v),p=o(0),T=o(1),C=n(T),y=o(33),b="crosshairs",M={activate:s,deactivate:u,enable:s,disable:u},x={activate:g,deactivate:m,enable:g,disable:m};t.crosshairs=M,t.crosshairsTouch=x},function(e,t,o){"use strict";function n(e){cornerstone.fitToWindow(e.element)}function a(e,t){return l.strategy(t),!1}Object.defineProperty(t,"__esModule",{value:!0});var r=o(35),i=function(e){return e&&e.__esModule?e:{default:e}}(r),l=(0,i.default)(a);l.strategies={default:n},l.strategy=n,t.default=l},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=cornerstone.getEnabledElement(e.element),o=t.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);var n=p.default.getActiveColor(),a=v.default.getFont(),r=v.default.getFontSize(),i=I.getConfiguration();o.save(),i&&i.shadow&&(o.shadowColor=i.shadowColor||"#000000",o.shadowOffsetX=i.shadowOffsetX||1,o.shadowOffsetY=i.shadowOffsetY||1);var l=Math.round(e.currentPoints.image.x),s=Math.round(e.currentPoints.image.y),u=void 0,c=void 0,d=void 0;if(!(l<0||s<0||l>=e.image.columns||s>=e.image.rows)){if(e.image.color)u=(0,b.default)(e.element,l,s,1,1),c=l+", "+s,d="R: "+u[0]+" G: "+u[1]+" B: "+u[2]+" A: "+u[3];else{u=cornerstone.getStoredPixels(e.element,l,s,1,1);var f=u[0],g=f*e.image.slope+e.image.intercept,m=(0,x.default)(e.image,f);c=l+", "+s,d="SP: "+f+" MO: "+parseFloat(g.toFixed(3)),m&&(d+=" SUV: "+parseFloat(m.toFixed(3)))}var h={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},T=cornerstone.pixelToCanvas(e.element,h);o.font=a,o.fillStyle=n,(0,C.default)(o,d,T.x,T.y+r+5,n),(0,C.default)(o,c,T.x,T.y,n),o.restore()}}function r(e){var t=e.element,o=cornerstone.getEnabledElement(t),n=o.image,a=o.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=p.default.getActiveColor(),i=v.default.getFont(),l=I.getConfiguration();a.save(),l&&l.shadow&&(a.shadowColor=l.shadowColor||"#000000",a.shadowOffsetX=l.shadowOffsetX||1,a.shadowOffsetY=l.shadowOffsetY||1);var s=cornerstone.metaData.get("generalSeriesModule",n.imageId),u=void 0;s&&(u=s.modality);var c=void 0;c=!0===e.isTouchEvent?cornerstone.pageToPixel(t,e.currentPoints.page.x,e.currentPoints.page.y-4*v.default.getFontSize()):cornerstone.pageToPixel(t,e.currentPoints.page.x,e.currentPoints.page.y-v.default.getFontSize()/2);var d=void 0,f="";if(!(c.x<0||c.y<0||c.x>=n.columns||c.y>=n.rows)){if(n.color)d=(0,b.default)(t,c.x,c.y,1,1),f="R: "+d[0]+" G: "+d[1]+" B: "+d[2];else{d=cornerstone.getStoredPixels(t,c.x,c.y,1,1);var g=d[0],m=g*e.image.slope+e.image.intercept,h=parseFloat(m.toFixed(2));if("CT"===u)f+="HU: "+h;else if("PT"===u){f+=h;var T=(0,x.default)(e.image,g);T&&(f+=" SUV: "+parseFloat(T.toFixed(2)))}else f+=h}var y=cornerstone.pixelToCanvas(t,c);a.font=i,a.fillStyle=r;var M=void 0,P=a.measureText(f).width;M=!0===e.isTouchEvent?{x:-P/2-5,y:-v.default.getFontSize()-10-12}:{x:12,y:-(v.default.getFontSize()+10)/2},a.beginPath(),a.strokeStyle=r,a.arc(y.x,y.y,6,0,2*Math.PI),a.stroke(),(0,C.default)(a,f,y.x+M.x,y.y+M.y,r),a.restore()}}function i(e,t){var o=t.element;$(o).off("CornerstoneImageRendered",s),$(o).off("CornerstoneToolsMouseDrag",u),$(o).off("CornerstoneToolsMouseUp",i),$(o).off("CornerstoneToolsMouseClick",i),cornerstone.updateImage(t.element)}function l(e,t){var o=t.element;if((0,w.default)(t.which,e.data.mouseButtonMask))return $(o).on("CornerstoneImageRendered",s),$(o).on("CornerstoneToolsMouseDrag",u),$(o).on("CornerstoneToolsMouseUp",i),$(o).on("CornerstoneToolsMouseClick",i),I.strategy(t),!1}function s(){S&&(I.strategy(S),S=null)}function u(e,t){var o=t.element;return S=t,cornerstone.updateImage(o),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.dragProbeTouch=t.dragProbe=void 0;var c=o(11),d=n(c),f=o(9),g=n(f),m=o(12),v=n(m),h=o(2),p=n(h),T=o(4),C=n(T),y=o(30),b=n(y),M=o(15),x=n(M),P=o(1),w=n(P),S=void 0,I=(0,d.default)(l);I.strategies={default:a,minimal:r},I.strategy=a;var k={fireOnTouchStart:!0},O=(0,g.default)(u,k);t.dragProbe=I,t.dragProbeTouch=O},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o,n){var a=cornerstone.pixelToCanvas(e,t.handles.start),r=cornerstone.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x)+n/2,top:Math.min(a.y,r.y)+n/2,width:Math.abs(a.x-r.x)-n,height:Math.abs(a.y-r.y)-n},l={left:Math.min(a.x,r.x)-n/2,top:Math.min(a.y,r.y)-n/2,width:Math.abs(a.x-r.x)+n,height:Math.abs(a.y-r.y)+n},s=(0,w.default)(i,o);return!(!(0,w.default)(l,o)||s)}function i(e,t,o){return r(e,t,o,15)}function l(e,t,o){return r(e,t,o,25)}function s(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function u(e,t){var o=(0,O.getToolState)(e.currentTarget,D);if(o){var n=t.image,a=t.element,r=v.default.getToolWidth(),i=_.getConfiguration(),l=t.canvasContext.canvas.getContext("2d"),u=cornerstone.metaData.get("generalSeriesModule",n.imageId),c=void 0;u&&(c=u.modality),l.setTransform(1,0,0,1,0,0);for(var d=0;d<o.data.length;d++){l.save();var f=o.data[d];i&&i.shadow&&(l.shadowColor=i.shadowColor||"#000000",l.shadowOffsetX=i.shadowOffsetX||1,l.shadowOffsetY=i.shadowOffsetY||1);var g=p.default.getColorIfActive(f.active),m=cornerstone.pixelToCanvas(a,f.handles.start),h=cornerstone.pixelToCanvas(a,f.handles.end),T=Math.min(m.x,h.x),y=Math.min(m.y,h.y),M=Math.abs(m.x-h.x),P=Math.abs(m.y-h.y);if(l.beginPath(),l.strokeStyle=g,l.lineWidth=r,(0,x.default)(l,T,y,M,P),l.closePath(),i&&i.drawHandlesOnHover)if(!0===f.active)(0,C.default)(l,t,f.handles,g);else{var w={drawHandlesIfActive:!0};(0,C.default)(l,t,f.handles,g,w)}else(0,C.default)(l,t,f.handles,g);var S=void 0,$=void 0,j=void 0;if(!1===f.invalidated)$=f.meanStdDev,j=f.meanStdDevSUV,S=f.area;else{var E={left:Math.round(Math.min(f.handles.start.x,f.handles.end.x)),top:Math.round(Math.min(f.handles.start.y,f.handles.end.y)),width:Math.round(Math.abs(f.handles.start.x-f.handles.end.x)),height:Math.round(Math.abs(f.handles.start.y-f.handles.end.y))};if(!n.color){var R=cornerstone.getPixels(a,E.left,E.top,E.width,E.height);$=(0,I.default)(R,E),"PT"===c&&(j={mean:(0,k.default)(n,($.mean-n.intercept)/n.slope),stdDev:(0,k.default)(n,($.stdDev-n.intercept)/n.slope)}),$&&!isNaN($.mean)&&(f.meanStdDev=$,f.meanStdDevSUV=j)}var A=n.columnPixelSpacing||1,B=n.rowPixelSpacing||1;S=Math.PI*(E.width*A/2)*(E.height*B/2),isNaN(S)||(f.area=S),f.invalidated=!1}var N=[];if($&&void 0!==$.mean){var H="";"CT"===c&&(H=" HU");var V="Mean: "+s($.mean.toFixed(2))+H,W="StdDev: "+s($.stdDev.toFixed(2))+H;if(j&&void 0!==j.mean){V+=" SUV: "+s(j.mean.toFixed(2)),W+=" SUV: "+s(j.stdDev.toFixed(2))}N.push(V),N.push(W)}if(S){var Y=" mm"+String.fromCharCode(178);n.rowPixelSpacing&&n.columnPixelSpacing||(Y=" pixels"+String.fromCharCode(178));var L="Area: "+s(S.toFixed(2))+Y;N.push(L)}f.handles.textBox.hasMoved||(f.handles.textBox.x=Math.max(f.handles.start.x,f.handles.end.x),f.handles.textBox.y=(f.handles.start.y+f.handles.end.y)/2);var F=cornerstone.pixelToCanvas(a,f.handles.textBox),U={centering:{x:!1,y:!0}},z=(0,b.default)(l,N,F.x,F.y,g,U);if(f.handles.textBox.boundingBox=z,f.handles.textBox.hasMoved){var X={start:{},end:{x:F.x,y:F.y}},q=[{x:T+M/2,y:y},{x:T,y:y+P/2},{x:T+M/2,y:y+P},{x:T+M,y:y+P/2}];X.start=cornerstoneMath.point.findClosestPoint(q,X.end);var G=[{x:z.left+z.width/2,y:z.top},{x:z.left,y:z.top+z.height/2},{x:z.left+z.width/2,y:z.top+z.height},{x:z.left+z.width,y:z.top+z.height/2}];X.end=cornerstoneMath.point.findClosestPoint(G,X.start),l.beginPath(),l.strokeStyle=g,l.lineWidth=r,l.setLineDash([2,3]),l.moveTo(X.start.x,X.start.y),l.lineTo(X.end.x,X.end.y),l.stroke()}l.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ellipticalRoiTouch=t.ellipticalRoi=void 0;var c=o(6),d=n(c),f=o(7),g=n(f),m=o(3),v=n(m),h=o(2),p=n(h),T=o(5),C=n(T),y=o(4),b=n(y),M=o(47),x=n(M),P=o(32),w=n(P),S=o(44),I=n(S),$=o(15),k=n($),O=o(0),D="ellipticalRoi",_=(0,d.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:i,toolType:D}),j=(0,g.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:l,toolType:D});t.ellipticalRoi=_,t.ellipticalRoiTouch=j},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,I.getToolState)(e.element,k);if(void 0!==t){var o=D.getConfiguration(),n=t.data[o.currentTool],a={x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,lines:[]};n.handles.length&&n.handles[o.currentHandle-1].lines.push(e.currentPoints.image),n.handles.push(a),o.currentHandle+=1,o.freehand=!1,cornerstone.updateImage(e.element)}}function r(e,t){var o=(0,I.getToolState)(e.element,k);if(void 0!==o){var n=o.data[t];if(void 0!==n.handles)for(var a=e.currentPoints.canvas,r=0;r<n.handles.length;r++){var i=cornerstone.pixelToCanvas(e.element,n.handles[r]);if(cornerstoneMath.point.distance(i,a)<5)return r}}}function i(e){var t=(0,I.getToolState)(e.element,k);if(t)for(var o=void 0,n=0;n<t.data.length;n++)if(void 0!==(o=r(e,n)))return{handleNearby:o,toolIndex:n}}function l(e,t){if($(t.element).off("CornerstoneToolsMouseUp",l),void 0!==(0,I.getToolState)(t.element,k)){var o=D.getConfiguration();t.event.shiftKey||(o.freehand=!1),cornerstone.updateImage(t.element)}}function s(e,t){var o=(0,I.getToolState)(t.element,k);if(o){var n=D.getConfiguration(),a=o.data[n.currentTool],i=Math.max(t.currentPoints.image.x,0);i=Math.min(i,t.image.width),n.mouseLocation.handles.start.x=i;var l=Math.max(t.currentPoints.image.y,0);l=Math.min(l,t.image.height),n.mouseLocation.handles.start.y=l;var s=n.currentHandle;if(n.modifying&&(a.active=!0,a.highlight=!0,a.handles[s].x=n.mouseLocation.handles.start.x,a.handles[s].y=n.mouseLocation.handles.start.y,s)){var u=a.handles[s-1].lines.length-1,c=a.handles[s-1].lines[u];c.x=n.mouseLocation.handles.start.x,c.y=n.mouseLocation.handles.start.y}if(n.freehand)a.handles[s-1].lines.push(t.currentPoints.image);else{var d=r(t,n.currentTool);void 0!==d&&d<a.handles.length-1&&(n.mouseLocation.handles.start.x=a.handles[d].x,n.mouseLocation.handles.start.y=a.handles[d].y)}cornerstone.updateImage(t.element)}}function u(e){$(e.element).on("CornerstoneToolsMouseMove",s),$(e.element).on("CornerstoneToolsMouseUp",l);var t={visible:!0,active:!0,handles:[]},o=D.getConfiguration();o.mouseLocation.handles.start.x=e.currentPoints.image.x,o.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,I.addToolState)(e.element,k,t);var n=(0,I.getToolState)(e.element,k);o.currentTool=n.data.length-1}function c(e,t){var o=(0,I.getToolState)(e.element,k);if(o){var n=D.getConfiguration(),a=o.data[n.currentTool];a.active=!1,a.highlight=!1,void 0!==t&&a.handles[n.currentHandle-1].lines.push({x:a.handles[t].x,y:a.handles[t].y}),n.modifying&&(n.modifying=!1),n.currentHandle=0,n.currentTool=-1,$(e.element).off("CornerstoneToolsMouseMove",s),cornerstone.updateImage(e.element)}}function d(e,t){if((0,S.default)(t.which,e.data.mouseButtonMask)){var o=(0,I.getToolState)(t.element,k),n=void 0,d=void 0,f=D.getConfiguration(),g=f.currentTool;if(f.modifying)return void c(t);if(g<0){var m=i(t);m?(n=m.handleNearby,d=m.toolIndex,void 0!==n&&($(t.element).on("CornerstoneToolsMouseMove",s),$(t.element).on("CornerstoneToolsMouseUp",l),f.modifying=!0,f.currentHandle=n,f.currentTool=d)):(u(t),a(t))}else g>=0&&o.data[g].active&&(n=r(t,g),void 0!==n?c(t,n):t.event.shiftKey?f.freehand=!0:a(t));return!1}}function f(e,t){var o=(0,I.getToolState)(e.currentTarget,k);if(void 0!==o){var n=D.getConfiguration(),a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r=void 0,i=y.default.getToolWidth(),l=M.default.getFillColor(),s=0;s<o.data.length;s++){a.save();var u=o.data[s];u.active?(r=M.default.getActiveColor(),l=M.default.getFillColor()):(r=M.default.getToolColor(),l=M.default.getToolColor());var c=void 0;if(u.handles.length)for(var d=0;d<u.handles.length;d++){c=u.handles[d];var f=cornerstone.pixelToCanvas(t.element,c);a.beginPath(),a.strokeStyle=r,a.lineWidth=i,a.moveTo(f.x,f.y);for(var g=0;g<u.handles[d].lines.length;g++){var m=cornerstone.pixelToCanvas(t.element,u.handles[d].lines[g]);a.lineTo(m.x,m.y),a.stroke()}var v=cornerstone.pixelToCanvas(t.element,n.mouseLocation.handles.start);d===u.handles.length-1&&(!u.active||n.freehand||n.modifying||(a.lineTo(v.x,v.y),a.stroke()))}var h={fill:l};u.active&&(0,P.default)(a,t,n.mouseLocation.handles,r,h),(0,P.default)(a,t,u.handles,r,h),a.restore()}}}function g(e){$(e).off("CornerstoneToolsMouseDown",d),$(e).off("CornerstoneToolsMouseUp",l),$(e).off("CornerstoneToolsMouseMove",s),$(e).off("CornerstoneImageRendered",f),$(e).on("CornerstoneImageRendered",f),cornerstone.updateImage(e)}function m(e){$(e).off("CornerstoneToolsMouseDown",d),$(e).off("CornerstoneToolsMouseUp",l),$(e).off("CornerstoneToolsMouseMove",s),$(e).off("CornerstoneImageRendered",f),cornerstone.updateImage(e)}function v(e,t){var o={mouseButtonMask:t};$(e).off("CornerstoneToolsMouseDown",o,d),$(e).off("CornerstoneToolsMouseUp",l),$(e).off("CornerstoneToolsMouseMove",s),$(e).off("CornerstoneImageRendered",f),$(e).on("CornerstoneImageRendered",f),$(e).on("CornerstoneToolsMouseDown",o,d),cornerstone.updateImage(e)}function h(e){$(e).off("CornerstoneToolsMouseDown",d),$(e).off("CornerstoneToolsMouseUp",l),$(e).off("CornerstoneToolsMouseMove",s),$(e).off("CornerstoneImageRendered",f),$(e).on("CornerstoneImageRendered",f),cornerstone.updateImage(e)}function p(){return O}function T(e){O=e}Object.defineProperty(t,"__esModule",{value:!0}),t.freehand=void 0;var C=o(3),y=n(C),b=o(2),M=n(b),x=o(5),P=n(x),w=o(1),S=n(w),I=o(0),k="freehand",O={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1},D={enable:g,disable:m,activate:v,deactivate:h,getConfiguration:p,setConfiguration:T};t.freehand=D},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,T.getToolState)(e.event.currentTarget,C);if(!(t&&t.data&&t.data.length>0)){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}}function r(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.start),a=cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(n.x,a.x),top:Math.min(n.y,a.y),width:Math.abs(n.x-a.x),height:Math.abs(n.y-a.y)},i=!1;return o.x>=r.left&&o.x<=r.left+r.width&&o.y>=r.top&&o.y<=r.top+r.height&&(i=!0),i}function i(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.start),a=cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(n.x,a.x),top:Math.min(n.y,a.y),width:Math.abs(n.x-a.x),height:Math.abs(n.y-a.y)};return cornerstoneMath.rect.distanceToPoint(r,o)<5}function l(e,t){var o=(0,T.getToolState)(e.currentTarget,C);if(void 0!==o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);var a=void 0,r=g.default.getToolWidth();n.save();var i=o.data[0];if(i){a=i.active?v.default.getActiveColor():v.default.getToolColor();var l=cornerstone.pixelToCanvas(t.element,i.handles.start),s=cornerstone.pixelToCanvas(t.element,i.handles.end),u={left:Math.min(l.x,s.x),top:Math.min(l.y,s.y),width:Math.abs(l.x-s.x),height:Math.abs(l.y-s.y)};n.beginPath(),n.strokeStyle="transparent",n.rect(0,0,n.canvas.clientWidth,n.canvas.clientHeight),n.rect(u.width+u.left,u.top,-u.width,u.height),n.stroke(),n.fillStyle="rgba(0,0,0,0.7)",n.fill(),n.closePath(),n.beginPath(),n.strokeStyle=a,n.lineWidth=r,n.setLineDash([4]),n.strokeRect(u.left,u.top,u.width,u.height),n.setLineDash([]),(0,p.default)(n,t,i.handles,a),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.highlightTouch=t.highlight=void 0;var s=o(36),u=n(s),c=o(7),d=n(c),f=o(3),g=n(f),m=o(2),v=n(m),h=o(5),p=n(h),T=o(0),C="highlight",y=(0,u.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,pointInsideRect:r,toolType:C},!0),b=(0,d.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,pointInsideRect:r,toolType:C},!0);t.highlight=y,t.highlightTouch=b},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=t.image,n=o.stats,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=[];Object.keys(n).forEach(function(e){var t=e+" : "+n[e];r.push(t)}),(0,s.default)(a,r,0,0,"orange"),r.forEach(function(e){console.log(e)})}Object.defineProperty(t,"__esModule",{value:!0});var r=o(17),i=n(r),l=o(4),s=n(l),u=(0,i.default)(a);t.default=u},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.end)};return cornerstoneMath.lineSegment.distanceToPoint(n,o)<25}function i(e,t){var o=(0,C.getToolState)(e.currentTarget,y);if(o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=m.default.getToolWidth(),r=b.getConfiguration(),i=0;i<o.data.length;i++){n.save(),r&&r.shadow&&(n.shadowColor=r.shadowColor||"#000000",n.shadowOffsetX=r.shadowOffsetX||1,n.shadowOffsetY=r.shadowOffsetY||1);var l=o.data[i],s=h.default.getColorIfActive(l.active),u=cornerstone.pixelToCanvas(t.element,l.handles.start),c=cornerstone.pixelToCanvas(t.element,l.handles.end);n.beginPath(),n.strokeStyle=s,n.lineWidth=a,n.moveTo(u.x,u.y),n.lineTo(c.x,c.y),n.stroke();var d={drawHandlesIfActive:r&&r.drawHandlesOnHover};(0,T.default)(n,t,l.handles,s,d),n.fillStyle=s;var g=(l.handles.end.x-l.handles.start.x)*(t.image.columnPixelSpacing||1),v=(l.handles.end.y-l.handles.start.y)*(t.image.rowPixelSpacing||1),p=Math.sqrt(g*g+v*v);l.length=p;var M=" mm";t.image.rowPixelSpacing&&t.image.columnPixelSpacing||(M=" pixels");var x=""+p.toFixed(2)+M;if(!l.handles.textBox.hasMoved){var P={x:Math.max(l.handles.start.x,l.handles.end.x)};P.x===l.handles.start.x?P.y=l.handles.start.y:P.y=l.handles.end.y,l.handles.textBox.x=P.x,l.handles.textBox.y=P.y}var w=cornerstone.pixelToCanvas(t.element,l.handles.textBox);w.x+=10;var S={centering:{x:!1,y:!0}},I=(0,f.default)(n,x,w.x,w.y,s,S);if(l.handles.textBox.boundingBox=I,l.handles.textBox.hasMoved){var $={start:{},end:{}},k={x:(u.x+c.x)/2,y:(u.y+c.y)/2},O=[u,c,k];$.end.x=w.x,$.end.y=w.y,$.start=cornerstoneMath.point.findClosestPoint(O,$.end);var D=[{x:I.left+I.width/2,y:I.top},{x:I.left,y:I.top+I.height/2},{x:I.left+I.width/2,y:I.top+I.height},{x:I.left+I.width,y:I.top+I.height/2}];$.end=cornerstoneMath.point.findClosestPoint(D,$.start),n.beginPath(),n.strokeStyle=s,n.lineWidth=a,n.setLineDash([2,3]),n.moveTo($.start.x,$.start.y),n.lineTo($.end.x,$.end.y),n.stroke()}n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.lengthTouch=t.length=void 0;var l=o(6),s=n(l),u=o(7),c=n(u),d=o(4),f=n(d),g=o(3),m=n(g),v=o(2),h=n(v),p=o(5),T=n(p),C=o(0),y="length",b=(0,s.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:y}),M=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:y});t.length=b,t.lengthTouch=M},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=t.element;$(o).off("CornerstoneToolsMouseDrag",u),$(o).off("CornerstoneToolsMouseUp",a),$(o).off("CornerstoneToolsMouseClick",a),$(o).off("CornerstoneNewImage",l),r(t)}function r(e){$(e.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function i(e,t){var o=t.element;if((0,M.default)(t.which,e.data.mouseButtonMask))return $(o).on("CornerstoneToolsMouseDrag",t,u),$(o).on("CornerstoneToolsMouseUp",t,a),$(o).on("CornerstoneToolsMouseClick",t,a),w=t.currentPoints,$(o).on("CornerstoneNewImage",t,l),c(t),!1}function l(e,t){t.currentPoints=w,c(t)}function s(e,t){var o=t.element;$(t.element).off("CornerstoneToolsDragEnd",s),$(t.element).off("CornerstoneToolsTouchEnd",s),$(o).off("CornerstoneNewImage",l),r(t)}function u(e,t){return w=t.currentPoints,c(t),!0===t.isTouchEvent&&($(t.element).on("CornerstoneToolsDragEnd",s),$(t.element).on("CornerstoneToolsTouchEnd",s)),!1}function c(e){var t=$(e.element).find(".magnifyTool").get(0);t||d(e.element);var o=S.getConfiguration(),n=o.magnifySize,a=o.magnificationLevel,r=$(e.element).find("canvas").not(".magnifyTool").get(0);r.getContext("2d").setTransform(1,0,0,1,0,0);var i=t.getContext("2d");i.setTransform(1,0,0,1,0,0);var l=n/a,s=cornerstone.pixelToCanvas(e.element,e.currentPoints.image);!0===e.isTouchEvent&&(s.y-=1.25*l),s.x=Math.max(s.x,0),s.x=Math.min(s.x,r.width),s.y=Math.max(s.y,0),s.y=Math.min(s.y,r.height),i.clearRect(0,0,n,n),i.fillStyle="transparent",i.fillRect(0,0,n,n);var u={x:s.x-.5*l,y:s.y-.5*l};"Safari"===P&&(u.x=Math.max(u.x,0),u.y=Math.max(u.y,0)),u.x=Math.min(u.x,r.width),u.y=Math.min(u.y,r.height);var c={x:(r.width-u.x)*a,y:(r.height-u.y)*a};i.drawImage(r,u.x,u.y,r.width-u.x,r.height-u.y,0,0,c.x,c.y),t.style.top=s.y-.5*n+"px",t.style.left=s.x-.5*n+"px",t.style.display="block",document.body.style.cursor="none"}function d(e){if(0===$(e).find(".magnifyTool").length){var t=document.createElement("canvas");t.classList.add("magnifyTool");var o=S.getConfiguration();t.width=o.magnifySize,t.height=o.magnifySize,t.style.position="absolute",e.appendChild(t)}}function f(e){$(e).find(".magnifyTool").remove()}function g(e){$(e).off("CornerstoneToolsMouseDown",i),f(e)}function m(e){if(!P){var t=(0,y.getBrowserInfo)(),o=t.split(" ");P=o[0]}d(e)}function v(e,t){var o={mouseButtonMask:t};$(e).off("CornerstoneToolsMouseDown",i),$(e).on("CornerstoneToolsMouseDown",o,i),d(e)}function h(){return x}function p(e){x=e}Object.defineProperty(t,"__esModule",{value:!0}),t.magnifyTouchDrag=t.magnify=void 0;var T=o(9),C=n(T),y=o(29),b=o(1),M=n(b),x={magnifySize:100,magnificationLevel:2},P=void 0,w=void 0,S={enable:m,activate:v,deactivate:g,disable:g,getConfiguration:h,setConfiguration:p},I={fireOnTouchStart:!0,activateCallback:d,disableCallback:f},k=(0,C.default)(u,I);t.magnify=S,t.magnifyTouchDrag=k},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=cornerstone.getEnabledElement(e),o=cornerstone.metaData.get("imagePlane",t.image.imageId);if(o&&o.rowCosines&&o.columnCosines){var n=s.default.getOrientationString(o.rowCosines),a=s.default.getOrientationString(o.columnCosines),r=s.default.invertOrientationString(n);return{top:s.default.invertOrientationString(a),bottom:a,left:r,right:n}}}function r(e){var t=cornerstone.getEnabledElement(e),o=void 0;o={x:t.image.width/2,y:5};var n=cornerstone.pixelToCanvas(e,o);o={x:t.image.width/2,y:t.image.height-5};var a=cornerstone.pixelToCanvas(e,o);o={x:5,y:t.image.height/2};var r=cornerstone.pixelToCanvas(e,o);return o={x:t.image.width-10,y:t.image.height/2},{top:n,bottom:a,left:r,right:cornerstone.pixelToCanvas(e,o)}}function i(e,t){var o=t.element,n=a(o);if(n){var i=r(o,n),l=t.canvasContext.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0);var s=f.default.getToolColor(),u={top:l.measureText(n.top).width,left:l.measureText(n.left).width,right:l.measureText(n.right).width,bottom:l.measureText(n.bottom).width};(0,m.default)(l,n.top,i.top.x-u.top/2,i.top.y,s),(0,m.default)(l,n.left,i.left.x-u.left/2,i.left.y,s);var c=v.getConfiguration();c&&c.drawAllMarkers&&((0,m.default)(l,n.right,i.right.x-u.right/2,i.right.y,s),(0,m.default)(l,n.bottom,i.bottom.x-u.bottom/2,i.bottom.y,s))}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(41),s=n(l),u=o(17),c=n(u),d=o(2),f=n(d),g=o(4),m=n(g),v=(0,c.default)(i);t.default=v},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){$(t.element).off("CornerstoneToolsMouseDrag",i),$(t.element).off("CornerstoneToolsMouseUp",a),$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,f.default)(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",i),$(t.element).on("CornerstoneToolsMouseUp",a),$(t.element).on("CornerstoneToolsMouseClick",a),!1}function i(e,t){var o=t.viewport.scale,n=t.viewport.scale;return t.image.rowPixelSpacing<t.image.columnPixelSpacing?o*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(n*=t.image.rowPixelSpacing/t.image.columnPixelSpacing),t.viewport.translation.x+=t.deltaPoints.page.x/o,t.viewport.translation.y+=t.deltaPoints.page.y/n,cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.panTouchDrag=t.pan=void 0;var l=o(11),s=n(l),u=o(9),c=n(u),d=o(1),f=n(d),g=(0,s.default)(r),m=(0,c.default)(i);t.pan=g,t.panTouchDrag=m},function(e,t,o){"use strict";function n(e,t){var o=l.getConfiguration();if(o&&o.testPointers(t))return t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0});var a=o(22),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i={testPointers:function(e){return e.numPointers>=2}},l=(0,r.default)(n);l.setConfiguration(i),t.default=l},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function r(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.end);return cornerstoneMath.point.distance(n,o)<5}function i(e,t){var o=(0,x.getToolState)(e.currentTarget,P);if(o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=void 0,r=m.default.getFont(),i=m.default.getFontSize(),l=0;l<o.data.length;l++){n.save();var s=o.data[l];a=s.active?f.default.getActiveColor():f.default.getToolColor(),(0,h.default)(n,t,s.handles,a);var u=Math.round(s.handles.end.x),c=Math.round(s.handles.end.y),d=void 0,g=void 0,v=void 0;if(u<0||c<0||u>=t.image.columns||c>=t.image.rows)return;if(t.image.color)g=u+", "+c,d=(0,y.default)(t.element,u,c,1,1),v="R: "+d[0]+" G: "+d[1]+" B: "+d[2];else{d=cornerstone.getStoredPixels(t.element,u,c,1,1);var p=d[0],C=p*t.image.slope+t.image.intercept,b=(0,M.default)(t.image,p);g=u+", "+c,v="SP: "+p+" MO: "+parseFloat(C.toFixed(3)),b&&(v+=" SUV: "+parseFloat(b.toFixed(3)))}var w={x:s.handles.end.x+3,y:s.handles.end.y-3},S=cornerstone.pixelToCanvas(t.element,w);n.font=r,n.fillStyle=a,(0,T.default)(n,v,S.x,S.y+i+5,a),(0,T.default)(n,g,S.x,S.y,a),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.probeTouch=t.probe=void 0;var l=o(6),s=n(l),u=o(7),c=n(u),d=o(2),f=n(d),g=o(12),m=n(g),v=o(5),h=n(v),p=o(4),T=n(p),C=o(30),y=n(C),b=o(15),M=n(b),x=o(0),P="probe",w=(0,s.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P}),S=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:P});t.probe=w,t.probeTouch=S},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.start),a=cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(n.x,a.x),top:Math.min(n.y,a.y),width:Math.abs(n.x-a.x),height:Math.abs(n.y-a.y)};return cornerstoneMath.rect.distanceToPoint(r,o)<5}function i(e,t){for(var o=0,n=0,a=0,r=0,i=t.top;i<t.top+t.height;i++)for(var l=t.left;l<t.left+t.width;l++)o+=e[r],n+=e[r]*e[r],a++,r++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var s=o/a,u=n/a-s*s;return{count:a,mean:s,variance:u,stdDev:Math.sqrt(u)}}function l(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function s(e,t){var o=(0,x.getToolState)(e.currentTarget,P);if(o){var n=t.image,a=t.element,r=m.default.getToolWidth(),s=w.getConfiguration(),u=t.canvasContext.canvas.getContext("2d"),c=cornerstone.metaData.get("generalSeriesModule",n.imageId),d=void 0;c&&(d=c.modality),u.setTransform(1,0,0,1,0,0);for(var f=0;f<o.data.length;f++){u.save();var g=o.data[f];s&&s.shadow&&(u.shadowColor=s.shadowColor||"#000000",u.shadowOffsetX=s.shadowOffsetX||1,u.shadowOffsetY=s.shadowOffsetY||1);var v=h.default.getColorIfActive(g.active),p=cornerstone.pixelToCanvas(a,g.handles.start),C=cornerstone.pixelToCanvas(a,g.handles.end),b=Math.min(p.x,C.x),S=Math.min(p.y,C.y),I=Math.abs(p.x-C.x),$=Math.abs(p.y-C.y);if(u.beginPath(),u.strokeStyle=v,u.lineWidth=r,u.rect(b,S,I,$),u.stroke(),s&&s.drawHandlesOnHover)if(!0===g.active)(0,T.default)(u,t,g.handles,v);else{var k={drawHandlesIfActive:!0};(0,T.default)(u,t,g.handles,v,k)}else(0,T.default)(u,t,g.handles,v);var O=void 0,D=void 0,_=void 0;if(!1===g.invalidated)D=g.meanStdDev,_=g.meanStdDevSUV,O=g.area;else{var j={left:Math.min(g.handles.start.x,g.handles.end.x),top:Math.min(g.handles.start.y,g.handles.end.y),width:Math.abs(g.handles.start.x-g.handles.end.x),height:Math.abs(g.handles.start.y-g.handles.end.y)};if(!n.color){D=i(cornerstone.getPixels(a,j.left,j.top,j.width,j.height),j),"PT"===d&&(_={mean:(0,M.default)(n,(D.mean-n.intercept)/n.slope),stdDev:(0,M.default)(n,(D.stdDev-n.intercept)/n.slope)}),D&&!isNaN(D.mean)&&(g.meanStdDev=D,g.meanStdDevSUV=_)}O=j.width*(n.columnPixelSpacing||1)*(j.height*(n.rowPixelSpacing||1)),isNaN(O)||(g.area=O),g.invalidated=!1}var E=[];if(D&&D.mean){var R="";"CT"===d&&(R=" HU");var A="Mean: "+l(D.mean.toFixed(2))+R,B="StdDev: "+l(D.stdDev.toFixed(2))+R;if(_&&void 0!==_.mean){A+=" SUV: "+l(_.mean.toFixed(2)),B+=" SUV: "+l(_.stdDev.toFixed(2))}E.push(A),E.push(B)}if(O){var N=" mm"+String.fromCharCode(178);n.rowPixelSpacing&&n.columnPixelSpacing||(N=" pixels"+String.fromCharCode(178));var H="Area: "+l(O.toFixed(2))+N;E.push(H)}g.handles.textBox.hasMoved||(g.handles.textBox.x=Math.max(g.handles.start.x,g.handles.end.x),g.handles.textBox.y=(g.handles.start.y+g.handles.end.y)/2);var V=cornerstone.pixelToCanvas(a,g.handles.textBox),W={centering:{x:!1,y:!0}},Y=(0,y.default)(u,E,V.x,V.y,v,W);if(g.handles.textBox.boundingBox=Y,g.handles.textBox.hasMoved){var L={start:{},end:{x:V.x,y:V.y}},F=[{x:b+I/2,y:S},{x:b,y:S+$/2},{x:b+I/2,y:S+$},{x:b+I,y:S+$/2}];L.start=cornerstoneMath.point.findClosestPoint(F,L.end);var U=[{x:Y.left+Y.width/2,y:Y.top},{x:Y.left,y:Y.top+Y.height/2},{x:Y.left+Y.width/2,y:Y.top+Y.height},{x:Y.left+Y.width,y:Y.top+Y.height/2}];L.end=cornerstoneMath.point.findClosestPoint(U,L.start),u.beginPath(),u.strokeStyle=v,u.lineWidth=r,u.setLineDash([2,3]),u.moveTo(L.start.x,L.start.y),u.lineTo(L.end.x,L.end.y),u.stroke()}u.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.rectangleRoiTouch=t.rectangleRoi=void 0;var u=o(6),c=n(u),d=o(7),f=n(d),g=o(3),m=n(g),v=o(2),h=n(v),p=o(5),T=n(p),C=o(4),y=n(C),b=o(15),M=n(b),x=o(0),P="rectangleRoi",w=(0,c.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:P}),S=(0,f.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:P});t.rectangleRoi=w,t.rectangleRoiTouch=S},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.element.getBoundingClientRect(e.element),o={x:e.currentPoints.client.x,y:e.currentPoints.client.y},n=e.element.clientWidth,a=e.element.clientHeight,r={x:o.x-t.left-n/2,y:-1*(o.y-t.top-a/2)},i=Math.atan2(r.y,r.x),l=i*(180/Math.PI),s=-1*l+90;e.viewport.rotation=s,cornerstone.setViewport(e.element,e.viewport)}function r(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,cornerstone.setViewport(e.element,e.viewport)}function i(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,cornerstone.setViewport(e.element,e.viewport)}function l(e,t){$(t.element).off("CornerstoneToolsMouseDrag",u),$(t.element).off("CornerstoneToolsMouseUp",l),$(t.element).off("CornerstoneToolsMouseClick",l)}function s(e,t){if((0,v.default)(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",u),$(t.element).on("CornerstoneToolsMouseUp",l),$(t.element).on("CornerstoneToolsMouseClick",l),!1}function u(e,t){return h.strategy(t),cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.rotateTouchDrag=t.rotate=void 0;var c=o(11),d=n(c),f=o(9),g=n(f),m=o(1),v=n(m),h=(0,d.default)(s);h.strategies={default:a,horizontal:r,vertical:i},h.strategy=a;var p=(0,g.default)(u);t.rotate=h,t.rotateTouchDrag=p},function(e,t,o){"use strict";function n(e,t){return t.viewport.rotation+=t.rotation,cornerstone.setViewport(t.element,t.viewport),!1}function a(e){$(e).off("CornerstoneToolsTouchRotate",n)}function r(e){$(e).off("CornerstoneToolsTouchRotate",n),$(e).on("CornerstoneToolsTouchRotate",n)}Object.defineProperty(t,"__esModule",{value:!0});var i={activate:r,disable:a};t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=$(e).find("canvas").get(0),n=document.createElement("a");if(n.download=t,n.href=o.toDataURL(),document.createEvent){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(a)}else n.fireEvent&&n.fireEvent("onclick")}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,o){o(prompt("Change your annotation:"))}function i(e){function t(e){null===e?(0,N.removeToolState)(o,H,a):a.text=e,a.active=!1,cornerstone.updateImage(o)}var o=e.element,n=W.getConfiguration(),a=l(e);(0,N.addToolState)(o,H,a),cornerstone.updateImage(o),(0,k.default)(e,H,a,a.handles.end,function(){(0,S.default)(e,a.handles)&&(0,N.removeToolState)(o,H,a),void 0===a.text&&n.getTextCallback(t),cornerstone.updateImage(o)})}function l(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,o){if(t.handles.end){var n=cornerstone.pixelToCanvas(e,t.handles.end);return cornerstoneMath.point.distance(n,o)<25}}function u(e,t){var o=(0,N.getToolState)(e.currentTarget,H);if(o){var n=t.enabledElement,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r=t.canvasContext.canvas.width,i=void 0,l=M.default.getToolWidth(),s=y.default.getFont(),u=W.getConfiguration(),c=0;c<o.data.length;c++){a.save(),u&&u.shadow&&(a.shadowColor=u.shadowColor||"#000000",a.shadowOffsetX=u.shadowOffsetX||1,a.shadowOffsetY=u.shadowOffsetY||1);var d=o.data[c];i=d.active?P.default.getActiveColor():P.default.getToolColor();var f=cornerstone.pixelToCanvas(t.element,d.handles.end);(0,j.default)(a,f,i,l);var g={drawHandlesIfActive:u&&u.drawHandlesOnHover};if(u.drawHandles&&(0,D.default)(a,t,f,i,g),d.text&&""!==d.text){a.font=s;var m="";m=u.showCoordinates?d.text+" x: "+Math.round(d.handles.end.x)+" y: "+Math.round(d.handles.end.y):d.text;var v=a.measureText(m).width+10,h=y.default.getFontSize()+10,p=Math.max(v,h)/2+5;f.x>r/2&&(p=-p);var C=void 0;if(!d.handles.textBox.hasMoved){C={x:f.x-v/2+p,y:f.y-h/2};var b=cornerstone.internal.getTransform(n);b.invert();var x=b.transformPoint(C.x,C.y);d.handles.textBox.x=x.x,d.handles.textBox.y=x.y}C=cornerstone.pixelToCanvas(t.element,d.handles.textBox);var w=(0,T.default)(a,m,C.x,C.y,i);if(d.handles.textBox.boundingBox=w,d.handles.textBox.hasMoved){var S={start:{},end:{}};S.end.x=C.x,S.end.y=C.y,S.start=f;var I=[{x:w.left+w.width/2,y:w.top},{x:w.left,y:w.top+w.height/2},{x:w.left+w.width/2,y:w.top+w.height},{x:w.left+w.width,y:w.top+w.height/2}];S.end=cornerstoneMath.point.findClosestPoint(I,S.start),a.beginPath(),a.strokeStyle=i,a.lineWidth=l,a.setLineDash([2,3]),a.moveTo(S.start.x,S.start.y),a.lineTo(S.end.x,S.end.y),a.stroke()}}a.restore()}}}function c(e){function t(e){null===e?(0,N.removeToolState)(o,H,a):a.text=e,a.active=!1,cornerstone.updateImage(o)}var o=e.element,n=W.getConfiguration(),a=l(e);(0,N.addToolState)(o,H,a),cornerstone.updateImage(o),(0,k.default)(e,H,a,a.handles.end,function(){(0,S.default)(e,a.handles)&&(0,N.removeToolState)(o,H,a),void 0===a.text&&n.getTextCallback(t),cornerstone.updateImage(o)})}function d(e,t){function o(e,t,o){!0===o?(0,N.removeToolState)(n,H,e):e.text=t,e.active=!1,cornerstone.updateImage(n)}var n=t.element,a=void 0;if(!e.data||!e.data.mouseButtonMask||(0,R.default)(t.which,e.data.mouseButtonMask)){var r=W.getConfiguration(),i=t.currentPoints.canvas,l=(0,N.getToolState)(n,H);if(l){for(var u=0;u<l.data.length;u++)if(a=l.data[u],s(n,a,i)||(0,B.default)(a.handles.textBox,i))return a.active=!0,cornerstone.updateImage(n),r.changeTextCallback(a,t,o),e.stopImmediatePropagation(),!1;return!1}}}function f(e,t){function o(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?(0,N.removeToolState)(n,H,e):e.text=t,e.active=!1,cornerstone.updateImage(n),$(n).on("CornerstoneToolsTouchStart",Y.touchStartCallback),$(n).on("CornerstoneToolsTouchStartActive",Y.touchDownActivateCallback),$(n).on("CornerstoneToolsTap",Y.tapCallback)}var n=t.element,a=void 0;if(e.data&&e.data.mouseButtonMask&&!(0,R.default)(t.which,e.data.mouseButtonMask))return!1;var r=W.getConfiguration(),i=t.currentPoints.canvas,l=(0,N.getToolState)(n,H);if(!l)return!1;if(t.handlePressed)return $(n).off("CornerstoneToolsTouchStart",Y.touchStartCallback),$(n).off("CornerstoneToolsTouchStartActive",Y.touchDownActivateCallback),$(n).off("CornerstoneToolsTap",Y.tapCallback),r.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var u=0;u<l.data.length;u++)if(a=l.data[u],s(n,a,i)||(0,B.default)(a.handles.textBox,i))return a.active=!0,cornerstone.updateImage(n),$(n).off("CornerstoneToolsTouchStart",Y.touchStartCallback),$(n).off("CornerstoneToolsTouchStartActive",Y.touchDownActivateCallback),$(n).off("CornerstoneToolsTap",Y.tapCallback),r.changeTextCallback(a,t,o),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.seedAnnotateTouch=t.seedAnnotate=void 0;var g=o(6),m=n(g),v=o(7),h=n(v),p=o(4),T=n(p),C=o(12),y=n(C),b=o(3),M=n(b),x=o(2),P=n(x),w=o(10),S=n(w),I=o(19),k=n(I),O=o(5),D=n(O),_=o(46),j=n(_),E=o(1),R=n(E),A=o(16),B=n(A),N=o(0),H="seedAnnotate",V={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,currentLetter:"A",currentNumber:0,showCoordinates:!0,countUp:!0},W=(0,m.default)({addNewMeasurement:i,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:H,mouseDoubleClickCallback:d});W.setConfiguration(V);var Y=(0,h.default)({addNewMeasurement:c,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:H,pressCallback:f});t.seedAnnotate=W,t.seedAnnotateTouch=Y},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.middle)},a=cornerstoneMath.lineSegment.distanceToPoint(n,o);return a<25||(n.start=cornerstone.pixelToCanvas(e,t.handles.middle),n.end=cornerstone.pixelToCanvas(e,t.handles.end),(a=cornerstoneMath.lineSegment.distanceToPoint(n,o))<25)}function i(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function l(e,t){var o=(0,j.getToolState)(e.currentTarget,E);if(o){var n=t.enabledElement,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r=void 0,l=C.default.getToolWidth(),s=p.default.getFont(),u=R.getConfiguration(),c=0;c<o.data.length;c++){a.save(),u&&u.shadow&&(a.shadowColor=u.shadowColor||"#000000",a.shadowOffsetX=u.shadowOffsetX||1,a.shadowOffsetY=u.shadowOffsetY||1);var d=o.data[c];r=d.active?b.default.getActiveColor():b.default.getToolColor();var f=cornerstone.pixelToCanvas(t.element,d.handles.start),m=cornerstone.pixelToCanvas(t.element,d.handles.middle),h=cornerstone.pixelToCanvas(t.element,d.handles.end);a.beginPath(),a.strokeStyle=r,a.lineWidth=l,a.moveTo(f.x,f.y),a.lineTo(m.x,m.y),a.lineTo(h.x,h.y),a.stroke();var T={drawHandlesIfActive:u&&u.drawHandlesOnHover};(0,O.default)(a,t,d.handles,r,T),a.fillStyle=r;var y=t.image.columnPixelSpacing||1,M=t.image.rowPixelSpacing||1,x="";t.image.rowPixelSpacing&&t.image.columnPixelSpacing||(x=" (isotropic)");var P={x:(Math.ceil(d.handles.middle.x)-Math.ceil(d.handles.start.x))*y,y:(Math.ceil(d.handles.middle.y)-Math.ceil(d.handles.start.y))*M},w={x:(Math.ceil(d.handles.end.x)-Math.ceil(d.handles.middle.x))*y,y:(Math.ceil(d.handles.end.y)-Math.ceil(d.handles.middle.y))*M},S={x:(Math.ceil(d.handles.end.x)-Math.ceil(d.handles.start.x))*y,y:(Math.ceil(d.handles.end.y)-Math.ceil(d.handles.start.y))*M},I=i(P),$=i(w),k=i(S),D=Math.acos((Math.pow(I,2)+Math.pow($,2)-Math.pow(k,2))/(2*I*$));D*=180/Math.PI;var _=(0,v.default)(D,2);if(_){var A=_.toString()+String.fromCharCode(parseInt("00B0",16))+x,B=void 0;if(d.handles.textBox.hasMoved)B=cornerstone.pixelToCanvas(t.element,d.handles.textBox);else{B={x:m.x,y:m.y},a.font=s;var N=a.measureText(A).width;m.x<f.x?B.x-=15+N+10:B.x+=15;var H=cornerstone.internal.getTransform(n);H.invert();var V=H.transformPoint(B.x,B.y);d.handles.textBox.x=V.x,d.handles.textBox.y=V.y}var W={centering:{x:!1,y:!0}},Y=(0,g.default)(a,A,B.x,B.y,r,W);if(d.handles.textBox.boundingBox=Y,d.handles.textBox.hasMoved){var L={start:{},end:{}},F=[f,h,m];L.end.x=B.x,L.end.y=B.y,L.start=cornerstoneMath.point.findClosestPoint(F,L.end);var U=[{x:Y.left+Y.width/2,y:Y.top},{x:Y.left,y:Y.top+Y.height/2},{x:Y.left+Y.width/2,y:Y.top+Y.height},{x:Y.left+Y.width,y:Y.top+Y.height/2}];L.end=cornerstoneMath.point.findClosestPoint(U,L.start),a.beginPath(),a.strokeStyle=r,a.lineWidth=l,a.setLineDash([2,3]),a.moveTo(L.start.x,L.start.y),a.lineTo(L.end.x,L.end.y),a.stroke()}}a.restore()}}}function s(e){var t=a(e),o=e.element,n={mouseButtonMask:e.which};(0,j.addToolState)(o,E,t),$(o).off("CornerstoneToolsMouseMove",R.mouseMoveCallback),$(o).off("CornerstoneToolsMouseDrag",R.mouseMoveCallback),$(o).off("CornerstoneToolsMouseDown",R.mouseDownCallback),$(o).off("CornerstoneToolsMouseDownActivate",R.mouseDownActivateCallback),cornerstone.updateImage(o),(0,w.default)(e,E,t,t.handles.middle,function(){if(t.active=!1,(0,x.default)(e,t.handles))return(0,j.removeToolState)(o,E,t),$(o).on("CornerstoneToolsMouseMove",R.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDrag",R.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDown",n,R.mouseDownCallback),$(o).on("CornerstoneToolsMouseDownActivate",n,R.mouseDownActivateCallback),void cornerstone.updateImage(o);t.handles.end.active=!0,cornerstone.updateImage(o),(0,w.default)(e,E,t,t.handles.end,function(){t.active=!1,(0,x.default)(e,t.handles)&&(0,j.removeToolState)(o,E,t),$(o).on("CornerstoneToolsMouseMove",R.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDrag",R.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDown",n,R.mouseDownCallback),$(o).on("CornerstoneToolsMouseDownActivate",n,R.mouseDownActivateCallback),cornerstone.updateImage(o)})})}function u(e){var t=a(e),o=e.element;(0,j.addToolState)(o,E,t),$(o).off("CornerstoneToolsTouchDrag",A.touchMoveCallback),$(o).off("CornerstoneToolsTouchStartActive",A.touchDownActivateCallback),$(o).off("CornerstoneToolsTouchStart",A.touchStartCallback),$(o).off("CornerstoneToolsTap",A.tapCallback),cornerstone.updateImage(o),(0,I.default)(e,E,t,t.handles.middle,function(){if((0,x.default)(e,t.handles))return(0,j.removeToolState)(o,E,t),$(o).on("CornerstoneToolsTouchDrag",A.touchMoveCallback),$(o).on("CornerstoneToolsTouchStart",A.touchStartCallback),$(o).on("CornerstoneToolsTouchStartActive",A.touchDownActivateCallback),$(o).on("CornerstoneToolsTap",A.tapCallback),void cornerstone.updateImage(o);(0,I.default)(e,E,t,t.handles.end,function(){(0,x.default)(e,t.handles)&&((0,j.removeToolState)(o,E,t),cornerstone.updateImage(o)),$(o).on("CornerstoneToolsTouchDrag",A.touchMoveCallback),$(o).on("CornerstoneToolsTouchStart",A.touchStartCallback),$(o).on("CornerstoneToolsTouchStartActive",A.touchDownActivateCallback),$(o).on("CornerstoneToolsTap",A.tapCallback)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleAngleTouch=t.simpleAngle=void 0;var c=o(6),d=n(c),f=o(4),g=n(f),m=o(34),v=n(m),h=o(12),p=n(h),T=o(3),C=n(T),y=o(2),b=n(y),M=o(10),x=n(M),P=o(20),w=n(P),S=o(21),I=n(S),k=o(5),O=n(k),D=o(7),_=n(D),j=o(0),E="simpleAngle",R=(0,d.default)({createNewMeasurement:a,addNewMeasurement:s,onImageRendered:l,pointNearTool:r,toolType:E}),A=(0,_.default)({createNewMeasurement:a,addNewMeasurement:u,onImageRendered:l,pointNearTool:r,toolType:E});t.simpleAngle=R,t.simpleAngleTouch=A},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=x.getConfiguration();if(t.current){var o={visible:!0,active:!0,text:t.current,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},n={left:0,top:0,width:e.image.width,height:e.image.height};if(cornerstoneMath.point.insideRect(o.handles.end,n)){var a=t.markers.indexOf(t.current);return t.ascending?(a+=1)>=t.markers.length&&(t.loop?a-=t.markers.length:a=-1):(a-=1)<0&&(t.loop?a+=t.markers.length:a=-1),t.current=t.markers[a],o}}}function r(e,t,o){if(t.handles.end.boundingBox){var n=cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,o),a=(0,m.default)(t.handles.end,o);return n<10||a}}function i(e,t){var o=(0,b.getToolState)(t.element,M);if(o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=x.getConfiguration(),r=0;r<o.data.length;r++){var i=o.data[r],l=h.default.getToolColor();i.active&&(l=h.default.getActiveColor()),n.save(),a&&a.shadow&&(n.shadowColor=a.shadowColor||"#000000",n.shadowOffsetX=a.shadowOffsetX||1,n.shadowOffsetY=a.shadowOffsetY||1),n.fillStyle=l;var s=n.measureText(i.text);i.textWidth=s.width+10;var u=cornerstone.pixelToCanvas(t.element,i.handles.end),c={centering:{x:!0,y:!0}},d=(0,y.default)(n,i.text,u.x,u.y-10,l,c);i.handles.end.boundingBox=d,n.restore()}}}function l(e,t){function o(t,o,a){!0===a?(0,b.removeToolState)(n,M,t):t.text=o,t.active=!1,cornerstone.updateImage(n);var r={mouseButtonMask:e.data.mouseButtonMask};$(n).on("CornerstoneToolsMouseMove",r,x.mouseMoveCallback),$(n).on("CornerstoneToolsMouseDown",r,x.mouseDownCallback),$(n).on("CornerstoneToolsMouseDownActivate",r,x.mouseDownActivateCallback),$(n).on("CornerstoneToolsMouseDoubleClick",r,x.mouseDoubleClickCallback)}var n=t.element,a=void 0;if(!e.data||!e.data.mouseButtonMask||(0,T.default)(t.which,e.data.mouseButtonMask)){var i=x.getConfiguration(),l=t.currentPoints.canvas,s=(0,b.getToolState)(n,M);if(s){for(var u=0;u<s.data.length;u++)if(a=s.data[u],r(n,a,l))return a.active=!0,cornerstone.updateImage(n),$(n).off("CornerstoneToolsMouseMove",x.mouseMoveCallback),$(n).off("CornerstoneToolsMouseDown",x.mouseDownCallback),$(n).off("CornerstoneToolsMouseDownActivate",x.mouseDownActivateCallback),$(n).off("CornerstoneToolsMouseDoubleClick",x.mouseDoubleClickCallback),i.changeTextCallback(a,t,o),e.stopImmediatePropagation(),!1;return!1}}}function s(e,t){function o(e,t,o){!0===o?(0,b.removeToolState)(n,M,e):e.text=t,e.active=!1,cornerstone.updateImage(n),$(n).on("CornerstoneToolsTouchDrag",P.touchMoveCallback),$(n).on("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),$(n).on("CornerstoneToolsTouchStart",P.touchStartCallback),$(n).on("CornerstoneToolsTap",P.tapCallback),$(n).on("CornerstoneToolsTouchPress",P.pressCallback)}var n=t.element,a=void 0,i=x.getConfiguration(),l=t.currentPoints.canvas,s=(0,b.getToolState)(n,M);if(!s)return!1;if(t.handlePressed)return t.handlePressed.active=!0,cornerstone.updateImage(n),$(n).off("CornerstoneToolsTouchDrag",P.touchMoveCallback),$(n).off("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),$(n).off("CornerstoneToolsTouchStart",P.touchStartCallback),$(n).off("CornerstoneToolsTap",P.tapCallback),$(n).off("CornerstoneToolsTouchPress",P.pressCallback),i.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var u=0;u<s.data.length;u++)if(a=s.data[u],r(n,a,l))return a.active=!0,cornerstone.updateImage(n),$(n).off("CornerstoneToolsTouchDrag",P.touchMoveCallback),$(n).off("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),$(n).off("CornerstoneToolsTouchStart",P.touchStartCallback),$(n).off("CornerstoneToolsTap",P.tapCallback),$(n).off("CornerstoneToolsTouchPress",P.pressCallback),i.changeTextCallback(a,t,o),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.textMarkerTouch=t.textMarker=void 0;var u=o(6),c=n(u),d=o(7),f=n(d),g=o(16),m=n(g),v=o(2),h=n(v),p=o(1),T=n(p),C=o(4),y=n(C),b=o(0),M="textMarker",x=(0,c.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:M,mouseDoubleClickCallback:l}),P=(0,f.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:M,pressCallback:s});t.textMarker=x,t.textMarkerTouch=P},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){$(t.element).off("CornerstoneToolsMouseDrag",l),$(t.element).off("CornerstoneToolsMouseUp",a),$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,m.default)(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",l),$(t.element).on("CornerstoneToolsMouseUp",a),$(t.element).on("CornerstoneToolsMouseClick",a),!1}function i(e){var t=e.image.maxPixelValue*e.image.slope+e.image.intercept,o=e.image.minPixelValue*e.image.slope+e.image.intercept,n=t-o,a=n/1024,r=e.deltaPoints.page.x*a,i=e.deltaPoints.page.y*a;e.viewport.voi.windowWidth+=r,e.viewport.voi.windowCenter+=i}function l(e,t){return v.strategy(t),cornerstone.setViewport(t.element,t.viewport),!1}function s(e,t){e.stopImmediatePropagation();var o=t,n=o.image.maxPixelValue*o.image.slope+o.image.intercept,a=o.image.minPixelValue*o.image.slope+o.image.intercept,r=n-a,i=r/1024,l=o.deltaPoints.page.x*i,s=o.deltaPoints.page.y*i,u=v.getConfiguration();u.orientation?0===u.orientation?(o.viewport.voi.windowWidth+=l,o.viewport.voi.windowCenter+=s):(o.viewport.voi.windowWidth+=s,o.viewport.voi.windowCenter+=l):(o.viewport.voi.windowWidth+=l,o.viewport.voi.windowCenter+=s),cornerstone.setViewport(o.element,o.viewport)}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcTouchDrag=t.wwwc=void 0;var u=o(11),c=n(u),d=o(9),f=n(d),g=o(1),m=n(g),v=(0,c.default)(r);v.strategies={default:i},v.strategy=i;var h=(0,f.default)(s);t.wwwc=v,t.wwwcTouchDrag=h},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,o){var n=e.length;if(n<2)return{min:t,max:o,mean:(t+o)/2};for(var a=o,r=t,i=0,l=0;l<n;l++){var s=e[l];a=Math.min(a,s),r=Math.max(r,s),i+=s}return{min:a,max:r,mean:i/n}}function r(e,t){var o=(0,x.getToolState)(t.element,k);o&&o.data&&(o.data=[]),$(t.element).off("CornerstoneToolsMouseMove",d),$(t.element).off("CornerstoneToolsMouseDrag",d),$(t.element).off("CornerstoneToolsMouseUp",i),$(t.element).off("CornerstoneToolsMouseClick",i);var n={mouseButtonMask:D};$(t.element).on("CornerstoneToolsMouseDown",n,u)}function i(e,t){$(t.element).off("CornerstoneToolsMouseMove",d),$(t.element).off("CornerstoneToolsMouseDrag",d),$(t.element).off("CornerstoneToolsMouseUp",i),$(t.element).off("CornerstoneToolsMouseClick",i);var o={mouseButtonMask:D};$(t.element).on("CornerstoneToolsMouseDown",o,u);var n=(0,x.getToolState)(t.element,k);n&&n.data&&n.data.length&&(n.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},l(t))}function l(e){var t=(0,x.getToolState)(e.element,k);if(t&&t.data&&t.data.length){var o=t.data[0].startPoint,n=t.data[0].endPoint,r=Math.abs(o.x-n.x),i=Math.abs(o.y-n.y),l=Math.min(o.x,n.x),s=Math.min(o.y,n.y);l=Math.max(l,0),l=Math.min(l,e.image.width),s=Math.max(s,0),s=Math.min(s,e.image.height),r=Math.floor(Math.min(r,Math.abs(e.image.width-l))),i=Math.floor(Math.min(i,Math.abs(e.image.height-s)));var u=(0,w.default)(e.element,l,s,r,i),c=a(u,e.image.minPixelValue,e.image.maxPixelValue),d=_.getConfiguration(),f=cornerstone.getViewport(e.element);void 0===d.minWindowWidth&&(d.minWindowWidth=10),f.voi.windowWidth=Math.max(Math.abs(c.max-c.min),d.minWindowWidth),f.voi.windowCenter=c.mean,cornerstone.setViewport(e.element,f),t.data=[],cornerstone.updateImage(e.element)}}function s(e,t){var o=t.element;$(o).off("CornerstoneToolsMouseMove"),$(o).off("CornerstoneToolsMouseDrag"),$(o).on("CornerstoneToolsMouseMove",d),$(o).on("CornerstoneToolsMouseDrag",d),$(o).on("CornerstoneToolsMouseClick",i),"CornerstoneToolsMouseDrag"===e.type&&$(o).on("CornerstoneToolsMouseUp",i)}function u(e,t){if((0,I.default)(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",t,s),$(t.element).on("CornerstoneToolsMouseMove",t,s),$(t.element).off("CornerstoneToolsMouseDown",u),c(t),!1}function c(e){var t=(0,x.getToolState)(e.element,k);t&&t.data&&(t.data=[]);var o={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};(0,x.addToolState)(e.element,k,o)}function d(e,t){var o=(0,x.getToolState)(t.element,k);if(o&&o.data&&o.data.length){var n={x:t.currentPoints.image.x,y:t.currentPoints.image.y};o.data[0].endPoint=n,cornerstone.updateImage(t.element)}}function f(e,t){var o=(0,x.getToolState)(t.element,k);if(o&&o.data&&o.data.length){var n=o.data[0].startPoint,a=o.data[0].endPoint;if(n&&a){var r=$(t.element).find("canvas").get(0),i=r.getContext("2d");i.setTransform(1,0,0,1,0,0);var l=M.default.getActiveColor(),s=cornerstone.pixelToCanvas(t.element,n),u=cornerstone.pixelToCanvas(t.element,a),c=Math.min(s.x,u.x),d=Math.min(s.y,u.y),f=Math.abs(s.x-u.x),g=Math.abs(s.y-u.y),m=y.default.getToolWidth(),v=_.getConfiguration();i.save(),v&&v.shadow&&(i.shadowColor=v.shadowColor||"#000000",i.shadowOffsetX=v.shadowOffsetX||1,i.shadowOffsetY=v.shadowOffsetY||1),i.beginPath(),i.strokeStyle=l,i.lineWidth=m,i.rect(c,d,f,g),i.stroke(),i.restore()}}}function g(e){$(e).off("CornerstoneToolsMouseDown",u),$(e).off("CornerstoneToolsMouseUp",i),$(e).off("CornerstoneToolsMouseClick",i),$(e).off("CornerstoneToolsMouseDrag",d),$(e).off("CornerstoneToolsMouseMove",d),$(e).off("CornerstoneImageRendered",f),$(e).off("CornerstoneNewImage",r),cornerstone.updateImage(e)}function m(e,t){var o={mouseButtonMask:t};if(D=t,!(0,x.getToolState)(e,k)){var n=[];(0,x.addToolState)(e,k,n)}$(e).off("CornerstoneToolsMouseDown",u),$(e).off("CornerstoneToolsMouseUp",i),$(e).off("CornerstoneToolsMouseClick",i),$(e).off("CornerstoneToolsMouseDrag",d),$(e).off("CornerstoneToolsMouseMove",d),$(e).off("CornerstoneImageRendered",f),$(e).off("CornerstoneNewImage",r),$(e).on("CornerstoneToolsMouseDown",o,u),$(e).on("CornerstoneImageRendered",f),$(e).on("CornerstoneNewImage",r),cornerstone.updateImage(e)}function v(e){$(e).off("CornerstoneToolsTouchDrag",d),$(e).off("CornerstoneToolsTouchStart",c),$(e).off("CornerstoneToolsDragEnd",l),$(e).off("CornerstoneImageRendered",f)}function h(e){if(!(0,x.getToolState)(e,k)){var t=[];(0,x.addToolState)(e,k,t)}$(e).off("CornerstoneToolsTouchDrag",d),$(e).off("CornerstoneToolsTouchStart",c),$(e).off("CornerstoneToolsDragEnd",l),$(e).off("CornerstoneImageRendered",f),$(e).on("CornerstoneToolsTouchDrag",d),$(e).on("CornerstoneToolsTouchStart",c),$(e).on("CornerstoneToolsDragEnd",l),$(e).on("CornerstoneImageRendered",f)}function p(){return O}function T(e){O=e}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcRegionTouch=t.wwwcRegion=void 0;var C=o(3),y=n(C),b=o(2),M=n(b),x=o(0),P=o(48),w=n(P),S=o(1),I=n(S),k="wwwcRegion",O={minWindowWidth:10},D=void 0,_={activate:m,deactivate:g,disable:g,setConfiguration:T,getConfiguration:p},j={activate:h,deactivate:v,disable:v};t.wwwcRegion=_,t.wwwcRegionTouch=j},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=S.getConfiguration(),n=Math.log(e.scale)/Math.log(1.7),a=n+t,r=Math.pow(1.7,a);return o.maxScale&&r>o.maxScale?e.scale=o.maxScale:o.minScale&&r<o.minScale?e.scale=o.minScale:e.scale=r,e}function r(e,t,o){return e.x=Math.max(e.x,0),e.y=Math.max(e.y,0),e.x=Math.min(e.x,t),e.y=Math.min(e.y,o),e}function i(e,t){if(t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),0!==t.rotation){var o=t.rotation*Math.PI/180,n=Math.cos(o),a=Math.sin(o),r=e.x*n-e.y*a,i=e.x*a+e.y*n;e.x=r,e.y=i}return e}function l(e,t){var o=e.element,n=a(e.viewport,t);cornerstone.setViewport(o,n);var r=cornerstone.pageToPixel(o,e.startPoints.page.x,e.startPoints.page.y),l={x:e.startPoints.image.x-r.x,y:e.startPoints.image.y-r.y};l=i(l,n),n.translation.x-=l.x,n.translation.y-=l.y,cornerstone.setViewport(o,n)}function s(e,t){var o=e.element,n=e.image,l=S.getConfiguration(),s=a(e.viewport,t),u={x:0,y:0};if(t<0)s.scale<3&&(Math.abs(s.translation.x)<.01?s.translation.x=0:u.x=s.translation.x/8,Math.abs(s.translation.y)<.01?s.translation.y=0:u.y=s.translation.y/8);else{l&&l.preventZoomOutsideImage&&(w.image=r(w.image,n.width,n.height));var c={x:n.width/2-w.image.x,y:n.height/2-w.image.y};c=i(c,s);var d={x:s.translation.x-c.x,y:s.translation.y-c.y};Math.abs(d.x)<.01?s.translation.x=c.x:u.x=d.x/8,Math.abs(d.y)<.01?s.translation.y=c.y:u.y=d.y/8}s.translation.x-=u.x,s.translation.y-=u.y,cornerstone.setViewport(o,s)}function u(e,t){var o=e.element,n=a(e.viewport,t);cornerstone.setViewport(o,n)}function c(e,t){$(t.element).off("CornerstoneToolsMouseDrag",f),$(t.element).off("CornerstoneToolsMouseUp",c),$(t.element).off("CornerstoneToolsMouseClick",c)}function d(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask))return w=t.startPoints,$(t.element).on("CornerstoneToolsMouseDrag",f),$(t.element).on("CornerstoneToolsMouseUp",c),$(t.element).on("CornerstoneToolsMouseClick",c),!1}function f(e,t){if(!t.deltaPoints.page.y)return!1;var o=t.deltaPoints.page.y/100;return S.strategy(t,o),!1}function g(e,t){var o=-t.direction/4,n=S.getConfiguration();n&&n.invert&&(o*=-1);var r=a(t.viewport,o);cornerstone.setViewport(t.element,r)}function m(e,t){var o=S.getConfiguration(),n=t.viewport,a=t.element;n.scale+=t.scaleChange*n.scale,o.maxScale&&n.scale>o.maxScale?n.scale=o.maxScale:o.minScale&&n.scale<o.minScale&&(n.scale=o.minScale),cornerstone.setViewport(a,n);var r=cornerstone.pageToPixel(a,t.startPoints.page.x,t.startPoints.page.y),l={x:t.startPoints.image.x-r.x,y:t.startPoints.image.y-r.y};l=i(l,n),n.translation.x-=l.x,n.translation.y-=l.y,cornerstone.setViewport(a,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=void 0;var v=o(11),h=n(v),p=o(1),T=n(p),C=o(18),y=n(C),b=o(37),M=n(b),x=o(9),P=n(x),w=void 0,S=(0,h.default)(d);S.strategies={default:l,translate:s,zoomToCenter:u},S.strategy=l;var I=(0,y.default)(g),k=(0,M.default)(m),O=(0,P.default)(f);t.zoom=S,t.zoomWheel=I,t.zoomTouchPinch=k,t.zoomTouchDrag=O},function(e,t,o){"use strict";function n(e){var t=e.currentTarget,o={event:window.event||e,element:t,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,currentPoints:{page:{x:l,y:s},image:cornerstone.pageToPixel(t,l,s)},keyCode:e.keyCode,which:e.which};o.currentPoints.canvas=cornerstone.pixelToCanvas(t,o.currentPoints.image);var n={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};$(t).trigger(n[e.type],o)}function a(e){l=e.pageX||e.originalEvent.pageX,s=e.pageY||e.originalEvent.pageY}function r(e){i(e),$(e).on(u,n),$(e).on("mousemove",a)}function i(e){$(e).off(u,n),$(e).off("mousemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var l=void 0,s=void 0,u="keydown keypress keyup",c={enable:r,disable:i};t.default=c},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(){v=!1}function r(e){$(e.element).trigger("CornerstoneToolsMouseDownActivate",e)}function i(e){var t=e.currentTarget,o="CornerstoneToolsMouseDoubleClick",n={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};n.canvas=cornerstone.pixelToCanvas(t,n.image);var a=(0,f.default)(n),r={event:e,which:e.which,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:n,lastPoints:a,currentPoints:n,deltaPoints:{x:0,y:0},type:o},i=$.Event(o,r);$(r.element).trigger(i,r)}function l(e){function t(e){var t={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};t.canvas=cornerstone.pixelToCanvas(n,t.image);var o={page:cornerstoneMath.point.subtract(t.page,l.page),image:cornerstoneMath.point.subtract(t.image,l.image),client:cornerstoneMath.point.subtract(t.client,l.client),canvas:cornerstoneMath.point.subtract(t.canvas,l.canvas)},a={which:d,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,startPoints:i,lastPoints:l,currentPoints:t,deltaPoints:o,type:"CornerstoneToolsMouseDrag"};return $(a.element).trigger("CornerstoneToolsMouseDrag",a),l=(0,f.default)(t),(0,m.default)(e)}function o(e){clearTimeout(h);var a="CornerstoneToolsMouseUp";v&&(a="CornerstoneToolsMouseClick");var r={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=cornerstone.pixelToCanvas(n,r.image);var u={page:cornerstoneMath.point.subtract(r.page,l.page),image:cornerstoneMath.point.subtract(r.image,l.image),client:cornerstoneMath.point.subtract(r.client,l.client),canvas:cornerstoneMath.point.subtract(r.canvas,l.canvas)},c={event:e,which:d,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,startPoints:i,lastPoints:l,currentPoints:r,deltaPoints:u,type:a},f=$.Event(a,c);$(c.element).trigger(f,c),$(document).off("mousemove",t),$(document).off("mouseup",o),$(c.element).on("mousemove",s),v=!0}h=setTimeout(a,p);var n=e.currentTarget;$(n).off("mousemove",s);var i={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(n,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=cornerstone.pixelToCanvas(n,i.image);var l=(0,f.default)(i),u={event:e,which:e.which,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,startPoints:i,lastPoints:l,currentPoints:i,deltaPoints:{x:0,y:0},type:"CornerstoneToolsMouseDown"},c=$.Event("CornerstoneToolsMouseDown",u);if($(u.element).trigger(c,u),!1===c.isImmediatePropagationStopped()&&!0===r(u))return(0,m.default)(e);var d=e.which;return $(document).on("mousemove",t),$(document).on("mouseup",o),(0,m.default)(e)}function s(e){var t=e.currentTarget,o={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=cornerstone.pixelToCanvas(t,o.image);var n=(0,f.default)(o),a=e.which,r={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=cornerstone.pixelToCanvas(t,r.image);var i={page:cornerstoneMath.point.subtract(r.page,n.page),image:cornerstoneMath.point.subtract(r.image,n.image),client:cornerstoneMath.point.subtract(r.client,n.client),canvas:cornerstoneMath.point.subtract(r.canvas,n.canvas)},l={which:a,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:o,lastPoints:n,currentPoints:r,deltaPoints:i,type:"CornerstoneToolsMouseMove"};$(t).trigger("CornerstoneToolsMouseMove",l),n=(0,f.default)(r)}function u(e){$(e).off("mousedown",l),$(e).off("mousemove",s),$(e).off("dblclick",i)}function c(e){u(e),$(e).on("mousedown",l),$(e).on("mousemove",s),$(e).on("dblclick",i)}Object.defineProperty(t,"__esModule",{value:!0});var d=o(28),f=n(d),g=o(31),m=n(g),v=!0,h=void 0,p=200,T={enable:c,disable:u};t.default=T},function(e,t,o){"use strict";function n(e){if(!("mousewheel"===e.originalEvent.type&&0===e.originalEvent.wheelDeltaY||"DOMMouseScroll"===e.originalEvent.type&&1===e.originalEvent.axis)){e.preventDefault();var t=e.currentTarget,o=void 0,n=void 0;void 0!==e.pageX&&void 0!==e.pageY?(o=e.pageX,n=e.pageY):e.originalEvent&&void 0!==e.originalEvent.pageX&&void 0!==e.originalEvent.pageY?(o=e.originalEvent.pageX,n=e.originalEvent.pageY):(o=e.x,n=e.y);var a=cornerstone.pageToPixel(t,o,n);e=window.event||e;var r=void 0;r=e.originalEvent&&e.originalEvent.wheelDelta?-e.originalEvent.wheelDelta:e.originalEvent&&e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent&&e.originalEvent.detail?-e.originalEvent.detail:e.wheelDelta;var i=r<0?-1:1,l={element:t,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,direction:i,pageX:o,pageY:n,imageX:a.x,imageY:a.y};$(t).trigger("CornerstoneToolsMouseWheel",l)}}function a(e){r(e),$(e).on(i,n)}function r(e){$(e).unbind(i,n)}Object.defineProperty(t,"__esModule",{value:!0});var i="mousewheel DOMMouseScroll",l={enable:a,disable:r};t.default=l},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.currentTarget||e.srcEvent.currentTarget,o=void 0,n=void 0,a=void 0,r=void 0,i=void 0,l=void 0;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(S=!1,clearTimeout(b)),e.type){case"tap":S=!1,clearTimeout(b),h={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},h.canvas=cornerstone.pixelToCanvas(t,h.image),n="CornerstoneToolsTap",C={event:e,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,currentPoints:h,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C);break;case"doubletap":S=!1,clearTimeout(b),h={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},h.canvas=cornerstone.pixelToCanvas(t,h.image),n="CornerstoneToolsDoubleTap",C={event:e,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,currentPoints:h,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C);break;case"pinchstart":S=!1,clearTimeout(b),x=1;break;case"pinchmove":if(S=!1,clearTimeout(b),!0===w){x=e.scale,w=!1;break}a=(e.scale-x)/x,v={page:e.center,image:cornerstone.pageToPixel(t,e.center.x,e.center.y)},v.canvas=cornerstone.pixelToCanvas(t,v.image),n="CornerstoneToolsTouchPinch",C={event:e,startPoints:v,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,direction:e.scale<1?1:-1,scaleChange:a,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C),x=e.scale;break;case"touchstart":x=1,clearTimeout(b),clearTimeout(y),y=setTimeout(function(){v={page:cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:cornerstone.pageToPixel(t,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},v.canvas=cornerstone.pixelToCanvas(t,v.image),n="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(n="CornerstoneToolsMultiTouchStart"),C={event:e,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:v,currentPoints:v,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C),!1===o.isImmediatePropagationStopped()&&(n="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(n="CornerstoneToolsMultiTouchStartActive"),C.type=n,$(t).trigger(n,C)),p=(0,c.default)(v)},50),S=!0,M=0,b=setTimeout(function(){S&&(h={page:cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:cornerstone.pageToPixel(t,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},h.canvas=cornerstone.pixelToCanvas(t,v.image),n="CornerstoneToolsTouchPress",C={event:e,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,currentPoints:h,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C))},k);break;case"touchend":x=1,S=!1,clearTimeout(b),setTimeout(function(){v={page:cornerstoneMath.point.pageToPoint(e.originalEvent.changedTouches[0]),image:cornerstone.pageToPixel(t,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},v.canvas=cornerstone.pixelToCanvas(t,v.image),n="CornerstoneToolsTouchEnd",C={event:e,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:v,currentPoints:v,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C)},50);break;case"panmove":r={x:e.deltaX-I.x,y:e.deltaY-I.y},I={x:e.deltaX,y:e.deltaY},h={page:{x:p.page.x+r.x,y:p.page.y+r.y},image:cornerstone.pageToPixel(t,p.page.x+r.x,p.page.y+r.y),client:{x:p.client.x+r.x,y:p.client.y+r.y}},h.canvas=cornerstone.pixelToCanvas(t,h.image),T={page:cornerstoneMath.point.subtract(h.page,p.page),image:cornerstoneMath.point.subtract(h.image,p.image),client:cornerstoneMath.point.subtract(h.client,p.client),canvas:cornerstoneMath.point.subtract(h.canvas,p.canvas)},M+=Math.sqrt(T.page.x*T.page.x+T.page.y*T.page.y),M>O&&(S=!1,clearTimeout(b)),n="CornerstoneToolsTouchDrag",e.pointers.length>1&&(n="CornerstoneToolsMultiTouchDrag"),C={viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:v,lastPoints:p,currentPoints:h,deltaPoints:T,numPointers:e.pointers.length,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C),p=(0,c.default)(h);break;case"panstart":I={x:e.deltaX,y:e.deltaY},h={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},h.canvas=cornerstone.pixelToCanvas(t,h.image),p=(0,c.default)(h);break;case"panend":return S=!1,(clearTimeout(b),p)?(h={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},h.canvas=cornerstone.pixelToCanvas(t,h.image),T={page:cornerstoneMath.point.subtract(h.page,p.page),image:cornerstoneMath.point.subtract(h.image,p.image),client:cornerstoneMath.point.subtract(h.client,p.client),canvas:cornerstoneMath.point.subtract(h.canvas,p.canvas)},n="CornerstoneToolsDragEnd",C={event:e.srcEvent,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:v,lastPoints:p,currentPoints:h,deltaPoints:T,type:n,isTouchEvent:!0},o=$.Event(n,C),$(t).trigger(o,C),i=e.pointers.length-e.changedPointers.length,2===i&&(w=!0),(0,f.default)(e)):!1;case"rotatemove":S=!1,clearTimeout(b),l=e.rotation-P,P=e.rotation,n="CornerstoneToolsTouchRotate",C={event:e.srcEvent,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,rotation:l,type:n},o=$.Event(n,C),$(t).trigger(o,C)}return!1}function r(e){i(e);var t={inputClass:s.default.SUPPORT_POINTER_EVENTS?s.default.PointerEventInput:s.default.TouchInput},o=new s.default.Manager(e,t),n={pointers:0,direction:s.default.DIRECTION_ALL,threshold:0},r=new s.default.Pan(n),l=new s.default.Pinch({threshold:0}),u=new s.default.Rotate({threshold:0});l.recognizeWith(r),l.recognizeWith(u),u.recognizeWith(r);var c=new s.default.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});c.recognizeWith(r),o.add([c,r,u,l]),o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",a),m.default.enable(e),$(e).on("touchstart touchend",a),$(e).data("hammer",o)}function i(e){m.default.disable(e),$(e).off("touchstart touchend",a);var t=$(e).data("hammer");t&&t.off("tap doubletap panstart panmove panend pinchmove rotatemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var l=o(115),s=n(l),u=o(28),c=n(u),d=o(31),f=n(d),g=o(38),m=n(g),v=void 0,h=void 0,p=void 0,T=void 0,C=void 0,y=void 0,b=void 0,M=void 0,x=1,P=0,w=!1,S=!1,I=void 0,k=700,O=5,D={enable:r,disable:i};t.default=D},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=cornerstone.metaData;t.default=n},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(52),r=n(a),i=o(111),l=n(i),s=o(53),u=n(s),c={calculateReferenceLine:r.default,tool:l.default,renderActiveReferenceLine:u.default};t.default=c},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(114);Object.defineProperty(t,"regionsThreshold",{enumerable:!0,get:function(){return n(a).default}});var r=o(113);Object.defineProperty(t,"regionsGrow",{enumerable:!0,get:function(){return n(r).default}});var i=o(112);Object.defineProperty(t,"regionsDraw",{enumerable:!0,get:function(){return n(i).default}})},function(e,t,o){"use strict";function n(e,t){var o=void 0,n=void 0,a=void 0,r=0,i=e.length,l=[];for(l.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),o=1;o<i;o++)a=Number(e[o])/t|0,l.push(a),1===o?n=a:a!==n&&(l.isTimeVarying=!0),r+=a;return l.length>0&&(a=l.isTimeVarying?r/l.length|0:l[0],l.push(a)),l}function a(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function r(e){var t={element:e},o=$.Event("CornerstoneToolsClipStopped",t);$(e).trigger(o,t)}function i(e,t){var o=void 0,i=void 0;if(void 0===e)throw new Error("playClip: element must not be undefined");var l=(0,c.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var s=l.data[0],f=(0,c.getToolState)(e,d);f&&f.data&&f.data.length?(o=f.data[0],a(o)):(o={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},(0,c.addToolState)(e,d,o)),(t<0||t>0)&&(o.framesPerSecond=Number(t),o.reverse=o.framesPerSecond<0,o.ignoreFrameTimeVector=!0),!0!==o.ignoreFrameTimeVector&&o.frameTimeVector&&o.frameTimeVector.length===s.imageIds.length&&(i=n(o.frameTimeVector,o.speed));var g=function(){var t=void 0,n=void 0,i=void 0,l=void 0,c=void 0,d=s.currentImageIdIndex,f=s.imageIds.length;if(o.reverse?d--:d++,!o.loop&&(d<0||d>=f))return a(o),void r(e);d>=f&&(d=0),d<0&&(d=f-1),d!==s.currentImageIdIndex&&(i=u.default.getStartLoadHandler(),l=u.default.getEndLoadHandler(),c=u.default.getErrorLoadingHandler(),i&&i(e),n=cornerstone.getViewport(e),t=!0===s.preventCache?cornerstone.loadImage(s.imageIds[d]):cornerstone.loadAndCacheImage(s.imageIds[d]),t.then(function(t){s.currentImageIdIndex=d,cornerstone.displayImage(e,t,n),l&&l(e,t)},function(t){var o=s.imageIds[d];c&&c(e,o,t)}))};i&&i.length>0&&i.isTimeVarying?(o.usingFrameTimeVector=!0,o.intervalId=setTimeout(function e(){o.intervalId=setTimeout(e,i[s.currentImageIdIndex]),g()},0)):(o.usingFrameTimeVector=!1,o.intervalId=setInterval(g,1e3/Math.abs(o.framesPerSecond)))}}function l(e){var t=(0,c.getToolState)(e,d);t&&t.data&&t.data.length&&a(t.data[0])}Object.defineProperty(t,"__esModule",{value:!0}),t.stopClip=t.playClip=void 0;var s=o(8),u=function(e){return e&&e.__esModule?e:{default:e}}(s),c=o(0),d="playClip";t.playClip=i,t.stopClip=l},function(e,t,o){"use strict";function n(e,t){var o=t.element,n=t.enabledElement.canvas.width,a=t.enabledElement.canvas.height;if(!n||!a)return!1;var r=t.enabledElement.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.save();var s=u.getConfiguration();r.fillStyle=s.backgroundColor,"horizontal"===s.orientation?r.fillRect(0,a-l,n,l):r.fillRect(0,0,l,a);var c=(0,i.getToolState)(o,"stack");if(c&&c.data&&c.data.length){var d=c.data[0].imageIds,f=c.data[0].currentImageIdIndex,g=n/d.length,m=a/d.length,v=g*f,h=m*f;r.fillStyle=s.fillColor,"horizontal"===s.orientation?r.fillRect(v,a-l,g,l):r.fillRect(0,h,l,m),r.restore()}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(17),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=o(0),l=6,s={backgroundColor:"rgb(19, 63, 141)",fillColor:"white",orientation:"horizontal"},u=(0,r.default)(n);u.setConfiguration(s),t.default=u},function(e,t,o){"use strict";function n(e,t){var o=t.keyCode;if(o===i.UP||o===i.DOWN){var n=1;o===i.DOWN&&(n=-1),scroll(t.element,n)}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(105),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i={UP:38,DOWN:40},l=(0,r.default)(n);t.default=l},function(e,t,o){"use strict";function n(e){var t={imageIdToolState:r.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach(function(e){var o=(0,i.getElementToolStateManager)(e);o!==r.globalImageIdSpecificToolStateManager&&(t.elementToolState[e.id]=o.saveToolState(),t.elementViewport[e.id]=cornerstone.getViewport(e))}),t}function a(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport"))return r.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach(function(t){var o=document.getElementById(t);if(o&&e.elementToolState.hasOwnProperty(t)){var n=(0,i.getElementToolStateManager)(o);if(n!==r.globalImageIdSpecificToolStateManager){n.restoreToolState(e.elementToolState[t]);var a=e.elementViewport[t];cornerstone.setViewport(o,a),cornerstone.updateImage(o)}}}),e}Object.defineProperty(t,"__esModule",{value:!0});var r=o(14),i=o(0),l={save:n,restore:a};t.default=l},function(e,t,o){"use strict";function n(){function e(e,t,o){!1===n.hasOwnProperty(e)&&(n[e]={});var a=n[e];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(o)}function t(e,t){if(!1!==n.hasOwnProperty(e)){var o=n[e];if(!1!==o.hasOwnProperty(t)){return o[t]}}}function o(e,t,o){if(!1!==n.hasOwnProperty(e)){var a=n[e];if(!1!==a.hasOwnProperty(t)){for(var r=a[t],i=-1,l=0;l<r.data.length;l++)r.data[l]===o&&(i=l);-1!==i&&r.data.splice(i,1)}}}var n={};return{get:t,add:e,remove:o}}Object.defineProperty(t,"__esModule",{value:!0});var a=n();t.newFrameOfReferenceSpecificToolStateManager=n,t.globalFrameOfReferenceSpecificToolStateManager=a},function(e,t,o){"use strict";function n(e,t){function o(){return i}function n(e){i=e}function a(o,n,a){if(!(e.indexOf(n)>=0))return t.add(o,n,a);!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a)}function r(o,n){return e.indexOf(n)>=0?(!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n]):t.get(o,n)}var i={};return{get:r,add:a,saveToolState:o,restoreToolState:n,toolState:i}}function a(e,t){var o=(0,i.getElementToolStateManager)(e);o||(o=r.globalImageIdSpecificToolStateManager);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs"];t&&(a=a.concat(t));var s=n(a,o);l.push(s),(0,i.setElementToolStateManager)(e,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.addStackStateManager=t.newStackSpecificToolStateManager=void 0;var r=o(14),i=o(0),l=[];t.newStackSpecificToolStateManager=n,t.addStackStateManager=a},function(e,t,o){"use strict";function n(e,t){function o(o,n,r){if(!(e.indexOf(n)>=0))return t.add(o,n,r);!1===a.hasOwnProperty(n)&&(a[n]={data:[]}),a[n].data.push(r)}function n(o,n){return e.indexOf(n)>=0?(!1===a.hasOwnProperty(n)&&(a[n]={data:[]}),a[n]):t.get(o,n)}var a={};return{get:n,add:o}}function a(e,t){t=t||["timeSeries"];var o=(0,i.getElementToolStateManager)(e);void 0===o&&(o=r.globalImageIdSpecificToolStateManager);var a=n(t,o);l.push(a),(0,i.setElementToolStateManager)(e,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=void 0;var r=o(14),i=o(0),l=[];t.addTimeSeriesStateManager=a,t.newTimeSeriesSpecificToolStateManager=n},function(e,t,o){"use strict";function n(e,t){function o(e,t){i.length&&l.length&&(s=!0,l.forEach(function(o){var n=l.indexOf(o);if(-1!==n){var a=u.imageIds.targetElements[n],s=i.indexOf(e);if(-1!==s){var d=u.imageIds.sourceElements[s],f=void 0;f=d===a?0:u.distances[d][a],c(r,e,o,t,f)}}}),s=!1)}function n(e,t){!0!==s&&o(e.currentTarget,t)}function a(e,t){var o=t.element;r.remove(o)}var r=this,i=[],l=[],s=!1,u={},c=t;this.setHandler=function(e){c=e},this.getHandler=function(){return c},this.getDistances=function(){i.length&&l.length&&(u.distances={},u.imageIds={sourceElements:[],targetElements:[]},i.forEach(function(e){var t=cornerstone.getEnabledElement(e);if(t&&t.image){var o=t.image.imageId,n=cornerstone.metaData.get("imagePlane",o);if(n&&n.imagePositionPatient){var a=n.imagePositionPatient;u.hasOwnProperty(t)||(u.distances[o]={},u.imageIds.sourceElements.push(o),l.forEach(function(t){var n=cornerstone.getEnabledElement(t);if(n&&n.image){var r=n.image.imageId;if(u.imageIds.targetElements.push(r),e!==t&&o!==r&&!u.distances[o].hasOwnProperty(r)){var i=cornerstone.metaData.get("imagePlane",r);if(i&&i.imagePositionPatient){var l=i.imagePositionPatient;u.distances[o][r]=l.clone().sub(a)}}}}),Object.keys(u.distances[o]).length||delete u.distances[o])}}}))},this.addSource=function(t){-1===i.indexOf(t)&&(i.push(t),$(t).on(e,n),r.getDistances(),r.updateDisableHandlers())},this.addTarget=function(e){-1===l.indexOf(e)&&(l.push(e),r.getDistances(),c(r,e,e,0),r.updateDisableHandlers())},this.add=function(e){r.addSource(e),r.addTarget(e)},this.removeSource=function(t){var a=i.indexOf(t);-1!==a&&(i.splice(a,1),$(t).off(e,n),r.getDistances(),o(t),r.updateDisableHandlers())},this.removeTarget=function(e){var t=l.indexOf(e);-1!==t&&(l.splice(t,1),r.getDistances(),c(r,e,e,0),r.updateDisableHandlers())},this.remove=function(e){r.removeTarget(e),r.removeSource(e)},this.getSourceElements=function(){return i},this.getTargetElements=function(){return l},this.displayImage=function(e,t,o){s=!0,cornerstone.displayImage(e,t,o),s=!1},this.setViewport=function(e,t){s=!0,cornerstone.setViewport(e,t),s=!1},this.updateDisableHandlers=function(){$.unique(i.concat(l)).forEach(function(e){$(e).off("CornerstoneElementDisabled",a),$(e).on("CornerstoneElementDisabled",a)})},this.destroy=function(){$.unique(i.concat(l)).forEach(function(e){r.remove(e)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var n=cornerstone.getViewport(t),a=cornerstone.getViewport(o);a.scale===n.scale&&a.translation.x===n.translation.x&&a.translation.y===n.translation.y||(a.scale=n.scale,a.translation.x=n.translation.x,a.translation.y=n.translation.y,e.setViewport(o,a))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var a=(0,n.getToolState)(t,"stack"),i=a.data[0],l=(0,n.getToolState)(o,"stack"),s=l.data[0],u=i.currentImageIdIndex;if((u=Math.min(Math.max(u,0),s.imageIds.length-1))!==s.currentImageIdIndex){var c=r.default.getStartLoadHandler(),d=r.default.getEndLoadHandler(),f=r.default.getErrorLoadingHandler();c&&c(o);var g=void 0;g=!0===s.preventCache?cornerstone.loadImage(s.imageIds[u]):cornerstone.loadAndCacheImage(s.imageIds[u]),g.then(function(t){var n=cornerstone.getViewport(o);s.currentImageIdIndex=u,e.displayImage(o,t,n),d&&d(o,t)},function(e){var t=s.imageIds[u];f&&f(o,t,e)})}}};var n=o(0),a=o(8),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,i){if(o!==t){var l=cornerstone.getEnabledElement(t),s=cornerstone.metaData.get("imagePlane",l.image.imageId),u=s.imagePositionPatient,c=(0,n.getToolState)(o,"stack"),d=c.data[0],f=Number.MAX_VALUE,g=-1;if(i){var m=u.clone().add(i);if(d.imageIds.forEach(function(e,t){var o=cornerstone.metaData.get("imagePlane",e),n=o.imagePositionPatient,a=m.distanceToSquared(n);a<f&&(f=a,g=t)}),g!==d.currentImageIdIndex&&-1!==g){var v=r.default.getStartLoadHandler(),h=r.default.getEndLoadHandler(),p=r.default.getErrorLoadingHandler();v&&v(o);var T=void 0;T=!0===d.preventCache?cornerstone.loadImage(d.imageIds[g]):cornerstone.loadAndCacheImage(d.imageIds[g]),T.then(function(t){var n=cornerstone.getViewport(o);d.currentImageIdIndex=g,e.displayImage(o,t,n),h&&h(o,t)},function(e){var t=d.imageIds[g];p&&p(o,t,e)})}}}};var n=o(0),a=o(8),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var a=cornerstone.getEnabledElement(t).image,i=cornerstone.metaData.get("imagePlane",a.imageId),l=i.imagePositionPatient,s=(0,n.getToolState)(o,"stack"),u=s.data[0],c=Number.MAX_VALUE,d=-1;if($.each(u.imageIds,function(e,t){var o=cornerstone.metaData.get("imagePlane",t),n=o.imagePositionPatient,a=n.distanceToSquared(l);a<c&&(c=a,d=e)}),d!==u.currentImageIdIndex){var f=r.default.getStartLoadHandler(),g=r.default.getEndLoadHandler(),m=r.default.getErrorLoadingHandler();if(f&&f(o),-1!==d){var v=void 0;v=!0===u.preventCache?cornerstone.loadImage(u.imageIds[d]):cornerstone.loadAndCacheImage(u.imageIds[d]),v.then(function(t){var n=cornerstone.getViewport(o);u.currentImageIdIndex=d,e.displayImage(o,t,n),g&&g(o,t)},function(e){var t=u.imageIds[d];m&&m(o,t,e)})}}}};var n=o(0),a=o(8),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a){if(t!==o&&a&&a.direction){var i=(0,n.getToolState)(o,"stack"),l=i.data[0],s=l.currentImageIdIndex+a.direction;if(s=Math.min(Math.max(s,0),l.imageIds.length-1),l.currentImageIdIndex!==s){var u=r.default.getStartLoadHandler(),c=r.default.getEndLoadHandler(),d=r.default.getErrorLoadingHandler();u&&u(o);var f=void 0;f=!0===l.preventCache?cornerstone.loadImage(l.imageIds[s]):cornerstone.loadAndCacheImage(l.imageIds[s]),f.then(function(t){var n=cornerstone.getViewport(o);l.currentImageIdIndex=s,e.displayImage(o,t,n),c&&c(o,t)},function(e){var t=l.imageIds[s];d&&d(o,t,e)})}}};var n=o(0),a=o(8),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){o!==t&&cornerstone.updateImage(o)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var n=cornerstone.getViewport(t),a=cornerstone.getViewport(o);a.voi.windowWidth===n.voi.windowWidth&&a.voi.windowCenter===n.voi.windowCenter&&a.invert===n.invert||(a.voi.windowWidth=n.voi.windowWidth,a.voi.windowCenter=n.voi.windowCenter,a.invert=n.invert,e.setViewport(o,a))}}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=[];e.timeSeries.stacks.forEach(function(o){var n=void 0;n=!0===o.preventCache?cornerstone.loadImage(o.imageIds[e.imageIdIndex]):cornerstone.loadAndCacheImage(o.imageIds[e.imageIdIndex]),n.then(function(o){var n=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*o.width,a=o.getPixelData()[n];t.push(a)})}),e.lineSample.set(t)}function r(e){var t=(0,g.getToolState)(e.element,"timeSeries");if(void 0!==t&&void 0!==t.data&&0!==t.data.length){var o=t.data[0],n={timeSeries:o,lineSample:new p.default,imageIdIndex:o.stacks[o.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return a(n),v.default.add(n),n}}function i(e,t){var o=(0,g.getToolState)(e.currentTarget,T);if(o){var n=t.canvasContext.canvas.getContext("2d");cornerstone.setToPixelCoordinateSystem(t.enabledElement,n);for(var a=0;a<o.data.length;a++){n.save();var r=o.data[a];n.beginPath(),(0,c.default)(n,t,r.handles,"white"),n.stroke();var i=(0,f.default)(t.enabledElement,t.canvasContext,15);n.font=i.fontSize+"px Arial";var l=Math.round(r.handles.end.x),s=Math.round(r.handles.end.y),u=r.handles.end.x+3,d=r.handles.end.y-3;n.fillStyle="white",n.fillText(l+","+s,u,d),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(6),s=n(l),u=o(5),c=n(u),d=o(51),f=n(d),g=o(0),m=o(108),v=n(m),h=o(107),p=n(h),T="probe4D",C=(0,s.default)({createNewMeasurement:r,onImageRendered:i,toolType:T});t.default=C},function(e,t,o){"use strict";function n(e,t){if(void 0===e)throw new Error("playClip: element must not be undefined");void 0===t&&(t=30);var o=(0,r.getToolState)(e,"timeSeries");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var n=(0,r.getToolState)(e,s),a=void 0;void 0===n||0===n.data.length?(a={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},(0,r.addToolState)(e,s,a)):(a=n.data[0],a.framesPerSecond=t),void 0===a.intervalId&&(a.intervalId=setInterval(function(){a.framesPerSecond>0?(0,l.default)(e,1,!0):(0,l.default)(e,-1,!0)},1e3/Math.abs(a.framesPerSecond)))}}function a(e){var t=(0,r.getToolState)(e,s);if(t&&t.data&&t.data.length){var o=t.data[0];clearInterval(o.intervalId),o.intervalId=void 0}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),i=o(27),l=function(e){return e&&e.__esModule?e:{default:e}}(i),s="timeSeriesPlayer",u={start:n,stop:a};t.default=u},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){$(t.element).off("CornerstoneToolsMouseDrag",i),$(t.element).off("CornerstoneToolsMouseUp",a),$(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask)){var o={deltaY:0,options:e.data.options};return $(t.element).on("CornerstoneToolsMouseDrag",o,i),$(t.element).on("CornerstoneToolsMouseUp",a),$(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function i(e,t){e.data.deltaY+=t.deltaPoints.page.y;var o=(0,C.getToolState)(t.element,"timeSeries");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var n=o.data[0],a=$(t.element).height()/n.stacks.length;if(void 0!==e.data.options&&void 0!==e.data.options.timeSeriesScrollSpeed&&(a=e.data.options.timeSeriesScrollSpeed),e.data.deltaY>=a||e.data.deltaY<=-a){var r=Math.round(e.data.deltaY/a),i=e.data.deltaY%a;(0,h.default)(t.element,r),e.data.deltaY=i}return!1}}function l(e,t){var o=-t.direction;(0,h.default)(t.element,o)}function s(e){var t=e.originalEvent.detail,o={deltaY:0};o.deltaY+=t.deltaPoints.page.y;var n=(0,C.getToolState)(t.element,"stack");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){if(o.deltaY>=3||o.deltaY<=-3){var a=o.deltaY/3,r=o.deltaY%3;(0,h.default)(o.element,a),o.deltaY=r}return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=void 0;var u=o(11),c=n(u),d=o(9),f=n(d),g=o(18),m=n(g),v=o(27),h=n(v),p=o(1),T=n(p),C=o(0),y=(0,c.default)(r),b=(0,m.default)(l),M=(0,f.default)(s);t.timeSeriesScroll=y,t.timeSeriesScrollWheel=b,t.timeSeriesScrollTouchDrag=M},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="0.8.6"},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t){$(t).off("CornerstoneToolsKeyDown",e),$(t).on("CornerstoneToolsKeyDown",e)},disable:function(t){$(t).off("CornerstoneToolsKeyDown",e)},enable:function(t){$(t).off("CornerstoneToolsKeyDown",e)},deactivate:function(t){$(t).off("CornerstoneToolsKeyDown",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(83);Object.defineProperty(t,"metaData",{enumerable:!0,get:function(){return n(a).default}});var r=o(84);Object.defineProperty(t,"referenceLines",{enumerable:!0,get:function(){return n(r).default}});var i=o(41);Object.defineProperty(t,"orientation",{enumerable:!0,get:function(){return n(i).default}});var l=o(25);Object.defineProperty(t,"requestPoolManager",{enumerable:!0,get:function(){return n(l).default}});var s=o(51);Object.defineProperty(t,"setContextToDisplayFontSize",{enumerable:!0,get:function(){return n(s).default}});var u=o(50);Object.defineProperty(t,"scrollToIndex",{enumerable:!0,get:function(){return n(u).default}});var c=o(49);Object.defineProperty(t,"scroll",{enumerable:!0,get:function(){return n(c).default}});var d=o(34);Object.defineProperty(t,"roundToDecimal",{enumerable:!0,get:function(){return n(d).default}});var f=o(33);Object.defineProperty(t,"projectPatientPointToImagePlane",{enumerable:!0,get:function(){return f.projectPatientPointToImagePlane}}),Object.defineProperty(t,"imagePointToPatientPoint",{enumerable:!0,get:function(){return f.imagePointToPatientPoint}}),Object.defineProperty(t,"planePlaneIntersection",{enumerable:!0,get:function(){return f.planePlaneIntersection}});var g=o(16);Object.defineProperty(t,"pointInsideBoundingBox",{enumerable:!0,get:function(){return n(g).default}});var m=o(32);Object.defineProperty(t,"pointInEllipse",{enumerable:!0,get:function(){return n(m).default}});var v=o(31);Object.defineProperty(t,"pauseEvent",{enumerable:!0,get:function(){return n(v).default}});var h=o(1);Object.defineProperty(t,"isMouseButtonEnabled",{enumerable:!0,get:function(){return n(h).default}});var p=o(30);Object.defineProperty(t,"getRGBPixels",{enumerable:!0,get:function(){return n(p).default}});var T=o(29);Object.defineProperty(t,"getDefaultSimultaneousRequests",{enumerable:!0,get:function(){return T.getDefaultSimultaneousRequests}}),Object.defineProperty(t,"getMaxSimultaneousRequests",{enumerable:!0,get:function(){return T.getMaxSimultaneousRequests}}),Object.defineProperty(t,"getBrowserInfo",{enumerable:!0,get:function(){return T.getBrowserInfo}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return T.isMobileDevice}});var C=o(48);Object.defineProperty(t,"getLuminance",{enumerable:!0,get:function(){return n(C).default}});var y=o(4);Object.defineProperty(t,"drawTextBox",{enumerable:!0,get:function(){return n(y).default}});var b=o(47);Object.defineProperty(t,"drawEllipse",{enumerable:!0,get:function(){return n(b).default}});var M=o(46);Object.defineProperty(t,"drawCircle",{enumerable:!0,get:function(){return n(M).default}});var x=o(45);Object.defineProperty(t,"drawArrow",{enumerable:!0,get:function(){return n(x).default}});var P=o(28);Object.defineProperty(t,"copyPoints",{enumerable:!0,get:function(){return n(P).default}});var w=o(15);Object.defineProperty(t,"calculateSUV",{enumerable:!0,get:function(){return n(w).default}});var S=o(44);Object.defineProperty(t,"calculateEllipseStatistics",{enumerable:!0,get:function(){return n(S).default}});var I=o(101);Object.defineProperty(t,"probeTool4D",{enumerable:!0,get:function(){return n(I).default}});var $=o(27);Object.defineProperty(t,"incrementTimePoint",{enumerable:!0,get:function(){return n($).default}});var k=o(102);Object.defineProperty(t,"timeSeriesPlayer",{enumerable:!0,get:function(){return n(k).default}});var O=o(103);Object.defineProperty(t,"timeSeriesScroll",{enumerable:!0,get:function(){return O.timeSeriesScroll}}),Object.defineProperty(t,"timeSeriesScrollWheel",{enumerable:!0,get:function(){return O.timeSeriesScrollWheel}}),Object.defineProperty(t,"timeSeriesScrollTouchDrag",{enumerable:!0,get:function(){return O.timeSeriesScrollTouchDrag}});var D=o(100);Object.defineProperty(t,"wwwcSynchronizer",{enumerable:!0,get:function(){return n(D).default}});var _=o(99);Object.defineProperty(t,"updateImageSynchronizer",{enumerable:!0,get:function(){return n(_).default}});var j=o(93);Object.defineProperty(t,"Synchronizer",{enumerable:!0,get:function(){return n(j).default}});var E=o(98);Object.defineProperty(t,"stackScrollSynchronizer",{enumerable:!0,get:function(){return n(E).default}});var R=o(97);Object.defineProperty(t,"stackImagePositionSynchronizer",{enumerable:!0,get:function(){return n(R).default}});var A=o(96);Object.defineProperty(t,"stackImagePositionOffsetSynchronizer",{enumerable:!0,get:function(){return n(A).default}});var B=o(95);Object.defineProperty(t,"stackImageIndexSynchronizer",{enumerable:!0,get:function(){return n(B).default}});var N=o(94);Object.defineProperty(t,"panZoomSynchronizer",{enumerable:!0,get:function(){return n(N).default}});var H=o(3);Object.defineProperty(t,"toolStyle",{enumerable:!0,get:function(){return n(H).default}});var V=o(0);Object.defineProperty(t,"addToolState",{enumerable:!0,get:function(){return V.addToolState}}),Object.defineProperty(t,"getToolState",{enumerable:!0,get:function(){return V.getToolState}}),Object.defineProperty(t,"removeToolState",{enumerable:!0,get:function(){return V.removeToolState}}),Object.defineProperty(t,"clearToolState",{enumerable:!0,get:function(){return V.clearToolState}}),Object.defineProperty(t,"setElementToolStateManager",{enumerable:!0,get:function(){return V.setElementToolStateManager}}),Object.defineProperty(t,"getElementToolStateManager",{enumerable:!0,get:function(){return V.getElementToolStateManager}});var W=o(26);Object.defineProperty(t,"toolCoordinates",{enumerable:!0,get:function(){return n(W).default}});var Y=o(2);Object.defineProperty(t,"toolColors",{enumerable:!0,get:function(){return n(Y).default}});var L=o(92);Object.defineProperty(t,"addTimeSeriesStateManager",{enumerable:!0,get:function(){return L.addTimeSeriesStateManager}}),Object.defineProperty(t,"newTimeSeriesSpecificToolStateManager",{enumerable:!0,get:function(){return L.newTimeSeriesSpecificToolStateManager}});var F=o(12);Object.defineProperty(t,"textStyle",{enumerable:!0,get:function(){return n(F).default}});var U=o(91);Object.defineProperty(t,"stackSpecificStateManager",{enumerable:!0,get:function(){return n(U).default}}),Object.defineProperty(t,"newStackSpecificToolStateManager",{enumerable:!0,get:function(){return U.newStackSpecificToolStateManager}}),Object.defineProperty(t,"addStackStateManager",{enumerable:!0,get:function(){return U.addStackStateManager}});var z=o(8);Object.defineProperty(t,"loadHandlerManager",{enumerable:!0,get:function(){return n(z).default}});var X=o(14);Object.defineProperty(t,"newImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.newImageIdSpecificToolStateManager}}),Object.defineProperty(t,"globalImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.globalImageIdSpecificToolStateManager}});var q=o(90);Object.defineProperty(t,"newFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return q.newFrameOfReferenceSpecificToolStateManager}}),Object.defineProperty(t,"globalFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return q.globalFrameOfReferenceSpecificToolStateManager}});var G=o(89);Object.defineProperty(t,"appState",{enumerable:!0,get:function(){return n(G).default}});var K=o(88);Object.defineProperty(t,"stackScrollKeyboard",{enumerable:!0,get:function(){return n(K).default}});var Z=o(43);Object.defineProperty(t,"stackScroll",{enumerable:!0,get:function(){return Z.stackScroll}}),Object.defineProperty(t,"stackScrollWheel",{enumerable:!0,get:function(){return Z.stackScrollWheel}}),Object.defineProperty(t,"stackScrollTouchDrag",{enumerable:!0,get:function(){return Z.stackScrollTouchDrag}}),Object.defineProperty(t,"stackScrollMultiTouch",{enumerable:!0,get:function(){return Z.stackScrollMultiTouch}});var J=o(42);Object.defineProperty(t,"stackPrefetch",{enumerable:!0,get:function(){return n(J).default}});var Q=o(87);Object.defineProperty(t,"scrollIndicator",{enumerable:!0,get:function(){return n(Q).default}});var ee=o(86);Object.defineProperty(t,"playClip",{enumerable:!0,get:function(){return ee.playClip}}),Object.defineProperty(t,"stopClip",{enumerable:!0,get:function(){return ee.stopClip}});var te=o(10);Object.defineProperty(t,"anyHandlesOutsideImage",{enumerable:!0,get:function(){return n(te).default}});var oe=o(5);Object.defineProperty(t,"drawHandles",{enumerable:!0,get:function(){return n(oe).default}});var ne=o(13);Object.defineProperty(t,"getHandleNearImagePoint",{enumerable:!0,get:function(){return n(ne).default}});var ae=o(23);Object.defineProperty(t,"handleActivator",{enumerable:!0,get:function(){return n(ae).default}});var re=o(24);Object.defineProperty(t,"moveAllHandles",{enumerable:!0,get:function(){return n(re).default}});var ie=o(19);Object.defineProperty(t,"moveHandle",{enumerable:!0,get:function(){return n(ie).default}});var le=o(20);Object.defineProperty(t,"moveNewHandle",{enumerable:!0,get:function(){return n(le).default}});var se=o(21);Object.defineProperty(t,"moveNewHandleTouch",{enumerable:!0,get:function(){return n(se).default}});var ue=o(39);Object.defineProperty(t,"touchMoveAllHandles",{enumerable:!0,get:function(){return n(ue).default}});var ce=o(40);Object.defineProperty(t,"touchMoveHandle",{enumerable:!0,get:function(){return n(ce).default}});var de=o(79);Object.defineProperty(t,"keyboardInput",{enumerable:!0,get:function(){return n(de).default}});var fe=o(80);Object.defineProperty(t,"mouseInput",{enumerable:!0,get:function(){return n(fe).default}});var ge=o(81);Object.defineProperty(t,"mouseWheelInput",{enumerable:!0,get:function(){return n(ge).default}});var me=o(38);Object.defineProperty(t,"preventGhostClick",{enumerable:!0,get:function(){return n(me).default}});var ve=o(82);Object.defineProperty(t,"touchInput",{enumerable:!0,get:function(){return n(ve).default}});var he=o(54);Object.defineProperty(t,"angle",{enumerable:!0,get:function(){return he.angle}}),Object.defineProperty(t,"angleTouch",{enumerable:!0,get:function(){return he.angleTouch}});var pe=o(55);Object.defineProperty(t,"arrowAnnotate",{enumerable:!0,get:function(){return pe.arrowAnnotate}}),Object.defineProperty(t,"arrowAnnotateTouch",{enumerable:!0,get:function(){return pe.arrowAnnotateTouch}});var Te=o(56);Object.defineProperty(t,"crosshairs",{enumerable:!0,get:function(){return Te.crosshairs}}),Object.defineProperty(t,"crosshairsTouch",{enumerable:!0,get:function(){return Te.crosshairsTouch}});var Ce=o(17);Object.defineProperty(t,"displayTool",{enumerable:!0,get:function(){return n(Ce).default}});var ye=o(35);Object.defineProperty(t,"doubleTapTool",{enumerable:!0,get:function(){return n(ye).default}});var be=o(57);Object.defineProperty(t,"doubleTapZoom",{enumerable:!0,get:function(){return n(be).default}});var Me=o(58);Object.defineProperty(t,"dragProbe",{enumerable:!0,get:function(){return Me.dragProbe}}),Object.defineProperty(t,"dragProbeTouch",{enumerable:!0,get:function(){return Me.dragProbeTouch}});var xe=o(59);Object.defineProperty(t,"ellipticalRoi",{enumerable:!0,get:function(){return xe.ellipticalRoi}}),Object.defineProperty(t,"ellipticalRoiTouch",{enumerable:!0,get:function(){return xe.ellipticalRoiTouch}});var Pe=o(60);Object.defineProperty(t,"freehand",{enumerable:!0,get:function(){return Pe.freehand}});var we=o(61);Object.defineProperty(t,"highlight",{enumerable:!0,get:function(){return we.highlight}}),Object.defineProperty(t,"highlightTouch",{enumerable:!0,get:function(){return we.highlightTouch}});var Se=o(62);Object.defineProperty(t,"imageStats",{enumerable:!0,get:function(){return n(Se).default}}),Object.defineProperty(t,"keyboardTool",{enumerable:!0,get:function(){return n(Se).default}});var Ie=o(63);Object.defineProperty(t,"length",{enumerable:!0,get:function(){return Ie.length}}),Object.defineProperty(t,"lengthTouch",{enumerable:!0,get:function(){return Ie.lengthTouch}});var $e=o(64);Object.defineProperty(t,"magnify",{enumerable:!0,get:function(){return $e.magnify}}),Object.defineProperty(t,"magnifyTouchDrag",{enumerable:!0,get:function(){return $e.magnifyTouchDrag}});var ke=o(36);Object.defineProperty(t,"mouseButtonRectangleTool",{enumerable:!0,get:function(){return n(ke).default}});var Oe=o(6);Object.defineProperty(t,"mouseButtonTool",{enumerable:!0,get:function(){return n(Oe).default}});var De=o(18);Object.defineProperty(t,"mouseWheelTool",{enumerable:!0,get:function(){return n(De).default}});var _e=o(22);Object.defineProperty(t,"multiTouchDragTool",{enumerable:!0,get:function(){return n(_e).default}});var je=o(65);Object.defineProperty(t,"orientationMarkers",{enumerable:!0,get:function(){return n(je).default}});var Ee=o(66);Object.defineProperty(t,"pan",{enumerable:!0,get:function(){return Ee.pan}}),Object.defineProperty(t,"panTouchDrag",{enumerable:!0,get:function(){return Ee.panTouchDrag}});var Re=o(67);Object.defineProperty(t,"panMultiTouch",{enumerable:!0,get:function(){return n(Re).default}});var Ae=o(68);Object.defineProperty(t,"probe",{enumerable:!0,get:function(){return Ae.probe}}),Object.defineProperty(t,"probeTouch",{enumerable:!0,get:function(){return Ae.probeTouch}});var Be=o(69);Object.defineProperty(t,"rectangleRoi",{enumerable:!0,get:function(){return Be.rectangleRoi}}),Object.defineProperty(t,"rectangleRoiTouch",{enumerable:!0,get:function(){return Be.rectangleRoiTouch}});var Ne=o(70);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return Ne.rotate}}),Object.defineProperty(t,"rotateTouchDrag",{enumerable:!0,get:function(){return Ne.rotateTouchDrag}});var He=o(71);Object.defineProperty(t,"rotateTouch",{enumerable:!0,get:function(){return n(He).default}});var Ve=o(72);Object.defineProperty(t,"saveAs",{enumerable:!0,get:function(){return n(Ve).default}});var We=o(73);Object.defineProperty(t,"seedAnnotate",{enumerable:!0,get:function(){return We.seedAnnotate}}),Object.defineProperty(t,"seedAnnotateTouch",{enumerable:!0,get:function(){return We.seedAnnotateTouch}});var Ye=o(74);Object.defineProperty(t,"simpleAngle",{enumerable:!0,get:function(){return Ye.simpleAngle}}),Object.defineProperty(t,"simpleAngleTouch",{enumerable:!0,get:function(){return Ye.simpleAngleTouch}});var Le=o(11);Object.defineProperty(t,"simpleMouseButtonTool",{enumerable:!0,get:function(){return n(Le).default}});var Fe=o(75);Object.defineProperty(t,"textMarker",{enumerable:!0,get:function(){return Fe.textMarker}}),Object.defineProperty(t,"textMarkerTouch",{enumerable:!0,get:function(){return Fe.textMarkerTouch}});var Ue=o(9);Object.defineProperty(t,"touchDragTool",{enumerable:!0,get:function(){return n(Ue).default}});var ze=o(37);Object.defineProperty(t,"touchPinchTool",{enumerable:!0,get:function(){return n(ze).default}});var Xe=o(7);Object.defineProperty(t,"touchTool",{enumerable:!0,get:function(){return n(Xe).default}});var qe=o(76);Object.defineProperty(t,"wwwc",{enumerable:!0,get:function(){return qe.wwwc}}),Object.defineProperty(t,"wwwcTouchDrag",{enumerable:!0,get:function(){return qe.wwwcTouchDrag}});var Ge=o(77);Object.defineProperty(t,"wwwcRegion",{enumerable:!0,get:function(){return Ge.wwwcRegion}}),Object.defineProperty(t,"wwwcRegionTouch",{enumerable:!0,get:function(){return Ge.wwwcRegionTouch}});var Ke=o(78);Object.defineProperty(t,"zoom",{enumerable:!0,get:function(){return Ke.zoom}}),Object.defineProperty(t,"zoomWheel",{enumerable:!0,get:function(){return Ke.zoomWheel}}),Object.defineProperty(t,"zoomTouchPinch",{enumerable:!0,get:function(){return Ke.zoomTouchPinch}}),Object.defineProperty(t,"zoomTouchDrag",{enumerable:!0,get:function(){return Ke.zoomTouchDrag}});var Ze=o(85);Object.defineProperty(t,"regionsThreshold",{enumerable:!0,get:function(){return Ze.regionsThreshold}}),Object.defineProperty(t,"regionsGrow",{enumerable:!0,get:function(){return Ze.regionsGrow}}),Object.defineProperty(t,"regionsDraw",{enumerable:!0,get:function(){return Ze.regionsDraw}});var Je=o(104);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return n(Je).default}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;e.samples=[],this.set=function(t){e.samples=t,$(e).trigger("CornerstoneLineSampleUpdated")}}},function(e,t,o){"use strict";function n(){var e=this;e.measurements=[],this.add=function(t){var o=e.measurements.push(t),n={index:o,measurement:t};$(e).trigger("CornerstoneMeasurementAdded",n)},this.remove=function(t){var o=e.measurements[t];e.measurements.splice(t,1);var n={index:t,measurement:o};$(e).trigger("CornerstoneMeasurementRemoved",n)}}Object.defineProperty(t,"__esModule",{value:!0});var a=new n;t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t="",o=e.x<0?"R":"L",n=e.y<0?"A":"P",a=e.z<0?"F":"H",r=new cornerstoneMath.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),i=0;i<3;i++)if(r.x>1e-4&&r.x>r.y&&r.x>r.z)t+=o,r.x=0;else if(r.y>1e-4&&r.y>r.x&&r.y>r.z)t+=n,r.y=0;else{if(!(r.z>1e-4&&r.z>r.x&&r.z>r.y))break;t+=a,r.z=0}return t}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.replace("H","f");return t=t.replace("F","h"),t=t.replace("R","l"),t=t.replace("L","r"),t=t.replace("A","p"),t=t.replace("P","a"),t=t.toUpperCase()}},function(e,t,o){"use strict";function n(e,t){var o=(0,i.getToolState)(e.currentTarget,u);if(void 0!==o){var n=o.data[0].synchronizationContext,a=n.getSourceElements(),r=o.data[0].renderer,l=t.canvasContext.canvas.getContext("2d");cornerstone.setToPixelCoordinateSystem(t.enabledElement,l),$.each(a,function(o,n){n!==e.currentTarget&&r(l,t,e.currentTarget,n)})}}function a(e,t,o){o=o||s.default,(0,i.addToolState)(e,u,{synchronizationContext:t,renderer:o}),$(e).on("CornerstoneImageRendered",n),cornerstone.updateImage(e)}function r(e){$(e).off("CornerstoneImageRendered",n),cornerstone.updateImage(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),l=o(53),s=function(e){return e&&e.__esModule?e:{default:e}}(l),u="referenceLines",c={enable:a,disable:r};t.default=c},function(e,t,o){"use strict";function n(e,t){for(var o=d(e,2),n=o[0],a=o[1],r=!1,i=0,l=t.length-1;i<t.length;l=i++){var s=d(t[i],2),u=s[0],c=s[1],f=d(t[l],2),g=f[0],m=f[1];c>a!=m>a&&n<(g-u)*(a-c)/(m-c)+u&&(r=!r)}return r}function a(e,t){var o=t.canvasContext,n=t.enabledElement,a=t.element;cornerstone.setToPixelCoordinateSystem(n,o);var r=(0,f.getToolState)(a,v),i=t.canvasContext,l=r.data[0].points;if(!(l.length<2)){var s=l[0],u=s[0],c=s[1];i.fillStyle="rgba(255,255,255,.2)",i.strokeStyle="white",i.beginPath(),i.moveTo(u,c),l.slice(1).forEach(function(e){i.lineTo(e[0],e[1])}),i.closePath(),i.stroke(),i.fill()}}function r(e,t,o,a){for(var r=(0,f.getToolState)(e,"stack"),i=(0,f.getToolState)(e,"regions"),l=(0,f.getToolState)(e,v),s=r.data[0].currentImageIdIndex,u=r.data[0].imageIds.length,c=i.data[0],d=l.data[0].points,g=c.buffer,m=c.width,h=c.height,p=Math.max(0,s-o),T=Math.min(u,s+a),C=m*h,y=p*C,b=new Uint8Array(g,y),M=0;M<=T-s;M+=1)for(var x=0;x<m;x+=1)for(var P=0;P<h;P+=1){var w=x+P*m+M*C,S=b[w];S>0&&n([x,P],d)&&(b[w]=t)}}function i(e,t){$(t.element).off("CornerstoneToolsMouseDrag",s),$(t.element).off("CornerstoneToolsMouseUp",i),$(t.element).off("CornerstoneImageRendered",a),r(t.element,h,p,T),cornerstone.updateImage(t.element)}function l(e,t){if((0,m.default)(t.which,e.data.mouseButtonMask)){return(0,f.getToolState)(e.currentTarget,v).data[0].points=[],$(t.element).on("CornerstoneToolsMouseDrag",s),$(t.element).on("CornerstoneToolsMouseUp",i),$(t.element).on("CornerstoneImageRendered",a),s(e,t)}}function s(e,t){e.stopImmediatePropagation();var o=(0,f.getToolState)(e.currentTarget,v);if(o){var n=t.currentPoints.image;return o.data[0].points.push([n.x,n.y]),cornerstone.updateImage(t.element),!1}}function u(e,t){var o={mouseButtonMask:t};(0,f.clearToolState)(e,v),(0,f.addToolState)(e,v,{points:[]}),$(e).off("CornerstoneToolsMouseDown",l),$(e).on("CornerstoneToolsMouseDown",o,l)}function c(e){$(e).off("CornerstoneToolsMouseDown",l)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){var o=[],n=!0,a=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(o.push(i.value),!t||o.length!==t);n=!0);}catch(e){a=!0,r=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw r}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=o(0),g=o(1),m=function(e){return e&&e.__esModule?e:{default:e}}(g),v="regionsDraw",h=4,p=0,T=5;t.default={enable:u,disable:c,activate:u,deactivate:c}},function(e,t,o){"use strict";function n(e,t,o){var n=e*t;return[o-1,o+1,o-e,o+e,o-n,o+n]}function a(e,t,o,a){var r=e.width,i=e.height,l=e.buffer,u=s(o,3),c=u[0],d=u[1],f=u[2],g=new Uint8Array(l),m=r*i,v=m*f,h=d*r+c,p=v+h,T=g[p];if(0!==T&&T!==a){for(var C=[p];0!==C.length;){C.forEach(function(e){g[e]=a});C=C.map(function(e){return n(r,i,e)}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e,t,o){return o.indexOf(e)===t}).filter(function(e){return g[e]===T})}return l}}function r(e,t){var o=t.element;if((0,d.default)(t.which,e.data.mouseButtonMask)){var n=s((0,u.getToolState)(o,"stack").data,1),r=n[0],i=s((0,u.getToolState)(o,"regions").data,1),l=i[0],c=r.currentImageIdIndex,g=r.imageIds,m=t.currentPoints.image,v=m.x,h=m.y,p=[Math.round(v),Math.round(h),c];a(l,g.length,p,f),cornerstone.updateImage(o)}}function i(e,t){var o=(0,u.getToolState)(e,"stack"),n=(0,u.getToolState)(e,"regions");o&&o.data&&o.data.length&&n&&n.data&&n.data.length&&$(e).on("CornerstoneToolsMouseDown",{mouseButtonMask:t},r)}function l(e){$(e).off("CornerstoneToolsMouseDown",r)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){var o=[],n=!0,a=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(o.push(i.value),!t||o.length!==t);n=!0);}catch(e){a=!0,r=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw r}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=o(0),c=o(1),d=function(e){return e&&e.__esModule?e:{default:e}}(c),f=2;t.default={enable:i,disable:l,activate:i,deactivate:l}},function(e,t,o){"use strict";function n(e,t){var o=void 0,n=void 0,a=e.imageIds,r=a.length;return cornerstone.loadImage(a[0]).then(function(e){o=e.width,n=e.height;var i=o*n*r*u,l=new ArrayBuffer(i),c=new Uint8Array(l),d=a.map(function(e,t){return cornerstone.loadImage(e).then(function(e){for(var a=e.slope,r=e.intercept,i=e.getPixelData(),l=o*n,u=0;u<l;u++){var d=i[u],f=d*a+r,g=f>=s?1:0;c[t*l+u]=g}})});return Promise.all(d).then(function(){var e={buffer:l,width:o,height:n};return t&&t(e),e})})}function a(e,t){var o=t.element,n=cornerstoneTools.getToolState(o,"stack"),a=cornerstoneTools.getToolState(o,"regions");if(a&&a.data&&a.data.length){var r=n.data[0].currentImageIdIndex,i=a.data[0].buffer,l=t.canvasContext,s=t.enabledElement,u=t.image,d=u.width,f=u.height,g=document.createElement("canvas");g.width=d,g.height=f;for(var m=g.getContext("2d"),v=m.createImageData(d,f),h=v.data,p=d*f,T=r*p,C=new Uint8Array(i,T,p),y=0;y<C.length;y+=1){var b=C[y];if(b){var M=4*y,x=c[b-1];h[M+0]=x[0],h[M+1]=x[1],h[M+2]=x[2],h[M+3]=127.5}}m.putImageData(v,0,0),cornerstone.setToPixelCoordinateSystem(s,l),l.drawImage(g,0,0)}}function r(e){var t=(0,l.getToolState)(e,"stack");if(t&&t.data&&t.data.length){var o={enabled:1,buffer:null,width:null,height:null};(0,l.addToolState)(e,"regions",o);n(t.data[0],function(t){var o=(0,l.getToolState)(e,"regions");o.data[0].buffer=t.buffer,o.data[0].width=t.width,o.data[0].height=t.height,$(e).on("CornerstoneImageRendered",a),cornerstone.updateImage(e)})}}function i(e){var t=(0,l.getToolState)(e,"regions");t&&t.data.length&&(t.data[0].enabled=!1)}Object.defineProperty(t,"__esModule",{value:!0});var l=o(0),s=130,u=8,c=[[255,10,255],[255,100,100],[100,100,255],[100,255,255],[255,100,255]];t.default={activate:r,deactivate:i,enable:r,disable:i}},function(t,o){t.exports=e}])});
//# sourceMappingURL=cornerstoneTools.min.js.map